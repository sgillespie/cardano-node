<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass      #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric       #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia         #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase          #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving  #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications    #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies        #-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.Storage.VolatileDB.API</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- * API</span></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#VolatileDB"><span class="hs-identifier">VolatileDB</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Types</span></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#BlockInfo"><span class="hs-identifier">BlockInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Errors</span></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#ApiMisuse"><span class="hs-identifier">ApiMisuse</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#UnexpectedFailure"><span class="hs-identifier">UnexpectedFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#VolatileDBError"><span class="hs-identifier">VolatileDBError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Derived functionality</span></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#getIsMember"><span class="hs-identifier">getIsMember</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#getKnownBlockComponent"><span class="hs-identifier">getKnownBlockComponent</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#getPredecessor"><span class="hs-identifier">getPredecessor</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#withDB"><span class="hs-identifier">withDB</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Read</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CBOR</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.html"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lazy</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#isJust"><span class="hs-identifier">isJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.html"><span class="hs-identifier">Data.Typeable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier">Typeable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Word.html"><span class="hs-identifier">Data.Word</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word16"><span class="hs-identifier">Word16</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.html"><span class="hs-identifier">GHC.Stack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier">HasCallStack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">NoThunks.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">OnlyCheckWhnfNamed</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Block.html"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Storage.Common.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.Common</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.Common.html#BlockComponent"><span class="hs-identifier">BlockComponent</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.IOLike.html"><span class="hs-identifier">Ouroboros.Consensus.Util.IOLike</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Block</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MaxSlotNo</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.FS.API.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FsError</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">FsPath</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  API
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">data</span><span> </span><span id="VolatileDB"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#VolatileDB"><span class="hs-identifier hs-var">VolatileDB</span></a></span></span><span> </span><span id="local-6989586621679839247"><span class="annot"><a href="#local-6989586621679839247"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679839248"><span class="annot"><a href="#local-6989586621679839248"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="VolatileDB"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#VolatileDB"><span class="hs-identifier hs-var">VolatileDB</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-49"></span><span>      </span><span class="hs-comment">-- | Close the VolatileDB.</span><span>
</span><span id="line-50"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-51"></span><span>      </span><span class="hs-comment">-- NOTE: idempotent after a manual closure, but not after an automatic</span><span>
</span><span id="line-52"></span><span>      </span><span class="hs-comment">-- closure in case of an 'UnexpectedFailure'. In that case, closing it</span><span>
</span><span id="line-53"></span><span>      </span><span class="hs-comment">-- again will cause a 'ClosedDBError' wrapping the original</span><span>
</span><span id="line-54"></span><span>      </span><span class="hs-comment">-- 'UnexpectedFailure' to be thrown.</span><span>
</span><span id="line-55"></span><span>      </span><span id="closeDB"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk. VolatileDB m blk -&gt; HasCallStack =&gt; m ()
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#closeDB"><span class="hs-identifier hs-var hs-var">closeDB</span></a></span></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679839247"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>      </span><span class="hs-comment">-- | Return the request block component for the block with the given</span><span>
</span><span id="line-57"></span><span>      </span><span class="hs-comment">-- hash. When not in the VolatileDB, 'Nothing' is returned.</span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="getBlockComponent"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk.
VolatileDB m blk
-&gt; forall b.
   HasCallStack =&gt;
   BlockComponent blk b -&gt; HeaderHash blk -&gt; m (Maybe b)
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#getBlockComponent"><span class="hs-identifier hs-var hs-var">getBlockComponent</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679839253"><span class="annot"><a href="#local-6989586621679839253"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span>
</span><span id="line-59"></span><span>                          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.Common.html#BlockComponent"><span class="hs-identifier hs-type">BlockComponent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839248"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839253"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-60"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeaderHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839248"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-61"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679839247"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839253"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>      </span><span class="hs-comment">-- | Store the given block in the VolatileDB.</span><span>
</span><span id="line-63"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-64"></span><span>      </span><span class="hs-comment">-- Returns after the block has been written to disk.</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="putBlock"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk.
VolatileDB m blk -&gt; HasCallStack =&gt; blk -&gt; m ()
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#putBlock"><span class="hs-identifier hs-var hs-var">putBlock</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679839248"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679839247"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>      </span><span class="hs-comment">-- | Return a function that returns the successors of the block with the</span><span>
</span><span id="line-67"></span><span>      </span><span class="hs-comment">-- given hash.</span><span>
</span><span id="line-68"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-69"></span><span>      </span><span class="hs-comment">-- This function will return a non-empty set for any block of which a</span><span>
</span><span id="line-70"></span><span>      </span><span class="hs-comment">-- successor has been added to the VolatileDB and will return an empty</span><span>
</span><span id="line-71"></span><span>      </span><span class="hs-comment">-- set if no successors for the given block have been added to the</span><span>
</span><span id="line-72"></span><span>      </span><span class="hs-comment">-- VolatileDB (yet).</span><span>
</span><span id="line-73"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-74"></span><span>      </span><span class="hs-comment">-- Note that it is not required that the given block has been added to</span><span>
</span><span id="line-75"></span><span>      </span><span class="hs-comment">-- the VolatileDB.</span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="filterByPredecessor"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk.
VolatileDB m blk
-&gt; HasCallStack =&gt; STM m (ChainHash blk -&gt; Set (HeaderHash blk))
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#filterByPredecessor"><span class="hs-identifier hs-var hs-var">filterByPredecessor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679839247"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ChainHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839248"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HeaderHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839248"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>      </span><span class="hs-comment">-- | Return a function that returns the 'BlockInfo' of the block with</span><span>
</span><span id="line-78"></span><span>      </span><span class="hs-comment">-- the given hash or 'Nothing' if the block is not found in the</span><span>
</span><span id="line-79"></span><span>      </span><span class="hs-comment">-- VolatileDB.</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="getBlockInfo"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk.
VolatileDB m blk
-&gt; HasCallStack =&gt; STM m (HeaderHash blk -&gt; Maybe (BlockInfo blk))
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#getBlockInfo"><span class="hs-identifier hs-var hs-var">getBlockInfo</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679839247"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HeaderHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839248"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#BlockInfo"><span class="hs-identifier hs-type">BlockInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839248"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>      </span><span class="hs-comment">-- | Try to remove all blocks with a slot number less than the given</span><span>
</span><span id="line-82"></span><span>      </span><span class="hs-comment">-- one.</span><span>
</span><span id="line-83"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-84"></span><span>      </span><span class="hs-comment">-- = Context</span><span>
</span><span id="line-85"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-86"></span><span>      </span><span class="hs-comment">-- When the current chain changes, blocks older than @k@, i.e., blocks</span><span>
</span><span id="line-87"></span><span>      </span><span class="hs-comment">-- that are followed by @k@ blocks or more, become /immutable/. Whenever</span><span>
</span><span id="line-88"></span><span>      </span><span class="hs-comment">-- this happens, we schedule a garbage collection on the VolatileDB that</span><span>
</span><span id="line-89"></span><span>      </span><span class="hs-comment">-- will try to remove blocks older than the most recent immutable block,</span><span>
</span><span id="line-90"></span><span>      </span><span class="hs-comment">-- as such blocks will never be adopted. There's no point in storing</span><span>
</span><span id="line-91"></span><span>      </span><span class="hs-comment">-- them anymore.</span><span>
</span><span id="line-92"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-93"></span><span>      </span><span class="hs-comment">-- = Block number vs slot number</span><span>
</span><span id="line-94"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-95"></span><span>      </span><span class="hs-comment">-- While we typically talk in terms of /block numbers/ when discussing</span><span>
</span><span id="line-96"></span><span>      </span><span class="hs-comment">-- immutability, i.e., /@k@ blocks/, we use /slot number/ for garbage</span><span>
</span><span id="line-97"></span><span>      </span><span class="hs-comment">-- collection. We schedule a garbage collection for blocks with a /slot</span><span>
</span><span id="line-98"></span><span>      </span><span class="hs-comment">-- number/ less than the slot number of the immutable block, as opposed</span><span>
</span><span id="line-99"></span><span>      </span><span class="hs-comment">-- to the block number. The reason for this is that the VolatileDB is</span><span>
</span><span id="line-100"></span><span>      </span><span class="hs-comment">-- not aware of block numbers, only of slot numbers.</span><span>
</span><span id="line-101"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-102"></span><span>      </span><span class="hs-comment">-- By using slot numbers for garbage collection, we might not /yet/ have</span><span>
</span><span id="line-103"></span><span>      </span><span class="hs-comment">-- garbage collected some blocks that could never be adopted again and</span><span>
</span><span id="line-104"></span><span>      </span><span class="hs-comment">-- that we would have garbage collected when using block numbers. This</span><span>
</span><span id="line-105"></span><span>      </span><span class="hs-comment">-- is harmless. The opposite direction is more important and</span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-comment">-- problematic: garbage collecting a block that we might want to adopt</span><span>
</span><span id="line-107"></span><span>      </span><span class="hs-comment">-- after all. Say we have mistakenly garbage collected such a block, in</span><span>
</span><span id="line-108"></span><span>      </span><span class="hs-comment">-- that case the following would be true:</span><span>
</span><span id="line-109"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-110"></span><span>      </span><span class="hs-comment">-- 1. The block has a slot number older than the immutable block's slot</span><span>
</span><span id="line-111"></span><span>      </span><span class="hs-comment">--    number: otherwise we wouldn't have mistakenly garbage collected</span><span>
</span><span id="line-112"></span><span>      </span><span class="hs-comment">--    it.</span><span>
</span><span id="line-113"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-114"></span><span>      </span><span class="hs-comment">-- 2. The block has a block number greater than the immutable block's</span><span>
</span><span id="line-115"></span><span>      </span><span class="hs-comment">--    block number: otherwise we wouldn't want to adopt it, as it would</span><span>
</span><span id="line-116"></span><span>      </span><span class="hs-comment">--    have been older than @k@.</span><span>
</span><span id="line-117"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-118"></span><span>      </span><span class="hs-comment">-- 3. The block is a part of a fork fitting on the immutable block. As</span><span>
</span><span id="line-119"></span><span>      </span><span class="hs-comment">--    we cannot roll back this block, all forks we could ever adopt</span><span>
</span><span id="line-120"></span><span>      </span><span class="hs-comment">--    would have to go through this block.</span><span>
</span><span id="line-121"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-122"></span><span>      </span><span class="hs-comment">-- As slot numbers grow monotonically within a chain, all forks starting</span><span>
</span><span id="line-123"></span><span>      </span><span class="hs-comment">-- after the immutable block will only contain blocks with slot numbers</span><span>
</span><span id="line-124"></span><span>      </span><span class="hs-comment">-- greater (or equal to in case of EBBs) than the immutable block's slot</span><span>
</span><span id="line-125"></span><span>      </span><span class="hs-comment">-- number. This directly contradicts (1), so we will /never/ garbage</span><span>
</span><span id="line-126"></span><span>      </span><span class="hs-comment">-- collect a block that we might still want to adopt.</span><span>
</span><span id="line-127"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-128"></span><span>      </span><span class="hs-comment">-- = Less than vs. less than or equal to</span><span>
</span><span id="line-129"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-130"></span><span>      </span><span class="hs-comment">-- Note that we remove blocks with a slot number /less than/ the given</span><span>
</span><span id="line-131"></span><span>      </span><span class="hs-comment">-- slot number, but not /equal to/ it. In practice, this off-by-one</span><span>
</span><span id="line-132"></span><span>      </span><span class="hs-comment">-- difference will not matter in terms of disk space usage, because as</span><span>
</span><span id="line-133"></span><span>      </span><span class="hs-comment">-- soon as the chain grows again by at least one block, those blocks</span><span>
</span><span id="line-134"></span><span>      </span><span class="hs-comment">-- will be removed anyway. The reason for @&lt;@ opposed to @&lt;=@ is to</span><span>
</span><span id="line-135"></span><span>      </span><span class="hs-comment">-- avoid issues with /EBBs/, which have the same slot number as the</span><span>
</span><span id="line-136"></span><span>      </span><span class="hs-comment">-- block after it.</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="garbageCollect"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk.
VolatileDB m blk -&gt; HasCallStack =&gt; SlotNo -&gt; m ()
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#garbageCollect"><span class="hs-identifier hs-var hs-var">garbageCollect</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679839247"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Return the highest slot number ever stored by the VolatileDB.</span></span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="getMaxSlotNo"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk.
VolatileDB m blk -&gt; HasCallStack =&gt; STM m MaxSlotNo
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#getMaxSlotNo"><span class="hs-identifier hs-var hs-var">getMaxSlotNo</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679839247"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaxSlotNo</span></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679839469"><span id="local-6989586621679839475"><span id="local-6989586621679839480"><span class="annot"><span class="annottext">Context -&gt; VolatileDB m blk -&gt; IO (Maybe ThunkInfo)
Proxy (VolatileDB m blk) -&gt; String
(Context -&gt; VolatileDB m blk -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; VolatileDB m blk -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (VolatileDB m blk) -&gt; String)
-&gt; NoThunks (VolatileDB m blk)
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
forall (m :: * -&gt; *) blk.
Context -&gt; VolatileDB m blk -&gt; IO (Maybe ThunkInfo)
forall (m :: * -&gt; *) blk. Proxy (VolatileDB m blk) -&gt; String
$cnoThunks :: forall (m :: * -&gt; *) blk.
Context -&gt; VolatileDB m blk -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; VolatileDB m blk -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall (m :: * -&gt; *) blk.
Context -&gt; VolatileDB m blk -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; VolatileDB m blk -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: forall (m :: * -&gt; *) blk. Proxy (VolatileDB m blk) -&gt; String
showTypeOf :: Proxy (VolatileDB m blk) -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></span></span></span></span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OnlyCheckWhnfNamed</span></span><span> </span><span class="annot"><span class="hs-string">&quot;VolatileDB&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#VolatileDB"><span class="hs-identifier hs-type">VolatileDB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839247"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839248"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">{------------------------------------------------------------------------------
  Types
------------------------------------------------------------------------------}</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="annot"><span class="hs-comment">-- | The information that the user has to provide for each new block.</span></span><span>
</span><span id="line-148"></span><span class="hs-keyword">data</span><span> </span><span id="BlockInfo"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#BlockInfo"><span class="hs-identifier hs-var">BlockInfo</span></a></span></span><span> </span><span id="local-6989586621679839290"><span class="annot"><a href="#local-6989586621679839290"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BlockInfo"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#BlockInfo"><span class="hs-identifier hs-var">BlockInfo</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-149"></span><span>      </span><span id="biHash"><span class="annot"><span class="annottext">forall blk. BlockInfo blk -&gt; HeaderHash blk
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#biHash"><span class="hs-identifier hs-var hs-var">biHash</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HeaderHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839290"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="biSlotNo"><span class="annot"><span class="annottext">forall blk. BlockInfo blk -&gt; SlotNo
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#biSlotNo"><span class="hs-identifier hs-var hs-var">biSlotNo</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="biBlockNo"><span class="annot"><span class="annottext">forall blk. BlockInfo blk -&gt; BlockNo
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#biBlockNo"><span class="hs-identifier hs-var hs-var">biBlockNo</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">BlockNo</span></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="biPrevHash"><span class="annot"><span class="annottext">forall blk. BlockInfo blk -&gt; ChainHash blk
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#biPrevHash"><span class="hs-identifier hs-var hs-var">biPrevHash</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ChainHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839290"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="biIsEBB"><span class="annot"><span class="annottext">forall blk. BlockInfo blk -&gt; IsEBB
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#biIsEBB"><span class="hs-identifier hs-var hs-var">biIsEBB</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Ouroboros.Consensus.Block.EBB.html#IsEBB"><span class="hs-identifier hs-type">IsEBB</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="biHeaderOffset"><span class="annot"><span class="annottext">forall blk. BlockInfo blk -&gt; Word16
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#biHeaderOffset"><span class="hs-identifier hs-var hs-var">biHeaderOffset</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="biHeaderSize"><span class="annot"><span class="annottext">forall blk. BlockInfo blk -&gt; Word16
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#biHeaderSize"><span class="hs-identifier hs-var hs-var">biHeaderSize</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679839495"><span id="local-6989586621679839510"><span class="annot"><span class="annottext">BlockInfo blk -&gt; BlockInfo blk -&gt; Bool
(BlockInfo blk -&gt; BlockInfo blk -&gt; Bool)
-&gt; (BlockInfo blk -&gt; BlockInfo blk -&gt; Bool) -&gt; Eq (BlockInfo blk)
forall blk.
StandardHash blk =&gt;
BlockInfo blk -&gt; BlockInfo blk -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall blk.
StandardHash blk =&gt;
BlockInfo blk -&gt; BlockInfo blk -&gt; Bool
== :: BlockInfo blk -&gt; BlockInfo blk -&gt; Bool
$c/= :: forall blk.
StandardHash blk =&gt;
BlockInfo blk -&gt; BlockInfo blk -&gt; Bool
/= :: BlockInfo blk -&gt; BlockInfo blk -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679839517"><span id="local-6989586621679839534"><span id="local-6989586621679839538"><span class="annot"><span class="annottext">Int -&gt; BlockInfo blk -&gt; ShowS
[BlockInfo blk] -&gt; ShowS
BlockInfo blk -&gt; String
(Int -&gt; BlockInfo blk -&gt; ShowS)
-&gt; (BlockInfo blk -&gt; String)
-&gt; ([BlockInfo blk] -&gt; ShowS)
-&gt; Show (BlockInfo blk)
forall blk. StandardHash blk =&gt; Int -&gt; BlockInfo blk -&gt; ShowS
forall blk. StandardHash blk =&gt; [BlockInfo blk] -&gt; ShowS
forall blk. StandardHash blk =&gt; BlockInfo blk -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall blk. StandardHash blk =&gt; Int -&gt; BlockInfo blk -&gt; ShowS
showsPrec :: Int -&gt; BlockInfo blk -&gt; ShowS
$cshow :: forall blk. StandardHash blk =&gt; BlockInfo blk -&gt; String
show :: BlockInfo blk -&gt; String
$cshowList :: forall blk. StandardHash blk =&gt; [BlockInfo blk] -&gt; ShowS
showList :: [BlockInfo blk] -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679839543"><span id="local-6989586621679839545"><span class="annot"><span class="annottext">(forall x. BlockInfo blk -&gt; Rep (BlockInfo blk) x)
-&gt; (forall x. Rep (BlockInfo blk) x -&gt; BlockInfo blk)
-&gt; Generic (BlockInfo blk)
forall x. Rep (BlockInfo blk) x -&gt; BlockInfo blk
forall x. BlockInfo blk -&gt; Rep (BlockInfo blk) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall blk x. Rep (BlockInfo blk) x -&gt; BlockInfo blk
forall blk x. BlockInfo blk -&gt; Rep (BlockInfo blk) x
$cfrom :: forall blk x. BlockInfo blk -&gt; Rep (BlockInfo blk) x
from :: forall x. BlockInfo blk -&gt; Rep (BlockInfo blk) x
$cto :: forall blk x. Rep (BlockInfo blk) x -&gt; BlockInfo blk
to :: forall x. Rep (BlockInfo blk) x -&gt; BlockInfo blk
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679839551"><span id="local-6989586621679839555"><span id="local-6989586621679839561"><span class="annot"><span class="annottext">Context -&gt; BlockInfo blk -&gt; IO (Maybe ThunkInfo)
Proxy (BlockInfo blk) -&gt; String
(Context -&gt; BlockInfo blk -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; BlockInfo blk -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (BlockInfo blk) -&gt; String)
-&gt; NoThunks (BlockInfo blk)
forall blk.
(StandardHash blk, Typeable blk) =&gt;
Context -&gt; BlockInfo blk -&gt; IO (Maybe ThunkInfo)
forall blk.
(StandardHash blk, Typeable blk) =&gt;
Proxy (BlockInfo blk) -&gt; String
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
$cnoThunks :: forall blk.
(StandardHash blk, Typeable blk) =&gt;
Context -&gt; BlockInfo blk -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; BlockInfo blk -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall blk.
(StandardHash blk, Typeable blk) =&gt;
Context -&gt; BlockInfo blk -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; BlockInfo blk -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: forall blk.
(StandardHash blk, Typeable blk) =&gt;
Proxy (BlockInfo blk) -&gt; String
showTypeOf :: Proxy (BlockInfo blk) -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">{------------------------------------------------------------------------------
  Errors
------------------------------------------------------------------------------}</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="annot"><span class="hs-comment">-- | Errors which might arise when working with this database.</span></span><span>
</span><span id="line-164"></span><span class="hs-keyword">data</span><span> </span><span id="VolatileDBError"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#VolatileDBError"><span class="hs-identifier hs-var">VolatileDBError</span></a></span></span><span> </span><span id="local-6989586621679839429"><span class="annot"><a href="#local-6989586621679839429"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-comment">-- | An error thrown because of incorrect usage of the VolatileDB</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-comment">-- by the user.</span><span>
</span><span id="line-167"></span><span>    </span><span id="ApiMisuse"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#ApiMisuse"><span class="hs-identifier hs-var">ApiMisuse</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#ApiMisuse"><span class="hs-identifier hs-type">ApiMisuse</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><span class="hs-comment">-- | An unexpected failure thrown because something went wrong.</span></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="UnexpectedFailure"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#UnexpectedFailure"><span class="hs-identifier hs-var">UnexpectedFailure</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#UnexpectedFailure"><span class="hs-identifier hs-type">UnexpectedFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839429"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span id="local-6989586621679839362"><span id="local-6989586621679839636"><span id="local-6989586621679839644"><span id="local-6989586621679839648"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StandardHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839362"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839362"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#VolatileDBError"><span class="hs-identifier hs-type">VolatileDBError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839362"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679839367"><span id="local-6989586621679839658"><span id="local-6989586621679839662"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StandardHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839367"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839367"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#Exception"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#VolatileDBError"><span class="hs-identifier hs-type">VolatileDBError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839367"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-175"></span><span>  </span><span id="local-6989586621679839668"><span class="annot"><span class="annottext">displayException :: VolatileDBError blk -&gt; String
</span><a href="#local-6989586621679839668"><span class="hs-identifier hs-var hs-var hs-var hs-var">displayException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-176"></span><span>      </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#ApiMisuse"><span class="hs-identifier hs-type">ApiMisuse</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;VolatileDB incorrectly used, indicative of a bug&quot;</span></span><span>
</span><span id="line-178"></span><span>      </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#UnexpectedFailure"><span class="hs-identifier hs-type">UnexpectedFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#FileSystemError"><span class="hs-identifier hs-type">FileSystemError</span></a></span><span> </span><span id="local-6989586621679839671"><span class="annot"><span class="annottext">FsError
</span><a href="#local-6989586621679839671"><span class="hs-identifier hs-var">fse</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-179"></span><span>        </span><span class="annot"><span class="annottext">FsError -&gt; String
forall e. Exception e =&gt; e -&gt; String
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#displayException"><span class="hs-identifier hs-var">displayException</span></a></span><span> </span><span class="annot"><span class="annottext">FsError
</span><a href="#local-6989586621679839671"><span class="hs-identifier hs-var">fse</span></a></span><span>
</span><span id="line-180"></span><span>      </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#UnexpectedFailure"><span class="hs-identifier hs-type">UnexpectedFailure</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-181"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The VolatileDB got corrupted, full validation will be enabled for the next startup&quot;</span></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-keyword">newtype</span><span> </span><span id="ApiMisuse"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#ApiMisuse"><span class="hs-identifier hs-var">ApiMisuse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-comment">-- | The VolatileDB was closed. In case it was automatically closed</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-comment">-- because an unexpected error was thrown during a read operation or any</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-comment">-- exception was thrown during a write operation, that exception is</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-comment">-- embedded.</span><span>
</span><span id="line-188"></span><span>    </span><span id="ClosedDBError"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#ClosedDBError"><span class="hs-identifier hs-var">ClosedDBError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679839673"><span id="local-6989586621679839679"><span id="local-6989586621679839682"><span class="annot"><span class="annottext">Int -&gt; ApiMisuse -&gt; ShowS
[ApiMisuse] -&gt; ShowS
ApiMisuse -&gt; String
(Int -&gt; ApiMisuse -&gt; ShowS)
-&gt; (ApiMisuse -&gt; String)
-&gt; ([ApiMisuse] -&gt; ShowS)
-&gt; Show ApiMisuse
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; ApiMisuse -&gt; ShowS
showsPrec :: Int -&gt; ApiMisuse -&gt; ShowS
$cshow :: ApiMisuse -&gt; String
show :: ApiMisuse -&gt; String
$cshowList :: [ApiMisuse] -&gt; ShowS
showList :: [ApiMisuse] -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-keyword">data</span><span> </span><span id="UnexpectedFailure"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#UnexpectedFailure"><span class="hs-identifier hs-var">UnexpectedFailure</span></a></span></span><span> </span><span id="local-6989586621679839430"><span class="annot"><a href="#local-6989586621679839430"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-192"></span><span>    </span><span id="FileSystemError"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#FileSystemError"><span class="hs-identifier hs-var">FileSystemError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FsError</span></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><span class="hs-comment">-- | A block failed to parse</span></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ParseError"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#ParseError"><span class="hs-identifier hs-var">ParseError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FsPath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Block.RealPoint.html#RealPoint"><span class="hs-identifier hs-type">RealPoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839430"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.DeserialiseFailure</span></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="hs-comment">-- | When parsing a block we got some trailing data</span></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TrailingDataError"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#TrailingDataError"><span class="hs-identifier hs-var">TrailingDataError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FsPath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Block.RealPoint.html#RealPoint"><span class="hs-identifier hs-type">RealPoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839430"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">Lazy.ByteString</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-comment">-- | Block missing</span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-comment">-- This exception gets thrown when a block that we /know/ it should be in</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-comment">-- the VolatileDB, nonetheless was not found.</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-comment">-- This exception will be thrown by @getKnownBlockComponent@.</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MissingBlockError"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#MissingBlockError"><span class="hs-identifier hs-var">MissingBlockError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HeaderHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839430"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-comment">-- | A (parsed) block did not pass the integrity check.</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-comment">-- This exception gets thrown when a block doesn't pass the integrity check</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-comment">-- done for 'GetVerifiedBlock'.</span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-comment">-- NOTE: we do not check the integrity of a block when it is added to the</span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-comment">-- VolatileDB. While this exception typically means the block has been</span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-comment">-- corrupted, it could also mean the block didn't pass the check at the time</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-comment">-- it was added.</span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CorruptBlockError"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#CorruptBlockError"><span class="hs-identifier hs-var">CorruptBlockError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HeaderHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839430"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span id="local-6989586621679839361"><span id="local-6989586621679839693"><span id="local-6989586621679839715"><span id="local-6989586621679839718"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839361"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StandardHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839361"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#UnexpectedFailure"><span class="hs-identifier hs-type">UnexpectedFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839361"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Derived functionality
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-comment">-- | Open the database using the given function, perform the given action</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- using the database, and closes the database using its 'closeDB' function,</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- in case of success or when an exception was raised.</span><span>
</span><span id="line-228"></span><span id="local-6989586621679839376"><span id="local-6989586621679839378"><span id="local-6989586621679839379"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#withDB"><span class="hs-identifier hs-type">withDB</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-229"></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679839376"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679839376"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#VolatileDB"><span class="hs-identifier hs-type">VolatileDB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839376"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839378"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ How to open the database</span></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#VolatileDB"><span class="hs-identifier hs-type">VolatileDB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839376"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839378"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679839376"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839379"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Action to perform using the database</span></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679839376"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839379"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-235"></span><span id="withDB"><span class="annot"><span class="annottext">withDB :: forall (m :: * -&gt; *) blk a.
(HasCallStack, MonadThrow m) =&gt;
m (VolatileDB m blk) -&gt; (VolatileDB m blk -&gt; m a) -&gt; m a
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#withDB"><span class="hs-identifier hs-var hs-var">withDB</span></a></span></span><span> </span><span id="local-6989586621679839725"><span class="annot"><span class="annottext">m (VolatileDB m blk)
</span><a href="#local-6989586621679839725"><span class="hs-identifier hs-var">openDB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (VolatileDB m blk)
-&gt; (VolatileDB m blk -&gt; m ()) -&gt; (VolatileDB m blk -&gt; m a) -&gt; m a
forall a b c. m a -&gt; (a -&gt; m b) -&gt; (a -&gt; m c) -&gt; m c
forall (m :: * -&gt; *) a b c.
MonadThrow m =&gt;
m a -&gt; (a -&gt; m b) -&gt; (a -&gt; m c) -&gt; m c
</span><span class="hs-identifier hs-var">bracket</span></span><span> </span><span class="annot"><span class="annottext">m (VolatileDB m blk)
</span><a href="#local-6989586621679839725"><span class="hs-identifier hs-var">openDB</span></a></span><span> </span><span class="annot"><span class="annottext">VolatileDB m blk -&gt; m ()
VolatileDB m blk -&gt; HasCallStack =&gt; m ()
forall (m :: * -&gt; *) blk. VolatileDB m blk -&gt; HasCallStack =&gt; m ()
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#closeDB"><span class="hs-identifier hs-var">closeDB</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span id="local-6989586621679839387"><span id="local-6989586621679839388"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#getIsMember"><span class="hs-identifier hs-type">getIsMember</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-238"></span><span>     </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Functor"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679839387"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#VolatileDB"><span class="hs-identifier hs-type">VolatileDB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839387"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839388"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679839387"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HeaderHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839388"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-241"></span><span id="getIsMember"><span class="annot"><span class="annottext">getIsMember :: forall (m :: * -&gt; *) blk.
Functor (STM m) =&gt;
VolatileDB m blk -&gt; STM m (HeaderHash blk -&gt; Bool)
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#getIsMember"><span class="hs-identifier hs-var hs-var">getIsMember</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((HeaderHash blk -&gt; Maybe (BlockInfo blk))
 -&gt; HeaderHash blk -&gt; Bool)
-&gt; STM m (HeaderHash blk -&gt; Maybe (BlockInfo blk))
-&gt; STM m (HeaderHash blk -&gt; Bool)
forall a b. (a -&gt; b) -&gt; STM m a -&gt; STM m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (BlockInfo blk) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (BlockInfo blk) -&gt; Bool)
-&gt; (HeaderHash blk -&gt; Maybe (BlockInfo blk))
-&gt; HeaderHash blk
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(STM m (HeaderHash blk -&gt; Maybe (BlockInfo blk))
 -&gt; STM m (HeaderHash blk -&gt; Bool))
-&gt; (VolatileDB m blk
    -&gt; STM m (HeaderHash blk -&gt; Maybe (BlockInfo blk)))
-&gt; VolatileDB m blk
-&gt; STM m (HeaderHash blk -&gt; Bool)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">VolatileDB m blk -&gt; STM m (HeaderHash blk -&gt; Maybe (BlockInfo blk))
VolatileDB m blk
-&gt; HasCallStack =&gt; STM m (HeaderHash blk -&gt; Maybe (BlockInfo blk))
forall (m :: * -&gt; *) blk.
VolatileDB m blk
-&gt; HasCallStack =&gt; STM m (HeaderHash blk -&gt; Maybe (BlockInfo blk))
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#getBlockInfo"><span class="hs-identifier hs-var">getBlockInfo</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span id="local-6989586621679839398"><span id="local-6989586621679839399"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#getPredecessor"><span class="hs-identifier hs-type">getPredecessor</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-244"></span><span>     </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Functor"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679839398"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#VolatileDB"><span class="hs-identifier hs-type">VolatileDB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839398"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839399"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679839398"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HeaderHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839399"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ChainHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839399"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-247"></span><span id="getPredecessor"><span class="annot"><span class="annottext">getPredecessor :: forall (m :: * -&gt; *) blk.
Functor (STM m) =&gt;
VolatileDB m blk -&gt; STM m (HeaderHash blk -&gt; Maybe (ChainHash blk))
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#getPredecessor"><span class="hs-identifier hs-var hs-var">getPredecessor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((HeaderHash blk -&gt; Maybe (BlockInfo blk))
 -&gt; HeaderHash blk -&gt; Maybe (ChainHash blk))
-&gt; STM m (HeaderHash blk -&gt; Maybe (BlockInfo blk))
-&gt; STM m (HeaderHash blk -&gt; Maybe (ChainHash blk))
forall a b. (a -&gt; b) -&gt; STM m a -&gt; STM m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BlockInfo blk -&gt; ChainHash blk)
-&gt; Maybe (BlockInfo blk) -&gt; Maybe (ChainHash blk)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">BlockInfo blk -&gt; ChainHash blk
forall blk. BlockInfo blk -&gt; ChainHash blk
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#biPrevHash"><span class="hs-identifier hs-var">biPrevHash</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (BlockInfo blk) -&gt; Maybe (ChainHash blk))
-&gt; (HeaderHash blk -&gt; Maybe (BlockInfo blk))
-&gt; HeaderHash blk
-&gt; Maybe (ChainHash blk)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(STM m (HeaderHash blk -&gt; Maybe (BlockInfo blk))
 -&gt; STM m (HeaderHash blk -&gt; Maybe (ChainHash blk)))
-&gt; (VolatileDB m blk
    -&gt; STM m (HeaderHash blk -&gt; Maybe (BlockInfo blk)))
-&gt; VolatileDB m blk
-&gt; STM m (HeaderHash blk -&gt; Maybe (ChainHash blk))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">VolatileDB m blk -&gt; STM m (HeaderHash blk -&gt; Maybe (BlockInfo blk))
VolatileDB m blk
-&gt; HasCallStack =&gt; STM m (HeaderHash blk -&gt; Maybe (BlockInfo blk))
forall (m :: * -&gt; *) blk.
VolatileDB m blk
-&gt; HasCallStack =&gt; STM m (HeaderHash blk -&gt; Maybe (BlockInfo blk))
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#getBlockInfo"><span class="hs-identifier hs-var">getBlockInfo</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span id="local-6989586621679839402"><span id="local-6989586621679839403"><span id="local-6989586621679839405"><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#getKnownBlockComponent"><span class="hs-identifier hs-type">getKnownBlockComponent</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-250"></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679839402"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasHeader</span></span><span> </span><span class="annot"><a href="#local-6989586621679839403"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#VolatileDB"><span class="hs-identifier hs-type">VolatileDB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839402"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839403"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.Common.html#BlockComponent"><span class="hs-identifier hs-type">BlockComponent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839403"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839405"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeaderHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839403"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679839402"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839405"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-255"></span><span id="getKnownBlockComponent"><span class="annot"><span class="annottext">getKnownBlockComponent :: forall (m :: * -&gt; *) blk b.
(MonadThrow m, HasHeader blk) =&gt;
VolatileDB m blk -&gt; BlockComponent blk b -&gt; HeaderHash blk -&gt; m b
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#getKnownBlockComponent"><span class="hs-identifier hs-var hs-var">getKnownBlockComponent</span></a></span></span><span> </span><span id="local-6989586621679839757"><span class="annot"><span class="annottext">VolatileDB m blk
</span><a href="#local-6989586621679839757"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621679839758"><span class="annot"><span class="annottext">BlockComponent blk b
</span><a href="#local-6989586621679839758"><span class="hs-identifier hs-var">blockComponent</span></a></span></span><span> </span><span id="local-6989586621679839759"><span class="annot"><span class="annottext">HeaderHash blk
</span><a href="#local-6989586621679839759"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-256"></span><span>    </span><span id="local-6989586621679839760"><span class="annot"><span class="annottext">Either (VolatileDBError blk) b
</span><a href="#local-6989586621679839760"><span class="hs-identifier hs-var">mBlock</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VolatileDB m blk
-&gt; HeaderHash blk -&gt; Maybe b -&gt; Either (VolatileDBError blk) b
forall (proxy :: * -&gt; *) blk b.
proxy blk
-&gt; HeaderHash blk -&gt; Maybe b -&gt; Either (VolatileDBError blk) b
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#mustExist"><span class="hs-identifier hs-var">mustExist</span></a></span><span> </span><span class="annot"><span class="annottext">VolatileDB m blk
</span><a href="#local-6989586621679839757"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderHash blk
</span><a href="#local-6989586621679839759"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe b -&gt; Either (VolatileDBError blk) b)
-&gt; m (Maybe b) -&gt; m (Either (VolatileDBError blk) b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-257"></span><span>      </span><span class="annot"><span class="annottext">VolatileDB m blk
-&gt; forall b.
   HasCallStack =&gt;
   BlockComponent blk b -&gt; HeaderHash blk -&gt; m (Maybe b)
forall (m :: * -&gt; *) blk.
VolatileDB m blk
-&gt; forall b.
   HasCallStack =&gt;
   BlockComponent blk b -&gt; HeaderHash blk -&gt; m (Maybe b)
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#getBlockComponent"><span class="hs-identifier hs-var">getBlockComponent</span></a></span><span> </span><span class="annot"><span class="annottext">VolatileDB m blk
</span><a href="#local-6989586621679839757"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">BlockComponent blk b
</span><a href="#local-6989586621679839758"><span class="hs-identifier hs-var">blockComponent</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderHash blk
</span><a href="#local-6989586621679839759"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (VolatileDBError blk) b
</span><a href="#local-6989586621679839760"><span class="hs-identifier hs-var">mBlock</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-259"></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679839763"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679839763"><span class="hs-identifier hs-var">b</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; m b
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679839763"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-260"></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679839764"><span class="annot"><span class="annottext">VolatileDBError blk
</span><a href="#local-6989586621679839764"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VolatileDBError blk -&gt; m b
forall e a. Exception e =&gt; e -&gt; m a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">VolatileDBError blk
</span><a href="#local-6989586621679839764"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#mustExist"><span class="hs-identifier hs-type">mustExist</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-263"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679839412"><span class="annot"><a href="#local-6989586621679839412"><span class="hs-identifier hs-type">proxy</span></a></span></span><span> </span><span id="local-6989586621679839413"><span class="annot"><a href="#local-6989586621679839413"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span id="local-6989586621679839414"><span class="annot"><a href="#local-6989586621679839414"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-264"></span><span>     </span><span class="annot"><a href="#local-6989586621679839412"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839413"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeaderHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679839413"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839414"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#VolatileDBError"><span class="hs-identifier hs-type">VolatileDBError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679839413"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679839414"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-268"></span><span id="mustExist"><span class="annot"><span class="annottext">mustExist :: forall (proxy :: * -&gt; *) blk b.
proxy blk
-&gt; HeaderHash blk -&gt; Maybe b -&gt; Either (VolatileDBError blk) b
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#mustExist"><span class="hs-identifier hs-var hs-var">mustExist</span></a></span></span><span> </span><span class="annot"><span class="annottext">proxy blk
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679839766"><span class="annot"><span class="annottext">HeaderHash blk
</span><a href="#local-6989586621679839766"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><span class="annottext">Maybe b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VolatileDBError blk -&gt; Either (VolatileDBError blk) b
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span>  </span><span class="annot"><span class="annottext">(VolatileDBError blk -&gt; Either (VolatileDBError blk) b)
-&gt; VolatileDBError blk -&gt; Either (VolatileDBError blk) b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnexpectedFailure blk -&gt; VolatileDBError blk
forall blk. UnexpectedFailure blk -&gt; VolatileDBError blk
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#UnexpectedFailure"><span class="hs-identifier hs-var">UnexpectedFailure</span></a></span><span> </span><span class="annot"><span class="annottext">(UnexpectedFailure blk -&gt; VolatileDBError blk)
-&gt; UnexpectedFailure blk -&gt; VolatileDBError blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall blk. HeaderHash blk -&gt; UnexpectedFailure blk
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.API.html#MissingBlockError"><span class="hs-identifier hs-var">MissingBlockError</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679839413"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderHash blk
</span><a href="#local-6989586621679839766"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679839767"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679839767"><span class="hs-identifier hs-var">b</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; Either (VolatileDBError blk) b
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; Either (VolatileDBError blk) b)
-&gt; b -&gt; Either (VolatileDBError blk) b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679839767"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-271"></span></pre></body></html>