<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Ouroboros.Consensus.Util.AnchoredFragment</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ouroboros-consensus-0.15.0.0: Consensus layer for the Ouroboros blockchain protocol</span><ul class="links" id="page-menu"><li id="quick-jump-button"><a href="#">Quick Jump</a></li><li><a href="src/Ouroboros.Consensus.Util.AnchoredFragment.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Ouroboros.Consensus.Util.AnchoredFragment</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Utility functions on anchored fragments</p><p>Intended for qualified import
 &gt; import qualified Ouroboros.Consensus.Util.AnchoredFragment as AF</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:compareAnchoredFragments">compareAnchoredFragments</a> :: <span class="keyword">forall</span> blk. (<a href="Ouroboros-Consensus-Block-SupportsProtocol.html#t:BlockSupportsProtocol" title="Ouroboros.Consensus.Block.SupportsProtocol">BlockSupportsProtocol</a> blk, <a href="Ouroboros-Consensus-Util-CallStack.html#t:HasCallStack" title="Ouroboros.Consensus.Util.CallStack">HasCallStack</a>) =&gt; <a href="Ouroboros-Consensus-Block-Abstract.html#t:BlockConfig" title="Ouroboros.Consensus.Block.Abstract">BlockConfig</a> blk -&gt; AnchoredFragment (<a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk) -&gt; AnchoredFragment (<a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk) -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ordering" title="Data.Ord">Ordering</a></li><li class="src short"><a href="#v:compareHeadBlockNo">compareHeadBlockNo</a> :: <a href="Ouroboros-Consensus-Block-Abstract.html#t:HasHeader" title="Ouroboros.Consensus.Block.Abstract">HasHeader</a> b =&gt; AnchoredFragment b -&gt; AnchoredFragment b -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ordering" title="Data.Ord">Ordering</a></li><li class="src short"><a href="#v:forksAtMostKBlocks">forksAtMostKBlocks</a> :: <a href="Ouroboros-Consensus-Block-Abstract.html#t:HasHeader" title="Ouroboros.Consensus.Block.Abstract">HasHeader</a> b =&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a> -&gt; AnchoredFragment b -&gt; AnchoredFragment b -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li class="src short"><a href="#v:preferAnchoredCandidate">preferAnchoredCandidate</a> :: <span class="keyword">forall</span> blk. (<a href="Ouroboros-Consensus-Block-SupportsProtocol.html#t:BlockSupportsProtocol" title="Ouroboros.Consensus.Block.SupportsProtocol">BlockSupportsProtocol</a> blk, <a href="Ouroboros-Consensus-Util-CallStack.html#t:HasCallStack" title="Ouroboros.Consensus.Util.CallStack">HasCallStack</a>) =&gt; <a href="Ouroboros-Consensus-Block-Abstract.html#t:BlockConfig" title="Ouroboros.Consensus.Block.Abstract">BlockConfig</a> blk -&gt; AnchoredFragment (<a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk) -&gt; AnchoredFragment (<a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk) -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:compareAnchoredFragments" class="def">compareAnchoredFragments</a> :: <span class="keyword">forall</span> blk. (<a href="Ouroboros-Consensus-Block-SupportsProtocol.html#t:BlockSupportsProtocol" title="Ouroboros.Consensus.Block.SupportsProtocol">BlockSupportsProtocol</a> blk, <a href="Ouroboros-Consensus-Util-CallStack.html#t:HasCallStack" title="Ouroboros.Consensus.Util.CallStack">HasCallStack</a>) =&gt; <a href="Ouroboros-Consensus-Block-Abstract.html#t:BlockConfig" title="Ouroboros.Consensus.Block.Abstract">BlockConfig</a> blk -&gt; AnchoredFragment (<a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk) -&gt; AnchoredFragment (<a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk) -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ordering" title="Data.Ord">Ordering</a> <a href="src/Ouroboros.Consensus.Util.AnchoredFragment.html#compareAnchoredFragments" class="link">Source</a> <a href="#v:compareAnchoredFragments" class="selflink">#</a></p><div class="doc"><p>Compare two (potentially empty!) <code>AnchoredFragment</code>s.</p><p>PRECONDITION: Either both fragments are non-empty or they intersect.</p><p>For a detailed discussion of this precondition, and a justification for the
 definition of this function, please refer to the Consensus Report.</p><p>Usage note: the primary user of this function is the chain database. It
 establishes the precondition in two different ways:</p><ul><li>When comparing a candidate fragment to our current chain, the fragment is
   guaranteed (by the chain sync client) to intersect with our chain (indeed,
   within at most <code>k</code> blocks from our tip, although the exact distance does
   not matter for <code><a href="Ouroboros-Consensus-Util-AnchoredFragment.html#v:compareAnchoredFragments" title="Ouroboros.Consensus.Util.AnchoredFragment">compareAnchoredFragments</a></code>).</li><li>It will only compare candidate fragments that it has previously verified
   are preferable to our current chain. Since these fragments intersect with
   our current chain, they must by transitivity also intersect each other.</li></ul></div></div><div class="top"><p class="src"><a id="v:compareHeadBlockNo" class="def">compareHeadBlockNo</a> :: <a href="Ouroboros-Consensus-Block-Abstract.html#t:HasHeader" title="Ouroboros.Consensus.Block.Abstract">HasHeader</a> b =&gt; AnchoredFragment b -&gt; AnchoredFragment b -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ordering" title="Data.Ord">Ordering</a> <a href="src/Ouroboros.Consensus.Util.AnchoredFragment.html#compareHeadBlockNo" class="link">Source</a> <a href="#v:compareHeadBlockNo" class="selflink">#</a></p><div class="doc"><p>Compare the <code>headBlockNo</code>, which is a measure of the length of the chain,
 of two anchored fragments.</p><p>A fragment with a head is always &quot;greater&quot; than one without. When both
 fragments have no head (i.e. are empty), they are <code><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#v:EQ" title="Data.Ord">EQ</a></code>.</p><p>Note that an EBB can share its <code>BlockNo</code> with another regular block. If
 such an EBB is the head of one fragment and the regular block with the same
 <code>BlockNo</code> is the head of the other fragment, then this function will say
 they are <code><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#v:EQ" title="Data.Ord">EQ</a></code>, while in fact one fragment should be preferred over the
 other.</p><p>This is not a big deal as we won't be seeing new EBBs, so they will not be
 the head of a fragment very often anyway, only when catching up. As soon as
 a new block/header is added to the fragment, the right decision will be
 made again (<code><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#v:GT" title="Data.Ord">GT</a></code> or <code><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#v:LT" title="Data.Ord">LT</a></code>).</p></div></div><div class="top"><p class="src"><a id="v:forksAtMostKBlocks" class="def">forksAtMostKBlocks</a> <a href="src/Ouroboros.Consensus.Util.AnchoredFragment.html#forksAtMostKBlocks" class="link">Source</a> <a href="#v:forksAtMostKBlocks" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Ouroboros-Consensus-Block-Abstract.html#t:HasHeader" title="Ouroboros.Consensus.Block.Abstract">HasHeader</a> b</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a></td><td class="doc"><p>How many blocks can it fork?</p></td></tr><tr><td class="src">-&gt; AnchoredFragment b</td><td class="doc"><p>Our chain.</p></td></tr><tr><td class="src">-&gt; AnchoredFragment b</td><td class="doc"><p>Their chain</p></td></tr><tr><td class="src">-&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></td><td class="doc"><p>Indicates whether their chain forks at most the
 specified number of blocks.</p></td></tr></table></div></div><div class="top"><p class="src"><a id="v:preferAnchoredCandidate" class="def">preferAnchoredCandidate</a> <a href="src/Ouroboros.Consensus.Util.AnchoredFragment.html#preferAnchoredCandidate" class="link">Source</a> <a href="#v:preferAnchoredCandidate" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <span class="keyword">forall</span> blk. (<a href="Ouroboros-Consensus-Block-SupportsProtocol.html#t:BlockSupportsProtocol" title="Ouroboros.Consensus.Block.SupportsProtocol">BlockSupportsProtocol</a> blk, <a href="Ouroboros-Consensus-Util-CallStack.html#t:HasCallStack" title="Ouroboros.Consensus.Util.CallStack">HasCallStack</a>)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Ouroboros-Consensus-Block-Abstract.html#t:BlockConfig" title="Ouroboros.Consensus.Block.Abstract">BlockConfig</a> blk</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; AnchoredFragment (<a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk)</td><td class="doc"><p>Our chain</p></td></tr><tr><td class="src">-&gt; AnchoredFragment (<a href="Ouroboros-Consensus-Block-Abstract.html#t:Header" title="Ouroboros.Consensus.Block.Abstract">Header</a> blk)</td><td class="doc"><p>Candidate</p></td></tr><tr><td class="src">-&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Lift <code>preferCandidate</code> to <code>AnchoredFragment</code></p><p>See discussion for <code><a href="Ouroboros-Consensus-Util-AnchoredFragment.html#v:compareAnchoredFragments" title="Ouroboros.Consensus.Util.AnchoredFragment">compareAnchoredFragments</a></code>.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.1</p></div></body></html>