<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP                        #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds                  #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies         #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts           #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase                 #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings          #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskellQuotes      #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications           #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies               #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators              #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns               #-}</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-comment">-- Due to CPP</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-unused-matches #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-unused-imports #-}</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- For some reason this module is very slow to compile otherwise</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# OPTIONS_GHC -O0 #-}</span><span>
</span><span id="line-19"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusTx.Plugin</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.Plugin.html#plugin"><span class="hs-identifier">plugin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">plc</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Bifunctor.html"><span class="hs-identifier">Data.Bifunctor</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusPrelude</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.Code</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusTx.Compiler.Builtins.html"><span class="hs-identifier">PlutusTx.Compiler.Builtins</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusTx.Compiler.Error.html"><span class="hs-identifier">PlutusTx.Compiler.Error</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusTx.Compiler.Expr.html"><span class="hs-identifier">PlutusTx.Compiler.Expr</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusTx.Compiler.Trace.html"><span class="hs-identifier">PlutusTx.Compiler.Trace</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusTx.Compiler.Types.html"><span class="hs-identifier">PlutusTx.Compiler.Types</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusTx.Compiler.Utils.html"><span class="hs-identifier">PlutusTx.Compiler.Utils</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.Coverage</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusTx.PIRTypes.html"><span class="hs-identifier">PlutusTx.PIRTypes</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusTx.PLCTypes.html"><span class="hs-identifier">PlutusTx.PLCTypes</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.Plugin.Utils</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.Trace</span></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.ByteCode.Types.html"><span class="hs-identifier">GHC.ByteCode.Types</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.html"><span class="hs-identifier">GHC</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Coercion.Opt.html"><span class="hs-identifier">GHC.Core.Coercion.Opt</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.html"><span class="hs-identifier">GHC</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.html"><span class="hs-identifier">GHC</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Arity.html"><span class="hs-identifier">GHC.Core.Opt.Arity</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.html"><span class="hs-identifier">GHC</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.OccurAnal.html"><span class="hs-identifier">GHC.Core.Opt.OccurAnal</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.html"><span class="hs-identifier">GHC</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Simplify.html"><span class="hs-identifier">GHC.Core.Opt.Simplify</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.html"><span class="hs-identifier">GHC</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Simplify.Env.html"><span class="hs-identifier">GHC.Core.Opt.Simplify.Env</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.html"><span class="hs-identifier">GHC</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Simplify.Monad.html"><span class="hs-identifier">GHC.Core.Opt.Simplify.Monad</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.html"><span class="hs-identifier">GHC</span></a></span><span class="hs-cpp">
#if MIN_VERSION_ghc(9,6,0)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Rules.Config.html"><span class="hs-identifier">GHC.Core.Rules.Config</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.html"><span class="hs-identifier">GHC</span></a></span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Unfold.html"><span class="hs-identifier">GHC.Core.Unfold</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.html"><span class="hs-identifier">GHC</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Plugins.html"><span class="hs-identifier">GHC.Plugins</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.html"><span class="hs-identifier">GHC</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Types.TyThing.html"><span class="hs-identifier">GHC.Types.TyThing</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.html"><span class="hs-identifier">GHC</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.html"><span class="hs-identifier">GHC</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore.Compiler</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore.Pretty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore.Quote</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusCore.Version</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UntypedPlutusCore</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UPLC</span></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusIR</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PIR</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusIR.Compiler</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PIR</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusIR.Compiler.Definitions</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PIR</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusTx.Options.html"><span class="hs-identifier">PlutusTx.Options</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html"><span class="hs-identifier">Language.Haskell.TH.Syntax</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#lift"><span class="hs-identifier">lift</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Exception.html"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#throwIO"><span class="hs-identifier">throwIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Except.html"><span class="hs-identifier">Control.Monad.Except</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Reader.html"><span class="hs-identifier">Control.Monad.Reader</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.State.html"><span class="hs-identifier">Control.Monad.State</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Writer.html"><span class="hs-identifier">Control.Monad.Writer</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Flat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Flat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">flat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unflat</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Unsafe.html"><span class="hs-identifier">Data.ByteString.Unsafe</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BSUnsafe</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either.Validation</span></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-bignum-1.3/src/GHC.Num.Integer.html"><span class="hs-identifier">GHC.Num.Integer</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusIR.Analysis.Builtins</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusIR.Compiler.Provenance</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">noProvenance</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">original</span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusIR.Transform.RewriteRules</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prettyprinter</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PP</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/System.IO.html"><span class="hs-identifier">System.IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/System.IO.html#openTempFile"><span class="hs-identifier">openTempFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/System.IO.Unsafe.html"><span class="hs-identifier">System.IO.Unsafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Unsafe.html#unsafePerformIO"><span class="hs-identifier">unsafePerformIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">data</span><span> </span><span id="PluginCtx"><span class="annot"><a href="PlutusTx.Plugin.html#PluginCtx"><span class="hs-identifier hs-var">PluginCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PluginCtx"><span class="annot"><a href="PlutusTx.Plugin.html#PluginCtx"><span class="hs-identifier hs-var">PluginCtx</span></a></span></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="pcOpts"><span class="annot"><span class="annottext">PluginCtx -&gt; PluginOptions
</span><a href="PlutusTx.Plugin.html#pcOpts"><span class="hs-identifier hs-var hs-var">pcOpts</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusTx.Options.html#PluginOptions"><span class="hs-identifier hs-type">PluginOptions</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="pcFamEnvs"><span class="annot"><span class="annottext">PluginCtx -&gt; FamInstEnvs
</span><a href="PlutusTx.Plugin.html#pcFamEnvs"><span class="hs-identifier hs-var hs-var">pcFamEnvs</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">GHC.FamInstEnvs</span></a></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="pcMarkerName"><span class="annot"><span class="annottext">PluginCtx -&gt; Name
</span><a href="PlutusTx.Plugin.html#pcMarkerName"><span class="hs-identifier hs-var hs-var">pcMarkerName</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">GHC.Name</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="pcModuleName"><span class="annot"><span class="annottext">PluginCtx -&gt; ModuleName
</span><a href="PlutusTx.Plugin.html#pcModuleName"><span class="hs-identifier hs-var hs-var">pcModuleName</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">GHC.ModuleName</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="pcModuleModBreaks"><span class="annot"><span class="annottext">PluginCtx -&gt; Maybe ModBreaks
</span><a href="PlutusTx.Plugin.html#pcModuleModBreaks"><span class="hs-identifier hs-var hs-var">pcModuleModBreaks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.ByteCode.Types.html#ModBreaks"><span class="hs-identifier hs-type">GHC.ModBreaks</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">{- Note [Making sure unfoldings are present]
Our plugin runs at the start of the Core pipeline. If we look around us, we will find
that as expected, we have unfoldings for some bindings from other modules or packages
depending on whether GHC thinks they're good to inline/are marked INLINEABLE.

But there will be no unfoldings for local bindings!

It turns out that these are added by the simplifier, of all things. To avoid relying too
much on the shape of the subsequent passes, we add a single, very gentle, simplifier
pass before we run, turning off everything that we can and running only once.

This means that we need to be robust to the transformations that the simplifier performs
unconditionally which we pretty much are.

See https://gitlab.haskell.org/ghc/ghc/issues/16615 for upstream discussion.
-}</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">{- Note [newtype field accessors in `base`]
For some unknown reason, newtype field accessors in `base`, such as `getFirst`, `appEndo` and
`getDual`, cause Cabal build and Nix build to behave differently. In Cabal build, these
field accessors' unfoldings are available to the GHC simplifier, and so the simplifier inlines
them into `Coercion`s. But in Nix build, somehow their unfoldings aren't available.

This started to happen after a seemingly innocent PR (#4552), and it eventually led to different
PIRs, PLCs and UPLCs, causing test failures. Replacing them with `coerce` avoids the problem.
-}</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="annot"><a href="PlutusTx.Plugin.html#plugin"><span class="hs-identifier hs-type">plugin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Driver.Plugins.html#Plugin"><span class="hs-identifier hs-type">GHC.Plugin</span></a></span><span>
</span><span id="line-125"></span><span id="plugin"><span class="annot"><span class="annottext">plugin :: Plugin
</span><a href="PlutusTx.Plugin.html#plugin"><span class="hs-identifier hs-var hs-var">plugin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Plugin
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Driver.Plugins.html#defaultPlugin"><span class="hs-identifier hs-var">GHC.defaultPlugin</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Driver.Plugins.html#pluginRecompile"><span class="hs-identifier hs-var">GHC.pluginRecompile</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Driver.Plugins.html#flagRecompile"><span class="hs-identifier hs-type">GHC.flagRecompile</span></a></span><span>
</span><span id="line-126"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Driver.Plugins.html#installCoreToDos"><span class="hs-identifier hs-var">GHC.installCoreToDos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679445887"><span class="hs-identifier hs-type">install</span></a></span><span>
</span><span id="line-127"></span><span>                           </span><span class="hs-special">}</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-129"></span><span>      </span><span class="annot"><a href="#local-6989586621679445887"><span class="hs-identifier hs-type">install</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Driver.Plugins.html#CommandLineOption"><span class="hs-identifier hs-type">GHC.CommandLineOption</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Pipeline.Types.html#CoreToDo"><span class="hs-identifier hs-type">GHC.CoreToDo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Monad.html#CoreM"><span class="hs-identifier hs-type">GHC.CoreM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Pipeline.Types.html#CoreToDo"><span class="hs-identifier hs-type">GHC.CoreToDo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-130"></span><span>      </span><span id="local-6989586621679445887"><span class="annot"><span class="annottext">install :: [CommandLineOption] -&gt; [CoreToDo] -&gt; CoreM [CoreToDo]
</span><a href="#local-6989586621679445887"><span class="hs-identifier hs-var hs-var">install</span></a></span></span><span> </span><span id="local-6989586621679445888"><span class="annot"><span class="annottext">[CommandLineOption]
</span><a href="#local-6989586621679445888"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621679445889"><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621679445889"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-131"></span><span>          </span><span class="hs-comment">-- create simplifier pass to be placed at the front</span><span>
</span><span id="line-132"></span><span>          </span><span id="local-6989586621679445890"><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621679445890"><span class="hs-identifier hs-var">simplPass</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Logger -&gt; CoreToDo
</span><a href="PlutusTx.Plugin.html#mkSimplPass"><span class="hs-identifier hs-var">mkSimplPass</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Logger -&gt; CoreToDo)
-&gt; CoreM DynFlags -&gt; CoreM (Logger -&gt; CoreToDo)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoreM DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">GHC.getDynFlags</span></a></span><span> </span><span class="annot"><span class="annottext">CoreM (Logger -&gt; CoreToDo) -&gt; CoreM Logger -&gt; CoreM CoreToDo
forall a b. CoreM (a -&gt; b) -&gt; CoreM a -&gt; CoreM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoreM Logger
forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">GHC.getLogger</span></a></span><span>
</span><span id="line-133"></span><span>          </span><span class="hs-comment">-- instantiate our plugin pass</span><span>
</span><span id="line-134"></span><span>          </span><span id="local-6989586621679445895"><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621679445895"><span class="hs-identifier hs-var">pluginPass</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; CoreToDo
</span><a href="PlutusTx.Plugin.html#mkPluginPass"><span class="hs-identifier hs-var">mkPluginPass</span></a></span><span> </span><span class="annot"><span class="annottext">(PluginOptions -&gt; CoreToDo)
-&gt; CoreM PluginOptions -&gt; CoreM CoreToDo
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[CommandLineOption] -&gt; Validation ParseErrors PluginOptions
</span><a href="PlutusTx.Options.html#parsePluginOptions"><span class="hs-identifier hs-var">parsePluginOptions</span></a></span><span> </span><span class="annot"><span class="annottext">[CommandLineOption]
</span><a href="#local-6989586621679445888"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-135"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Success</span></span><span> </span><span id="local-6989586621679445899"><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679445899"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; CoreM PluginOptions
forall a. a -&gt; CoreM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679445899"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-136"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Failure</span></span><span> </span><span id="local-6989586621679445901"><span class="annot"><span class="annottext">ParseErrors
</span><a href="#local-6989586621679445901"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO PluginOptions -&gt; CoreM PluginOptions
forall a. IO a -&gt; CoreM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO PluginOptions -&gt; CoreM PluginOptions)
-&gt; IO PluginOptions -&gt; CoreM PluginOptions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ParseErrors -&gt; IO PluginOptions
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">ParseErrors
</span><a href="#local-6989586621679445901"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-137"></span><span>          </span><span class="hs-comment">-- return the pipeline</span><span>
</span><span id="line-138"></span><span>          </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; CoreM [CoreToDo]
forall a. a -&gt; CoreM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">([CoreToDo] -&gt; CoreM [CoreToDo]) -&gt; [CoreToDo] -&gt; CoreM [CoreToDo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-139"></span><span>             </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621679445890"><span class="hs-identifier hs-var">simplPass</span></a></span><span>
</span><span id="line-140"></span><span>             </span><span class="annot"><span class="annottext">CoreToDo -&gt; [CoreToDo] -&gt; [CoreToDo]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621679445895"><span class="hs-identifier hs-var">pluginPass</span></a></span><span>
</span><span id="line-141"></span><span>             </span><span class="annot"><span class="annottext">CoreToDo -&gt; [CoreToDo] -&gt; [CoreToDo]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621679445889"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">{- Note [GHC.sm_pre_inline]
We run a GHC simplifier pass before the plugin, in which we turn on `sm_pre_inline`, which
makes GHC inline certain bindings before the plugin runs. Pre-inlining is a phase of the GHC
inliner that inlines bindings in GHC Core where the binder occurs exactly once in an
unconditionally safe way (e.g., the occurrence isn't inside a lambda). For details, see paper
&quot;Secrets of the Glasgow Haskell Compiler inliner&quot;.

The reason we need the pre-inlining is that the plugin requires certain functions
to be fully applied. For example, it has a special rule to handle
`noinline @(String -&gt; BuiltinString) stringToBuiltinString &quot;a&quot;`, but it cannot compile
`let f = noinline @(String -&gt; BuiltinString) stringToBuiltinString in f &quot;a&quot;`.
By turning on pre-inlining, the `f` in the latter expression will be inlined, resulting in
the former expression, which the plugin knows how to compile.

There is a related flag, `sm_inline`, which controls whether GHC's call-site inlining is
enabled. If enabled, GHC will inline additional bindings that cannot be unconditionally
inlined, on a call-site-by-call-site basis. Currently we haven't found the need to turn on
`sm_inline`. Turning it on seems to reduce PIR sizes in many cases, but it is unclear
whether it may affect the semantics of Plutus Core.

Arguably, relying on `sm_pre_inline` is not the proper solution - what if we get
`let f = noinline @(String -&gt; BuiltinString) stringToBuiltinString in f &quot;a&quot; &lt;&gt; f &quot;b&quot;`?
Here `f` won't be pre-inlined because it occurs twice. Instead, we should perhaps
inline a binding when the RHS is a partially applied function that we need fully applied.
But so far we haven't had an issue like this.

We should also make the error message better in cases like this. The current error message is
&quot;Unsupported feature: Type constructor: GHC.Prim.Char#&quot;, resulting from attempting to inline
and compile `stringToBuiltinString`.

Note also, this `sm_pre_inline` pass doesn't include some of the inlining GHC does before the
plugin.
The GHC desugarer generates a large number of intermediate definitions and general clutter that
should be removed quickly. So GHC's &quot;simple optimiser&quot; (GHC.Core.SimpleOpt) also inlines things with
single occurrences. This is why the NOINLINE pragma is needed to avoid inlining of bindings that
have single occurrence.
None of -fmax-simplifier-iterations=0  -fforce-recomp -O0 would prevent it,
nor will turning off `sm_pre_inline`.
See https://gitlab.haskell.org/ghc/ghc/-/issues/23337.
-}</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="annot"><span class="hs-comment">-- | A simplifier pass, implemented by GHC</span></span><span>
</span><span id="line-185"></span><span class="annot"><a href="PlutusTx.Plugin.html#mkSimplPass"><span class="hs-identifier hs-type">mkSimplPass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">GHC.DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">GHC.Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Pipeline.Types.html#CoreToDo"><span class="hs-identifier hs-type">GHC.CoreToDo</span></a></span><span>
</span><span id="line-186"></span><span id="mkSimplPass"><span class="annot"><span class="annottext">mkSimplPass :: DynFlags -&gt; Logger -&gt; CoreToDo
</span><a href="PlutusTx.Plugin.html#mkSimplPass"><span class="hs-identifier hs-var hs-var">mkSimplPass</span></a></span></span><span> </span><span id="local-6989586621679445903"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621679445903"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621679445904"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621679445904"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-comment">-- See Note [Making sure unfoldings are present]</span><span class="hs-cpp">
#if MIN_VERSION_ghc(9,6,0)
</span><span>  </span><span class="hs-comment">-- Changed in 9.6</span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><span class="annottext">SimplifyOpts -&gt; CoreToDo
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Pipeline.Types.html#CoreDoSimplify"><span class="hs-identifier hs-var">GHC.CoreDoSimplify</span></a></span><span> </span><span class="annot"><span class="annottext">(SimplifyOpts -&gt; CoreToDo) -&gt; SimplifyOpts -&gt; CoreToDo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Simplify.html#SimplifyOpts"><span class="hs-identifier hs-type">GHC.SimplifyOpts</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">so_dump_core_sizes :: Bool
</span><a href="#local-6989586621679445907"><span class="hs-identifier hs-var">GHC.so_dump_core_sizes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">so_iterations :: Int
</span><a href="#local-6989586621679445908"><span class="hs-identifier hs-var">GHC.so_iterations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">so_mode :: SimplMode
</span><a href="#local-6989586621679445909"><span class="hs-identifier hs-var">GHC.so_mode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplMode
</span><a href="#local-6989586621679445910"><span class="hs-identifier hs-var">simplMode</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">so_pass_result_cfg :: Maybe LintPassResultConfig
</span><a href="#local-6989586621679445911"><span class="hs-identifier hs-var">GHC.so_pass_result_cfg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe LintPassResultConfig
forall a. Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">so_hpt_rules :: RuleBase
</span><a href="#local-6989586621679445912"><span class="hs-identifier hs-var">GHC.so_hpt_rules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleBase
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Rules.html#emptyRuleBase"><span class="hs-identifier hs-var">GHC.emptyRuleBase</span></a></span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">so_top_env_cfg :: TopEnvConfig
</span><a href="#local-6989586621679445914"><span class="hs-identifier hs-var">GHC.so_top_env_cfg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; TopEnvConfig
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Simplify.Monad.html#TopEnvConfig"><span class="hs-identifier hs-var">GHC.TopEnvConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-special">}</span><span class="hs-cpp">
#else
</span><span>  </span><span class="hs-identifier">GHC.CoreDoSimplify</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-identifier">simplMode</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-202"></span><span>      </span><span id="local-6989586621679445910"><span class="annot"><span class="annottext">simplMode :: SimplMode
</span><a href="#local-6989586621679445910"><span class="hs-identifier hs-var hs-var">simplMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Simplify.Env.html#SimplMode"><span class="hs-identifier hs-type">GHC.SimplMode</span></a></span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sm_names :: [CommandLineOption]
</span><a href="#local-6989586621679445917"><span class="hs-identifier hs-var">GHC.sm_names</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;Ensure unfoldings are present&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_phase :: CompilerPhase
</span><a href="#local-6989586621679445918"><span class="hs-identifier hs-var">GHC.sm_phase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompilerPhase
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Types.Basic.html#InitialPhase"><span class="hs-identifier hs-var">GHC.InitialPhase</span></a></span><span>
</span><span id="line-205"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_uf_opts :: UnfoldingOpts
</span><a href="#local-6989586621679445920"><span class="hs-identifier hs-var">GHC.sm_uf_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnfoldingOpts
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Unfold.html#defaultUnfoldingOpts"><span class="hs-identifier hs-var">GHC.defaultUnfoldingOpts</span></a></span><span>
</span><span id="line-206"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_rules :: Bool
</span><a href="#local-6989586621679445922"><span class="hs-identifier hs-var">GHC.sm_rules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_cast_swizzle :: Bool
</span><a href="#local-6989586621679445923"><span class="hs-identifier hs-var">GHC.sm_cast_swizzle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-comment">-- See Note [GHC.sm_pre_inline]</span><span>
</span><span id="line-209"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_pre_inline :: Bool
</span><a href="#local-6989586621679445924"><span class="hs-identifier hs-var">GHC.sm_pre_inline</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-comment">-- You might think you would need this, but apparently not</span><span>
</span><span id="line-211"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_inline :: Bool
</span><a href="#local-6989586621679445925"><span class="hs-identifier hs-var">GHC.sm_inline</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-212"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_case_case :: Bool
</span><a href="#local-6989586621679445926"><span class="hs-identifier hs-var">GHC.sm_case_case</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-213"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_eta_expand :: Bool
</span><a href="#local-6989586621679445927"><span class="hs-identifier hs-var">GHC.sm_eta_expand</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-cpp">
#if MIN_VERSION_ghc(9,6,0)
</span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_float_enable :: FloatEnable
</span><a href="#local-6989586621679445928"><span class="hs-identifier hs-var">GHC.sm_float_enable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FloatEnable
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Simplify.Env.html#FloatDisabled"><span class="hs-identifier hs-var">GHC.FloatDisabled</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_do_eta_reduction :: Bool
</span><a href="#local-6989586621679445930"><span class="hs-identifier hs-var">GHC.sm_do_eta_reduction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_arity_opts :: ArityOpts
</span><a href="#local-6989586621679445931"><span class="hs-identifier hs-var">GHC.sm_arity_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; ArityOpts
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Arity.html#ArityOpts"><span class="hs-identifier hs-var">GHC.ArityOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_rule_opts :: RuleOpts
</span><a href="#local-6989586621679445933"><span class="hs-identifier hs-var">GHC.sm_rule_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool -&gt; Bool -&gt; Bool -&gt; RuleOpts
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Rules.Config.html#RuleOpts"><span class="hs-identifier hs-var">GHC.RuleOpts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">GHC.targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621679445903"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_case_folding :: Bool
</span><a href="#local-6989586621679445936"><span class="hs-identifier hs-var">GHC.sm_case_folding</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_case_merge :: Bool
</span><a href="#local-6989586621679445937"><span class="hs-identifier hs-var">GHC.sm_case_merge</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_co_opt_opts :: OptCoercionOpts
</span><a href="#local-6989586621679445938"><span class="hs-identifier hs-var">GHC.sm_co_opt_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; OptCoercionOpts
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Coercion.Opt.html#OptCoercionOpts"><span class="hs-identifier hs-var">GHC.OptCoercionOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-cpp">
#else
</span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">GHC.sm_logger</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">logger</span><span>
</span><span id="line-224"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">GHC.sm_dflags</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dflags</span><span class="hs-cpp">
#endif
</span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-comment">{- Note [Marker resolution]
We use TH's 'foo exact syntax for resolving the 'plc marker's ghc name, as
explained in: &lt;http://hackage.haskell.org/package/ghc-8.10.1/docs/GhcPlugins.html#v:thNameToGhcName&gt;

The GHC haddock suggests that the &quot;exact syntax&quot; will always succeed because it is statically
resolved here (inside this Plugin module);

If this is the case, then it means that our plugin will always traverse each module's binds
searching for plc markers even in the case that the `plc` name is not in scope locally in the module
 under compilation.

The alternative is to use the &quot;dynamic syntax&quot; (`TH.mkName &quot;plc&quot;`), which implies that
the &quot;plc&quot; name will be resolved dynamically during module's compilation. In case &quot;plc&quot; is not
locally in scope,
the plugin would finish faster by completely skipping the module under compilation.
This dynamic approach comes with its own downsides however,
because the user may have imported &quot;plc&quot; qualified or aliased it, which will fail to resolve.
-}</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="hs-comment">-- | Our plugin works at haskell-module level granularity; the plugin</span><span>
</span><span id="line-249"></span><span class="hs-comment">-- looks at the module's top-level bindings for plc markers and compiles their right-hand-side core</span><span>
</span><span id="line-250"></span><span class="hs-comment">-- expressions.</span><span>
</span><span id="line-251"></span><span class="annot"><a href="PlutusTx.Plugin.html#mkPluginPass"><span class="hs-identifier hs-type">mkPluginPass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusTx.Options.html#PluginOptions"><span class="hs-identifier hs-type">PluginOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Pipeline.Types.html#CoreToDo"><span class="hs-identifier hs-type">GHC.CoreToDo</span></a></span><span>
</span><span id="line-252"></span><span id="mkPluginPass"><span class="annot"><span class="annottext">mkPluginPass :: PluginOptions -&gt; CoreToDo
</span><a href="PlutusTx.Plugin.html#mkPluginPass"><span class="hs-identifier hs-var hs-var">mkPluginPass</span></a></span></span><span> </span><span id="local-6989586621679445940"><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679445940"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; CorePluginPass -&gt; CoreToDo
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Pipeline.Types.html#CoreDoPluginPass"><span class="hs-identifier hs-var">GHC.CoreDoPluginPass</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;Core to PLC&quot;</span></span><span> </span><span class="annot"><span class="annottext">(CorePluginPass -&gt; CoreToDo) -&gt; CorePluginPass -&gt; CoreToDo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679445942"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621679445942"><span class="hs-identifier hs-var">guts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-comment">-- Family env code borrowed from SimplCore</span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621679445943"><span class="annot"><span class="annottext">PackageFamInstEnv
</span><a href="#local-6989586621679445943"><span class="hs-identifier hs-var">p_fam_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreM PackageFamInstEnv
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Monad.html#getPackageFamInstEnv"><span class="hs-identifier hs-var">GHC.getPackageFamInstEnv</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-comment">-- See Note [Marker resolution]</span><span>
</span><span id="line-256"></span><span>    </span><span id="local-6989586621679445945"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679445945"><span class="hs-identifier hs-var">maybeMarkerName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CoreM (Maybe Name)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Plugins.html#thNameToGhcName"><span class="hs-identifier hs-var">GHC.thNameToGhcName</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">plc</span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679445945"><span class="hs-identifier hs-var">maybeMarkerName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-258"></span><span>        </span><span class="hs-comment">-- TODO: test that this branch can happen using TH's 'plc exact syntax.</span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-comment">-- See Note [Marker resolution]</span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CorePluginPass
forall a. a -&gt; CoreM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621679445942"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679445947"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679445947"><span class="hs-identifier hs-var">markerName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-262"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679445948"><span class="annot"><span class="annottext">pctx :: PluginCtx
</span><a href="#local-6989586621679445948"><span class="hs-identifier hs-var hs-var">pctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusTx.Plugin.html#PluginCtx"><span class="hs-identifier hs-type">PluginCtx</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pcOpts :: PluginOptions
</span><a href="PlutusTx.Plugin.html#pcOpts"><span class="hs-identifier hs-var">pcOpts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679445940"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-263"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pcFamEnvs :: FamInstEnvs
</span><a href="PlutusTx.Plugin.html#pcFamEnvs"><span class="hs-identifier hs-var">pcFamEnvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PackageFamInstEnv
</span><a href="#local-6989586621679445943"><span class="hs-identifier hs-var">p_fam_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; PackageFamInstEnv
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Unit.Module.ModGuts.html#mg_fam_inst_env"><span class="hs-identifier hs-var">GHC.mg_fam_inst_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621679445942"><span class="hs-identifier hs-var">guts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pcMarkerName :: Name
</span><a href="PlutusTx.Plugin.html#pcMarkerName"><span class="hs-identifier hs-var">pcMarkerName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679445947"><span class="hs-identifier hs-var">markerName</span></a></span><span>
</span><span id="line-265"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pcModuleName :: ModuleName
</span><a href="PlutusTx.Plugin.html#pcModuleName"><span class="hs-identifier hs-var">pcModuleName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">GHC.moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">(GenModule Unit -&gt; ModuleName) -&gt; GenModule Unit -&gt; ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; GenModule Unit
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Unit.Module.ModGuts.html#mg_module"><span class="hs-identifier hs-var">GHC.mg_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621679445942"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-266"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pcModuleModBreaks :: Maybe ModBreaks
</span><a href="PlutusTx.Plugin.html#pcModuleModBreaks"><span class="hs-identifier hs-var">pcModuleModBreaks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; Maybe ModBreaks
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Unit.Module.ModGuts.html#mg_modBreaks"><span class="hs-identifier hs-var">GHC.mg_modBreaks</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621679445942"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-267"></span><span>                                 </span><span class="hs-special">}</span><span>
</span><span id="line-268"></span><span>                </span><span class="hs-comment">-- start looking for plc calls from the top-level binds</span><span>
</span><span id="line-269"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(CoreProgram -&gt; CoreM CoreProgram) -&gt; CorePluginPass
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Pipeline.Types.html#bindsOnlyPass"><span class="hs-identifier hs-var">GHC.bindsOnlyPass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginCtx
-&gt; PluginM DefaultUni DefaultFun CoreProgram -&gt; CoreM CoreProgram
forall (uni :: * -&gt; *) fun a.
(PrettyUni uni, Pretty fun) =&gt;
PluginCtx -&gt; PluginM uni fun a -&gt; CoreM a
</span><a href="PlutusTx.Plugin.html#runPluginM"><span class="hs-identifier hs-var">runPluginM</span></a></span><span> </span><span class="annot"><span class="annottext">PluginCtx
</span><a href="#local-6989586621679445948"><span class="hs-identifier hs-var">pctx</span></a></span><span> </span><span class="annot"><span class="annottext">(PluginM DefaultUni DefaultFun CoreProgram -&gt; CoreM CoreProgram)
-&gt; (CoreProgram -&gt; PluginM DefaultUni DefaultFun CoreProgram)
-&gt; CoreProgram
-&gt; CoreM CoreProgram
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreBind
 -&gt; ReaderT
      PluginCtx
      (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
      CoreBind)
-&gt; CoreProgram -&gt; PluginM DefaultUni DefaultFun CoreProgram
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">CoreBind
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreBind
</span><a href="PlutusTx.Plugin.html#compileBind"><span class="hs-identifier hs-var">compileBind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621679445942"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-comment">-- | The monad where the plugin runs in for each module.</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- It is a core-&gt;core compiler monad, called PluginM, augmented with pure errors.</span><span>
</span><span id="line-273"></span><span class="hs-keyword">type</span><span> </span><span id="PluginM"><span class="annot"><a href="PlutusTx.Plugin.html#PluginM"><span class="hs-identifier hs-var">PluginM</span></a></span></span><span> </span><span id="local-6989586621679445958"><span class="annot"><a href="#local-6989586621679445958"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621679445959"><span class="annot"><a href="#local-6989586621679445959"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#ReaderT"><span class="hs-identifier hs-type">ReaderT</span></a></span><span> </span><span class="annot"><a href="PlutusTx.Plugin.html#PluginCtx"><span class="hs-identifier hs-type">PluginCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#ExceptT"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.Compiler.Error.html#CompileError"><span class="hs-identifier hs-type">CompileError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445958"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445959"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Monad.html#CoreM"><span class="hs-identifier hs-type">GHC.CoreM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="annot"><span class="hs-comment">-- | Runs the plugin monad in a given context; throws a Ghc.Exception when compilation fails.</span></span><span>
</span><span id="line-276"></span><span id="local-6989586621679445059"><span id="local-6989586621679445060"><span id="local-6989586621679445061"><span class="annot"><a href="PlutusTx.Plugin.html#runPluginM"><span class="hs-identifier hs-type">runPluginM</span></a></span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PLC.PrettyUni</span></span><span> </span><span class="annot"><a href="#local-6989586621679445059"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PP.Pretty</span></span><span> </span><span class="annot"><a href="#local-6989586621679445060"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Plugin.html#PluginCtx"><span class="hs-identifier hs-type">PluginCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Plugin.html#PluginM"><span class="hs-identifier hs-type">PluginM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445059"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445060"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445061"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.Monad.html#CoreM"><span class="hs-identifier hs-type">GHC.CoreM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445061"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-279"></span><span id="runPluginM"><span class="annot"><span class="annottext">runPluginM :: forall (uni :: * -&gt; *) fun a.
(PrettyUni uni, Pretty fun) =&gt;
PluginCtx -&gt; PluginM uni fun a -&gt; CoreM a
</span><a href="PlutusTx.Plugin.html#runPluginM"><span class="hs-identifier hs-var hs-var">runPluginM</span></a></span></span><span> </span><span id="local-6989586621679445977"><span class="annot"><span class="annottext">PluginCtx
</span><a href="#local-6989586621679445977"><span class="hs-identifier hs-var">pctx</span></a></span></span><span> </span><span id="local-6989586621679445978"><span class="annot"><span class="annottext">PluginM uni fun a
</span><a href="#local-6989586621679445978"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621679445979"><span class="annot"><span class="annottext">Either (CompileError uni fun Ann) a
</span><a href="#local-6989586621679445979"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT (CompileError uni fun Ann) CoreM a
-&gt; CoreM (Either (CompileError uni fun Ann) a)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#runExceptT"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT (CompileError uni fun Ann) CoreM a
 -&gt; CoreM (Either (CompileError uni fun Ann) a))
-&gt; ExceptT (CompileError uni fun Ann) CoreM a
-&gt; CoreM (Either (CompileError uni fun Ann) a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PluginM uni fun a
-&gt; PluginCtx -&gt; ExceptT (CompileError uni fun Ann) CoreM a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#runReaderT"><span class="hs-identifier hs-var">runReaderT</span></a></span><span> </span><span class="annot"><span class="annottext">PluginM uni fun a
</span><a href="#local-6989586621679445978"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">PluginCtx
</span><a href="#local-6989586621679445977"><span class="hs-identifier hs-var">pctx</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (CompileError uni fun Ann) a
</span><a href="#local-6989586621679445979"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-282"></span><span>        </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679445982"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679445982"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; CoreM a
forall a. a -&gt; CoreM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679445982"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-283"></span><span>        </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679445983"><span class="annot"><span class="annottext">CompileError uni fun Ann
</span><a href="#local-6989586621679445983"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-284"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679445984"><span class="annot"><span class="annottext">errInGhc :: GhcException
</span><a href="#local-6989586621679445984"><span class="hs-identifier hs-var hs-var">errInGhc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; GhcException
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Utils.Panic.html#ProgramError"><span class="hs-identifier hs-var">GHC.ProgramError</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOption -&gt; GhcException)
-&gt; (Doc Any -&gt; CommandLineOption) -&gt; Doc Any -&gt; GhcException
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Doc Any -&gt; CommandLineOption
forall a. Show a =&gt; a -&gt; CommandLineOption
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc Any -&gt; GhcException) -&gt; Doc Any -&gt; GhcException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Doc Any
</span><span class="hs-string">&quot;GHC Core to PLC plugin:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc Any -&gt; Doc Any -&gt; Doc Any
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">PP.&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">CompileError uni fun Ann -&gt; Doc Any
forall a ann. Pretty a =&gt; a -&gt; Doc ann
forall ann. CompileError uni fun Ann -&gt; Doc ann
</span><span class="hs-identifier hs-var">PP.pretty</span></span><span> </span><span class="annot"><span class="annottext">CompileError uni fun Ann
</span><a href="#local-6989586621679445983"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-285"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; CoreM a
forall a. IO a -&gt; CoreM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; CoreM a) -&gt; IO a -&gt; CoreM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO a
forall a. GhcException -&gt; IO a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">GHC.throwGhcExceptionIO</span></a></span><span> </span><span class="annot"><span class="annottext">GhcException
</span><a href="#local-6989586621679445984"><span class="hs-identifier hs-var">errInGhc</span></a></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="annot"><span class="hs-comment">-- | Compiles all the marked expressions in the given binder into PLC literals.</span></span><span>
</span><span id="line-288"></span><span class="annot"><a href="PlutusTx.Plugin.html#compileBind"><span class="hs-identifier hs-type">compileBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">GHC.CoreBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Plugin.html#PluginM"><span class="hs-identifier hs-type">PluginM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PLC.DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PLC.DefaultFun</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">GHC.CoreBind</span></a></span><span>
</span><span id="line-289"></span><span id="compileBind"><span class="annot"><span class="annottext">compileBind :: CoreBind
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreBind
</span><a href="PlutusTx.Plugin.html#compileBind"><span class="hs-identifier hs-var hs-var">compileBind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#NonRec"><span class="hs-identifier hs-type">GHC.NonRec</span></a></span><span> </span><span id="local-6989586621679445991"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679445991"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679445992"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679445992"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; CoreExpr -&gt; CoreBind
forall b. b -&gt; Expr b -&gt; Bind b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#NonRec"><span class="hs-identifier hs-var">GHC.NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679445991"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreBind)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreBind
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
</span><a href="PlutusTx.Plugin.html#compileMarkedExprs"><span class="hs-identifier hs-var">compileMarkedExprs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679445992"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-291"></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Rec"><span class="hs-identifier hs-type">GHC.Rec</span></a></span><span> </span><span id="local-6989586621679445995"><span class="annot"><span class="annottext">[(Var, CoreExpr)]
</span><a href="#local-6989586621679445995"><span class="hs-identifier hs-var">bindsRhses</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Var, CoreExpr)] -&gt; CoreBind
forall b. [(b, Expr b)] -&gt; Bind b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Rec"><span class="hs-identifier hs-var">GHC.Rec</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, CoreExpr)] -&gt; CoreBind)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     [(Var, CoreExpr)]
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreBind
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, CoreExpr)]
-&gt; ((Var, CoreExpr)
    -&gt; ReaderT
         PluginCtx
         (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
         (Var, CoreExpr))
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     [(Var, CoreExpr)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Traversable.html#for"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, CoreExpr)]
</span><a href="#local-6989586621679445995"><span class="hs-identifier hs-var">bindsRhses</span></a></span><span> </span><span class="annot"><span class="annottext">(((Var, CoreExpr)
  -&gt; ReaderT
       PluginCtx
       (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
       (Var, CoreExpr))
 -&gt; ReaderT
      PluginCtx
      (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
      [(Var, CoreExpr)])
-&gt; ((Var, CoreExpr)
    -&gt; ReaderT
         PluginCtx
         (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
         (Var, CoreExpr))
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     [(Var, CoreExpr)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679445997"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679445997"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679445998"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679445998"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-292"></span><span>                                             </span><span id="local-6989586621679445999"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679445999"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
</span><a href="PlutusTx.Plugin.html#compileMarkedExprs"><span class="hs-identifier hs-var">compileMarkedExprs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679445998"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-293"></span><span>                                             </span><span class="annot"><span class="annottext">(Var, CoreExpr)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     (Var, CoreExpr)
forall a.
a
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679445997"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679445999"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">{- Note [Hooking in the plugin]
Working out what to process and where to put it is tricky. We are going to turn the result in
to a 'CompiledCode', not the Haskell expression we started with!

Currently we look for calls to the @plc :: a -&gt; CompiledCode a@ function,
and we replace the whole application with the generated code object, which will still be well-typed.
-}</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="hs-comment">{- Note [Polymorphic values and Any]
If you try and use the plugin on a polymorphic expression, then GHC will replace the quantified
types with 'Any' and remove the type lambdas. This is pretty annoying, and I don't entirely
understand why it happens, despite poking around in GHC a fair bit.

Possibly it has to do with the type that is given to 'plc' being unconstrained, resulting in GHC
putting 'Any' there, and that then propagating into the type of the quote. It's tricky to experiment
with this, since you can't really specify a polymorphic type in a type application or in the
resulting 'CompiledCode' because that's impredicative polymorphism.
-}</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="annot"><span class="hs-comment">-- | Compiles all the core-expressions surrounded by plc in the given expression into PLC literals.</span></span><span>
</span><span id="line-315"></span><span class="annot"><a href="PlutusTx.Plugin.html#compileMarkedExprs"><span class="hs-identifier hs-type">compileMarkedExprs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">GHC.CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Plugin.html#PluginM"><span class="hs-identifier hs-type">PluginM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PLC.DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PLC.DefaultFun</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">GHC.CoreExpr</span></a></span><span>
</span><span id="line-316"></span><span id="compileMarkedExprs"><span class="annot"><span class="annottext">compileMarkedExprs :: CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
</span><a href="PlutusTx.Plugin.html#compileMarkedExprs"><span class="hs-identifier hs-var hs-var">compileMarkedExprs</span></a></span></span><span> </span><span id="local-6989586621679446000"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446000"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-317"></span><span>    </span><span id="local-6989586621679446001"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679446001"><span class="hs-identifier hs-var">markerName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PluginCtx -&gt; Name)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     Name
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Reader.Class.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">PluginCtx -&gt; Name
</span><a href="PlutusTx.Plugin.html#pcMarkerName"><span class="hs-identifier hs-var">pcMarkerName</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446000"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-319"></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#App"><span class="hs-identifier hs-type">GHC.App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#App"><span class="hs-identifier hs-type">GHC.App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#App"><span class="hs-identifier hs-type">GHC.App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#App"><span class="hs-identifier hs-type">GHC.App</span></a></span><span>
</span><span id="line-320"></span><span>                          </span><span class="hs-comment">-- function id</span><span>
</span><span id="line-321"></span><span>                          </span><span class="hs-comment">-- sometimes GHCi sticks ticks around this for some reason</span><span>
</span><span id="line-322"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="PlutusTx.Plugin.html#stripTicks"><span class="hs-identifier hs-var">stripTicks</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Var"><span class="hs-identifier hs-type">GHC.Var</span></a></span><span> </span><span id="local-6989586621679446006"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679446006"><span class="hs-identifier hs-var">fid</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>                          </span><span class="hs-comment">-- first type argument, must be a string literal type</span><span>
</span><span id="line-324"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Type"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Maybe FastString
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Type.html#isStrLitTy"><span class="hs-identifier hs-var">GHC.isStrLitTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679446009"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621679446009"><span class="hs-identifier hs-var">fs_locStr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>                     </span><span class="hs-comment">-- second type argument</span><span>
</span><span id="line-326"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Type"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span id="local-6989586621679446010"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679446010"><span class="hs-identifier hs-var">codeTy</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>            </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>            </span><span class="hs-comment">-- value argument</span><span>
</span><span id="line-329"></span><span>            </span><span id="local-6989586621679446011"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446011"><span class="hs-identifier hs-var">inner</span></a></span></span><span>
</span><span id="line-330"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679446001"><span class="hs-identifier hs-var">markerName</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Name
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">GHC.idName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679446006"><span class="hs-identifier hs-var">fid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CommandLineOption
-&gt; Type
-&gt; CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
</span><a href="PlutusTx.Plugin.html#compileMarkedExprOrDefer"><span class="hs-identifier hs-var">compileMarkedExprOrDefer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; CommandLineOption
forall a. Show a =&gt; a -&gt; CommandLineOption
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621679446009"><span class="hs-identifier hs-var">fs_locStr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679446010"><span class="hs-identifier hs-var">codeTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446011"><span class="hs-identifier hs-var">inner</span></a></span><span>
</span><span id="line-331"></span><span>      </span><span id="local-6989586621679446014"><span class="annot"><span class="annottext">e :: CoreExpr
</span><a href="#local-6989586621679446014"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Var"><span class="hs-identifier hs-type">GHC.Var</span></a></span><span> </span><span id="local-6989586621679446015"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679446015"><span class="hs-identifier hs-var">fid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679446001"><span class="hs-identifier hs-var">markerName</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Name
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">GHC.idName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679446015"><span class="hs-identifier hs-var">fid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-332"></span><span>        </span><span class="annot"><span class="annottext">CompileError DefaultUni DefaultFun Ann
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a.
CompileError DefaultUni DefaultFun Ann
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(CompileError DefaultUni DefaultFun Ann
 -&gt; ReaderT
      PluginCtx
      (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
      CoreExpr)
-&gt; (SDoc -&gt; CompileError DefaultUni DefaultFun Ann)
-&gt; SDoc
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Error DefaultUni DefaultFun Ann
-&gt; CompileError DefaultUni DefaultFun Ann
forall c e. e -&gt; WithContext c e
</span><a href="PlutusTx.Compiler.Error.html#NoContext"><span class="hs-identifier hs-var">NoContext</span></a></span><span> </span><span class="annot"><span class="annottext">(Error DefaultUni DefaultFun Ann
 -&gt; CompileError DefaultUni DefaultFun Ann)
-&gt; (SDoc -&gt; Error DefaultUni DefaultFun Ann)
-&gt; SDoc
-&gt; CompileError DefaultUni DefaultFun Ann
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; Error DefaultUni DefaultFun Ann
forall (uni :: * -&gt; *) fun a. CommandLineOption -&gt; Error uni fun a
</span><a href="PlutusTx.Compiler.Error.html#InvalidMarkerError"><span class="hs-identifier hs-var">InvalidMarkerError</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOption -&gt; Error DefaultUni DefaultFun Ann)
-&gt; (SDoc -&gt; CommandLineOption)
-&gt; SDoc
-&gt; Error DefaultUni DefaultFun Ann
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; CommandLineOption
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Utils.Outputable.html#showSDocUnsafe"><span class="hs-identifier hs-var">GHC.showSDocUnsafe</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc
 -&gt; ReaderT
      PluginCtx
      (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
      CoreExpr)
-&gt; SDoc
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">GHC.ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446014"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-333"></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#App"><span class="hs-identifier hs-type">GHC.App</span></a></span><span> </span><span id="local-6989586621679446021"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446021"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679446022"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446022"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#App"><span class="hs-identifier hs-var">GHC.App</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr -&gt; CoreExpr)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     (CoreExpr -&gt; CoreExpr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
</span><a href="PlutusTx.Plugin.html#compileMarkedExprs"><span class="hs-identifier hs-var">compileMarkedExprs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446021"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT
  PluginCtx
  (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
  (CoreExpr -&gt; CoreExpr)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a b.
ReaderT
  PluginCtx
  (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
  (a -&gt; b)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     a
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
</span><a href="PlutusTx.Plugin.html#compileMarkedExprs"><span class="hs-identifier hs-var">compileMarkedExprs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446022"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-334"></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Lam"><span class="hs-identifier hs-type">GHC.Lam</span></a></span><span> </span><span id="local-6989586621679446024"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679446024"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679446025"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446025"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Lam"><span class="hs-identifier hs-var">GHC.Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679446024"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
</span><a href="PlutusTx.Plugin.html#compileMarkedExprs"><span class="hs-identifier hs-var">compileMarkedExprs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446025"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-335"></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Let"><span class="hs-identifier hs-type">GHC.Let</span></a></span><span> </span><span id="local-6989586621679446027"><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621679446027"><span class="hs-identifier hs-var">bnd</span></a></span></span><span> </span><span id="local-6989586621679446028"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446028"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreBind -&gt; CoreExpr -&gt; CoreExpr
forall b. Bind b -&gt; Expr b -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Let"><span class="hs-identifier hs-var">GHC.Let</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreBind -&gt; CoreExpr -&gt; CoreExpr)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreBind
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     (CoreExpr -&gt; CoreExpr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoreBind
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreBind
</span><a href="PlutusTx.Plugin.html#compileBind"><span class="hs-identifier hs-var">compileBind</span></a></span><span> </span><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621679446027"><span class="hs-identifier hs-var">bnd</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT
  PluginCtx
  (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
  (CoreExpr -&gt; CoreExpr)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a b.
ReaderT
  PluginCtx
  (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
  (a -&gt; b)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     a
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
</span><a href="PlutusTx.Plugin.html#compileMarkedExprs"><span class="hs-identifier hs-var">compileMarkedExprs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446028"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-336"></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Case"><span class="hs-identifier hs-type">GHC.Case</span></a></span><span> </span><span id="local-6989586621679446030"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446030"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679446031"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679446031"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679446032"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679446032"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679446033"><span class="annot"><span class="annottext">[Alt Var]
</span><a href="#local-6989586621679446033"><span class="hs-identifier hs-var">alts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>            </span><span id="local-6989586621679446034"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446034"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
</span><a href="PlutusTx.Plugin.html#compileMarkedExprs"><span class="hs-identifier hs-var">compileMarkedExprs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446030"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-338"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679446038"><span class="annot"><span class="annottext">expAlt :: Alt Var
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     (Alt Var)
</span><a href="#local-6989586621679446038"><span class="hs-identifier hs-var hs-var">expAlt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Alt"><span class="hs-identifier hs-type">GHC.Alt</span></a></span><span> </span><span id="local-6989586621679446040"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621679446040"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679446041"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621679446041"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621679446042"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446042"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AltCon -&gt; [Var] -&gt; CoreExpr -&gt; Alt Var
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Alt"><span class="hs-identifier hs-var">GHC.Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621679446040"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621679446041"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; Alt Var)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     (Alt Var)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
</span><a href="PlutusTx.Plugin.html#compileMarkedExprs"><span class="hs-identifier hs-var">compileMarkedExprs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446042"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-339"></span><span>            </span><span id="local-6989586621679446043"><span class="annot"><span class="annottext">[Alt Var]
</span><a href="#local-6989586621679446043"><span class="hs-identifier hs-var">alts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Alt Var
 -&gt; ReaderT
      PluginCtx
      (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
      (Alt Var))
-&gt; [Alt Var]
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     [Alt Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Alt Var
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     (Alt Var)
</span><a href="#local-6989586621679446038"><span class="hs-identifier hs-var">expAlt</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Var]
</span><a href="#local-6989586621679446033"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-340"></span><span>            </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a.
a
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr
 -&gt; ReaderT
      PluginCtx
      (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
      CoreExpr)
-&gt; CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Var -&gt; Type -&gt; [Alt Var] -&gt; CoreExpr
forall b. Expr b -&gt; b -&gt; Type -&gt; [Alt b] -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Case"><span class="hs-identifier hs-var">GHC.Case</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446034"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679446031"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679446032"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Var]
</span><a href="#local-6989586621679446043"><span class="hs-identifier hs-var">alts'</span></a></span><span>
</span><span id="line-341"></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Cast"><span class="hs-identifier hs-type">GHC.Cast</span></a></span><span> </span><span id="local-6989586621679446046"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446046"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679446047"><span class="annot"><span class="annottext">CoercionR
</span><a href="#local-6989586621679446047"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoercionR -&gt; CoreExpr)
-&gt; CoercionR -&gt; CoreExpr -&gt; CoreExpr
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoercionR -&gt; CoreExpr
forall b. Expr b -&gt; CoercionR -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Cast"><span class="hs-identifier hs-var">GHC.Cast</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionR
</span><a href="#local-6989586621679446047"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
</span><a href="PlutusTx.Plugin.html#compileMarkedExprs"><span class="hs-identifier hs-var">compileMarkedExprs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446046"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-342"></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Tick"><span class="hs-identifier hs-type">GHC.Tick</span></a></span><span> </span><span id="local-6989586621679446050"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621679446050"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679446051"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446051"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
forall b. CoreTickish -&gt; Expr b -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Tick"><span class="hs-identifier hs-var">GHC.Tick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621679446050"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
</span><a href="PlutusTx.Plugin.html#compileMarkedExprs"><span class="hs-identifier hs-var">compileMarkedExprs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446051"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-343"></span><span>      </span><span id="local-6989586621679446052"><span class="annot"><span class="annottext">e :: CoreExpr
</span><a href="#local-6989586621679446052"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Coercion"><span class="hs-identifier hs-type">GHC.Coercion</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionR
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a.
a
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446052"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-344"></span><span>      </span><span id="local-6989586621679446054"><span class="annot"><span class="annottext">e :: CoreExpr
</span><a href="#local-6989586621679446054"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Lit"><span class="hs-identifier hs-type">GHC.Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a.
a
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446054"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-345"></span><span>      </span><span id="local-6989586621679446056"><span class="annot"><span class="annottext">e :: CoreExpr
</span><a href="#local-6989586621679446056"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Var"><span class="hs-identifier hs-type">GHC.Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a.
a
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446056"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-346"></span><span>      </span><span id="local-6989586621679446057"><span class="annot"><span class="annottext">e :: CoreExpr
</span><a href="#local-6989586621679446057"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Type"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a.
a
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446057"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="hs-comment">-- | Behaves the same as 'compileMarkedExpr', unless a compilation error occurs ;</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- if a compilation error happens and the 'defer-errors' option is turned on,</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- the compilation error is suppressed and the original hs expression is replaced with a</span><span>
</span><span id="line-351"></span><span class="hs-comment">-- haskell runtime-error expression.</span><span>
</span><span id="line-352"></span><span class="annot"><a href="PlutusTx.Plugin.html#compileMarkedExprOrDefer"><span class="hs-identifier hs-type">compileMarkedExprOrDefer</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-353"></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">GHC.CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Plugin.html#PluginM"><span class="hs-identifier hs-type">PluginM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PLC.DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PLC.DefaultFun</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">GHC.CoreExpr</span></a></span><span>
</span><span id="line-354"></span><span id="compileMarkedExprOrDefer"><span class="annot"><span class="annottext">compileMarkedExprOrDefer :: CommandLineOption
-&gt; Type
-&gt; CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
</span><a href="PlutusTx.Plugin.html#compileMarkedExprOrDefer"><span class="hs-identifier hs-var hs-var">compileMarkedExprOrDefer</span></a></span></span><span> </span><span id="local-6989586621679446059"><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446059"><span class="hs-identifier hs-var">locStr</span></a></span></span><span> </span><span id="local-6989586621679446060"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679446060"><span class="hs-identifier hs-var">codeTy</span></a></span></span><span> </span><span id="local-6989586621679446061"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446061"><span class="hs-identifier hs-var">origE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-355"></span><span>    </span><span id="local-6989586621679446062"><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446062"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PluginCtx -&gt; PluginOptions)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     PluginOptions
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Reader.Class.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">PluginCtx -&gt; PluginOptions
</span><a href="PlutusTx.Plugin.html#pcOpts"><span class="hs-identifier hs-var">pcOpts</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679446063"><span class="annot"><span class="annottext">compileAct :: ReaderT
  PluginCtx
  (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
  CoreExpr
</span><a href="#local-6989586621679446063"><span class="hs-identifier hs-var hs-var">compileAct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandLineOption
-&gt; Type
-&gt; CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
</span><a href="PlutusTx.Plugin.html#compileMarkedExpr"><span class="hs-identifier hs-var">compileMarkedExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446059"><span class="hs-identifier hs-var">locStr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679446060"><span class="hs-identifier hs-var">codeTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446061"><span class="hs-identifier hs-var">origE</span></a></span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Bool
</span><a href="PlutusTx.Options.html#_posDeferErrors"><span class="hs-identifier hs-var">_posDeferErrors</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446062"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-358"></span><span>      </span><span class="hs-comment">-- TODO: we could perhaps move this catchError to the &quot;runExceptT&quot; module-level, but</span><span>
</span><span id="line-359"></span><span>      </span><span class="hs-comment">-- it leads to uglier code and difficulty of handling other pure errors</span><span>
</span><span id="line-360"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ReaderT
  PluginCtx
  (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
  CoreExpr
</span><a href="#local-6989586621679446063"><span class="hs-identifier hs-var">compileAct</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT
  PluginCtx
  (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
  CoreExpr
-&gt; (CompileError DefaultUni DefaultFun Ann
    -&gt; ReaderT
         PluginCtx
         (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
         CoreExpr)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a.
ReaderT
  PluginCtx
  (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
  a
-&gt; (CompileError DefaultUni DefaultFun Ann
    -&gt; ReaderT
         PluginCtx
         (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
         a)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#catchError"><span class="hs-operator hs-var">`catchError`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
-&gt; CompileError DefaultUni DefaultFun Ann
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall (uni :: * -&gt; *) fun.
(PrettyUni uni, Pretty fun) =&gt;
Type -&gt; CompileError uni fun Ann -&gt; PluginM uni fun CoreExpr
</span><a href="PlutusTx.Plugin.html#emitRuntimeError"><span class="hs-identifier hs-var">emitRuntimeError</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679446060"><span class="hs-identifier hs-var">codeTy</span></a></span><span>
</span><span id="line-361"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ReaderT
  PluginCtx
  (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
  CoreExpr
</span><a href="#local-6989586621679446063"><span class="hs-identifier hs-var">compileAct</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="hs-comment">-- | Given an expected Haskell type 'a', it generates Haskell code which throws a GHC runtime error</span><span>
</span><span id="line-364"></span><span class="hs-comment">-- \&quot;as\&quot; 'CompiledCode a'.</span><span>
</span><span id="line-365"></span><span id="local-6989586621679445129"><span id="local-6989586621679445130"><span class="annot"><a href="PlutusTx.Plugin.html#emitRuntimeError"><span class="hs-identifier hs-type">emitRuntimeError</span></a></span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PLC.PrettyUni</span></span><span> </span><span class="annot"><a href="#local-6989586621679445129"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PP.Pretty</span></span><span> </span><span class="annot"><a href="#local-6989586621679445130"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Compiler.Error.html#CompileError"><span class="hs-identifier hs-type">CompileError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445129"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445130"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Plugin.html#PluginM"><span class="hs-identifier hs-type">PluginM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445129"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445130"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">GHC.CoreExpr</span></a></span></span></span><span>
</span><span id="line-368"></span><span id="emitRuntimeError"><span class="annot"><span class="annottext">emitRuntimeError :: forall (uni :: * -&gt; *) fun.
(PrettyUni uni, Pretty fun) =&gt;
Type -&gt; CompileError uni fun Ann -&gt; PluginM uni fun CoreExpr
</span><a href="PlutusTx.Plugin.html#emitRuntimeError"><span class="hs-identifier hs-var hs-var">emitRuntimeError</span></a></span></span><span> </span><span id="local-6989586621679446086"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679446086"><span class="hs-identifier hs-var">codeTy</span></a></span></span><span> </span><span id="local-6989586621679446087"><span class="annot"><span class="annottext">CompileError uni fun Ann
</span><a href="#local-6989586621679446087"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>    </span><span id="local-6989586621679446088"><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446088"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PluginCtx -&gt; PluginOptions)
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) PluginOptions
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Reader.Class.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">PluginCtx -&gt; PluginOptions
</span><a href="PlutusTx.Plugin.html#pcOpts"><span class="hs-identifier hs-var">pcOpts</span></a></span><span>
</span><span id="line-370"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679446089"><span class="annot"><span class="annottext">shown :: CommandLineOption
</span><a href="#local-6989586621679446089"><span class="hs-identifier hs-var hs-var">shown</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc Any -&gt; CommandLineOption
forall a. Show a =&gt; a -&gt; CommandLineOption
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc Any -&gt; CommandLineOption) -&gt; Doc Any -&gt; CommandLineOption
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CompileError uni fun Ann -&gt; Doc Any
forall a ann. Pretty a =&gt; a -&gt; Doc ann
forall ann. CompileError uni fun Ann -&gt; Doc ann
</span><span class="hs-identifier hs-var">PP.pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; CompileError uni fun Ann -&gt; CompileError uni fun Ann
forall c e. Int -&gt; WithContext c e -&gt; WithContext c e
</span><a href="PlutusTx.Compiler.Error.html#pruneContext"><span class="hs-identifier hs-var">pruneContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions -&gt; Int
</span><a href="PlutusTx.Options.html#_posContextLevel"><span class="hs-identifier hs-var">_posContextLevel</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446088"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CompileError uni fun Ann
</span><a href="#local-6989586621679446087"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>    </span><span id="local-6989586621679446092"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679446092"><span class="hs-identifier hs-var">tcName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; PluginM uni fun Name
forall (uni :: * -&gt; *) fun. Name -&gt; PluginM uni fun Name
</span><a href="PlutusTx.Plugin.html#thNameToGhcNameOrFail"><span class="hs-identifier hs-var">thNameToGhcNameOrFail</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">CompiledCode</span><span>
</span><span id="line-372"></span><span>    </span><span id="local-6989586621679446094"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679446094"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT (CompileError uni fun Ann) CoreM TyCon
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) TyCon
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT PluginCtx m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT (CompileError uni fun Ann) CoreM TyCon
 -&gt; ReaderT
      PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) TyCon)
-&gt; (CoreM TyCon -&gt; ExceptT (CompileError uni fun Ann) CoreM TyCon)
-&gt; CoreM TyCon
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) TyCon
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CoreM TyCon -&gt; ExceptT (CompileError uni fun Ann) CoreM TyCon
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; ExceptT (CompileError uni fun Ann) m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreM TyCon
 -&gt; ReaderT
      PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) TyCon)
-&gt; CoreM TyCon
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; CoreM TyCon
forall (m :: * -&gt; *). MonadThings m =&gt; Name -&gt; m TyCon
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Types.TyThing.html#lookupTyCon"><span class="hs-identifier hs-var">GHC.lookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679446092"><span class="hs-identifier hs-var">tcName</span></a></span><span class="hs-cpp">
#if MIN_VERSION_ghc (9,6,0)
</span><span>    </span><span class="annot"><span class="annottext">CoreExpr -&gt; PluginM uni fun CoreExpr
forall a.
a -&gt; ReaderT PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; PluginM uni fun CoreExpr)
-&gt; CoreExpr -&gt; PluginM uni fun CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; CommandLineOption -&gt; CoreExpr
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Make.html#mkImpossibleExpr"><span class="hs-identifier hs-var">GHC.mkImpossibleExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">GHC.mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679446094"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679446086"><span class="hs-identifier hs-var">codeTy</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446089"><span class="hs-identifier hs-var">shown</span></a></span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">GHC.mkRuntimeErrorApp</span><span> </span><span class="hs-identifier">GHC.rUNTIME_ERROR_ID</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">GHC.mkTyConApp</span><span> </span><span class="hs-identifier">tc</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">codeTy</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">shown</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- | Compile the core expression that is surrounded by a 'plc' marker,</span><span>
</span><span id="line-380"></span><span class="hs-comment">-- and return a core expression which evaluates to the compiled plc AST as a serialized bytestring,</span><span>
</span><span id="line-381"></span><span class="hs-comment">-- to be injected back to the Haskell program.</span><span>
</span><span id="line-382"></span><span class="annot"><a href="PlutusTx.Plugin.html#compileMarkedExpr"><span class="hs-identifier hs-type">compileMarkedExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-383"></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">GHC.CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Plugin.html#PluginM"><span class="hs-identifier hs-type">PluginM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PLC.DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PLC.DefaultFun</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">GHC.CoreExpr</span></a></span><span>
</span><span id="line-384"></span><span id="compileMarkedExpr"><span class="annot"><span class="annottext">compileMarkedExpr :: CommandLineOption
-&gt; Type
-&gt; CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
</span><a href="PlutusTx.Plugin.html#compileMarkedExpr"><span class="hs-identifier hs-var hs-var">compileMarkedExpr</span></a></span></span><span> </span><span id="local-6989586621679446099"><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446099"><span class="hs-identifier hs-var">locStr</span></a></span></span><span> </span><span id="local-6989586621679446100"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679446100"><span class="hs-identifier hs-var">codeTy</span></a></span></span><span> </span><span id="local-6989586621679446101"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446101"><span class="hs-identifier hs-var">origE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-385"></span><span>    </span><span id="local-6989586621679446102"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621679446102"><span class="hs-identifier hs-var">flags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT
  PluginCtx
  (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
  DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">GHC.getDynFlags</span></a></span><span>
</span><span id="line-386"></span><span>    </span><span id="local-6989586621679446103"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621679446103"><span class="hs-identifier hs-var">famEnvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PluginCtx -&gt; FamInstEnvs)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     FamInstEnvs
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Reader.Class.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">PluginCtx -&gt; FamInstEnvs
</span><a href="PlutusTx.Plugin.html#pcFamEnvs"><span class="hs-identifier hs-var">pcFamEnvs</span></a></span><span>
</span><span id="line-387"></span><span>    </span><span id="local-6989586621679446104"><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446104"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PluginCtx -&gt; PluginOptions)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     PluginOptions
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Reader.Class.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">PluginCtx -&gt; PluginOptions
</span><a href="PlutusTx.Plugin.html#pcOpts"><span class="hs-identifier hs-var">pcOpts</span></a></span><span>
</span><span id="line-388"></span><span>    </span><span id="local-6989586621679446105"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621679446105"><span class="hs-identifier hs-var">moduleName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PluginCtx -&gt; ModuleName)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     ModuleName
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Reader.Class.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">PluginCtx -&gt; ModuleName
</span><a href="PlutusTx.Plugin.html#pcModuleName"><span class="hs-identifier hs-var">pcModuleName</span></a></span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679446106"><span class="annot"><span class="annottext">moduleNameStr :: CommandLineOption
</span><a href="#local-6989586621679446106"><span class="hs-identifier hs-var hs-var">moduleNameStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-390"></span><span>            </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitState -&gt; NamePprCtx -&gt; SDoc -&gt; CommandLineOption
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Driver.Ppr.html#showSDocForUser"><span class="hs-identifier hs-var">GHC.showSDocForUser</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621679446102"><span class="hs-identifier hs-var">flags</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Unit.State.html#emptyUnitState"><span class="hs-identifier hs-var">GHC.emptyUnitState</span></a></span><span> </span><span class="annot"><span class="annottext">NamePprCtx
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Utils.Outputable.html#alwaysQualify"><span class="hs-identifier hs-var">GHC.alwaysQualify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">GHC.ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621679446105"><span class="hs-identifier hs-var">moduleName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-comment">-- We need to do this out here, since it has to run in CoreM</span><span>
</span><span id="line-392"></span><span>    </span><span id="local-6989586621679446110"><span class="annot"><span class="annottext">NameInfo
</span><a href="#local-6989586621679446110"><span class="hs-identifier hs-var">nameInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; PluginM DefaultUni DefaultFun NameInfo
forall (uni :: * -&gt; *) fun. [Name] -&gt; PluginM uni fun NameInfo
</span><a href="PlutusTx.Plugin.html#makePrimitiveNameInfo"><span class="hs-identifier hs-var">makePrimitiveNameInfo</span></a></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; PluginM DefaultUni DefaultFun NameInfo)
-&gt; [Name] -&gt; PluginM DefaultUni DefaultFun NameInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-393"></span><span>        </span><span class="annot"><span class="annottext">[Name]
</span><a href="PlutusTx.Compiler.Builtins.html#builtinNames"><span class="hs-identifier hs-var">builtinNames</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; [Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">''</span><span class="hs-identifier">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">False</span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">True</span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">traceBool</span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">GHC.Num.Integer.integerNegate</span><span class="hs-special">]</span><span>
</span><span id="line-394"></span><span>    </span><span id="local-6989586621679446113"><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621679446113"><span class="hs-identifier hs-var">modBreaks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PluginCtx -&gt; Maybe ModBreaks)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     (Maybe ModBreaks)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Reader.Class.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">PluginCtx -&gt; Maybe ModBreaks
</span><a href="PlutusTx.Plugin.html#pcModuleModBreaks"><span class="hs-identifier hs-var">pcModuleModBreaks</span></a></span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679446114"><span class="annot"><span class="annottext">coverage :: CoverageOpts
</span><a href="#local-6989586621679446114"><span class="hs-identifier hs-var hs-var">coverage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set CoverageType -&gt; CoverageOpts
</span><a href="PlutusTx.Compiler.Types.html#CoverageOpts"><span class="hs-identifier hs-var">CoverageOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(Set CoverageType -&gt; CoverageOpts)
-&gt; ([CoverageType] -&gt; Set CoverageType)
-&gt; [CoverageType]
-&gt; CoverageOpts
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[CoverageType] -&gt; Set CoverageType
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([CoverageType] -&gt; CoverageOpts) -&gt; [CoverageType] -&gt; CoverageOpts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-396"></span><span>                   </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CoverageType
</span><a href="#local-6989586621679446117"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Bool
</span><a href="PlutusTx.Options.html#_posCoverageAll"><span class="hs-identifier hs-var">_posCoverageAll</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446104"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679446117"><span class="annot"><span class="annottext">CoverageType
</span><a href="#local-6989586621679446117"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoverageType
forall a. Bounded a =&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Enum.html#minBound"><span class="hs-identifier hs-var">minBound</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">CoverageType
forall a. Bounded a =&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Enum.html#maxBound"><span class="hs-identifier hs-var">maxBound</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-397"></span><span>                </span><span class="annot"><span class="annottext">[CoverageType] -&gt; [CoverageType] -&gt; [CoverageType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CoverageType
</span><a href="PlutusTx.Compiler.Types.html#LocationCoverage"><span class="hs-identifier hs-var">LocationCoverage</span></a></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Bool
</span><a href="PlutusTx.Options.html#_posCoverageLocation"><span class="hs-identifier hs-var">_posCoverageLocation</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446104"><span class="hs-identifier hs-var">opts</span></a></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-398"></span><span>                </span><span class="annot"><span class="annottext">[CoverageType] -&gt; [CoverageType] -&gt; [CoverageType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CoverageType
</span><a href="PlutusTx.Compiler.Types.html#BooleanCoverage"><span class="hs-identifier hs-var">BooleanCoverage</span></a></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Bool
</span><a href="PlutusTx.Options.html#_posCoverageBoolean"><span class="hs-identifier hs-var">_posCoverageBoolean</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446104"><span class="hs-identifier hs-var">opts</span></a></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679446125"><span class="annot"><span class="annottext">ctx :: CompileContext DefaultUni DefaultFun
</span><a href="#local-6989586621679446125"><span class="hs-identifier hs-var hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusTx.Compiler.Types.html#CompileContext"><span class="hs-identifier hs-type">CompileContext</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-400"></span><span>            </span><span class="annot"><span class="annottext">ccOpts :: CompileOptions
</span><a href="PlutusTx.Compiler.Types.html#ccOpts"><span class="hs-identifier hs-var">ccOpts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusTx.Compiler.Types.html#CompileOptions"><span class="hs-identifier hs-type">CompileOptions</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-401"></span><span>                </span><span class="annot"><span class="annottext">coProfile :: ProfileOpts
</span><a href="PlutusTx.Compiler.Types.html#coProfile"><span class="hs-identifier hs-var">coProfile</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">PluginOptions -&gt; ProfileOpts
</span><a href="PlutusTx.Options.html#_posProfile"><span class="hs-identifier hs-var">_posProfile</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446104"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-402"></span><span>                </span><span class="hs-special">,</span><span class="annot"><span class="annottext">coCoverage :: CoverageOpts
</span><a href="PlutusTx.Compiler.Types.html#coCoverage"><span class="hs-identifier hs-var">coCoverage</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">CoverageOpts
</span><a href="#local-6989586621679446114"><span class="hs-identifier hs-var">coverage</span></a></span><span>
</span><span id="line-403"></span><span>                </span><span class="hs-special">,</span><span class="annot"><span class="annottext">coRemoveTrace :: Bool
</span><a href="PlutusTx.Compiler.Types.html#coRemoveTrace"><span class="hs-identifier hs-var">coRemoveTrace</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">PluginOptions -&gt; Bool
</span><a href="PlutusTx.Options.html#_posRemoveTrace"><span class="hs-identifier hs-var">_posRemoveTrace</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446104"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-404"></span><span>            </span><span class="annot"><span class="annottext">ccFlags :: DynFlags
</span><a href="PlutusTx.Compiler.Types.html#ccFlags"><span class="hs-identifier hs-var">ccFlags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621679446102"><span class="hs-identifier hs-var">flags</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-405"></span><span>            </span><span class="annot"><span class="annottext">ccFamInstEnvs :: FamInstEnvs
</span><a href="PlutusTx.Compiler.Types.html#ccFamInstEnvs"><span class="hs-identifier hs-var">ccFamInstEnvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621679446103"><span class="hs-identifier hs-var">famEnvs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-406"></span><span>            </span><span class="annot"><span class="annottext">ccNameInfo :: NameInfo
</span><a href="PlutusTx.Compiler.Types.html#ccNameInfo"><span class="hs-identifier hs-var">ccNameInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameInfo
</span><a href="#local-6989586621679446110"><span class="hs-identifier hs-var">nameInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-407"></span><span>            </span><span class="annot"><span class="annottext">ccScope :: Scope DefaultUni
</span><a href="PlutusTx.Compiler.Types.html#ccScope"><span class="hs-identifier hs-var">ccScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope DefaultUni
forall (uni :: * -&gt; *). Scope uni
</span><a href="PlutusTx.Compiler.Types.html#initialScope"><span class="hs-identifier hs-var">initialScope</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-408"></span><span>            </span><span class="annot"><span class="annottext">ccBlackholed :: Set Name
</span><a href="PlutusTx.Compiler.Types.html#ccBlackholed"><span class="hs-identifier hs-var">ccBlackholed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Name
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-409"></span><span>            </span><span class="annot"><span class="annottext">ccCurDef :: Maybe LexName
</span><a href="PlutusTx.Compiler.Types.html#ccCurDef"><span class="hs-identifier hs-var">ccCurDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe LexName
forall a. Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-410"></span><span>            </span><span class="annot"><span class="annottext">ccModBreaks :: Maybe ModBreaks
</span><a href="PlutusTx.Compiler.Types.html#ccModBreaks"><span class="hs-identifier hs-var">ccModBreaks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621679446113"><span class="hs-identifier hs-var">modBreaks</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-411"></span><span>            </span><span class="annot"><span class="annottext">ccBuiltinsInfo :: BuiltinsInfo DefaultUni DefaultFun
</span><a href="PlutusTx.Compiler.Types.html#ccBuiltinsInfo"><span class="hs-identifier hs-var">ccBuiltinsInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinsInfo DefaultUni DefaultFun
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span class="hs-special">,</span><span>
</span><span id="line-412"></span><span>            </span><span class="annot"><span class="annottext">ccBuiltinCostModel :: CostingPart DefaultUni DefaultFun
</span><a href="PlutusTx.Compiler.Types.html#ccBuiltinCostModel"><span class="hs-identifier hs-var">ccBuiltinCostModel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CostingPart DefaultUni DefaultFun
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span class="hs-special">,</span><span>
</span><span id="line-413"></span><span>            </span><span class="annot"><span class="annottext">ccDebugTraceOn :: Bool
</span><a href="PlutusTx.Compiler.Types.html#ccDebugTraceOn"><span class="hs-identifier hs-var">ccDebugTraceOn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Bool
</span><a href="PlutusTx.Options.html#_posDumpCompilationTrace"><span class="hs-identifier hs-var">_posDumpCompilationTrace</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446104"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-414"></span><span>            </span><span class="annot"><span class="annottext">ccRewriteRules :: RewriteRules DefaultUni DefaultFun
</span><a href="PlutusTx.Compiler.Types.html#ccRewriteRules"><span class="hs-identifier hs-var">ccRewriteRules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewriteRules DefaultUni DefaultFun
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-415"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-416"></span><span>        </span><span id="local-6989586621679446150"><span class="annot"><span class="annottext">st :: CompileState
</span><a href="#local-6989586621679446150"><span class="hs-identifier hs-var hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; CompileState
</span><a href="PlutusTx.Compiler.Types.html#CompileState"><span class="hs-identifier hs-var">CompileState</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[Int]
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-comment">-- See Note [Occurrence analysis]</span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679446152"><span class="annot"><span class="annottext">origE' :: CoreExpr
</span><a href="#local-6989586621679446152"><span class="hs-identifier hs-var hs-var">origE'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Opt.OccurAnal.html#occurAnalyseExpr"><span class="hs-identifier hs-var">GHC.occurAnalyseExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446101"><span class="hs-identifier hs-var">origE</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679446154"><span class="annot"><span class="annottext">PIRProgram DefaultUni DefaultFun
</span><a href="#local-6989586621679446154"><span class="hs-identifier hs-var">pirP</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679446155"><span class="annot"><span class="annottext">UPLCProgram DefaultUni DefaultFun
</span><a href="#local-6989586621679446155"><span class="hs-identifier hs-var">uplcP</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679446156"><span class="annot"><span class="annottext">CoverageIndex
</span><a href="#local-6989586621679446156"><span class="hs-identifier hs-var">covIdx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WriterT
  CoverageIndex
  (ReaderT
     PluginCtx (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM))
  (PIRProgram DefaultUni DefaultFun,
   UPLCProgram DefaultUni DefaultFun)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     ((PIRProgram DefaultUni DefaultFun,
       UPLCProgram DefaultUni DefaultFun),
      CoverageIndex)
forall w (m :: * -&gt; *) a. WriterT w m a -&gt; m (a, w)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Writer.Lazy.html#runWriterT"><span class="hs-identifier hs-var">runWriterT</span></a></span><span> </span><span class="annot"><span class="annottext">(WriterT
   CoverageIndex
   (ReaderT
      PluginCtx (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM))
   (PIRProgram DefaultUni DefaultFun,
    UPLCProgram DefaultUni DefaultFun)
 -&gt; ReaderT
      PluginCtx
      (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
      ((PIRProgram DefaultUni DefaultFun,
        UPLCProgram DefaultUni DefaultFun),
       CoverageIndex))
-&gt; (StateT
      CompileState
      (ReaderT
         (CompileContext DefaultUni DefaultFun)
         (QuoteT
            (WriterT
               CoverageIndex
               (ReaderT
                  PluginCtx
                  (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
      (PIRProgram DefaultUni DefaultFun,
       UPLCProgram DefaultUni DefaultFun)
    -&gt; WriterT
         CoverageIndex
         (ReaderT
            PluginCtx (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM))
         (PIRProgram DefaultUni DefaultFun,
          UPLCProgram DefaultUni DefaultFun))
-&gt; StateT
     CompileState
     (ReaderT
        (CompileContext DefaultUni DefaultFun)
        (QuoteT
           (WriterT
              CoverageIndex
              (ReaderT
                 PluginCtx
                 (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     ((PIRProgram DefaultUni DefaultFun,
       UPLCProgram DefaultUni DefaultFun),
      CoverageIndex)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteT
  (WriterT
     CoverageIndex
     (ReaderT
        PluginCtx
        (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))
  (PIRProgram DefaultUni DefaultFun,
   UPLCProgram DefaultUni DefaultFun)
-&gt; WriterT
     CoverageIndex
     (ReaderT
        PluginCtx (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
forall (m :: * -&gt; *) a. Monad m =&gt; QuoteT m a -&gt; m a
</span><span class="hs-identifier hs-var">runQuoteT</span></span><span> </span><span class="annot"><span class="annottext">(QuoteT
   (WriterT
      CoverageIndex
      (ReaderT
         PluginCtx
         (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))
   (PIRProgram DefaultUni DefaultFun,
    UPLCProgram DefaultUni DefaultFun)
 -&gt; WriterT
      CoverageIndex
      (ReaderT
         PluginCtx (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM))
      (PIRProgram DefaultUni DefaultFun,
       UPLCProgram DefaultUni DefaultFun))
-&gt; (StateT
      CompileState
      (ReaderT
         (CompileContext DefaultUni DefaultFun)
         (QuoteT
            (WriterT
               CoverageIndex
               (ReaderT
                  PluginCtx
                  (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
      (PIRProgram DefaultUni DefaultFun,
       UPLCProgram DefaultUni DefaultFun)
    -&gt; QuoteT
         (WriterT
            CoverageIndex
            (ReaderT
               PluginCtx
               (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))
         (PIRProgram DefaultUni DefaultFun,
          UPLCProgram DefaultUni DefaultFun))
-&gt; StateT
     CompileState
     (ReaderT
        (CompileContext DefaultUni DefaultFun)
        (QuoteT
           (WriterT
              CoverageIndex
              (ReaderT
                 PluginCtx
                 (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
-&gt; WriterT
     CoverageIndex
     (ReaderT
        PluginCtx (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   (CompileContext DefaultUni DefaultFun)
   (QuoteT
      (WriterT
         CoverageIndex
         (ReaderT
            PluginCtx
            (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM))))
   (PIRProgram DefaultUni DefaultFun,
    UPLCProgram DefaultUni DefaultFun)
 -&gt; CompileContext DefaultUni DefaultFun
 -&gt; QuoteT
      (WriterT
         CoverageIndex
         (ReaderT
            PluginCtx
            (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))
      (PIRProgram DefaultUni DefaultFun,
       UPLCProgram DefaultUni DefaultFun))
-&gt; CompileContext DefaultUni DefaultFun
-&gt; ReaderT
     (CompileContext DefaultUni DefaultFun)
     (QuoteT
        (WriterT
           CoverageIndex
           (ReaderT
              PluginCtx
              (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM))))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
-&gt; QuoteT
     (WriterT
        CoverageIndex
        (ReaderT
           PluginCtx
           (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT
  (CompileContext DefaultUni DefaultFun)
  (QuoteT
     (WriterT
        CoverageIndex
        (ReaderT
           PluginCtx
           (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM))))
  (PIRProgram DefaultUni DefaultFun,
   UPLCProgram DefaultUni DefaultFun)
-&gt; CompileContext DefaultUni DefaultFun
-&gt; QuoteT
     (WriterT
        CoverageIndex
        (ReaderT
           PluginCtx
           (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#runReaderT"><span class="hs-identifier hs-var">runReaderT</span></a></span><span> </span><span class="annot"><span class="annottext">CompileContext DefaultUni DefaultFun
</span><a href="#local-6989586621679446125"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   (CompileContext DefaultUni DefaultFun)
   (QuoteT
      (WriterT
         CoverageIndex
         (ReaderT
            PluginCtx
            (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM))))
   (PIRProgram DefaultUni DefaultFun,
    UPLCProgram DefaultUni DefaultFun)
 -&gt; QuoteT
      (WriterT
         CoverageIndex
         (ReaderT
            PluginCtx
            (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))
      (PIRProgram DefaultUni DefaultFun,
       UPLCProgram DefaultUni DefaultFun))
-&gt; (StateT
      CompileState
      (ReaderT
         (CompileContext DefaultUni DefaultFun)
         (QuoteT
            (WriterT
               CoverageIndex
               (ReaderT
                  PluginCtx
                  (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
      (PIRProgram DefaultUni DefaultFun,
       UPLCProgram DefaultUni DefaultFun)
    -&gt; ReaderT
         (CompileContext DefaultUni DefaultFun)
         (QuoteT
            (WriterT
               CoverageIndex
               (ReaderT
                  PluginCtx
                  (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM))))
         (PIRProgram DefaultUni DefaultFun,
          UPLCProgram DefaultUni DefaultFun))
-&gt; StateT
     CompileState
     (ReaderT
        (CompileContext DefaultUni DefaultFun)
        (QuoteT
           (WriterT
              CoverageIndex
              (ReaderT
                 PluginCtx
                 (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
-&gt; QuoteT
     (WriterT
        CoverageIndex
        (ReaderT
           PluginCtx
           (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT
   CompileState
   (ReaderT
      (CompileContext DefaultUni DefaultFun)
      (QuoteT
         (WriterT
            CoverageIndex
            (ReaderT
               PluginCtx
               (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
   (PIRProgram DefaultUni DefaultFun,
    UPLCProgram DefaultUni DefaultFun)
 -&gt; CompileState
 -&gt; ReaderT
      (CompileContext DefaultUni DefaultFun)
      (QuoteT
         (WriterT
            CoverageIndex
            (ReaderT
               PluginCtx
               (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM))))
      (PIRProgram DefaultUni DefaultFun,
       UPLCProgram DefaultUni DefaultFun))
-&gt; CompileState
-&gt; StateT
     CompileState
     (ReaderT
        (CompileContext DefaultUni DefaultFun)
        (QuoteT
           (WriterT
              CoverageIndex
              (ReaderT
                 PluginCtx
                 (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
-&gt; ReaderT
     (CompileContext DefaultUni DefaultFun)
     (QuoteT
        (WriterT
           CoverageIndex
           (ReaderT
              PluginCtx
              (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM))))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">StateT
  CompileState
  (ReaderT
     (CompileContext DefaultUni DefaultFun)
     (QuoteT
        (WriterT
           CoverageIndex
           (ReaderT
              PluginCtx
              (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
  (PIRProgram DefaultUni DefaultFun,
   UPLCProgram DefaultUni DefaultFun)
-&gt; CompileState
-&gt; ReaderT
     (CompileContext DefaultUni DefaultFun)
     (QuoteT
        (WriterT
           CoverageIndex
           (ReaderT
              PluginCtx
              (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM))))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.State.Lazy.html#evalStateT"><span class="hs-identifier hs-var">evalStateT</span></a></span><span> </span><span class="annot"><span class="annottext">CompileState
</span><a href="#local-6989586621679446150"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT
   CompileState
   (ReaderT
      (CompileContext DefaultUni DefaultFun)
      (QuoteT
         (WriterT
            CoverageIndex
            (ReaderT
               PluginCtx
               (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
   (PIRProgram DefaultUni DefaultFun,
    UPLCProgram DefaultUni DefaultFun)
 -&gt; ReaderT
      PluginCtx
      (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
      ((PIRProgram DefaultUni DefaultFun,
        UPLCProgram DefaultUni DefaultFun),
       CoverageIndex))
-&gt; StateT
     CompileState
     (ReaderT
        (CompileContext DefaultUni DefaultFun)
        (QuoteT
           (WriterT
              CoverageIndex
              (ReaderT
                 PluginCtx
                 (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     ((PIRProgram DefaultUni DefaultFun,
       UPLCProgram DefaultUni DefaultFun),
      CoverageIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-421"></span><span>        </span><span class="annot"><span class="annottext">Int
-&gt; SDoc
-&gt; StateT
     CompileState
     (ReaderT
        (CompileContext DefaultUni DefaultFun)
        (QuoteT
           (WriterT
              CoverageIndex
              (ReaderT
                 PluginCtx
                 (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
-&gt; StateT
     CompileState
     (ReaderT
        (CompileContext DefaultUni DefaultFun)
        (QuoteT
           (WriterT
              CoverageIndex
              (ReaderT
                 PluginCtx
                 (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
forall (uni :: * -&gt; *) fun (m :: * -&gt; *) e a.
(MonadReader (CompileContext uni fun) m, MonadState CompileState m,
 MonadError (WithContext Text e) m) =&gt;
Int -&gt; SDoc -&gt; m a -&gt; m a
</span><a href="PlutusTx.Compiler.Trace.html#traceCompilation"><span class="hs-identifier hs-var">traceCompilation</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-string">&quot;Compiling expr at&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">GHC.&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">GHC.text</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446099"><span class="hs-identifier hs-var">locStr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT
   CompileState
   (ReaderT
      (CompileContext DefaultUni DefaultFun)
      (QuoteT
         (WriterT
            CoverageIndex
            (ReaderT
               PluginCtx
               (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
   (PIRProgram DefaultUni DefaultFun,
    UPLCProgram DefaultUni DefaultFun)
 -&gt; StateT
      CompileState
      (ReaderT
         (CompileContext DefaultUni DefaultFun)
         (QuoteT
            (WriterT
               CoverageIndex
               (ReaderT
                  PluginCtx
                  (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
      (PIRProgram DefaultUni DefaultFun,
       UPLCProgram DefaultUni DefaultFun))
-&gt; StateT
     CompileState
     (ReaderT
        (CompileContext DefaultUni DefaultFun)
        (QuoteT
           (WriterT
              CoverageIndex
              (ReaderT
                 PluginCtx
                 (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
-&gt; StateT
     CompileState
     (ReaderT
        (CompileContext DefaultUni DefaultFun)
        (QuoteT
           (WriterT
              CoverageIndex
              (ReaderT
                 PluginCtx
                 (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-422"></span><span>            </span><span class="annot"><span class="annottext">CommandLineOption
-&gt; PluginOptions
-&gt; CoreExpr
-&gt; StateT
     CompileState
     (ReaderT
        (CompileContext DefaultUni DefaultFun)
        (QuoteT
           (WriterT
              CoverageIndex
              (ReaderT
                 PluginCtx
                 (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)))))
     (PIRProgram DefaultUni DefaultFun,
      UPLCProgram DefaultUni DefaultFun)
forall (uni :: * -&gt; *) fun (m :: * -&gt; *).
(uni ~ DefaultUni, fun ~ DefaultFun,
 MonadReader (CompileContext uni fun) m, MonadState CompileState m,
 MonadWriter CoverageIndex m, MonadQuote m,
 MonadError (CompileError uni fun Ann) m, MonadIO m) =&gt;
CommandLineOption
-&gt; PluginOptions
-&gt; CoreExpr
-&gt; m (PIRProgram uni fun, UPLCProgram uni fun)
</span><a href="PlutusTx.Plugin.html#runCompiler"><span class="hs-identifier hs-var">runCompiler</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446106"><span class="hs-identifier hs-var">moduleNameStr</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446104"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446152"><span class="hs-identifier hs-var">origE'</span></a></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-comment">-- serialize the PIR, PLC, and coverageindex outputs into a bytestring.</span><span>
</span><span id="line-425"></span><span>    </span><span id="local-6989586621679446164"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446164"><span class="hs-identifier hs-var">bsPir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall (uni :: * -&gt; *) fun. ByteString -&gt; PluginM uni fun CoreExpr
</span><a href="PlutusTx.Plugin.html#makeByteStringLiteral"><span class="hs-identifier hs-var">makeByteStringLiteral</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString
 -&gt; ReaderT
      PluginCtx
      (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
      CoreExpr)
-&gt; ByteString
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PIRProgram DefaultUni DefaultFun -&gt; ByteString
forall a. Flat a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">flat</span></span><span> </span><span class="annot"><span class="annottext">PIRProgram DefaultUni DefaultFun
</span><a href="#local-6989586621679446154"><span class="hs-identifier hs-var">pirP</span></a></span><span>
</span><span id="line-426"></span><span>    </span><span id="local-6989586621679446166"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446166"><span class="hs-identifier hs-var">bsPlc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall (uni :: * -&gt; *) fun. ByteString -&gt; PluginM uni fun CoreExpr
</span><a href="PlutusTx.Plugin.html#makeByteStringLiteral"><span class="hs-identifier hs-var">makeByteStringLiteral</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString
 -&gt; ReaderT
      PluginCtx
      (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
      CoreExpr)
-&gt; ByteString
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnrestrictedProgram NamedDeBruijn DefaultUni DefaultFun SrcSpans
-&gt; ByteString
forall a. Flat a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">flat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UPLCProgram DefaultUni DefaultFun
-&gt; UnrestrictedProgram NamedDeBruijn DefaultUni DefaultFun SrcSpans
forall name (uni :: * -&gt; *) fun ann.
Program name uni fun ann -&gt; UnrestrictedProgram name uni fun ann
</span><span class="hs-identifier hs-var">UPLC.UnrestrictedProgram</span></span><span> </span><span class="annot"><span class="annottext">UPLCProgram DefaultUni DefaultFun
</span><a href="#local-6989586621679446155"><span class="hs-identifier hs-var">uplcP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>    </span><span id="local-6989586621679446168"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446168"><span class="hs-identifier hs-var">covIdxFlat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall (uni :: * -&gt; *) fun. ByteString -&gt; PluginM uni fun CoreExpr
</span><a href="PlutusTx.Plugin.html#makeByteStringLiteral"><span class="hs-identifier hs-var">makeByteStringLiteral</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString
 -&gt; ReaderT
      PluginCtx
      (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
      CoreExpr)
-&gt; ByteString
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoverageIndex -&gt; ByteString
forall a. Flat a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">flat</span></span><span> </span><span class="annot"><span class="annottext">CoverageIndex
</span><a href="#local-6989586621679446156"><span class="hs-identifier hs-var">covIdx</span></a></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span>    </span><span id="local-6989586621679446169"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679446169"><span class="hs-identifier hs-var">builder</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM Var
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     Var
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT PluginCtx m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM Var
 -&gt; ReaderT
      PluginCtx
      (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
      Var)
-&gt; (Name
    -&gt; ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM Var)
-&gt; Name
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     Var
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CoreM Var
-&gt; ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM Var
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; ExceptT (CompileError DefaultUni DefaultFun Ann) m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreM Var
 -&gt; ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM Var)
-&gt; (Name -&gt; CoreM Var)
-&gt; Name
-&gt; ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM Var
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; CoreM Var
forall (m :: * -&gt; *). MonadThings m =&gt; Name -&gt; m Var
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Types.TyThing.html#lookupId"><span class="hs-identifier hs-var">GHC.lookupId</span></a></span><span> </span><span class="annot"><span class="annottext">(Name
 -&gt; ReaderT
      PluginCtx
      (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
      Var)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     Name
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     Var
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     Name
forall (uni :: * -&gt; *) fun. Name -&gt; PluginM uni fun Name
</span><a href="PlutusTx.Plugin.html#thNameToGhcNameOrFail"><span class="hs-identifier hs-var">thNameToGhcNameOrFail</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">mkCompiledCode</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-comment">-- inject the three bytestrings back as Haskell code.</span><span>
</span><span id="line-432"></span><span>    </span><span class="annot"><span class="annottext">CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a.
a
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr
 -&gt; ReaderT
      PluginCtx
      (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
      CoreExpr)
-&gt; CoreExpr
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError DefaultUni DefaultFun Ann) CoreM)
     CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-433"></span><span>        </span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. Var -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Var"><span class="hs-identifier hs-var">GHC.Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679446169"><span class="hs-identifier hs-var">builder</span></a></span><span>
</span><span id="line-434"></span><span>        </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#App"><span class="hs-operator hs-var">`GHC.App`</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Type"><span class="hs-identifier hs-var">GHC.Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679446100"><span class="hs-identifier hs-var">codeTy</span></a></span><span>
</span><span id="line-435"></span><span>        </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#App"><span class="hs-operator hs-var">`GHC.App`</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446166"><span class="hs-identifier hs-var">bsPlc</span></a></span><span>
</span><span id="line-436"></span><span>        </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#App"><span class="hs-operator hs-var">`GHC.App`</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446164"><span class="hs-identifier hs-var">bsPir</span></a></span><span>
</span><span id="line-437"></span><span>        </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#App"><span class="hs-operator hs-var">`GHC.App`</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446168"><span class="hs-identifier hs-var">covIdxFlat</span></a></span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="hs-comment">-- | The GHC.Core to PIR to PLC compiler pipeline. Returns both the PIR and PLC output.</span><span>
</span><span id="line-440"></span><span class="hs-comment">-- It invokes the whole compiler chain:  Core expr -&gt; PIR expr -&gt; PLC expr -&gt; UPLC expr.</span><span>
</span><span id="line-441"></span><span class="annot"><a href="PlutusTx.Plugin.html#runCompiler"><span class="hs-identifier hs-type">runCompiler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-442"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679445174"><span class="annot"><a href="#local-6989586621679445174"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621679445175"><span class="annot"><a href="#local-6989586621679445175"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621679445176"><span class="annot"><a href="#local-6989586621679445176"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-443"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621679445174"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#~"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PLC.DefaultUni</span></span><span>
</span><span id="line-444"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679445175"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#~"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PLC.DefaultFun</span></span><span>
</span><span id="line-445"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Reader.Class.html#MonadReader"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.Compiler.Types.html#CompileContext"><span class="hs-identifier hs-type">CompileContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445174"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445175"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679445176"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-446"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#MonadState"><span class="hs-identifier hs-type">MonadState</span></a></span><span> </span><span class="annot"><a href="PlutusTx.Compiler.Types.html#CompileState"><span class="hs-identifier hs-type">CompileState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445176"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-447"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Writer.Class.html#MonadWriter"><span class="hs-identifier hs-type">MonadWriter</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CoverageIndex</span></span><span> </span><span class="annot"><a href="#local-6989586621679445176"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-448"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadQuote</span></span><span> </span><span class="annot"><a href="#local-6989586621679445176"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-449"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#MonadError"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.Compiler.Error.html#CompileError"><span class="hs-identifier hs-type">CompileError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445174"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445175"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679445176"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-450"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.IO.Class.html#MonadIO"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445176"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-451"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-452"></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-453"></span><span>    </span><span class="annot"><a href="PlutusTx.Options.html#PluginOptions"><span class="hs-identifier hs-type">PluginOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-454"></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">GHC.CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-455"></span><span>    </span><span class="annot"><a href="#local-6989586621679445176"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.PIRTypes.html#PIRProgram"><span class="hs-identifier hs-type">PIRProgram</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445174"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445175"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusTx.PLCTypes.html#UPLCProgram"><span class="hs-identifier hs-type">UPLCProgram</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445174"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445175"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span id="runCompiler"><span class="annot"><span class="annottext">runCompiler :: forall (uni :: * -&gt; *) fun (m :: * -&gt; *).
(uni ~ DefaultUni, fun ~ DefaultFun,
 MonadReader (CompileContext uni fun) m, MonadState CompileState m,
 MonadWriter CoverageIndex m, MonadQuote m,
 MonadError (CompileError uni fun Ann) m, MonadIO m) =&gt;
CommandLineOption
-&gt; PluginOptions
-&gt; CoreExpr
-&gt; m (PIRProgram uni fun, UPLCProgram uni fun)
</span><a href="PlutusTx.Plugin.html#runCompiler"><span class="hs-identifier hs-var hs-var">runCompiler</span></a></span></span><span> </span><span id="local-6989586621679446435"><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446435"><span class="hs-identifier hs-var">moduleName</span></a></span></span><span> </span><span id="local-6989586621679446436"><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679446437"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446437"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-comment">-- Plc configuration</span><span>
</span><span id="line-458"></span><span>    </span><span id="local-6989586621679446438"><span class="annot"><span class="annottext">TypeCheckConfig uni fun
</span><a href="#local-6989586621679446438"><span class="hs-identifier hs-var">plcTcConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Provenance Ann -&gt; m (TypeCheckConfig uni fun)
forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
(MonadKindCheck err term uni fun ann m, Typecheckable uni fun) =&gt;
ann -&gt; m (TypeCheckConfig uni fun)
</span><span class="hs-identifier hs-var">PLC.getDefTypeCheckConfig</span></span><span> </span><span class="annot"><span class="annottext">Provenance Ann
forall a. Provenance a
</span><span class="hs-identifier hs-var">PIR.noProvenance</span></span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679446440"><span class="annot"><span class="annottext">plcVersion :: Version
</span><a href="#local-6989586621679446440"><span class="hs-identifier hs-var hs-var">plcVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Version PluginOptions Version -&gt; Version
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Version PluginOptions Version
Lens' PluginOptions Version
</span><a href="PlutusTx.Options.html#posPlcTargetVersion"><span class="hs-identifier hs-var">posPlcTargetVersion</span></a></span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679446448"><span class="annot"><span class="annottext">hints :: InlineHints name (Provenance Ann)
</span><a href="#local-6989586621679446448"><span class="hs-identifier hs-var hs-var">hints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Provenance Ann -&gt; name -&gt; Bool)
-&gt; InlineHints name (Provenance Ann)
forall name a. (a -&gt; name -&gt; Bool) -&gt; InlineHints name a
</span><span class="hs-identifier hs-var">UPLC.InlineHints</span></span><span> </span><span class="annot"><span class="annottext">((Provenance Ann -&gt; name -&gt; Bool)
 -&gt; InlineHints name (Provenance Ann))
-&gt; (Provenance Ann -&gt; name -&gt; Bool)
-&gt; InlineHints name (Provenance Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679446450"><span class="annot"><span class="annottext">Provenance Ann
</span><a href="#local-6989586621679446450"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="annot"><span class="annottext">name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Provenance Ann
</span><a href="#local-6989586621679446450"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-462"></span><span>            </span><span class="hs-comment">-- See Note [The problem of inlining destructors]</span><span>
</span><span id="line-463"></span><span>            </span><span class="hs-comment">-- We want to inline destructors, but even in UPLC our inlining heuristics</span><span>
</span><span id="line-464"></span><span>            </span><span class="hs-comment">-- aren't quite smart enough to tell that they're good inlining candidates,</span><span>
</span><span id="line-465"></span><span>            </span><span class="hs-comment">-- so we just explicitly tell the inliner to inline them all.</span><span>
</span><span id="line-466"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-467"></span><span>            </span><span class="hs-comment">-- In fact, this instructs the inliner to inline *any* binding inside a destructor,</span><span>
</span><span id="line-468"></span><span>            </span><span class="hs-comment">-- which is a slightly large hammer but is actually what we want since it will mean</span><span>
</span><span id="line-469"></span><span>            </span><span class="hs-comment">-- that we also aggressively reduce the bindings inside the destructor.</span><span>
</span><span id="line-470"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">PIR.DatatypeComponent</span></span><span> </span><span class="annot"><span class="annottext">DatatypeComponent
</span><span class="hs-identifier hs-var">PIR.Destructor</span></span><span> </span><span class="annot"><span class="annottext">Provenance Ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-471"></span><span>            </span><span class="annot"><span class="annottext">Provenance Ann
</span><span class="hs-identifier">_</span></span><span>                                      </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-472"></span><span>                </span><span class="annot"><span class="annottext">Inline
</span><span class="hs-identifier hs-var">AlwaysInline</span></span><span> </span><span class="annot"><span class="annottext">Inline -&gt; [Inline] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">(Ann -&gt; Inline) -&gt; [Ann] -&gt; [Inline]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Inline
</span><span class="hs-identifier hs-var">annInline</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Provenance Ann -&gt; [Ann]
forall a. Provenance a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Provenance Ann
</span><a href="#local-6989586621679446450"><span class="hs-identifier hs-var">ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-473"></span><span>    </span><span class="hs-comment">-- Compilation configuration</span><span>
</span><span id="line-474"></span><span>    </span><span class="hs-comment">-- pir's tc-config is based on plc tcconfig</span><span>
</span><span id="line-475"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679446457"><span class="annot"><span class="annottext">pirTcConfig :: PirTCConfig uni fun
</span><a href="#local-6989586621679446457"><span class="hs-identifier hs-var hs-var">pirTcConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeCheckConfig uni fun -&gt; AllowEscape -&gt; PirTCConfig uni fun
forall (uni :: * -&gt; *) fun.
TypeCheckConfig uni fun -&gt; AllowEscape -&gt; PirTCConfig uni fun
</span><span class="hs-identifier hs-var">PIR.PirTCConfig</span></span><span> </span><span class="annot"><span class="annottext">TypeCheckConfig uni fun
</span><a href="#local-6989586621679446438"><span class="hs-identifier hs-var">plcTcConfig</span></a></span><span> </span><span class="annot"><span class="annottext">AllowEscape
</span><span class="hs-identifier hs-var">PIR.YesEscape</span></span><span>
</span><span id="line-476"></span><span>        </span><span id="local-6989586621679446460"><span class="annot"><span class="annottext">pirCtx :: CompilationCtx uni fun Ann
</span><a href="#local-6989586621679446460"><span class="hs-identifier hs-var hs-var">pirCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeCheckConfig uni fun -&gt; CompilationCtx uni fun Ann
forall (uni :: * -&gt; *) fun a.
(Default (BuiltinsInfo uni fun), Default (CostingPart uni fun),
 Default (RewriteRules uni fun)) =&gt;
TypeCheckConfig uni fun -&gt; CompilationCtx uni fun a
</span><span class="hs-identifier hs-var">PIR.toDefaultCompilationCtx</span></span><span> </span><span class="annot"><span class="annottext">TypeCheckConfig uni fun
</span><a href="#local-6989586621679446438"><span class="hs-identifier hs-var">plcTcConfig</span></a></span><span>
</span><span id="line-477"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
-&gt; Bool -&gt; CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool) -&gt; CompilationOpts a -&gt; f (CompilationOpts a)
</span><span class="hs-identifier hs-var">PIR.coOptimize</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posOptimize"><span class="hs-identifier hs-var">posOptimize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
-&gt; Bool -&gt; CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool) -&gt; CompilationOpts a -&gt; f (CompilationOpts a)
</span><span class="hs-identifier hs-var">PIR.coTypecheck</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posDoTypecheck"><span class="hs-identifier hs-var">posDoTypecheck</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
-&gt; Bool -&gt; CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool) -&gt; CompilationOpts a -&gt; f (CompilationOpts a)
</span><span class="hs-identifier hs-var">PIR.coPedantic</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posPedantic"><span class="hs-identifier hs-var">posPedantic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
-&gt; Bool -&gt; CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool) -&gt; CompilationOpts a -&gt; f (CompilationOpts a)
</span><span class="hs-identifier hs-var">PIR.coVerbose</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions
-&gt; Getting Verbosity PluginOptions Verbosity -&gt; Verbosity
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Verbosity PluginOptions Verbosity
Lens' PluginOptions Verbosity
</span><a href="PlutusTx.Options.html#posVerbosity"><span class="hs-identifier hs-var">posVerbosity</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity -&gt; Verbosity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="PlutusTx.Compiler.Types.html#Verbose"><span class="hs-identifier hs-var">Verbose</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
-&gt; Bool -&gt; CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool) -&gt; CompilationOpts a -&gt; f (CompilationOpts a)
</span><span class="hs-identifier hs-var">PIR.coDebug</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions
-&gt; Getting Verbosity PluginOptions Verbosity -&gt; Verbosity
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Verbosity PluginOptions Verbosity
Lens' PluginOptions Verbosity
</span><a href="PlutusTx.Options.html#posVerbosity"><span class="hs-identifier hs-var">posVerbosity</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity -&gt; Verbosity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="PlutusTx.Compiler.Types.html#Debug"><span class="hs-identifier hs-var">Debug</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Int Int
-&gt; Int -&gt; CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((Int -&gt; Identity Int)
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Int Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Identity Int)
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Int -&gt; f Int) -&gt; CompilationOpts a -&gt; f (CompilationOpts a)
</span><span class="hs-identifier hs-var">PIR.coMaxSimplifierIterations</span></span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Int PluginOptions Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Int PluginOptions Int
Lens' PluginOptions Int
</span><a href="PlutusTx.Options.html#posMaxSimplifierIterationsPir"><span class="hs-identifier hs-var">posMaxSimplifierIterationsPir</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann)
  (CompilationCtx uni fun Ann)
  (PirTCConfig uni fun)
  (PirTCConfig uni fun)
-&gt; PirTCConfig uni fun
-&gt; CompilationCtx uni fun Ann
-&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann)
  (CompilationCtx uni fun Ann)
  (PirTCConfig uni fun)
  (PirTCConfig uni fun)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(PirTCConfig uni fun -&gt; f (PirTCConfig uni fun))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccTypeCheckConfig</span></span><span> </span><span class="annot"><span class="annottext">PirTCConfig uni fun
</span><a href="#local-6989586621679446457"><span class="hs-identifier hs-var">pirTcConfig</span></a></span><span>
</span><span id="line-485"></span><span>                 </span><span class="hs-comment">-- Simplifier options</span><span>
</span><span id="line-486"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
-&gt; Bool -&gt; CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool) -&gt; CompilationOpts a -&gt; f (CompilationOpts a)
</span><span class="hs-identifier hs-var">PIR.coDoSimplifierUnwrapCancel</span></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posDoSimplifierUnwrapCancel"><span class="hs-identifier hs-var">posDoSimplifierUnwrapCancel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
-&gt; Bool -&gt; CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool) -&gt; CompilationOpts a -&gt; f (CompilationOpts a)
</span><span class="hs-identifier hs-var">PIR.coDoSimplifierBeta</span></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posDoSimplifierBeta"><span class="hs-identifier hs-var">posDoSimplifierBeta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
-&gt; Bool -&gt; CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool) -&gt; CompilationOpts a -&gt; f (CompilationOpts a)
</span><span class="hs-identifier hs-var">PIR.coDoSimplifierInline</span></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posDoSimplifierInline"><span class="hs-identifier hs-var">posDoSimplifierInline</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
-&gt; Bool -&gt; CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool) -&gt; CompilationOpts a -&gt; f (CompilationOpts a)
</span><span class="hs-identifier hs-var">PIR.coDoSimplifierEvaluateBuiltins</span></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posDoSimplifierEvaluateBuiltins"><span class="hs-identifier hs-var">posDoSimplifierEvaluateBuiltins</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
-&gt; Bool -&gt; CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool) -&gt; CompilationOpts a -&gt; f (CompilationOpts a)
</span><span class="hs-identifier hs-var">PIR.coDoSimplifierStrictifyBindings</span></span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posDoSimplifierStrictifyBindings"><span class="hs-identifier hs-var">posDoSimplifierStrictifyBindings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann)
  (CompilationCtx uni fun Ann)
  (InlineHints Name (Provenance Ann))
  (InlineHints Name (Provenance Ann))
-&gt; InlineHints Name (Provenance Ann)
-&gt; CompilationCtx uni fun Ann
-&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((InlineHints Name (Provenance Ann)
     -&gt; Identity (InlineHints Name (Provenance Ann)))
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann)
     (CompilationCtx uni fun Ann)
     (InlineHints Name (Provenance Ann))
     (InlineHints Name (Provenance Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(InlineHints Name (Provenance Ann)
 -&gt; Identity (InlineHints Name (Provenance Ann)))
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a1 a2 (f :: * -&gt; *).
Functor f =&gt;
(InlineHints Name (Provenance a1)
 -&gt; f (InlineHints Name (Provenance a2)))
-&gt; CompilationOpts a1 -&gt; f (CompilationOpts a2)
</span><span class="hs-identifier hs-var">PIR.coInlineHints</span></span><span class="hs-special">)</span><span>                    </span><span class="annot"><span class="annottext">InlineHints Name (Provenance Ann)
forall {name}. InlineHints name (Provenance Ann)
</span><a href="#local-6989586621679446448"><span class="hs-identifier hs-var">hints</span></a></span><span>
</span><span id="line-497"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
-&gt; Bool -&gt; CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool) -&gt; CompilationOpts a -&gt; f (CompilationOpts a)
</span><span class="hs-identifier hs-var">PIR.coRelaxedFloatin</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posRelaxedFloatin"><span class="hs-identifier hs-var">posRelaxedFloatin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
-&gt; Bool -&gt; CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool) -&gt; CompilationOpts a -&gt; f (CompilationOpts a)
</span><span class="hs-identifier hs-var">PIR.coCaseOfCaseConservative</span></span><span class="hs-special">)</span><span>
</span><span id="line-499"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posCaseOfCaseConservative"><span class="hs-identifier hs-var">posCaseOfCaseConservative</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
-&gt; Bool -&gt; CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann) (CompilationCtx uni fun Ann) Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool) -&gt; CompilationOpts a -&gt; f (CompilationOpts a)
</span><span class="hs-identifier hs-var">PIR.coPreserveLogging</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posPreserveLogging"><span class="hs-identifier hs-var">posPreserveLogging</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>                 </span><span class="hs-comment">-- We could make this configurable with an option, but:</span><span>
</span><span id="line-502"></span><span>                 </span><span class="hs-comment">-- 1. The only other choice you can make is new version + Scott encoding, and</span><span>
</span><span id="line-503"></span><span>                 </span><span class="hs-comment">-- there's really no reason to pick that</span><span>
</span><span id="line-504"></span><span>                 </span><span class="hs-comment">-- 2. This is consistent with what we do in Lift</span><span>
</span><span id="line-505"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann)
  (CompilationCtx uni fun Ann)
  DatatypeStyle
  DatatypeStyle
-&gt; DatatypeStyle
-&gt; CompilationCtx uni fun Ann
-&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CompilationOpts a -&gt; f (CompilationOpts a))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccOpts</span></span><span> </span><span class="annot"><span class="annottext">((CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; Identity (CompilationCtx uni fun Ann))
-&gt; ((DatatypeStyle -&gt; Identity DatatypeStyle)
    -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ASetter
     (CompilationCtx uni fun Ann)
     (CompilationCtx uni fun Ann)
     DatatypeStyle
     DatatypeStyle
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(DatatypeCompilationOpts -&gt; Identity DatatypeCompilationOpts)
-&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann)
forall a (f :: * -&gt; *).
Functor f =&gt;
(DatatypeCompilationOpts -&gt; f DatatypeCompilationOpts)
-&gt; CompilationOpts a -&gt; f (CompilationOpts a)
</span><span class="hs-identifier hs-var">PIR.coDatatypes</span></span><span> </span><span class="annot"><span class="annottext">((DatatypeCompilationOpts -&gt; Identity DatatypeCompilationOpts)
 -&gt; CompilationOpts Ann -&gt; Identity (CompilationOpts Ann))
-&gt; ((DatatypeStyle -&gt; Identity DatatypeStyle)
    -&gt; DatatypeCompilationOpts -&gt; Identity DatatypeCompilationOpts)
-&gt; (DatatypeStyle -&gt; Identity DatatypeStyle)
-&gt; CompilationOpts Ann
-&gt; Identity (CompilationOpts Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(DatatypeStyle -&gt; Identity DatatypeStyle)
-&gt; DatatypeCompilationOpts -&gt; Identity DatatypeCompilationOpts
Iso' DatatypeCompilationOpts DatatypeStyle
</span><span class="hs-identifier hs-var">PIR.dcoStyle</span></span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>                    </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679446440"><span class="hs-identifier hs-var">plcVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Version -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">PLC.plcVersion110</span></span><span>
</span><span id="line-507"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DatatypeStyle
</span><span class="hs-identifier hs-var">PIR.ScottEncoding</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DatatypeStyle
</span><span class="hs-identifier hs-var">PIR.SumsOfProducts</span></span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>                 </span><span class="hs-comment">-- TODO: ensure the same as the one used in the plugin</span><span>
</span><span id="line-509"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann)
  (CompilationCtx uni fun Ann)
  (BuiltinsInfo uni fun)
  (BuiltinsInfo uni fun)
-&gt; BuiltinsInfo uni fun
-&gt; CompilationCtx uni fun Ann
-&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann)
  (CompilationCtx uni fun Ann)
  (BuiltinsInfo uni fun)
  (BuiltinsInfo uni fun)
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(BuiltinsInfo uni fun -&gt; f (BuiltinsInfo uni fun))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccBuiltinsInfo</span></span><span> </span><span class="annot"><span class="annottext">BuiltinsInfo uni fun
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-510"></span><span>                 </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
-&gt; (CompilationCtx uni fun Ann -&gt; CompilationCtx uni fun Ann)
-&gt; CompilationCtx uni fun Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationCtx uni fun Ann)
  (CompilationCtx uni fun Ann)
  BuiltinCostModel
  BuiltinCostModel
-&gt; BuiltinCostModel
-&gt; CompilationCtx uni fun Ann
-&gt; CompilationCtx uni fun Ann
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="annot"><span class="annottext">(CostingPart uni fun -&gt; Identity (CostingPart uni fun))
-&gt; CompilationCtx uni fun Ann
-&gt; Identity (CompilationCtx uni fun Ann)
ASetter
  (CompilationCtx uni fun Ann)
  (CompilationCtx uni fun Ann)
  BuiltinCostModel
  BuiltinCostModel
forall (uni :: * -&gt; *) fun a (f :: * -&gt; *).
Functor f =&gt;
(CostingPart uni fun -&gt; f (CostingPart uni fun))
-&gt; CompilationCtx uni fun a -&gt; f (CompilationCtx uni fun a)
</span><span class="hs-identifier hs-var">PIR.ccBuiltinCostModel</span></span><span> </span><span class="annot"><span class="annottext">BuiltinCostModel
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-511"></span><span>        </span><span id="local-6989586621679446504"><span class="annot"><span class="annottext">plcOpts :: CompilationOpts Name (Provenance Ann)
</span><a href="#local-6989586621679446504"><span class="hs-identifier hs-var hs-var">plcOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompilationOpts Any Any
forall name a. CompilationOpts name a
</span><span class="hs-identifier hs-var">PLC.defaultCompilationOpts</span></span><span>
</span><span id="line-512"></span><span>            </span><span class="annot"><span class="annottext">CompilationOpts Any Any
-&gt; (CompilationOpts Any Any -&gt; CompilationOpts Any Any)
-&gt; CompilationOpts Any Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter (CompilationOpts Any Any) (CompilationOpts Any Any) Int Int
-&gt; Int -&gt; CompilationOpts Any Any -&gt; CompilationOpts Any Any
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SimplifyOpts Any Any -&gt; Identity (SimplifyOpts Any Any))
-&gt; CompilationOpts Any Any -&gt; Identity (CompilationOpts Any Any)
forall name1 a1 name2 a2 (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Profunctor p, Functor f) =&gt;
p (SimplifyOpts name1 a1) (f (SimplifyOpts name2 a2))
-&gt; p (CompilationOpts name1 a1) (f (CompilationOpts name2 a2))
</span><span class="hs-identifier hs-var">PLC.coSimplifyOpts</span></span><span> </span><span class="annot"><span class="annottext">((SimplifyOpts Any Any -&gt; Identity (SimplifyOpts Any Any))
 -&gt; CompilationOpts Any Any -&gt; Identity (CompilationOpts Any Any))
-&gt; ((Int -&gt; Identity Int)
    -&gt; SimplifyOpts Any Any -&gt; Identity (SimplifyOpts Any Any))
-&gt; ASetter
     (CompilationOpts Any Any) (CompilationOpts Any Any) Int Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Identity Int)
-&gt; SimplifyOpts Any Any -&gt; Identity (SimplifyOpts Any Any)
forall name a (f :: * -&gt; *).
Functor f =&gt;
(Int -&gt; f Int) -&gt; SimplifyOpts name a -&gt; f (SimplifyOpts name a)
</span><span class="hs-identifier hs-var">UPLC.soMaxSimplifierIterations</span></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Int PluginOptions Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Int PluginOptions Int
Lens' PluginOptions Int
</span><a href="PlutusTx.Options.html#posMaxSimplifierIterationsUPlc"><span class="hs-identifier hs-var">posMaxSimplifierIterationsUPlc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>            </span><span class="annot"><span class="annottext">CompilationOpts Any Any
-&gt; (CompilationOpts Any Any -&gt; CompilationOpts Any Any)
-&gt; CompilationOpts Any Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter (CompilationOpts Any Any) (CompilationOpts Any Any) Int Int
-&gt; Int -&gt; CompilationOpts Any Any -&gt; CompilationOpts Any Any
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SimplifyOpts Any Any -&gt; Identity (SimplifyOpts Any Any))
-&gt; CompilationOpts Any Any -&gt; Identity (CompilationOpts Any Any)
forall name1 a1 name2 a2 (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Profunctor p, Functor f) =&gt;
p (SimplifyOpts name1 a1) (f (SimplifyOpts name2 a2))
-&gt; p (CompilationOpts name1 a1) (f (CompilationOpts name2 a2))
</span><span class="hs-identifier hs-var">PLC.coSimplifyOpts</span></span><span> </span><span class="annot"><span class="annottext">((SimplifyOpts Any Any -&gt; Identity (SimplifyOpts Any Any))
 -&gt; CompilationOpts Any Any -&gt; Identity (CompilationOpts Any Any))
-&gt; ((Int -&gt; Identity Int)
    -&gt; SimplifyOpts Any Any -&gt; Identity (SimplifyOpts Any Any))
-&gt; ASetter
     (CompilationOpts Any Any) (CompilationOpts Any Any) Int Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Identity Int)
-&gt; SimplifyOpts Any Any -&gt; Identity (SimplifyOpts Any Any)
forall name a (f :: * -&gt; *).
Functor f =&gt;
(Int -&gt; f Int) -&gt; SimplifyOpts name a -&gt; f (SimplifyOpts name a)
</span><span class="hs-identifier hs-var">UPLC.soMaxCseIterations</span></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Int PluginOptions Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Int PluginOptions Int
Lens' PluginOptions Int
</span><a href="PlutusTx.Options.html#posMaxCseIterations"><span class="hs-identifier hs-var">posMaxCseIterations</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>            </span><span class="annot"><span class="annottext">CompilationOpts Any Any
-&gt; (CompilationOpts Any Any -&gt; CompilationOpts Any Any)
-&gt; CompilationOpts Any Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationOpts Any Any) (CompilationOpts Any Any) Bool Bool
-&gt; Bool -&gt; CompilationOpts Any Any -&gt; CompilationOpts Any Any
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SimplifyOpts Any Any -&gt; Identity (SimplifyOpts Any Any))
-&gt; CompilationOpts Any Any -&gt; Identity (CompilationOpts Any Any)
forall name1 a1 name2 a2 (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Profunctor p, Functor f) =&gt;
p (SimplifyOpts name1 a1) (f (SimplifyOpts name2 a2))
-&gt; p (CompilationOpts name1 a1) (f (CompilationOpts name2 a2))
</span><span class="hs-identifier hs-var">PLC.coSimplifyOpts</span></span><span> </span><span class="annot"><span class="annottext">((SimplifyOpts Any Any -&gt; Identity (SimplifyOpts Any Any))
 -&gt; CompilationOpts Any Any -&gt; Identity (CompilationOpts Any Any))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; SimplifyOpts Any Any -&gt; Identity (SimplifyOpts Any Any))
-&gt; ASetter
     (CompilationOpts Any Any) (CompilationOpts Any Any) Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; SimplifyOpts Any Any -&gt; Identity (SimplifyOpts Any Any)
forall name a (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool) -&gt; SimplifyOpts name a -&gt; f (SimplifyOpts name a)
</span><span class="hs-identifier hs-var">UPLC.soConservativeOpts</span></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posConservativeOpts"><span class="hs-identifier hs-var">posConservativeOpts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>            </span><span class="annot"><span class="annottext">CompilationOpts Any Any
-&gt; (CompilationOpts Any Any
    -&gt; CompilationOpts Name (Provenance Ann))
-&gt; CompilationOpts Name (Provenance Ann)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (CompilationOpts Any Any)
  (CompilationOpts Name (Provenance Ann))
  (InlineHints Any Any)
  (InlineHints Name (Provenance Ann))
-&gt; InlineHints Name (Provenance Ann)
-&gt; CompilationOpts Any Any
-&gt; CompilationOpts Name (Provenance Ann)
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SimplifyOpts Any Any
 -&gt; Identity (SimplifyOpts Name (Provenance Ann)))
-&gt; CompilationOpts Any Any
-&gt; Identity (CompilationOpts Name (Provenance Ann))
forall name1 a1 name2 a2 (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Profunctor p, Functor f) =&gt;
p (SimplifyOpts name1 a1) (f (SimplifyOpts name2 a2))
-&gt; p (CompilationOpts name1 a1) (f (CompilationOpts name2 a2))
</span><span class="hs-identifier hs-var">PLC.coSimplifyOpts</span></span><span> </span><span class="annot"><span class="annottext">((SimplifyOpts Any Any
  -&gt; Identity (SimplifyOpts Name (Provenance Ann)))
 -&gt; CompilationOpts Any Any
 -&gt; Identity (CompilationOpts Name (Provenance Ann)))
-&gt; ((InlineHints Any Any
     -&gt; Identity (InlineHints Name (Provenance Ann)))
    -&gt; SimplifyOpts Any Any
    -&gt; Identity (SimplifyOpts Name (Provenance Ann)))
-&gt; ASetter
     (CompilationOpts Any Any)
     (CompilationOpts Name (Provenance Ann))
     (InlineHints Any Any)
     (InlineHints Name (Provenance Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(InlineHints Any Any
 -&gt; Identity (InlineHints Name (Provenance Ann)))
-&gt; SimplifyOpts Any Any
-&gt; Identity (SimplifyOpts Name (Provenance Ann))
forall name1 a1 name2 a2 (f :: * -&gt; *).
Functor f =&gt;
(InlineHints name1 a1 -&gt; f (InlineHints name2 a2))
-&gt; SimplifyOpts name1 a1 -&gt; f (SimplifyOpts name2 a2)
</span><span class="hs-identifier hs-var">UPLC.soInlineHints</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InlineHints Name (Provenance Ann)
forall {name}. InlineHints name (Provenance Ann)
</span><a href="#local-6989586621679446448"><span class="hs-identifier hs-var">hints</span></a></span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span>    </span><span class="hs-comment">-- GHC.Core -&gt; Pir translation.</span><span>
</span><span id="line-521"></span><span>    </span><span id="local-6989586621679446514"><span class="annot"><span class="annottext">Term TyName Name uni fun (Provenance Ann)
</span><a href="#local-6989586621679446514"><span class="hs-identifier hs-var">pirT</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun Ann
-&gt; Term TyName Name uni fun (Provenance Ann)
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f (Provenance a)
</span><span class="hs-identifier hs-var">original</span></span><span> </span><span class="annot"><span class="annottext">(Term TyName Name uni fun Ann
 -&gt; Term TyName Name uni fun (Provenance Ann))
-&gt; m (Term TyName Name uni fun Ann)
-&gt; m (Term TyName Name uni fun (Provenance Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann
-&gt; DefT LexName uni fun Ann m (Term TyName Name uni fun Ann)
-&gt; m (Term TyName Name uni fun Ann)
forall (m :: * -&gt; *) key ann (uni :: * -&gt; *) fun.
(Monad m, Ord key) =&gt;
ann
-&gt; DefT key uni fun ann m (Term TyName Name uni fun ann)
-&gt; m (Term TyName Name uni fun ann)
</span><span class="hs-identifier hs-var">PIR.runDefT</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">annMayInline</span></span><span> </span><span class="annot"><span class="annottext">(DefT LexName uni fun Ann m (Term TyName Name uni fun Ann)
 -&gt; m (Term TyName Name uni fun Ann))
-&gt; DefT LexName uni fun Ann m (Term TyName Name uni fun Ann)
-&gt; m (Term TyName Name uni fun Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; DefT LexName uni fun Ann m (Term TyName Name uni fun Ann)
forall (uni :: * -&gt; *) fun (m :: * -&gt; *) ann.
CompilingDefault uni fun m ann =&gt;
CoreExpr -&gt; m (PIRTerm uni fun)
</span><a href="PlutusTx.Compiler.Expr.html#compileExprWithDefs"><span class="hs-identifier hs-var">compileExprWithDefs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446437"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679446518"><span class="annot"><span class="annottext">pirP :: Program TyName Name uni fun (Provenance Ann)
</span><a href="#local-6989586621679446518"><span class="hs-identifier hs-var hs-var">pirP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Provenance Ann
-&gt; Version
-&gt; Term TyName Name uni fun (Provenance Ann)
-&gt; Program TyName Name uni fun (Provenance Ann)
forall tyname name (uni :: * -&gt; *) fun ann.
ann
-&gt; Version
-&gt; Term tyname name uni fun ann
-&gt; Program tyname name uni fun ann
</span><span class="hs-identifier hs-var">PIR.Program</span></span><span> </span><span class="annot"><span class="annottext">Provenance Ann
forall a. Provenance a
</span><span class="hs-identifier hs-var">noProvenance</span></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679446440"><span class="hs-identifier hs-var">plcVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun (Provenance Ann)
</span><a href="#local-6989586621679446514"><span class="hs-identifier hs-var">pirT</span></a></span><span>
</span><span id="line-523"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posDumpPir"><span class="hs-identifier hs-var">posDumpPir</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; (IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-524"></span><span>        </span><span class="annot"><span class="annottext">Program TyName Name uni fun ()
-&gt; CommandLineOption -&gt; CommandLineOption -&gt; IO ()
forall t.
Flat t =&gt;
t -&gt; CommandLineOption -&gt; CommandLineOption -&gt; IO ()
</span><a href="#local-6989586621679446522"><span class="hs-identifier hs-var">dumpFlat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Program TyName Name uni fun (Provenance Ann)
-&gt; Program TyName Name uni fun ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Program TyName Name uni fun (Provenance Ann)
</span><a href="#local-6989586621679446518"><span class="hs-identifier hs-var">pirP</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;initial PIR program&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446435"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; CommandLineOption -&gt; CommandLineOption
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;.pir-initial.flat&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-comment">-- Pir -&gt; (Simplified) Pir pass. We can then dump/store a more legible PIR program.</span><span>
</span><span id="line-527"></span><span>    </span><span id="local-6989586621679446524"><span class="annot"><span class="annottext">Program TyName Name uni fun (Provenance Ann)
</span><a href="#local-6989586621679446524"><span class="hs-identifier hs-var">spirP</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ReaderT
   (CompilationCtx uni fun Ann)
   m
   (Program TyName Name uni fun (Provenance Ann))
 -&gt; CompilationCtx uni fun Ann
 -&gt; m (Program TyName Name uni fun (Provenance Ann)))
-&gt; CompilationCtx uni fun Ann
-&gt; ReaderT
     (CompilationCtx uni fun Ann)
     m
     (Program TyName Name uni fun (Provenance Ann))
-&gt; m (Program TyName Name uni fun (Provenance Ann))
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT
  (CompilationCtx uni fun Ann)
  m
  (Program TyName Name uni fun (Provenance Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; m (Program TyName Name uni fun (Provenance Ann))
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#runReaderT"><span class="hs-identifier hs-var">runReaderT</span></a></span><span> </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
</span><a href="#local-6989586621679446460"><span class="hs-identifier hs-var">pirCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   (CompilationCtx uni fun Ann)
   m
   (Program TyName Name uni fun (Provenance Ann))
 -&gt; m (Program TyName Name uni fun (Provenance Ann)))
-&gt; ReaderT
     (CompilationCtx uni fun Ann)
     m
     (Program TyName Name uni fun (Provenance Ann))
-&gt; m (Program TyName Name uni fun (Provenance Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Program TyName Name uni fun (Provenance Ann)
-&gt; ReaderT
     (CompilationCtx uni fun Ann)
     m
     (Program TyName Name uni fun (Provenance Ann))
forall (m :: * -&gt; *) e (uni :: * -&gt; *) fun a b.
(Compiling m e uni fun a, b ~ Provenance a) =&gt;
Program TyName Name uni fun b -&gt; m (Program TyName Name uni fun b)
</span><span class="hs-identifier hs-var">PIR.compileToReadable</span></span><span> </span><span class="annot"><span class="annottext">Program TyName Name uni fun (Provenance Ann)
</span><a href="#local-6989586621679446518"><span class="hs-identifier hs-var">pirP</span></a></span><span>
</span><span id="line-528"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posDumpPir"><span class="hs-identifier hs-var">posDumpPir</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; (IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-529"></span><span>        </span><span class="annot"><span class="annottext">Program TyName Name uni fun ()
-&gt; CommandLineOption -&gt; CommandLineOption -&gt; IO ()
forall t.
Flat t =&gt;
t -&gt; CommandLineOption -&gt; CommandLineOption -&gt; IO ()
</span><a href="#local-6989586621679446522"><span class="hs-identifier hs-var">dumpFlat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Program TyName Name uni fun (Provenance Ann)
-&gt; Program TyName Name uni fun ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Program TyName Name uni fun (Provenance Ann)
</span><a href="#local-6989586621679446524"><span class="hs-identifier hs-var">spirP</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;simplified PIR program&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446435"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; CommandLineOption -&gt; CommandLineOption
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;.pir-simplified.flat&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span>    </span><span class="hs-comment">-- (Simplified) Pir -&gt; Plc translation.</span><span>
</span><span id="line-532"></span><span>    </span><span id="local-6989586621679446526"><span class="annot"><span class="annottext">PLCProgram uni fun Ann
</span><a href="#local-6989586621679446526"><span class="hs-identifier hs-var">plcP</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ReaderT (CompilationCtx uni fun Ann) m (PLCProgram uni fun Ann)
 -&gt; CompilationCtx uni fun Ann -&gt; m (PLCProgram uni fun Ann))
-&gt; CompilationCtx uni fun Ann
-&gt; ReaderT (CompilationCtx uni fun Ann) m (PLCProgram uni fun Ann)
-&gt; m (PLCProgram uni fun Ann)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT (CompilationCtx uni fun Ann) m (PLCProgram uni fun Ann)
-&gt; CompilationCtx uni fun Ann -&gt; m (PLCProgram uni fun Ann)
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#runReaderT"><span class="hs-identifier hs-var">runReaderT</span></a></span><span> </span><span class="annot"><span class="annottext">CompilationCtx uni fun Ann
</span><a href="#local-6989586621679446460"><span class="hs-identifier hs-var">pirCtx</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (CompilationCtx uni fun Ann) m (PLCProgram uni fun Ann)
 -&gt; m (PLCProgram uni fun Ann))
-&gt; ReaderT (CompilationCtx uni fun Ann) m (PLCProgram uni fun Ann)
-&gt; m (PLCProgram uni fun Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Program TyName Name uni fun (Provenance Ann)
-&gt; ReaderT (CompilationCtx uni fun Ann) m (PLCProgram uni fun Ann)
forall (m :: * -&gt; *) e (uni :: * -&gt; *) fun a b.
(Compiling m e uni fun a, b ~ Provenance a) =&gt;
Program TyName Name uni fun b -&gt; m (PLCProgram uni fun a)
</span><span class="hs-identifier hs-var">PIR.compileReadableToPlc</span></span><span> </span><span class="annot"><span class="annottext">Program TyName Name uni fun (Provenance Ann)
</span><a href="#local-6989586621679446524"><span class="hs-identifier hs-var">spirP</span></a></span><span>
</span><span id="line-533"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posDumpPlc"><span class="hs-identifier hs-var">posDumpPlc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; (IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-534"></span><span>        </span><span class="annot"><span class="annottext">Program TyName Name uni fun ()
-&gt; CommandLineOption -&gt; CommandLineOption -&gt; IO ()
forall t.
Flat t =&gt;
t -&gt; CommandLineOption -&gt; CommandLineOption -&gt; IO ()
</span><a href="#local-6989586621679446522"><span class="hs-identifier hs-var">dumpFlat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLCProgram uni fun Ann -&gt; Program TyName Name uni fun ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">PLCProgram uni fun Ann
</span><a href="#local-6989586621679446526"><span class="hs-identifier hs-var">plcP</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;typed PLC program&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446435"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; CommandLineOption -&gt; CommandLineOption
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;.plc.flat&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span>    </span><span class="hs-comment">-- We do this after dumping the programs so that if we fail typechecking we still get the dump.</span><span>
</span><span id="line-537"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posDoTypecheck"><span class="hs-identifier hs-var">posDoTypecheck</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ())
-&gt; (m (Normalized (Type TyName uni ())) -&gt; m ())
-&gt; m (Normalized (Type TyName uni ()))
-&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">m (Normalized (Type TyName uni ())) -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Normalized (Type TyName uni ())) -&gt; m ())
-&gt; m (Normalized (Type TyName uni ())) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-538"></span><span>        </span><span class="annot"><span class="annottext">ExceptT
  (Error DefaultUni DefaultFun Ann)
  m
  (Normalized (Type TyName uni ()))
-&gt; m (Normalized (Type TyName uni ()))
forall b. ExceptT (Error DefaultUni DefaultFun Ann) m b -&gt; m b
</span><a href="#local-6989586621679446529"><span class="hs-identifier hs-var">liftExcept</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   (Error DefaultUni DefaultFun Ann)
   m
   (Normalized (Type TyName uni ()))
 -&gt; m (Normalized (Type TyName uni ())))
-&gt; ExceptT
     (Error DefaultUni DefaultFun Ann)
     m
     (Normalized (Type TyName uni ()))
-&gt; m (Normalized (Type TyName uni ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TypeCheckConfig uni fun
-&gt; Program TyName Name uni fun Ann
-&gt; ExceptT
     (Error DefaultUni DefaultFun Ann)
     m
     (Normalized (Type TyName uni ()))
forall err (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadTypeCheckPlc err uni fun ann m =&gt;
TypeCheckConfig uni fun
-&gt; Program TyName Name uni fun ann
-&gt; m (Normalized (Type TyName uni ()))
</span><span class="hs-identifier hs-var">PLC.inferTypeOfProgram</span></span><span> </span><span class="annot"><span class="annottext">TypeCheckConfig uni fun
</span><a href="#local-6989586621679446438"><span class="hs-identifier hs-var">plcTcConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PLCProgram uni fun Ann
</span><a href="#local-6989586621679446526"><span class="hs-identifier hs-var">plcP</span></a></span><span> </span><span class="annot"><span class="annottext">PLCProgram uni fun Ann -&gt; Ann -&gt; Program TyName Name uni fun Ann
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%24%3E"><span class="hs-operator hs-var">$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">annMayInline</span></span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span>    </span><span id="local-6989586621679446532"><span class="annot"><span class="annottext">Program Name uni fun (Provenance Ann)
</span><a href="#local-6989586621679446532"><span class="hs-identifier hs-var">uplcP</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ReaderT
   (CompilationOpts Name (Provenance Ann))
   m
   (Program Name uni fun (Provenance Ann))
 -&gt; CompilationOpts Name (Provenance Ann)
 -&gt; m (Program Name uni fun (Provenance Ann)))
-&gt; CompilationOpts Name (Provenance Ann)
-&gt; ReaderT
     (CompilationOpts Name (Provenance Ann))
     m
     (Program Name uni fun (Provenance Ann))
-&gt; m (Program Name uni fun (Provenance Ann))
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT
  (CompilationOpts Name (Provenance Ann))
  m
  (Program Name uni fun (Provenance Ann))
-&gt; CompilationOpts Name (Provenance Ann)
-&gt; m (Program Name uni fun (Provenance Ann))
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#runReaderT"><span class="hs-identifier hs-var">runReaderT</span></a></span><span> </span><span class="annot"><span class="annottext">CompilationOpts Name (Provenance Ann)
</span><a href="#local-6989586621679446504"><span class="hs-identifier hs-var">plcOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   (CompilationOpts Name (Provenance Ann))
   m
   (Program Name uni fun (Provenance Ann))
 -&gt; m (Program Name uni fun (Provenance Ann)))
-&gt; ReaderT
     (CompilationOpts Name (Provenance Ann))
     m
     (Program Name uni fun (Provenance Ann))
-&gt; m (Program Name uni fun (Provenance Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PLCProgram uni fun Ann
-&gt; ReaderT
     (CompilationOpts Name (Provenance Ann))
     m
     (Program Name uni fun (Provenance Ann))
forall (m :: * -&gt; *) (uni :: * -&gt; *) fun name a tyname.
(Compiling m uni fun name a,
 MonadReader (CompilationOpts name a) m) =&gt;
Program tyname name uni fun a -&gt; m (Program name uni fun a)
</span><span class="hs-identifier hs-var">PLC.compileProgram</span></span><span> </span><span class="annot"><span class="annottext">PLCProgram uni fun Ann
</span><a href="#local-6989586621679446526"><span class="hs-identifier hs-var">plcP</span></a></span><span>
</span><span id="line-541"></span><span>    </span><span id="local-6989586621679446534"><span class="annot"><span class="annottext">Program NamedDeBruijn uni fun (Provenance Ann)
</span><a href="#local-6989586621679446534"><span class="hs-identifier hs-var">dbP</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT
  (Error DefaultUni DefaultFun Ann)
  m
  (Program NamedDeBruijn uni fun (Provenance Ann))
-&gt; m (Program NamedDeBruijn uni fun (Provenance Ann))
forall b. ExceptT (Error DefaultUni DefaultFun Ann) m b -&gt; m b
</span><a href="#local-6989586621679446529"><span class="hs-identifier hs-var">liftExcept</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   (Error DefaultUni DefaultFun Ann)
   m
   (Program NamedDeBruijn uni fun (Provenance Ann))
 -&gt; m (Program NamedDeBruijn uni fun (Provenance Ann)))
-&gt; ExceptT
     (Error DefaultUni DefaultFun Ann)
     m
     (Program NamedDeBruijn uni fun (Provenance Ann))
-&gt; m (Program NamedDeBruijn uni fun (Provenance Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LensLike
  (ExceptT (Error DefaultUni DefaultFun Ann) m)
  (Program Name uni fun (Provenance Ann))
  (Program NamedDeBruijn uni fun (Provenance Ann))
  (Term Name uni fun (Provenance Ann))
  (Term NamedDeBruijn uni fun (Provenance Ann))
-&gt; LensLike
     (ExceptT (Error DefaultUni DefaultFun Ann) m)
     (Program Name uni fun (Provenance Ann))
     (Program NamedDeBruijn uni fun (Provenance Ann))
     (Term Name uni fun (Provenance Ann))
     (Term NamedDeBruijn uni fun (Provenance Ann))
forall (f :: * -&gt; *) s t a b.
LensLike f s t a b -&gt; LensLike f s t a b
</span><span class="hs-identifier hs-var">traverseOf</span></span><span> </span><span class="annot"><span class="annottext">LensLike
  (ExceptT (Error DefaultUni DefaultFun Ann) m)
  (Program Name uni fun (Provenance Ann))
  (Program NamedDeBruijn uni fun (Provenance Ann))
  (Term Name uni fun (Provenance Ann))
  (Term NamedDeBruijn uni fun (Provenance Ann))
forall name1 (uni1 :: * -&gt; *) fun1 ann name2 (uni2 :: * -&gt; *) fun2
       (f :: * -&gt; *).
Functor f =&gt;
(Term name1 uni1 fun1 ann -&gt; f (Term name2 uni2 fun2 ann))
-&gt; Program name1 uni1 fun1 ann -&gt; f (Program name2 uni2 fun2 ann)
</span><span class="hs-identifier hs-var">UPLC.progTerm</span></span><span> </span><span class="annot"><span class="annottext">Term Name uni fun (Provenance Ann)
-&gt; ExceptT
     (Error DefaultUni DefaultFun Ann)
     m
     (Term NamedDeBruijn uni fun (Provenance Ann))
forall e (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
(AsFreeVariableError e, MonadError e m) =&gt;
Term Name uni fun ann -&gt; m (Term NamedDeBruijn uni fun ann)
</span><span class="hs-identifier hs-var">UPLC.deBruijnTerm</span></span><span> </span><span class="annot"><span class="annottext">Program Name uni fun (Provenance Ann)
</span><a href="#local-6989586621679446532"><span class="hs-identifier hs-var">uplcP</span></a></span><span>
</span><span id="line-542"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PluginOptions
</span><a href="#local-6989586621679446436"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PluginOptions -&gt; Getting Bool PluginOptions Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Bool PluginOptions Bool
Lens' PluginOptions Bool
</span><a href="PlutusTx.Options.html#posDumpUPlc"><span class="hs-identifier hs-var">posDumpUPlc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; (IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-543"></span><span>        </span><span class="annot"><span class="annottext">UnrestrictedProgram NamedDeBruijn uni fun ()
-&gt; CommandLineOption -&gt; CommandLineOption -&gt; IO ()
forall t.
Flat t =&gt;
t -&gt; CommandLineOption -&gt; CommandLineOption -&gt; IO ()
</span><a href="#local-6989586621679446522"><span class="hs-identifier hs-var">dumpFlat</span></a></span><span>
</span><span id="line-544"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Program NamedDeBruijn uni fun ()
-&gt; UnrestrictedProgram NamedDeBruijn uni fun ()
forall name (uni :: * -&gt; *) fun ann.
Program name uni fun ann -&gt; UnrestrictedProgram name uni fun ann
</span><span class="hs-identifier hs-var">UPLC.UnrestrictedProgram</span></span><span> </span><span class="annot"><span class="annottext">(Program NamedDeBruijn uni fun ()
 -&gt; UnrestrictedProgram NamedDeBruijn uni fun ())
-&gt; Program NamedDeBruijn uni fun ()
-&gt; UnrestrictedProgram NamedDeBruijn uni fun ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Program NamedDeBruijn uni fun (Provenance Ann)
-&gt; Program NamedDeBruijn uni fun ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Program NamedDeBruijn uni fun (Provenance Ann)
</span><a href="#local-6989586621679446534"><span class="hs-identifier hs-var">dbP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>            </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;untyped PLC program&quot;</span></span><span>
</span><span id="line-546"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446435"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; CommandLineOption -&gt; CommandLineOption
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;.uplc.flat&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>    </span><span class="hs-comment">-- Discard the Provenance information at this point, just keep the SrcSpans</span><span>
</span><span id="line-548"></span><span>    </span><span class="hs-comment">-- TODO: keep it and do something useful with it</span><span>
</span><span id="line-549"></span><span>    </span><span class="annot"><span class="annottext">(PIRProgram uni fun, UPLCProgram uni fun)
-&gt; m (PIRProgram uni fun, UPLCProgram uni fun)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Provenance Ann -&gt; SrcSpans)
-&gt; Program TyName Name uni fun (Provenance Ann)
-&gt; PIRProgram uni fun
forall a b.
(a -&gt; b)
-&gt; Program TyName Name uni fun a -&gt; Program TyName Name uni fun b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Provenance Ann -&gt; SrcSpans
</span><a href="#local-6989586621679446539"><span class="hs-identifier hs-var">getSrcSpans</span></a></span><span> </span><span class="annot"><span class="annottext">Program TyName Name uni fun (Provenance Ann)
</span><a href="#local-6989586621679446524"><span class="hs-identifier hs-var">spirP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Provenance Ann -&gt; SrcSpans)
-&gt; Program NamedDeBruijn uni fun (Provenance Ann)
-&gt; UPLCProgram uni fun
forall a b.
(a -&gt; b)
-&gt; Program NamedDeBruijn uni fun a
-&gt; Program NamedDeBruijn uni fun b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Provenance Ann -&gt; SrcSpans
</span><a href="#local-6989586621679446539"><span class="hs-identifier hs-var">getSrcSpans</span></a></span><span> </span><span class="annot"><span class="annottext">Program NamedDeBruijn uni fun (Provenance Ann)
</span><a href="#local-6989586621679446534"><span class="hs-identifier hs-var">dbP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-550"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-551"></span><span>      </span><span class="hs-comment">-- ugly trick to take out the concrete plc.error and in case of error, map it / rethrow it</span><span>
</span><span id="line-552"></span><span>      </span><span class="hs-comment">--  using our 'CompileError'</span><span>
</span><span id="line-553"></span><span>      </span><span id="local-6989586621679445440"><span class="annot"><a href="#local-6989586621679446529"><span class="hs-identifier hs-type">liftExcept</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#ExceptT"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PLC.Error</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PLC.DefaultUni</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PLC.DefaultFun</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679445176"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445440"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679445176"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445440"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-554"></span><span>      </span><span id="local-6989586621679446529"><span class="annot"><span class="annottext">liftExcept :: forall b. ExceptT (Error DefaultUni DefaultFun Ann) m b -&gt; m b
</span><a href="#local-6989586621679446529"><span class="hs-identifier hs-var hs-var">liftExcept</span></a></span></span><span> </span><span id="local-6989586621679446556"><span class="annot"><span class="annottext">ExceptT (Error DefaultUni DefaultFun Ann) m b
</span><a href="#local-6989586621679446556"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-555"></span><span>        </span><span id="local-6989586621679446557"><span class="annot"><span class="annottext">Either (Error DefaultUni DefaultFun Ann) b
</span><a href="#local-6989586621679446557"><span class="hs-identifier hs-var">plcTcError</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT (Error DefaultUni DefaultFun Ann) m b
-&gt; m (Either (Error DefaultUni DefaultFun Ann) b)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#runExceptT"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT (Error DefaultUni DefaultFun Ann) m b
</span><a href="#local-6989586621679446556"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-556"></span><span>        </span><span class="hs-comment">-- also wrap the PLC Error annotations into Original provenances, to match our expected</span><span>
</span><span id="line-557"></span><span>        </span><span class="hs-comment">-- 'CompileError'</span><span>
</span><span id="line-558"></span><span>        </span><span class="annot"><span class="annottext">Either (CompileError DefaultUni DefaultFun Ann) b -&gt; m b
forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#liftEither"><span class="hs-identifier hs-var">liftEither</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (CompileError DefaultUni DefaultFun Ann) b -&gt; m b)
-&gt; Either (CompileError DefaultUni DefaultFun Ann) b -&gt; m b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Error DefaultUni DefaultFun Ann
 -&gt; CompileError DefaultUni DefaultFun Ann)
-&gt; Either (Error DefaultUni DefaultFun Ann) b
-&gt; Either (CompileError DefaultUni DefaultFun Ann) b
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  (CompileError DefaultUni DefaultFun Ann)
  (Error DefaultUni DefaultFun (Provenance Ann))
  (CompileError DefaultUni DefaultFun Ann)
-&gt; Error DefaultUni DefaultFun (Provenance Ann)
-&gt; CompileError DefaultUni DefaultFun Ann
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AReview
  (CompileError DefaultUni DefaultFun Ann)
  (Error DefaultUni DefaultFun (Provenance Ann))
-&gt; Getter
     (Error DefaultUni DefaultFun (Provenance Ann))
     (CompileError DefaultUni DefaultFun Ann)
forall t b. AReview t b -&gt; Getter b t
</span><span class="hs-identifier hs-var">re</span></span><span> </span><span class="annot"><span class="annottext">AReview
  (CompileError DefaultUni DefaultFun Ann)
  (Error DefaultUni DefaultFun (Provenance Ann))
forall r (uni :: * -&gt; *) fun a.
AsError r uni fun a =&gt;
Prism' r (Error uni fun a)
Prism'
  (CompileError DefaultUni DefaultFun Ann)
  (Error DefaultUni DefaultFun (Provenance Ann))
</span><span class="hs-identifier hs-var">PIR._PLCError</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Error DefaultUni DefaultFun (Provenance Ann)
 -&gt; CompileError DefaultUni DefaultFun Ann)
-&gt; (Error DefaultUni DefaultFun Ann
    -&gt; Error DefaultUni DefaultFun (Provenance Ann))
-&gt; Error DefaultUni DefaultFun Ann
-&gt; CompileError DefaultUni DefaultFun Ann
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Ann -&gt; Provenance Ann)
-&gt; Error DefaultUni DefaultFun Ann
-&gt; Error DefaultUni DefaultFun (Provenance Ann)
forall a b.
(a -&gt; b)
-&gt; Error DefaultUni DefaultFun a -&gt; Error DefaultUni DefaultFun b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Provenance Ann
forall a. a -&gt; Provenance a
</span><span class="hs-identifier hs-var">PIR.Original</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either (Error DefaultUni DefaultFun Ann) b
</span><a href="#local-6989586621679446557"><span class="hs-identifier hs-var">plcTcError</span></a></span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span>      </span><span id="local-6989586621679445422"><span class="annot"><a href="#local-6989586621679446522"><span class="hs-identifier hs-type">dumpFlat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Flat</span></span><span> </span><span class="annot"><a href="#local-6989586621679445422"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679445422"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-561"></span><span>      </span><span id="local-6989586621679446522"><span class="annot"><span class="annottext">dumpFlat :: forall t.
Flat t =&gt;
t -&gt; CommandLineOption -&gt; CommandLineOption -&gt; IO ()
</span><a href="#local-6989586621679446522"><span class="hs-identifier hs-var hs-var">dumpFlat</span></a></span></span><span> </span><span id="local-6989586621679446575"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679446575"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679446576"><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446576"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span id="local-6989586621679446577"><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446577"><span class="hs-identifier hs-var">fileName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-562"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679446578"><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446578"><span class="hs-identifier hs-var">tPath</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679446579"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679446579"><span class="hs-identifier hs-var">tHandle</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CommandLineOption
-&gt; CommandLineOption -&gt; IO (CommandLineOption, Handle)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/System.IO.html#openTempFile"><span class="hs-identifier hs-var">openTempFile</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446577"><span class="hs-identifier hs-var">fileName</span></a></span><span>
</span><span id="line-563"></span><span>        </span><span class="annot"><span class="annottext">CommandLineOption -&gt; IO ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/System.IO.html#putStrLn"><span class="hs-identifier hs-var">putStrLn</span></a></span><span> </span><span class="annot"><span class="annottext">(CommandLineOption -&gt; IO ()) -&gt; CommandLineOption -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;!!! dumping &quot;</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; CommandLineOption -&gt; CommandLineOption
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446576"><span class="hs-identifier hs-var">desc</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; CommandLineOption -&gt; CommandLineOption
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot; to &quot;</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; CommandLineOption -&gt; CommandLineOption
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; CommandLineOption
forall a. Show a =&gt; a -&gt; CommandLineOption
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><a href="#local-6989586621679446578"><span class="hs-identifier hs-var">tPath</span></a></span><span>
</span><span id="line-564"></span><span>        </span><span class="annot"><span class="annottext">Handle -&gt; ByteString -&gt; IO ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.html#hPut"><span class="hs-identifier hs-var">BS.hPut</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679446579"><span class="hs-identifier hs-var">tHandle</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ()) -&gt; ByteString -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; ByteString
forall a. Flat a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">flat</span></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679446575"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span>      </span><span class="annot"><a href="#local-6989586621679446539"><span class="hs-identifier hs-type">getSrcSpans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PIR.Provenance</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SrcSpans</span></span><span>
</span><span id="line-567"></span><span>      </span><span id="local-6989586621679446539"><span class="annot"><span class="annottext">getSrcSpans :: Provenance Ann -&gt; SrcSpans
</span><a href="#local-6989586621679446539"><span class="hs-identifier hs-var hs-var">getSrcSpans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set SrcSpan -&gt; SrcSpans
</span><span class="hs-identifier hs-var">SrcSpans</span></span><span> </span><span class="annot"><span class="annottext">(Set SrcSpan -&gt; SrcSpans)
-&gt; (Provenance Ann -&gt; Set SrcSpan) -&gt; Provenance Ann -&gt; SrcSpans
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Set SrcSpan] -&gt; Set SrcSpan
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">Set.unions</span></a></span><span> </span><span class="annot"><span class="annottext">([Set SrcSpan] -&gt; Set SrcSpan)
-&gt; (Provenance Ann -&gt; [Set SrcSpan])
-&gt; Provenance Ann
-&gt; Set SrcSpan
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Ann -&gt; Set SrcSpan) -&gt; [Ann] -&gt; [Set SrcSpan]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpans -&gt; Set SrcSpan
</span><span class="hs-identifier hs-var">unSrcSpans</span></span><span> </span><span class="annot"><span class="annottext">(SrcSpans -&gt; Set SrcSpan)
-&gt; (Ann -&gt; SrcSpans) -&gt; Ann -&gt; Set SrcSpan
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Ann -&gt; SrcSpans
</span><span class="hs-identifier hs-var">annSrcSpans</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Ann] -&gt; [Set SrcSpan])
-&gt; (Provenance Ann -&gt; [Ann]) -&gt; Provenance Ann -&gt; [Set SrcSpan]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Provenance Ann -&gt; [Ann]
forall a. Provenance a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span class="annot"><span class="hs-comment">-- | Get the 'GHC.Name' corresponding to the given 'TH.Name', or throw an error if we can't get it.</span></span><span>
</span><span id="line-570"></span><span id="local-6989586621679445135"><span id="local-6989586621679445136"><span class="annot"><a href="PlutusTx.Plugin.html#thNameToGhcNameOrFail"><span class="hs-identifier hs-type">thNameToGhcNameOrFail</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Plugin.html#PluginM"><span class="hs-identifier hs-type">PluginM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445135"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445136"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">GHC.Name</span></a></span></span></span><span>
</span><span id="line-571"></span><span id="thNameToGhcNameOrFail"><span class="annot"><span class="annottext">thNameToGhcNameOrFail :: forall (uni :: * -&gt; *) fun. Name -&gt; PluginM uni fun Name
</span><a href="PlutusTx.Plugin.html#thNameToGhcNameOrFail"><span class="hs-identifier hs-var hs-var">thNameToGhcNameOrFail</span></a></span></span><span> </span><span id="local-6989586621679446597"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679446597"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-572"></span><span>    </span><span id="local-6989586621679446598"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679446598"><span class="hs-identifier hs-var">maybeName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT (CompileError uni fun Ann) CoreM (Maybe Name)
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) (Maybe Name)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT PluginCtx m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT (CompileError uni fun Ann) CoreM (Maybe Name)
 -&gt; ReaderT
      PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) (Maybe Name))
-&gt; (CoreM (Maybe Name)
    -&gt; ExceptT (CompileError uni fun Ann) CoreM (Maybe Name))
-&gt; CoreM (Maybe Name)
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) (Maybe Name)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CoreM (Maybe Name)
-&gt; ExceptT (CompileError uni fun Ann) CoreM (Maybe Name)
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; ExceptT (CompileError uni fun Ann) m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreM (Maybe Name)
 -&gt; ReaderT
      PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) (Maybe Name))
-&gt; CoreM (Maybe Name)
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) (Maybe Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; CoreM (Maybe Name)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Plugins.html#thNameToGhcName"><span class="hs-identifier hs-var">GHC.thNameToGhcName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679446597"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-573"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679446598"><span class="hs-identifier hs-var">maybeName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-574"></span><span>        </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679446599"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679446599"><span class="hs-identifier hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; PluginM uni fun Name
forall a.
a -&gt; ReaderT PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679446599"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-575"></span><span>        </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError uni fun Ann -&gt; PluginM uni fun Name
forall a.
CompileError uni fun Ann
-&gt; ReaderT PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(CompileError uni fun Ann -&gt; PluginM uni fun Name)
-&gt; (Error uni fun Ann -&gt; CompileError uni fun Ann)
-&gt; Error uni fun Ann
-&gt; PluginM uni fun Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Error uni fun Ann -&gt; CompileError uni fun Ann
forall c e. e -&gt; WithContext c e
</span><a href="PlutusTx.Compiler.Error.html#NoContext"><span class="hs-identifier hs-var">NoContext</span></a></span><span> </span><span class="annot"><span class="annottext">(Error uni fun Ann -&gt; PluginM uni fun Name)
-&gt; Error uni fun Ann -&gt; PluginM uni fun Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Error uni fun Ann
forall (uni :: * -&gt; *) fun a. Name -&gt; Error uni fun a
</span><a href="PlutusTx.Compiler.Error.html#CoreNameLookupError"><span class="hs-identifier hs-var">CoreNameLookupError</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679446597"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span class="annot"><span class="hs-comment">-- | Create a GHC Core expression that will evaluate to the given ByteString at runtime.</span></span><span>
</span><span id="line-578"></span><span id="local-6989586621679445177"><span id="local-6989586621679445178"><span class="annot"><a href="PlutusTx.Plugin.html#makeByteStringLiteral"><span class="hs-identifier hs-type">makeByteStringLiteral</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Plugin.html#PluginM"><span class="hs-identifier hs-type">PluginM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445177"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445178"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">GHC.CoreExpr</span></a></span></span></span><span>
</span><span id="line-579"></span><span id="makeByteStringLiteral"><span class="annot"><span class="annottext">makeByteStringLiteral :: forall (uni :: * -&gt; *) fun. ByteString -&gt; PluginM uni fun CoreExpr
</span><a href="PlutusTx.Plugin.html#makeByteStringLiteral"><span class="hs-identifier hs-var hs-var">makeByteStringLiteral</span></a></span></span><span> </span><span id="local-6989586621679446632"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679446632"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-580"></span><span>    </span><span id="local-6989586621679446633"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621679446633"><span class="hs-identifier hs-var">flags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT
  PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">GHC.getDynFlags</span></a></span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span>    </span><span class="hs-comment">{-
    This entire section will crash horribly in a number of circumstances. Such is life.
    - If any of the names we need can't be found as GHC Names
    - If we then can't look up those GHC Names to get their IDs/types
    - If we make any mistakes creating the Core expression
    -}</span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span>    </span><span class="hs-comment">-- Get the names of functions/types that we need for our expression</span><span>
</span><span id="line-590"></span><span>    </span><span id="local-6989586621679446634"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679446634"><span class="hs-identifier hs-var">upio</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT (CompileError uni fun Ann) CoreM Var
-&gt; ReaderT PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Var
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT PluginCtx m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT (CompileError uni fun Ann) CoreM Var
 -&gt; ReaderT
      PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Var)
-&gt; (Name -&gt; ExceptT (CompileError uni fun Ann) CoreM Var)
-&gt; Name
-&gt; ReaderT PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Var
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CoreM Var -&gt; ExceptT (CompileError uni fun Ann) CoreM Var
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; ExceptT (CompileError uni fun Ann) m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreM Var -&gt; ExceptT (CompileError uni fun Ann) CoreM Var)
-&gt; (Name -&gt; CoreM Var)
-&gt; Name
-&gt; ExceptT (CompileError uni fun Ann) CoreM Var
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; CoreM Var
forall (m :: * -&gt; *). MonadThings m =&gt; Name -&gt; m Var
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Types.TyThing.html#lookupId"><span class="hs-identifier hs-var">GHC.lookupId</span></a></span><span> </span><span class="annot"><span class="annottext">(Name
 -&gt; ReaderT
      PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Var)
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Name
-&gt; ReaderT PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Var
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Name
forall (uni :: * -&gt; *) fun. Name -&gt; PluginM uni fun Name
</span><a href="PlutusTx.Plugin.html#thNameToGhcNameOrFail"><span class="hs-identifier hs-var">thNameToGhcNameOrFail</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">unsafePerformIO</span><span>
</span><span id="line-591"></span><span>    </span><span id="local-6989586621679446635"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679446635"><span class="hs-identifier hs-var">bsTc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT (CompileError uni fun Ann) CoreM TyCon
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) TyCon
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT PluginCtx m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT (CompileError uni fun Ann) CoreM TyCon
 -&gt; ReaderT
      PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) TyCon)
-&gt; (Name -&gt; ExceptT (CompileError uni fun Ann) CoreM TyCon)
-&gt; Name
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) TyCon
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CoreM TyCon -&gt; ExceptT (CompileError uni fun Ann) CoreM TyCon
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; ExceptT (CompileError uni fun Ann) m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreM TyCon -&gt; ExceptT (CompileError uni fun Ann) CoreM TyCon)
-&gt; (Name -&gt; CoreM TyCon)
-&gt; Name
-&gt; ExceptT (CompileError uni fun Ann) CoreM TyCon
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; CoreM TyCon
forall (m :: * -&gt; *). MonadThings m =&gt; Name -&gt; m TyCon
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Types.TyThing.html#lookupTyCon"><span class="hs-identifier hs-var">GHC.lookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">(Name
 -&gt; ReaderT
      PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) TyCon)
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Name
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) TyCon
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Name
forall (uni :: * -&gt; *) fun. Name -&gt; PluginM uni fun Name
</span><a href="PlutusTx.Plugin.html#thNameToGhcNameOrFail"><span class="hs-identifier hs-var">thNameToGhcNameOrFail</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">BS.ByteString</span><span>
</span><span id="line-592"></span><span>    </span><span id="local-6989586621679446636"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679446636"><span class="hs-identifier hs-var">upal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT (CompileError uni fun Ann) CoreM Var
-&gt; ReaderT PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Var
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT PluginCtx m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT (CompileError uni fun Ann) CoreM Var
 -&gt; ReaderT
      PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Var)
-&gt; (Name -&gt; ExceptT (CompileError uni fun Ann) CoreM Var)
-&gt; Name
-&gt; ReaderT PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Var
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CoreM Var -&gt; ExceptT (CompileError uni fun Ann) CoreM Var
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; ExceptT (CompileError uni fun Ann) m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreM Var -&gt; ExceptT (CompileError uni fun Ann) CoreM Var)
-&gt; (Name -&gt; CoreM Var)
-&gt; Name
-&gt; ExceptT (CompileError uni fun Ann) CoreM Var
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; CoreM Var
forall (m :: * -&gt; *). MonadThings m =&gt; Name -&gt; m Var
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Types.TyThing.html#lookupId"><span class="hs-identifier hs-var">GHC.lookupId</span></a></span><span> </span><span class="annot"><span class="annottext">(Name
 -&gt; ReaderT
      PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Var)
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Name
-&gt; ReaderT PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Var
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) Name
forall (uni :: * -&gt; *) fun. Name -&gt; PluginM uni fun Name
</span><a href="PlutusTx.Plugin.html#thNameToGhcNameOrFail"><span class="hs-identifier hs-var">thNameToGhcNameOrFail</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">BSUnsafe.unsafePackAddressLen</span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span>    </span><span class="hs-comment">-- We construct the following expression:</span><span>
</span><span id="line-595"></span><span>    </span><span class="hs-comment">-- unsafePerformIO $</span><span>
</span><span id="line-596"></span><span>    </span><span class="hs-comment">--     unsafePackAddressLen &lt;length as int literal&gt; &lt;data as string literal address&gt;</span><span>
</span><span id="line-597"></span><span>    </span><span class="hs-comment">-- This technique gratefully borrowed from the file-embed package</span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span>    </span><span class="hs-comment">-- The flags here are so GHC can check whether the int is in range for the current platform.</span><span>
</span><span id="line-600"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679446637"><span class="annot"><span class="annottext">lenLit :: CoreExpr
</span><a href="#local-6989586621679446637"><span class="hs-identifier hs-var hs-var">lenLit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Integer -&gt; CoreExpr
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Make.html#mkIntExpr"><span class="hs-identifier hs-var">GHC.mkIntExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">GHC.targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621679446633"><span class="hs-identifier hs-var">flags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; CoreExpr) -&gt; Integer -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Integer) -&gt; Int -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.html#length"><span class="hs-identifier hs-var">BS.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679446632"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-601"></span><span>    </span><span class="hs-comment">-- This will have type Addr#, which is right for unsafePackAddressLen</span><span>
</span><span id="line-602"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679446640"><span class="annot"><span class="annottext">bsLit :: CoreExpr
</span><a href="#local-6989586621679446640"><span class="hs-identifier hs-var hs-var">bsLit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Lit"><span class="hs-identifier hs-var">GHC.Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Literal
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Types.Literal.html#LitString"><span class="hs-identifier hs-var">GHC.LitString</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679446632"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679446642"><span class="annot"><span class="annottext">upaled :: CoreExpr
</span><a href="#local-6989586621679446642"><span class="hs-identifier hs-var hs-var">upaled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Make.html#mkCoreApps"><span class="hs-identifier hs-var">GHC.mkCoreApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. Var -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Var"><span class="hs-identifier hs-var">GHC.Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679446636"><span class="hs-identifier hs-var">upal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446637"><span class="hs-identifier hs-var">lenLit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446640"><span class="hs-identifier hs-var">bsLit</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-604"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679446644"><span class="annot"><span class="annottext">upioed :: CoreExpr
</span><a href="#local-6989586621679446644"><span class="hs-identifier hs-var hs-var">upioed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.Make.html#mkCoreApps"><span class="hs-identifier hs-var">GHC.mkCoreApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. Var -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Var"><span class="hs-identifier hs-var">GHC.Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679446634"><span class="hs-identifier hs-var">upio</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Type"><span class="hs-identifier hs-var">GHC.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.TyCon.html#mkTyConTy"><span class="hs-identifier hs-var">GHC.mkTyConTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679446635"><span class="hs-identifier hs-var">bsTc</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446642"><span class="hs-identifier hs-var">upaled</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span>    </span><span class="annot"><span class="annottext">CoreExpr -&gt; PluginM uni fun CoreExpr
forall a.
a -&gt; ReaderT PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446644"><span class="hs-identifier hs-var">upioed</span></a></span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span class="annot"><span class="hs-comment">-- | Strips all enclosing 'GHC.Tick's off an expression.</span></span><span>
</span><span id="line-609"></span><span class="annot"><a href="PlutusTx.Plugin.html#stripTicks"><span class="hs-identifier hs-type">stripTicks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">GHC.CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">GHC.CoreExpr</span></a></span><span>
</span><span id="line-610"></span><span id="stripTicks"><span class="annot"><span class="annottext">stripTicks :: CoreExpr -&gt; CoreExpr
</span><a href="PlutusTx.Plugin.html#stripTicks"><span class="hs-identifier hs-var hs-var">stripTicks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-611"></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Core.html#Tick"><span class="hs-identifier hs-type">GHC.Tick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679446647"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446647"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="PlutusTx.Plugin.html#stripTicks"><span class="hs-identifier hs-var">stripTicks</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446647"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-612"></span><span>    </span><span id="local-6989586621679446648"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446648"><span class="hs-identifier hs-var">e</span></a></span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621679446648"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span class="annot"><span class="hs-comment">-- | Helper to avoid doing too much construction of Core ourselves</span></span><span>
</span><span id="line-615"></span><span class="annot"><a href="PlutusTx.Plugin.html#mkCompiledCode"><span class="hs-identifier hs-type">mkCompiledCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679445515"><span class="annot"><a href="#local-6989586621679445515"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CompiledCode</span></span><span> </span><span class="annot"><a href="#local-6989586621679445515"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-616"></span><span id="mkCompiledCode"><span class="annot"><span class="annottext">mkCompiledCode :: forall a. ByteString -&gt; ByteString -&gt; ByteString -&gt; CompiledCode a
</span><a href="PlutusTx.Plugin.html#mkCompiledCode"><span class="hs-identifier hs-var hs-var">mkCompiledCode</span></a></span></span><span> </span><span id="local-6989586621679446656"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679446656"><span class="hs-identifier hs-var">plcBS</span></a></span></span><span> </span><span id="local-6989586621679446657"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679446657"><span class="hs-identifier hs-var">pirBS</span></a></span></span><span> </span><span id="local-6989586621679446658"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679446658"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; Maybe ByteString
-&gt; CoverageIndex
-&gt; CompiledCodeIn DefaultUni DefaultFun a
forall (uni :: * -&gt; *) fun a.
ByteString
-&gt; Maybe ByteString -&gt; CoverageIndex -&gt; CompiledCodeIn uni fun a
</span><span class="hs-identifier hs-var">SerializedCode</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679446656"><span class="hs-identifier hs-var">plcBS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679446657"><span class="hs-identifier hs-var">pirBS</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either DecodeException CoverageIndex -&gt; CoverageIndex
forall m. Monoid m =&gt; Either DecodeException m -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#fold"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">(Either DecodeException CoverageIndex -&gt; CoverageIndex)
-&gt; (ByteString -&gt; Either DecodeException CoverageIndex)
-&gt; ByteString
-&gt; CoverageIndex
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either DecodeException CoverageIndex
forall a b. (Flat a, AsByteString b) =&gt; b -&gt; Decoded a
</span><span class="hs-identifier hs-var">unflat</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; CoverageIndex) -&gt; ByteString -&gt; CoverageIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679446658"><span class="hs-identifier hs-var">ci</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span class="hs-comment">-- | Make a 'NameInfo' mapping the given set of TH names to their</span><span>
</span><span id="line-619"></span><span class="hs-comment">-- 'GHC.TyThing's for later reference.</span><span>
</span><span id="line-620"></span><span id="local-6989586621679445145"><span id="local-6989586621679445146"><span class="annot"><a href="PlutusTx.Plugin.html#makePrimitiveNameInfo"><span class="hs-identifier hs-type">makePrimitiveNameInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/template-haskell-2.20.0.0/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Plugin.html#PluginM"><span class="hs-identifier hs-type">PluginM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445145"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679445146"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="PlutusTx.Compiler.Types.html#NameInfo"><span class="hs-identifier hs-type">NameInfo</span></a></span></span></span><span>
</span><span id="line-621"></span><span id="makePrimitiveNameInfo"><span class="annot"><span class="annottext">makePrimitiveNameInfo :: forall (uni :: * -&gt; *) fun. [Name] -&gt; PluginM uni fun NameInfo
</span><a href="PlutusTx.Plugin.html#makePrimitiveNameInfo"><span class="hs-identifier hs-var hs-var">makePrimitiveNameInfo</span></a></span></span><span> </span><span id="local-6989586621679446677"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679446677"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-622"></span><span>    </span><span id="local-6989586621679446678"><span class="annot"><span class="annottext">[(Name, TyThing)]
</span><a href="#local-6989586621679446678"><span class="hs-identifier hs-var">infos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name]
-&gt; (Name
    -&gt; ReaderT
         PluginCtx
         (ExceptT (CompileError uni fun Ann) CoreM)
         (Name, TyThing))
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError uni fun Ann) CoreM)
     [(Name, TyThing)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Traversable.html#for"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679446677"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">((Name
  -&gt; ReaderT
       PluginCtx
       (ExceptT (CompileError uni fun Ann) CoreM)
       (Name, TyThing))
 -&gt; ReaderT
      PluginCtx
      (ExceptT (CompileError uni fun Ann) CoreM)
      [(Name, TyThing)])
-&gt; (Name
    -&gt; ReaderT
         PluginCtx
         (ExceptT (CompileError uni fun Ann) CoreM)
         (Name, TyThing))
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError uni fun Ann) CoreM)
     [(Name, TyThing)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679446679"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679446679"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-623"></span><span>        </span><span id="local-6989586621679446680"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679446680"><span class="hs-identifier hs-var">ghcName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; PluginM uni fun Name
forall (uni :: * -&gt; *) fun. Name -&gt; PluginM uni fun Name
</span><a href="PlutusTx.Plugin.html#thNameToGhcNameOrFail"><span class="hs-identifier hs-var">thNameToGhcNameOrFail</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679446679"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-624"></span><span>        </span><span id="local-6989586621679446681"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621679446681"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT (CompileError uni fun Ann) CoreM TyThing
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) TyThing
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT PluginCtx m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT (CompileError uni fun Ann) CoreM TyThing
 -&gt; ReaderT
      PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) TyThing)
-&gt; (CoreM TyThing
    -&gt; ExceptT (CompileError uni fun Ann) CoreM TyThing)
-&gt; CoreM TyThing
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) TyThing
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CoreM TyThing -&gt; ExceptT (CompileError uni fun Ann) CoreM TyThing
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; ExceptT (CompileError uni fun Ann) m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreM TyThing
 -&gt; ReaderT
      PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) TyThing)
-&gt; CoreM TyThing
-&gt; ReaderT
     PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) TyThing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; CoreM TyThing
forall (m :: * -&gt; *). MonadThings m =&gt; Name -&gt; m TyThing
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-9.6.3/src/GHC.Types.TyThing.html#lookupThing"><span class="hs-identifier hs-var">GHC.lookupThing</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679446680"><span class="hs-identifier hs-var">ghcName</span></a></span><span>
</span><span id="line-625"></span><span>        </span><span class="annot"><span class="annottext">(Name, TyThing)
-&gt; ReaderT
     PluginCtx
     (ExceptT (CompileError uni fun Ann) CoreM)
     (Name, TyThing)
forall a.
a -&gt; ReaderT PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679446679"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621679446681"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>    </span><span class="annot"><span class="annottext">NameInfo -&gt; PluginM uni fun NameInfo
forall a.
a -&gt; ReaderT PluginCtx (ExceptT (CompileError uni fun Ann) CoreM) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(NameInfo -&gt; PluginM uni fun NameInfo)
-&gt; NameInfo -&gt; PluginM uni fun NameInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyThing)] -&gt; NameInfo
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyThing)]
</span><a href="#local-6989586621679446678"><span class="hs-identifier hs-var">infos</span></a></span><span>
</span><span id="line-627"></span></pre></body></html>