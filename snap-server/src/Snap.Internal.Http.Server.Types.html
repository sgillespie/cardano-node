<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-3"></span><span class="annot"><span class="hs-comment">-- | Types internal to the implementation of the Snap HTTP server.</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Snap.Internal.Http.Server.Types</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#ServerConfig"><span class="hs-identifier">ServerConfig</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#PerSessionData"><span class="hs-identifier">PerSessionData</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#DataFinishedHook"><span class="hs-identifier">DataFinishedHook</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#EscapeSnapHook"><span class="hs-identifier">EscapeSnapHook</span></a></span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#ExceptionHook"><span class="hs-identifier">ExceptionHook</span></a></span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#ParseHook"><span class="hs-identifier">ParseHook</span></a></span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#NewRequestHook"><span class="hs-identifier">NewRequestHook</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#UserHandlerFinishedHook"><span class="hs-identifier">UserHandlerFinishedHook</span></a></span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Handlers</span></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#SendFileHandler"><span class="hs-identifier">SendFileHandler</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#ServerHandler"><span class="hs-identifier">ServerHandler</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#AcceptFunc"><span class="hs-identifier">AcceptFunc</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Socket types</span></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#SocketConfig"><span class="hs-identifier">SocketConfig</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Exception.html"><span class="hs-identifier">Control.Exception</span></a></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier">SomeException</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span>                  </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>                       </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IORef.html#IORef"><span class="hs-identifier">IORef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Word.html"><span class="hs-identifier">Data.Word</span></a></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word64"><span class="hs-identifier">Word64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Network.Socket</span></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Socket</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Builder.html"><span class="hs-identifier">Data.ByteString.Builder</span></a></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Builder.Internal.html#Builder"><span class="hs-identifier">Builder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Builder.Internal.html"><span class="hs-identifier">Data.ByteString.Builder.Internal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Builder.Internal.html#Buffer"><span class="hs-identifier">Buffer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.IO.Streams</span></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">InputStream</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">OutputStream</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Snap.Core</span></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Request</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Response</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- | The 'NewRequestHook' is called once processing for an HTTP request begins,</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- i.e. after the connection has been accepted and we know that there's data</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- available to read from the socket. The IORef passed to the hook initially</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- contains a bottom value that will throw an exception if evaluated.</span><span>
</span><span id="line-42"></span><span class="hs-keyword">type</span><span> </span><span id="NewRequestHook"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#NewRequestHook"><span class="hs-identifier hs-var">NewRequestHook</span></a></span></span><span> </span><span id="local-6989586621679098688"><span class="annot"><a href="#local-6989586621679098688"><span class="hs-identifier hs-type">hookState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#PerSessionData"><span class="hs-identifier hs-type">PerSessionData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679098688"><span class="hs-identifier hs-type">hookState</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">-- | The 'ParseHook' is called after the HTTP Request has been parsed by the</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- server, but before the user handler starts running.</span><span>
</span><span id="line-46"></span><span class="hs-keyword">type</span><span> </span><span id="ParseHook"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#ParseHook"><span class="hs-identifier hs-var">ParseHook</span></a></span></span><span> </span><span id="local-6989586621679098689"><span class="annot"><a href="#local-6989586621679098689"><span class="hs-identifier hs-type">hookState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679098689"><span class="hs-identifier hs-type">hookState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-comment">-- | The 'UserHandlerFinishedHook' is called once the user handler has finished</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- running, but before the data for the HTTP response starts being sent to the</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- client.</span><span>
</span><span id="line-51"></span><span class="hs-keyword">type</span><span> </span><span id="UserHandlerFinishedHook"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#UserHandlerFinishedHook"><span class="hs-identifier hs-var">UserHandlerFinishedHook</span></a></span></span><span> </span><span id="local-6989586621679098690"><span class="annot"><a href="#local-6989586621679098690"><span class="hs-identifier hs-type">hookState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679098690"><span class="hs-identifier hs-type">hookState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Response</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-comment">-- | The 'DataFinishedHook' is called once the server has finished sending the</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- HTTP response to the client.</span><span>
</span><span id="line-56"></span><span class="hs-keyword">type</span><span> </span><span id="DataFinishedHook"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#DataFinishedHook"><span class="hs-identifier hs-var">DataFinishedHook</span></a></span></span><span> </span><span id="local-6989586621679098691"><span class="annot"><a href="#local-6989586621679098691"><span class="hs-identifier hs-type">hookState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679098691"><span class="hs-identifier hs-type">hookState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Response</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">-- | The 'ExceptionHook' is called if an exception reaches the toplevel of the</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- server, i.e. if an exception leaks out of the user handler or if an</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- exception is raised during the sending of the HTTP response data.</span><span>
</span><span id="line-62"></span><span class="hs-keyword">type</span><span> </span><span id="ExceptionHook"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#ExceptionHook"><span class="hs-identifier hs-var">ExceptionHook</span></a></span></span><span> </span><span id="local-6989586621679098692"><span class="annot"><a href="#local-6989586621679098692"><span class="hs-identifier hs-type">hookState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679098692"><span class="hs-identifier hs-type">hookState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- | The 'EscapeSnapHook' is called if the user handler escapes the HTTP</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- session, e.g. for websockets.</span><span>
</span><span id="line-66"></span><span class="hs-keyword">type</span><span> </span><span id="EscapeSnapHook"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#EscapeSnapHook"><span class="hs-identifier hs-var">EscapeSnapHook</span></a></span></span><span> </span><span id="local-6989586621679098693"><span class="annot"><a href="#local-6989586621679098693"><span class="hs-identifier hs-type">hookState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679098693"><span class="hs-identifier hs-type">hookState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>                             </span><span class="hs-comment">---------------------</span><span>
</span><span id="line-70"></span><span>                             </span><span class="hs-comment">-- data structures --</span><span>
</span><span id="line-71"></span><span>                             </span><span class="hs-comment">---------------------</span><span>
</span><span id="line-72"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- | Data and services that all HTTP response handlers share.</span><span>
</span><span id="line-74"></span><span class="hs-comment">--</span><span>
</span><span id="line-75"></span><span class="hs-keyword">data</span><span> </span><span id="ServerConfig"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#ServerConfig"><span class="hs-identifier hs-var">ServerConfig</span></a></span></span><span> </span><span id="local-6989586621679098652"><span class="annot"><a href="#local-6989586621679098652"><span class="hs-identifier hs-type">hookState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ServerConfig"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#ServerConfig"><span class="hs-identifier hs-var">ServerConfig</span></a></span></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_logAccess"><span class="annot"><span class="annottext">forall hookState.
ServerConfig hookState -&gt; Request -&gt; Response -&gt; Word64 -&gt; IO ()
</span><a href="Snap.Internal.Http.Server.Types.html#_logAccess"><span class="hs-identifier hs-var hs-var">_logAccess</span></a></span></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Response</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_logError"><span class="annot"><span class="annottext">forall hookState. ServerConfig hookState -&gt; Builder -&gt; IO ()
</span><a href="Snap.Internal.Http.Server.Types.html#_logError"><span class="hs-identifier hs-var hs-var">_logError</span></a></span></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Builder.Internal.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_onNewRequest"><span class="annot"><span class="annottext">forall hookState.
ServerConfig hookState -&gt; NewRequestHook hookState
</span><a href="Snap.Internal.Http.Server.Types.html#_onNewRequest"><span class="hs-identifier hs-var hs-var">_onNewRequest</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#NewRequestHook"><span class="hs-identifier hs-type">NewRequestHook</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679098652"><span class="hs-identifier hs-type">hookState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_onParse"><span class="annot"><span class="annottext">forall hookState. ServerConfig hookState -&gt; ParseHook hookState
</span><a href="Snap.Internal.Http.Server.Types.html#_onParse"><span class="hs-identifier hs-var hs-var">_onParse</span></a></span></span><span>               </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#ParseHook"><span class="hs-identifier hs-type">ParseHook</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679098652"><span class="hs-identifier hs-type">hookState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_onUserHandlerFinished"><span class="annot"><span class="annottext">forall hookState.
ServerConfig hookState -&gt; UserHandlerFinishedHook hookState
</span><a href="Snap.Internal.Http.Server.Types.html#_onUserHandlerFinished"><span class="hs-identifier hs-var hs-var">_onUserHandlerFinished</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#UserHandlerFinishedHook"><span class="hs-identifier hs-type">UserHandlerFinishedHook</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679098652"><span class="hs-identifier hs-type">hookState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_onDataFinished"><span class="annot"><span class="annottext">forall hookState.
ServerConfig hookState -&gt; UserHandlerFinishedHook hookState
</span><a href="Snap.Internal.Http.Server.Types.html#_onDataFinished"><span class="hs-identifier hs-var hs-var">_onDataFinished</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#DataFinishedHook"><span class="hs-identifier hs-type">DataFinishedHook</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679098652"><span class="hs-identifier hs-type">hookState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_onException"><span class="annot"><span class="annottext">forall hookState. ServerConfig hookState -&gt; ExceptionHook hookState
</span><a href="Snap.Internal.Http.Server.Types.html#_onException"><span class="hs-identifier hs-var hs-var">_onException</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#ExceptionHook"><span class="hs-identifier hs-type">ExceptionHook</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679098652"><span class="hs-identifier hs-type">hookState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_onEscape"><span class="annot"><span class="annottext">forall hookState.
ServerConfig hookState -&gt; EscapeSnapHook hookState
</span><a href="Snap.Internal.Http.Server.Types.html#_onEscape"><span class="hs-identifier hs-var hs-var">_onEscape</span></a></span></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#EscapeSnapHook"><span class="hs-identifier hs-type">EscapeSnapHook</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679098652"><span class="hs-identifier hs-type">hookState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>      </span><span class="annot"><span class="hs-comment">-- | will be overridden by a @Host@ header if it appears.</span></span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_localHostname"><span class="annot"><span class="annottext">forall hookState. ServerConfig hookState -&gt; ByteString
</span><a href="Snap.Internal.Http.Server.Types.html#_localHostname"><span class="hs-identifier hs-var hs-var">_localHostname</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_defaultTimeout"><span class="annot"><span class="annottext">forall hookState. ServerConfig hookState -&gt; Int
</span><a href="Snap.Internal.Http.Server.Types.html#_defaultTimeout"><span class="hs-identifier hs-var hs-var">_defaultTimeout</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_isSecure"><span class="annot"><span class="annottext">forall hookState. ServerConfig hookState -&gt; Bool
</span><a href="Snap.Internal.Http.Server.Types.html#_isSecure"><span class="hs-identifier hs-var hs-var">_isSecure</span></a></span></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Number of accept loops to spawn.</span></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_numAcceptLoops"><span class="annot"><span class="annottext">forall hookState. ServerConfig hookState -&gt; Int
</span><a href="Snap.Internal.Http.Server.Types.html#_numAcceptLoops"><span class="hs-identifier hs-var hs-var">_numAcceptLoops</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-96"></span><span class="annot"><span class="hs-comment">-- | All of the things a session needs to service a single HTTP request.</span></span><span>
</span><span id="line-97"></span><span class="hs-keyword">data</span><span> </span><span id="PerSessionData"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#PerSessionData"><span class="hs-identifier hs-var">PerSessionData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PerSessionData"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#PerSessionData"><span class="hs-identifier hs-var">PerSessionData</span></a></span></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- | If the bool stored in this IORef becomes true, the server will close</span><span>
</span><span id="line-99"></span><span>      </span><span class="hs-comment">-- the connection after the current request is processed.</span><span>
</span><span id="line-100"></span><span>      </span><span id="_forceConnectionClose"><span class="annot"><span class="annottext">PerSessionData -&gt; IORef Bool
</span><a href="Snap.Internal.Http.Server.Types.html#_forceConnectionClose"><span class="hs-identifier hs-var hs-var">_forceConnectionClose</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span>      </span><span class="annot"><span class="hs-comment">-- | An IO action to modify the current request timeout.</span></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_twiddleTimeout"><span class="annot"><span class="annottext">PerSessionData -&gt; (Int -&gt; Int) -&gt; IO ()
</span><a href="Snap.Internal.Http.Server.Types.html#_twiddleTimeout"><span class="hs-identifier hs-var hs-var">_twiddleTimeout</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>      </span><span class="hs-comment">-- | The value stored in this IORef is True if this request is the first</span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-comment">-- on a new connection, and False if it is a subsequent keep-alive</span><span>
</span><span id="line-107"></span><span>      </span><span class="hs-comment">-- request.</span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_isNewConnection"><span class="annot"><span class="annottext">PerSessionData -&gt; IORef Bool
</span><a href="Snap.Internal.Http.Server.Types.html#_isNewConnection"><span class="hs-identifier hs-var hs-var">_isNewConnection</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>      </span><span class="annot"><span class="hs-comment">-- | The function called when we want to use @sendfile().@</span></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_sendfileHandler"><span class="annot"><span class="annottext">PerSessionData -&gt; SendFileHandler
</span><a href="Snap.Internal.Http.Server.Types.html#_sendfileHandler"><span class="hs-identifier hs-var hs-var">_sendfileHandler</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#SendFileHandler"><span class="hs-identifier hs-type">SendFileHandler</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><span class="hs-comment">-- | The server's idea of its local address.</span></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_localAddress"><span class="annot"><span class="annottext">PerSessionData -&gt; ByteString
</span><a href="Snap.Internal.Http.Server.Types.html#_localAddress"><span class="hs-identifier hs-var hs-var">_localAddress</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>      </span><span class="annot"><span class="hs-comment">-- | The listening port number.</span></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_localPort"><span class="annot"><span class="annottext">PerSessionData -&gt; Int
</span><a href="Snap.Internal.Http.Server.Types.html#_localPort"><span class="hs-identifier hs-var hs-var">_localPort</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>      </span><span class="annot"><span class="hs-comment">-- | The address of the remote user.</span></span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_remoteAddress"><span class="annot"><span class="annottext">PerSessionData -&gt; ByteString
</span><a href="Snap.Internal.Http.Server.Types.html#_remoteAddress"><span class="hs-identifier hs-var hs-var">_remoteAddress</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span>      </span><span class="annot"><span class="hs-comment">-- | The remote user's port.</span></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_remotePort"><span class="annot"><span class="annottext">PerSessionData -&gt; Int
</span><a href="Snap.Internal.Http.Server.Types.html#_remotePort"><span class="hs-identifier hs-var hs-var">_remotePort</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>      </span><span class="annot"><span class="hs-comment">-- | The read end of the socket connection.</span></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_readEnd"><span class="annot"><span class="annottext">PerSessionData -&gt; InputStream ByteString
</span><a href="Snap.Internal.Http.Server.Types.html#_readEnd"><span class="hs-identifier hs-var hs-var">_readEnd</span></a></span></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InputStream</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>      </span><span class="annot"><span class="hs-comment">-- | The write end of the socket connection.</span></span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_writeEnd"><span class="annot"><span class="annottext">PerSessionData -&gt; OutputStream ByteString
</span><a href="Snap.Internal.Http.Server.Types.html#_writeEnd"><span class="hs-identifier hs-var hs-var">_writeEnd</span></a></span></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">OutputStream</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-134"></span><span class="hs-keyword">newtype</span><span> </span><span id="AcceptFunc"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#AcceptFunc"><span class="hs-identifier hs-var">AcceptFunc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AcceptFunc"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#AcceptFunc"><span class="hs-identifier hs-var">AcceptFunc</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-135"></span><span>  </span><span id="runAcceptFunc"><span class="annot"><span class="annottext">AcceptFunc
-&gt; (forall a. IO a -&gt; IO a)
-&gt; IO
     (SendFileHandler, ByteString, Int, ByteString, Int,
      InputStream ByteString, OutputStream ByteString, IO ())
</span><a href="Snap.Internal.Http.Server.Types.html#runAcceptFunc"><span class="hs-identifier hs-var hs-var">runAcceptFunc</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679098682"><span class="annot"><a href="#local-6989586621679098682"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679098682"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679098682"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- exception restore function</span><span>
</span><span id="line-136"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#SendFileHandler"><span class="hs-identifier hs-type">SendFileHandler</span></a></span><span>          </span><span class="hs-comment">-- what to do on sendfile</span><span>
</span><span id="line-137"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>               </span><span class="hs-comment">-- local address</span><span>
</span><span id="line-138"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>                      </span><span class="hs-comment">-- local port</span><span>
</span><span id="line-139"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>               </span><span class="hs-comment">-- remote address</span><span>
</span><span id="line-140"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>                      </span><span class="hs-comment">-- remote port</span><span>
</span><span id="line-141"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InputStream</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>   </span><span class="hs-comment">-- socket read end</span><span>
</span><span id="line-142"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OutputStream</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>  </span><span class="hs-comment">-- socket write end</span><span>
</span><span id="line-143"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>                    </span><span class="hs-comment">-- cleanup action</span><span>
</span><span id="line-144"></span><span>                          </span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>                             </span><span class="hs-comment">--------------------</span><span>
</span><span id="line-148"></span><span>                             </span><span class="hs-comment">-- function types --</span><span>
</span><span id="line-149"></span><span>                             </span><span class="hs-comment">--------------------</span><span>
</span><span id="line-150"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- | This function, provided to the web server internals from the outside, is</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- responsible for producing a 'Response' once the server has parsed the</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- 'Request'.</span><span>
</span><span id="line-154"></span><span class="hs-comment">--</span><span>
</span><span id="line-155"></span><span class="hs-keyword">type</span><span> </span><span id="ServerHandler"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#ServerHandler"><span class="hs-identifier hs-var">ServerHandler</span></a></span></span><span> </span><span id="local-6989586621679098720"><span class="annot"><a href="#local-6989586621679098720"><span class="hs-identifier hs-type">hookState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-156"></span><span>        </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#ServerConfig"><span class="hs-identifier hs-type">ServerConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679098720"><span class="hs-identifier hs-type">hookState</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ global server config</span></span><span>
</span><span id="line-157"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#PerSessionData"><span class="hs-identifier hs-type">PerSessionData</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ per-connection data</span></span><span>
</span><span id="line-158"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span>                    </span><span class="annot"><span class="hs-comment">-- ^ HTTP request object</span></span><span>
</span><span id="line-159"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Response</span></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- | A 'SendFileHandler' is called if the user handler requests that a file be</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- sent using @sendfile()@ on systems that support it (Linux, Mac OSX, and</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- FreeBSD).</span><span>
</span><span id="line-166"></span><span class="hs-keyword">type</span><span> </span><span id="SendFileHandler"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#SendFileHandler"><span class="hs-identifier hs-var">SendFileHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-167"></span><span>       </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Builder.Internal.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ builder buffer</span></span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Builder.Internal.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span><span>                  </span><span class="annot"><span class="hs-comment">-- ^ status line and headers</span></span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ file to send</span></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ start offset</span></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ number of bytes</span></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>                        </span><span class="hs-comment">-------------------------------</span><span>
</span><span id="line-177"></span><span>                        </span><span class="hs-comment">-- types for server backends --</span><span>
</span><span id="line-178"></span><span>                        </span><span class="hs-comment">-------------------------------</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- | Either the server should start listening on the given interface \/ port</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- combination, or the server should start up with a 'Socket' that has already</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- had @bind()@ and @listen()@ called on it.</span><span>
</span><span id="line-184"></span><span class="hs-keyword">data</span><span> </span><span id="SocketConfig"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#SocketConfig"><span class="hs-identifier hs-var">SocketConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StartListening"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#StartListening"><span class="hs-identifier hs-var">StartListening</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-185"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span id="PreBound"><span class="annot"><a href="Snap.Internal.Http.Server.Types.html#PreBound"><span class="hs-identifier hs-var">PreBound</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket</span></span><span>
</span><span id="line-186"></span></pre></body></html>