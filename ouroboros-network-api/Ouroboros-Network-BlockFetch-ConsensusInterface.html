<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Ouroboros.Network.BlockFetch.ConsensusInterface</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ouroboros-network-api-0.6.3.0: A networking api shared with ouroboros-consensus</span><ul class="links" id="page-menu"><li id="quick-jump-button"><a href="#">Quick Jump</a></li><li><a href="src/Ouroboros.Network.BlockFetch.ConsensusInterface.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Ouroboros.Network.BlockFetch.ConsensusInterface</p></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:FetchMode">FetchMode</a><ul class="subs"><li>= <a href="#v:FetchModeBulkSync">FetchModeBulkSync</a></li><li>| <a href="#v:FetchModeDeadline">FetchModeDeadline</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:BlockFetchConsensusInterface">BlockFetchConsensusInterface</a> peer header block m = <a href="#v:BlockFetchConsensusInterface">BlockFetchConsensusInterface</a> {<ul class="subs"><li><a href="#v:readCandidateChains">readCandidateChains</a> :: STM m (<a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> peer (<a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header))</li><li><a href="#v:readCurrentChain">readCurrentChain</a> :: STM m (<a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header)</li><li><a href="#v:readFetchMode">readFetchMode</a> :: STM m <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FetchMode</a></li><li><a href="#v:readFetchedBlocks">readFetchedBlocks</a> :: STM m (<a href="Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> block -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>)</li><li><a href="#v:mkAddFetchedBlock">mkAddFetchedBlock</a> :: <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:WhetherReceivingTentativeBlocks" title="Ouroboros.Network.BlockFetch.ConsensusInterface">WhetherReceivingTentativeBlocks</a> -&gt; STM m (<a href="Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> block -&gt; block -&gt; m ())</li><li><a href="#v:readFetchedMaxSlotNo">readFetchedMaxSlotNo</a> :: STM m <a href="Ouroboros-Network-Block.html#t:MaxSlotNo" title="Ouroboros.Network.Block">MaxSlotNo</a></li><li><a href="#v:plausibleCandidateChain">plausibleCandidateChain</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a> =&gt; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header -&gt; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li><a href="#v:compareCandidateChains">compareCandidateChains</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a> =&gt; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header -&gt; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ordering" title="Data.Ord">Ordering</a></li><li><a href="#v:blockFetchSize">blockFetchSize</a> :: header -&gt; <a href="Ouroboros-Network-SizeInBytes.html#t:SizeInBytes" title="Ouroboros.Network.SizeInBytes">SizeInBytes</a></li><li><a href="#v:blockMatchesHeader">blockMatchesHeader</a> :: header -&gt; block -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li><a href="#v:headerForgeUTCTime">headerForgeUTCTime</a> :: <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> header -&gt; STM m <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/Data-Time-Clock.html#t:UTCTime" title="Data.Time.Clock">UTCTime</a></li><li><a href="#v:blockForgeUTCTime">blockForgeUTCTime</a> :: <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> block -&gt; STM m <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/Data-Time-Clock.html#t:UTCTime" title="Data.Time.Clock">UTCTime</a></li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:WhetherReceivingTentativeBlocks">WhetherReceivingTentativeBlocks</a><ul class="subs"><li>= <a href="#v:ReceivingTentativeBlocks">ReceivingTentativeBlocks</a></li><li>| <a href="#v:NotReceivingTentativeBlocks">NotReceivingTentativeBlocks</a></li></ul></li><li class="src short"><span class="keyword">newtype</span> <a href="#t:FromConsensus">FromConsensus</a> a = <a href="#v:FromConsensus">FromConsensus</a> {<ul class="subs"><li><a href="#v:unFromConsensus">unFromConsensus</a> :: a</li></ul>}</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:FetchMode" class="def">FetchMode</a> <a href="src/Ouroboros.Network.BlockFetch.ConsensusInterface.html#FetchMode" class="link">Source</a> <a href="#t:FetchMode" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:FetchModeBulkSync" class="def">FetchModeBulkSync</a></td><td class="doc"><p>Use this mode when we are catching up on the chain but are stil
 well behind. In this mode the fetch logic will optimise for
 throughput rather than latency.</p></td></tr><tr><td class="src"><a id="v:FetchModeDeadline" class="def">FetchModeDeadline</a></td><td class="doc"><p>Use this mode for block-producing nodes that have a known deadline
 to produce a block and need to get the best chain before that. In
 this mode the fetch logic will optimise for picking the best chain
 within the given deadline.</p></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:FetchMode">Instances</h4><details id="i:FetchMode" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FetchMode:Show:1"></span> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FetchMode</a></span> <a href="src/Ouroboros.Network.BlockFetch.ConsensusInterface.html#line-43" class="link">Source</a> <a href="#t:FetchMode" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:FetchMode:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html">Ouroboros.Network.BlockFetch.ConsensusInterface</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FetchMode</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FetchMode</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FetchMode</a>] -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FetchMode:Eq:2"></span> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FetchMode</a></span> <a href="src/Ouroboros.Network.BlockFetch.ConsensusInterface.html#line-43" class="link">Source</a> <a href="#t:FetchMode" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:FetchMode:Eq:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html">Ouroboros.Network.BlockFetch.ConsensusInterface</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FetchMode</a> -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FetchMode</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src" class="link">Source</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FetchMode</a> -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FetchMode</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src" class="link">Source</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:BlockFetchConsensusInterface" class="def">BlockFetchConsensusInterface</a> peer header block m <a href="src/Ouroboros.Network.BlockFetch.ConsensusInterface.html#BlockFetchConsensusInterface" class="link">Source</a> <a href="#t:BlockFetchConsensusInterface" class="selflink">#</a></p><div class="doc"><p>The consensus layer functionality that the block fetch logic requires.</p><p>These are provided as input to the block fetch by the consensus layer.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:BlockFetchConsensusInterface" class="def">BlockFetchConsensusInterface</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:readCandidateChains" class="def">readCandidateChains</a> :: STM m (<a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> peer (<a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header))</dfn><div class="doc"><p>Read the K-suffixes of the candidate chains.</p><p>Assumptions:
 * Their headers must be already validated.
 * They may contain <em>fewer</em> than <code>K</code> blocks.
 * Their anchor does not have to intersect with the current chain.</p></div></li><li><dfn class="src"><a id="v:readCurrentChain" class="def">readCurrentChain</a> :: STM m (<a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header)</dfn><div class="doc"><p>Read the K-suffix of the current chain.</p><p>This must contain info on the last <code>K</code> blocks (unless we're near
 the chain genesis of course).</p></div></li><li><dfn class="src"><a id="v:readFetchMode" class="def">readFetchMode</a> :: STM m <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FetchMode</a></dfn><div class="doc"><p>Read the current fetch mode that the block fetch logic should use.</p><p>The fetch mode is a dynamic part of the block fetch policy. In
 <code><a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#v:FetchModeBulkSync" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FetchModeBulkSync</a></code> it follows a policy that optimises for expected
 bandwidth over latency to fetch any particular block, whereas in
 <code><a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#v:FetchModeDeadline" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FetchModeDeadline</a></code> it follows a policy optimises for the latency
 to fetch blocks, at the expense of wasting bandwidth.</p><p>This mode should be set so that when the node's current chain is near
 to &quot;now&quot; it uses the deadline mode, and when it is far away it uses
 the bulk sync mode.</p></div></li><li><dfn class="src"><a id="v:readFetchedBlocks" class="def">readFetchedBlocks</a> :: STM m (<a href="Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> block -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>)</dfn><div class="doc"><p>Recent, only within last K</p></div></li><li><dfn class="src"><a id="v:mkAddFetchedBlock" class="def">mkAddFetchedBlock</a> :: <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:WhetherReceivingTentativeBlocks" title="Ouroboros.Network.BlockFetch.ConsensusInterface">WhetherReceivingTentativeBlocks</a> -&gt; STM m (<a href="Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> block -&gt; block -&gt; m ())</dfn><div class="doc"><p>This method allocates an <code>addFetchedBlock</code> function per client.
 That function and <code><a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#v:readFetchedBlocks" title="Ouroboros.Network.BlockFetch.ConsensusInterface">readFetchedBlocks</a></code> are required to be linked. Upon
 successful completion of <code>addFetchedBlock</code> it must be the case that
 <code><a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#v:readFetchedBlocks" title="Ouroboros.Network.BlockFetch.ConsensusInterface">readFetchedBlocks</a></code> reports the block.</p></div></li><li><dfn class="src"><a id="v:readFetchedMaxSlotNo" class="def">readFetchedMaxSlotNo</a> :: STM m <a href="Ouroboros-Network-Block.html#t:MaxSlotNo" title="Ouroboros.Network.Block">MaxSlotNo</a></dfn><div class="doc"><p>The highest stored/downloaded slot number.</p><p>This is used to optimise the filtering of fragments in the block
 fetch logic: when removing already downloaded blocks from a
 fragment, the filtering (with a linear cost) is stopped as soon as a
 block has a slot number higher than this slot number, as it cannot
 have been downloaded anyway.</p></div></li><li><dfn class="src"><a id="v:plausibleCandidateChain" class="def">plausibleCandidateChain</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a> =&gt; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header -&gt; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></dfn><div class="doc"><p>Given the current chain, is the given chain plausible as a
 candidate chain. Classically for Ouroboros this would simply
 check if the candidate is strictly longer, but for Ouroboros
 with operational key certificates there are also cases where
 we would consider a chain of equal length to the current chain.</p></div></li><li><dfn class="src"><a id="v:compareCandidateChains" class="def">compareCandidateChains</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a> =&gt; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header -&gt; <a href="Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ordering" title="Data.Ord">Ordering</a></dfn><div class="doc"><p>Compare two candidate chains and return a preference ordering.
 This is used as part of selecting which chains to prioritise for
 downloading block bodies.</p></div></li><li><dfn class="src"><a id="v:blockFetchSize" class="def">blockFetchSize</a> :: header -&gt; <a href="Ouroboros-Network-SizeInBytes.html#t:SizeInBytes" title="Ouroboros.Network.SizeInBytes">SizeInBytes</a></dfn><div class="doc"><p>Much of the logic for deciding which blocks to download from which
 peer depends on making estimates based on recent performance metrics.
 These estimates of course depend on the amount of data we will be
 downloading.</p></div></li><li><dfn class="src"><a id="v:blockMatchesHeader" class="def">blockMatchesHeader</a> :: header -&gt; block -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></dfn><div class="doc"><p>Given a block header, validate the supposed corresponding block
 body.</p></div></li><li><dfn class="src"><a id="v:headerForgeUTCTime" class="def">headerForgeUTCTime</a> :: <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> header -&gt; STM m <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/Data-Time-Clock.html#t:UTCTime" title="Data.Time.Clock">UTCTime</a></dfn><div class="doc"><p>Calculate when a header's block was forged.</p><p>PRECONDITION: This function will succeed and give a _correct_ result
 when applied to headers obtained via this interface (ie via
 Consensus, ie via <code><a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#v:readCurrentChain" title="Ouroboros.Network.BlockFetch.ConsensusInterface">readCurrentChain</a></code> or <code><a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#v:readCandidateChains" title="Ouroboros.Network.BlockFetch.ConsensusInterface">readCandidateChains</a></code>).</p><p>WARNING: This function may fail or, worse, __give an incorrect result
 (!!)__ if applied to headers obtained from sources outside of this
 interface. The <code><a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a></code> newtype wrapper is intended to make it
 difficult to make that mistake, so please pay that syntactic price
 and consider its meaning at each call to this function. Relatedly,
 preserve that argument wrapper as much as possible when deriving
 ancillary functions/interfaces from this function.</p></div></li><li><dfn class="src"><a id="v:blockForgeUTCTime" class="def">blockForgeUTCTime</a> :: <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> block -&gt; STM m <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/Data-Time-Clock.html#t:UTCTime" title="Data.Time.Clock">UTCTime</a></dfn><div class="doc"><p>Calculate when a block was forged.</p><p>PRECONDITION: Same as <code><a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#v:headerForgeUTCTime" title="Ouroboros.Network.BlockFetch.ConsensusInterface">headerForgeUTCTime</a></code>.</p><p>WARNING: Same as <code><a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#v:headerForgeUTCTime" title="Ouroboros.Network.BlockFetch.ConsensusInterface">headerForgeUTCTime</a></code>.</p></div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:WhetherReceivingTentativeBlocks" class="def">WhetherReceivingTentativeBlocks</a> <a href="src/Ouroboros.Network.BlockFetch.ConsensusInterface.html#WhetherReceivingTentativeBlocks" class="link">Source</a> <a href="#t:WhetherReceivingTentativeBlocks" class="selflink">#</a></p><div class="doc"><p>Whether the block fetch peer is sending tentative blocks, which are
 understood to possibly be invalid</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ReceivingTentativeBlocks" class="def">ReceivingTentativeBlocks</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:NotReceivingTentativeBlocks" class="def">NotReceivingTentativeBlocks</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:FromConsensus" class="def">FromConsensus</a> a <a href="src/Ouroboros.Network.BlockFetch.ConsensusInterface.html#FromConsensus" class="link">Source</a> <a href="#t:FromConsensus" class="selflink">#</a></p><div class="doc"><p>A new type used to emphasize the precondition of
 <code><a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#v:headerForgeUTCTime" title="Ouroboros.Network.BlockFetch.ConsensusInterface">headerForgeUTCTime</a></code> and
 <code><a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#v:blockForgeUTCTime" title="Ouroboros.Network.BlockFetch.ConsensusInterface">blockForgeUTCTime</a></code> at each
 call site.</p><p>At time of writing, the <code>a</code> is either a header or a block. The headers are
 literally from Consensus (ie provided by ChainSync). Blocks, on the other
 hand, are indirectly from Consensus: they were fetched only because we
 favored the corresponding header that Consensus provided.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:FromConsensus" class="def">FromConsensus</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:unFromConsensus" class="def">unFromConsensus</a> :: a</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:FromConsensus">Instances</h4><details id="i:FromConsensus" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FromConsensus:Applicative:1"></span> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Control-Applicative.html#t:Applicative" title="Control.Applicative">Applicative</a> <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a></span> <a href="src/Ouroboros.Network.BlockFetch.ConsensusInterface.html#line-178" class="link">Source</a> <a href="#t:FromConsensus" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:FromConsensus:Applicative:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html">Ouroboros.Network.BlockFetch.ConsensusInterface</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:pure">pure</a> :: a -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> a <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:pure" class="selflink">#</a></p><p class="src"><a href="#v:-60--42--62-">(&lt;*&gt;)</a> :: <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> (a -&gt; b) -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> a -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> b <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:-60--42--62-" class="selflink">#</a></p><p class="src"><a href="#v:liftA2">liftA2</a> :: (a -&gt; b -&gt; c) -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> a -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> b -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> c <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:liftA2" class="selflink">#</a></p><p class="src"><a href="#v:-42--62-">(*&gt;)</a> :: <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> a -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> b -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> b <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:-42--62-" class="selflink">#</a></p><p class="src"><a href="#v:-60--42-">(&lt;*)</a> :: <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> a -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> b -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> a <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:-60--42-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FromConsensus:Functor:2"></span> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Functor.html#t:Functor" title="Data.Functor">Functor</a> <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a></span> <a href="src/Ouroboros.Network.BlockFetch.ConsensusInterface.html#line-176" class="link">Source</a> <a href="#t:FromConsensus" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:FromConsensus:Functor:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html">Ouroboros.Network.BlockFetch.ConsensusInterface</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:fmap">fmap</a> :: (a -&gt; b) -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> a -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> b <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:fmap" class="selflink">#</a></p><p class="src"><a href="#v:-60--36-">(&lt;$)</a> :: a -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> b -&gt; <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html#t:FromConsensus" title="Ouroboros.Network.BlockFetch.ConsensusInterface">FromConsensus</a> a <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:-60--36-" class="selflink">#</a></p></div></details></td></tr></table></details></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.1</p></div></body></html>