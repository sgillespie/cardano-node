<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns              #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveFunctor             #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE ExistentialQuantification #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts          #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE GADTs                     #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns            #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms           #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards           #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables       #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving        #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns              #-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Network.PeerSelection.Governor.Types</span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * P2P governor policies</span></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionPolicy"><span class="hs-identifier">PeerSelectionPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier">PeerSelectionTargets</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#nullPeerSelectionTargets"><span class="hs-identifier">nullPeerSelectionTargets</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#sanePeerSelectionTargets"><span class="hs-identifier">sanePeerSelectionTargets</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier">PickPolicy</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#pickPeers"><span class="hs-identifier">pickPeers</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><span class="hs-comment">-- * P2P governor low level API</span></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-comment">-- These records are needed to run the peer selection.</span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerStateActions"><span class="hs-identifier">PeerStateActions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionActions"><span class="hs-identifier">PeerSelectionActions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#ChurnMode"><span class="hs-identifier">ChurnMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><span class="hs-comment">-- * P2P governor internals</span></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier">PeerSelectionState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#emptyPeerSelectionState"><span class="hs-identifier">emptyPeerSelectionState</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#assertPeerSelectionState"><span class="hs-identifier">assertPeerSelectionState</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeersStatus"><span class="hs-identifier">establishedPeersStatus</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PublicPeerSelectionState"><span class="hs-identifier">PublicPeerSelectionState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#emptyPublicPeerSelectionState"><span class="hs-identifier">emptyPublicPeerSelectionState</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#toPublicState"><span class="hs-identifier">toPublicState</span></a></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier">Guarded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier">GuardedSkip</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier">Guarded</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Decision"><span class="hs-identifier">Decision</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TimedDecision"><span class="hs-identifier">TimedDecision</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#MkGuardedDecision"><span class="hs-identifier">MkGuardedDecision</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Completion"><span class="hs-identifier">Completion</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionCounters"><span class="hs-identifier">PeerSelectionCounters</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#peerStateToCounters"><span class="hs-identifier">peerStateToCounters</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Peer Sharing Auxiliary data type</span></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">PeerSharingResult</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Traces</span></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePeerSelection"><span class="hs-identifier">TracePeerSelection</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#DebugPeerSelection"><span class="hs-identifier">DebugPeerSelection</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Cache</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Cache</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier">fromMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Monoid.Synchronisation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FirstToFinish</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Semigroup.html"><span class="hs-identifier">Data.Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Semigroup.html#Min"><span class="hs-identifier">Min</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Applicative.html"><span class="hs-identifier">Control.Applicative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Alternative"><span class="hs-identifier">Alternative</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Concurrent.JobPool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Job</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Exception.html"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier">SomeException</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier">assert</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadSTM</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadTime.SI</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.Random</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">StdGen</span></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.ExitPolicy.html"><span class="hs-identifier">Ouroboros.Network.ExitPolicy</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.LedgerPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.LedgerPeers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IsBigLedgerPeer</span></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>                     </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.LedgerPeers.Common.html#IsLedgerPeer"><span class="hs-identifier">IsLedgerPeer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.PeerSelection.PeerAdvertise</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PeerAdvertise</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.PeerSelection.PeerSharing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PeerSharing</span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.EstablishedPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.State.EstablishedPeers</span></a></span><span>
</span><span id="line-70"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.EstablishedPeers.html#EstablishedPeers"><span class="hs-identifier">EstablishedPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.EstablishedPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.State.EstablishedPeers</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EstablishedPeers</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.KnownPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.State.KnownPeers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.KnownPeers.html#KnownPeers"><span class="hs-identifier">KnownPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.KnownPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.State.KnownPeers</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">KnownPeers</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.State.LocalRootPeers</span></a></span><span>
</span><span id="line-75"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#HotValency"><span class="hs-identifier">HotValency</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#LocalRootPeers"><span class="hs-identifier">LocalRootPeers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#WarmValency"><span class="hs-identifier">WarmValency</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.State.LocalRootPeers</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LocalRootPeers</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerSource"><span class="hs-identifier">PeerSource</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>                     </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerStatus"><span class="hs-identifier">PeerStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerHot"><span class="hs-identifier">PeerHot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerWarm"><span class="hs-identifier">PeerWarm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Protocol.PeerSharing.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PeerSharingAmount</span></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>                     </span><span class="annot"><span class="hs-identifier">PeerSharingResult</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | A peer pick policy is an action that picks a subset of elements from a</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- map of peers.</span><span>
</span><span id="line-85"></span><span class="hs-comment">--</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- The pre-condition is that the map of available choices will be non-empty,</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- and the requested number to pick will be strictly positive.</span><span>
</span><span id="line-88"></span><span class="hs-comment">--</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- The post-condition is that the picked set is non-empty but must not be</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- bigger than the requested number.</span><span>
</span><span id="line-91"></span><span class="hs-comment">--</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- Peer selection API is using `STM m` monad, internally it is using `m`.</span><span>
</span><span id="line-93"></span><span class="hs-comment">--</span><span>
</span><span id="line-94"></span><span class="hs-keyword">type</span><span> </span><span id="PickPolicy"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-var">PickPolicy</span></a></span></span><span> </span><span id="local-6989586621679218344"><span class="annot"><a href="#local-6989586621679218344"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679218345"><span class="annot"><a href="#local-6989586621679218345"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-95"></span><span>         </span><span class="hs-comment">-- Extra peer attributes available to use in the picking policy.</span><span>
</span><span id="line-96"></span><span>         </span><span class="hs-comment">-- As more attributes are needed, extend this with more such functions.</span><span>
</span><span id="line-97"></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679218344"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerSource"><span class="hs-identifier hs-type">PeerSource</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Where the peer is known from</span><span>
</span><span id="line-98"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679218344"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- Connection failure count</span><span>
</span><span id="line-99"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679218344"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- Found to be tepid flag</span><span>
</span><span id="line-100"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218344"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>             </span><span class="hs-comment">-- The set to pick from</span><span>
</span><span id="line-101"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>                      </span><span class="hs-comment">-- Max number to choose, fewer is ok.</span><span>
</span><span id="line-102"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679218345"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218344"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- The set picked.</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-keyword">data</span><span> </span><span id="PeerSelectionPolicy"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionPolicy"><span class="hs-identifier hs-var">PeerSelectionPolicy</span></a></span></span><span> </span><span id="local-6989586621679217978"><span class="annot"><a href="#local-6989586621679217978"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679217979"><span class="annot"><a href="#local-6989586621679217979"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerSelectionPolicy"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionPolicy"><span class="hs-identifier hs-var">PeerSelectionPolicy</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>       </span><span id="policyPickKnownPeersForPeerShare"><span class="annot"><span class="annottext">forall peeraddr (m :: * -&gt; *).
PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr (STM m)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickKnownPeersForPeerShare"><span class="hs-identifier hs-var hs-var">policyPickKnownPeersForPeerShare</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679217978"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679217979"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>       </span><span id="policyPickColdPeersToPromote"><span class="annot"><span class="annottext">forall peeraddr (m :: * -&gt; *).
PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr (STM m)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickColdPeersToPromote"><span class="hs-identifier hs-var hs-var">policyPickColdPeersToPromote</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679217978"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679217979"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>       </span><span id="policyPickWarmPeersToPromote"><span class="annot"><span class="annottext">forall peeraddr (m :: * -&gt; *).
PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr (STM m)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickWarmPeersToPromote"><span class="hs-identifier hs-var hs-var">policyPickWarmPeersToPromote</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679217978"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679217979"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>       </span><span id="policyPickHotPeersToDemote"><span class="annot"><span class="annottext">forall peeraddr (m :: * -&gt; *).
PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr (STM m)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickHotPeersToDemote"><span class="hs-identifier hs-var hs-var">policyPickHotPeersToDemote</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679217978"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679217979"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>       </span><span id="policyPickWarmPeersToDemote"><span class="annot"><span class="annottext">forall peeraddr (m :: * -&gt; *).
PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr (STM m)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickWarmPeersToDemote"><span class="hs-identifier hs-var hs-var">policyPickWarmPeersToDemote</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679217978"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679217979"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>       </span><span id="policyPickColdPeersToForget"><span class="annot"><span class="annottext">forall peeraddr (m :: * -&gt; *).
PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr (STM m)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickColdPeersToForget"><span class="hs-identifier hs-var hs-var">policyPickColdPeersToForget</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679217978"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679217979"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>       </span><span id="policyFindPublicRootTimeout"><span class="annot"><span class="annottext">forall peeraddr (m :: * -&gt; *).
PeerSelectionPolicy peeraddr m -&gt; DiffTime
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyFindPublicRootTimeout"><span class="hs-identifier hs-var hs-var">policyFindPublicRootTimeout</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>       </span><span id="policyMaxInProgressPeerShareReqs"><span class="annot"><span class="annottext">forall peeraddr (m :: * -&gt; *).
PeerSelectionPolicy peeraddr m -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyMaxInProgressPeerShareReqs"><span class="hs-identifier hs-var hs-var">policyMaxInProgressPeerShareReqs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Maximum number of peer sharing requests that can be in progress</span></span><span>
</span><span id="line-117"></span><span>       </span><span id="policyPeerShareRetryTime"><span class="annot"><span class="annottext">forall peeraddr (m :: * -&gt; *).
PeerSelectionPolicy peeraddr m -&gt; DiffTime
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPeerShareRetryTime"><span class="hs-identifier hs-var hs-var">policyPeerShareRetryTime</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>       </span><span class="hs-comment">-- ^ Amount of time a node has to wait before issuing a new peer sharing</span><span>
</span><span id="line-119"></span><span>       </span><span class="hs-comment">-- request</span><span>
</span><span id="line-120"></span><span>       </span><span id="policyPeerShareBatchWaitTime"><span class="annot"><span class="annottext">forall peeraddr (m :: * -&gt; *).
PeerSelectionPolicy peeraddr m -&gt; DiffTime
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPeerShareBatchWaitTime"><span class="hs-identifier hs-var hs-var">policyPeerShareBatchWaitTime</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Amount of time a batch of peer sharing requests is allowed to take</span></span><span>
</span><span id="line-122"></span><span>       </span><span id="policyPeerShareOverallTimeout"><span class="annot"><span class="annottext">forall peeraddr (m :: * -&gt; *).
PeerSelectionPolicy peeraddr m -&gt; DiffTime
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPeerShareOverallTimeout"><span class="hs-identifier hs-var hs-var">policyPeerShareOverallTimeout</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-123"></span><span>       </span><span class="hs-comment">-- ^ Amount of time the overall batches of peer sharing requests are</span><span>
</span><span id="line-124"></span><span>       </span><span class="hs-comment">-- allowed to take</span><span>
</span><span id="line-125"></span><span>       </span><span id="policyPeerShareActivationDelay"><span class="annot"><span class="annottext">forall peeraddr (m :: * -&gt; *).
PeerSelectionPolicy peeraddr m -&gt; DiffTime
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPeerShareActivationDelay"><span class="hs-identifier hs-var hs-var">policyPeerShareActivationDelay</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-126"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Delay until we consider a peer suitable for peer sharing</span></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>       </span><span class="hs-comment">-- | Re-promote delay, passed from `ExitPolicy`.</span><span>
</span><span id="line-129"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-130"></span><span>       </span><span id="policyErrorDelay"><span class="annot"><span class="annottext">forall peeraddr (m :: * -&gt; *).
PeerSelectionPolicy peeraddr m -&gt; DiffTime
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyErrorDelay"><span class="hs-identifier hs-var hs-var">policyErrorDelay</span></a></span></span><span>                 </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-131"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">-- | Adjustable targets for the peer selection mechanism.</span><span>
</span><span id="line-135"></span><span class="hs-comment">--</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- These are used by the peer selection governor as targets. They are used by</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- the peer churn governor loop as knobs to adjust, to influence the peer</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- selection governor.</span><span>
</span><span id="line-139"></span><span class="hs-comment">--</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- The /known/, /established/ and /active/ peer targets are targets both from</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- below and from above: the governor will attempt to grow or shrink the sets</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- to hit these targets.</span><span>
</span><span id="line-143"></span><span class="hs-comment">--</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- Unlike the other targets, the /root/ peer target is \&quot;one sided\&quot;, it is</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- only a target from below. The governor does not try to shrink the root set</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- to hit it, it simply stops looking for more.</span><span>
</span><span id="line-147"></span><span class="hs-comment">--</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- There is also an implicit target that enough local root peers are selected</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- as active. This comes from the configuration for local roots, and is not an</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- independently adjustable target.</span><span>
</span><span id="line-151"></span><span class="hs-comment">--</span><span>
</span><span id="line-152"></span><span class="hs-keyword">data</span><span> </span><span id="PeerSelectionTargets"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-var">PeerSelectionTargets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerSelectionTargets"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-var">PeerSelectionTargets</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>       </span><span id="targetNumberOfRootPeers"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfRootPeers"><span class="hs-identifier hs-var hs-var">targetNumberOfRootPeers</span></a></span></span><span>                 </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>       </span><span class="hs-comment">-- | The target number of all known peers.  This includes ledger,</span><span>
</span><span id="line-157"></span><span>       </span><span class="hs-comment">-- big ledger peers.</span><span>
</span><span id="line-158"></span><span>       </span><span id="targetNumberOfKnownPeers"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfKnownPeers"><span class="hs-identifier hs-var hs-var">targetNumberOfKnownPeers</span></a></span></span><span>                </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-159"></span><span>       </span><span class="hs-comment">-- | The target number of established peers (does not include big ledger</span><span>
</span><span id="line-160"></span><span>       </span><span class="hs-comment">-- peers).</span><span>
</span><span id="line-161"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-162"></span><span>       </span><span class="hs-comment">-- The target includes root peers, local root peers, ledger peers and big</span><span>
</span><span id="line-163"></span><span>       </span><span class="hs-comment">-- ledger peers.</span><span>
</span><span id="line-164"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-165"></span><span>       </span><span id="targetNumberOfEstablishedPeers"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfEstablishedPeers"><span class="hs-identifier hs-var hs-var">targetNumberOfEstablishedPeers</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-166"></span><span>       </span><span class="hs-comment">-- | The target number of active peers (does not include big ledger</span><span>
</span><span id="line-167"></span><span>       </span><span class="hs-comment">-- peers).</span><span>
</span><span id="line-168"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-169"></span><span>       </span><span class="hs-comment">-- The</span><span>
</span><span id="line-170"></span><span>       </span><span id="targetNumberOfActivePeers"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfActivePeers"><span class="hs-identifier hs-var hs-var">targetNumberOfActivePeers</span></a></span></span><span>               </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span>       </span><span class="hs-comment">-- | Target number of known big ledger peers.</span><span>
</span><span id="line-173"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-174"></span><span>       </span><span class="hs-comment">-- This target is independent of `targetNumberOfKnownPeers`.  The total</span><span>
</span><span id="line-175"></span><span>       </span><span class="hs-comment">-- number of known peers will be sum of the two targets.</span><span>
</span><span id="line-176"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-177"></span><span>       </span><span id="targetNumberOfKnownBigLedgerPeers"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfKnownBigLedgerPeers"><span class="hs-identifier hs-var hs-var">targetNumberOfKnownBigLedgerPeers</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-178"></span><span>       </span><span class="hs-comment">-- | Target number of established big ledger peers.</span><span>
</span><span id="line-179"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-180"></span><span>       </span><span class="hs-comment">-- This target is independent of `targetNumberOfEstablishedPeers`.  The</span><span>
</span><span id="line-181"></span><span>       </span><span class="hs-comment">-- total number of established peers will be sum of the two targets and</span><span>
</span><span id="line-182"></span><span>       </span><span class="hs-comment">-- local root peers.</span><span>
</span><span id="line-183"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-184"></span><span>       </span><span id="targetNumberOfEstablishedBigLedgerPeers"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfEstablishedBigLedgerPeers"><span class="hs-identifier hs-var hs-var">targetNumberOfEstablishedBigLedgerPeers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-185"></span><span>       </span><span class="hs-comment">-- | Target number of active big ledger peers.</span><span>
</span><span id="line-186"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-187"></span><span>       </span><span class="hs-comment">-- This target is independent of `targetNumberOfActivePeers`.  The total</span><span>
</span><span id="line-188"></span><span>       </span><span class="hs-comment">-- number of active peers will be sum of the two targets and active local</span><span>
</span><span id="line-189"></span><span>       </span><span class="hs-comment">-- root peers.</span><span>
</span><span id="line-190"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-191"></span><span>       </span><span id="targetNumberOfActiveBigLedgerPeers"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfActiveBigLedgerPeers"><span class="hs-identifier hs-var hs-var">targetNumberOfActiveBigLedgerPeers</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>       </span><span class="hs-comment">-- Expressed as intervals rather than frequencies</span><span>
</span><span id="line-194"></span><span class="hs-comment">--     targetChurnIntervalKnownPeers       :: !DiffTime,</span><span>
</span><span id="line-195"></span><span class="hs-comment">--     targetChurnIntervalEstablishedPeers :: !DiffTime,</span><span>
</span><span id="line-196"></span><span class="hs-comment">--     targetChurnIntervalActivePeers      :: !DiffTime</span><span>
</span><span id="line-197"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679218371"><span id="local-6989586621679218381"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool
(PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool)
-&gt; (PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool)
-&gt; Eq PeerSelectionTargets
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool
== :: PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool
$c/= :: PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool
/= :: PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218386"><span id="local-6989586621679218397"><span id="local-6989586621679218401"><span class="annot"><span class="annottext">Int -&gt; PeerSelectionTargets -&gt; ShowS
[PeerSelectionTargets] -&gt; ShowS
PeerSelectionTargets -&gt; String
(Int -&gt; PeerSelectionTargets -&gt; ShowS)
-&gt; (PeerSelectionTargets -&gt; String)
-&gt; ([PeerSelectionTargets] -&gt; ShowS)
-&gt; Show PeerSelectionTargets
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; PeerSelectionTargets -&gt; ShowS
showsPrec :: Int -&gt; PeerSelectionTargets -&gt; ShowS
$cshow :: PeerSelectionTargets -&gt; String
show :: PeerSelectionTargets -&gt; String
$cshowList :: [PeerSelectionTargets] -&gt; ShowS
showList :: [PeerSelectionTargets] -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#nullPeerSelectionTargets"><span class="hs-identifier hs-type">nullPeerSelectionTargets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span>
</span><span id="line-201"></span><span id="nullPeerSelectionTargets"><span class="annot"><span class="annottext">nullPeerSelectionTargets :: PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#nullPeerSelectionTargets"><span class="hs-identifier hs-var hs-var">nullPeerSelectionTargets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-203"></span><span>       </span><span class="annot"><span class="annottext">targetNumberOfRootPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfRootPeers"><span class="hs-identifier hs-var">targetNumberOfRootPeers</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-204"></span><span>       </span><span class="annot"><span class="annottext">targetNumberOfKnownPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfKnownPeers"><span class="hs-identifier hs-var">targetNumberOfKnownPeers</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-205"></span><span>       </span><span class="annot"><span class="annottext">targetNumberOfEstablishedPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfEstablishedPeers"><span class="hs-identifier hs-var">targetNumberOfEstablishedPeers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-206"></span><span>       </span><span class="annot"><span class="annottext">targetNumberOfActivePeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfActivePeers"><span class="hs-identifier hs-var">targetNumberOfActivePeers</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-207"></span><span>       </span><span class="annot"><span class="annottext">targetNumberOfKnownBigLedgerPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfKnownBigLedgerPeers"><span class="hs-identifier hs-var">targetNumberOfKnownBigLedgerPeers</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-208"></span><span>       </span><span class="annot"><span class="annottext">targetNumberOfEstablishedBigLedgerPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfEstablishedBigLedgerPeers"><span class="hs-identifier hs-var">targetNumberOfEstablishedBigLedgerPeers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-209"></span><span>       </span><span class="annot"><span class="annottext">targetNumberOfActiveBigLedgerPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfActiveBigLedgerPeers"><span class="hs-identifier hs-var">targetNumberOfActiveBigLedgerPeers</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-210"></span><span class="hs-comment">--     targetChurnIntervalKnownPeers       = 0,</span><span>
</span><span id="line-211"></span><span class="hs-comment">--     targetChurnIntervalEstablishedPeers = 0,</span><span>
</span><span id="line-212"></span><span class="hs-comment">--     targetChurnIntervalActivePeers      = 0</span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#sanePeerSelectionTargets"><span class="hs-identifier hs-type">sanePeerSelectionTargets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-216"></span><span id="sanePeerSelectionTargets"><span class="annot"><span class="annottext">sanePeerSelectionTargets :: PeerSelectionTargets -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#sanePeerSelectionTargets"><span class="hs-identifier hs-var hs-var">sanePeerSelectionTargets</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span class="hs-special">{</span><span id="local-6989586621679218404"><span id="local-6989586621679218405"><span id="local-6989586621679218406"><span id="local-6989586621679218407"><span id="local-6989586621679218408"><span id="local-6989586621679218409"><span id="local-6989586621679218410"><span class="annot"><span class="annottext">Int
targetNumberOfRootPeers :: PeerSelectionTargets -&gt; Int
targetNumberOfKnownPeers :: PeerSelectionTargets -&gt; Int
targetNumberOfEstablishedPeers :: PeerSelectionTargets -&gt; Int
targetNumberOfActivePeers :: PeerSelectionTargets -&gt; Int
targetNumberOfKnownBigLedgerPeers :: PeerSelectionTargets -&gt; Int
targetNumberOfEstablishedBigLedgerPeers :: PeerSelectionTargets -&gt; Int
targetNumberOfActiveBigLedgerPeers :: PeerSelectionTargets -&gt; Int
targetNumberOfRootPeers :: Int
targetNumberOfKnownPeers :: Int
targetNumberOfEstablishedPeers :: Int
targetNumberOfActivePeers :: Int
targetNumberOfKnownBigLedgerPeers :: Int
targetNumberOfEstablishedBigLedgerPeers :: Int
targetNumberOfActiveBigLedgerPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfRootPeers"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-217"></span><span>                                 </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218407"><span class="hs-identifier hs-var">targetNumberOfActivePeers</span></a></span><span>
</span><span id="line-218"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218407"><span class="hs-identifier hs-var">targetNumberOfActivePeers</span></a></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218406"><span class="hs-identifier hs-var">targetNumberOfEstablishedPeers</span></a></span><span>
</span><span id="line-219"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218406"><span class="hs-identifier hs-var">targetNumberOfEstablishedPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218405"><span class="hs-identifier hs-var">targetNumberOfKnownPeers</span></a></span><span>
</span><span id="line-220"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>      </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218404"><span class="hs-identifier hs-var">targetNumberOfRootPeers</span></a></span><span>   </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218405"><span class="hs-identifier hs-var">targetNumberOfKnownPeers</span></a></span><span>
</span><span id="line-221"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>                              </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218404"><span class="hs-identifier hs-var">targetNumberOfRootPeers</span></a></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>                                       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218410"><span class="hs-identifier hs-var">targetNumberOfActiveBigLedgerPeers</span></a></span><span>
</span><span id="line-224"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218410"><span class="hs-identifier hs-var">targetNumberOfActiveBigLedgerPeers</span></a></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218409"><span class="hs-identifier hs-var">targetNumberOfEstablishedBigLedgerPeers</span></a></span><span>
</span><span id="line-225"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218409"><span class="hs-identifier hs-var">targetNumberOfEstablishedBigLedgerPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218408"><span class="hs-identifier hs-var">targetNumberOfKnownBigLedgerPeers</span></a></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218407"><span class="hs-identifier hs-var">targetNumberOfActivePeers</span></a></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span>
</span><span id="line-228"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218406"><span class="hs-identifier hs-var">targetNumberOfEstablishedPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000</span></span><span>
</span><span id="line-229"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218405"><span class="hs-identifier hs-var">targetNumberOfKnownPeers</span></a></span><span>       </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10000</span></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218410"><span class="hs-identifier hs-var">targetNumberOfActiveBigLedgerPeers</span></a></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span>
</span><span id="line-232"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218409"><span class="hs-identifier hs-var">targetNumberOfEstablishedBigLedgerPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000</span></span><span>
</span><span id="line-233"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218408"><span class="hs-identifier hs-var">targetNumberOfKnownBigLedgerPeers</span></a></span><span>       </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10000</span></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">-- | Actions performed by the peer selection governor.</span><span>
</span><span id="line-237"></span><span class="hs-comment">--</span><span>
</span><span id="line-238"></span><span class="hs-comment">-- These being pluggable allows:</span><span>
</span><span id="line-239"></span><span class="hs-comment">--</span><span>
</span><span id="line-240"></span><span class="hs-comment">-- * choice of known peer root sets</span><span>
</span><span id="line-241"></span><span class="hs-comment">-- * running both in simulation and for real</span><span>
</span><span id="line-242"></span><span class="hs-comment">--</span><span>
</span><span id="line-243"></span><span class="hs-keyword">data</span><span> </span><span id="PeerSelectionActions"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionActions"><span class="hs-identifier hs-var">PeerSelectionActions</span></a></span></span><span> </span><span id="local-6989586621679218014"><span class="annot"><a href="#local-6989586621679218014"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679218015"><span class="annot"><a href="#local-6989586621679218015"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span id="local-6989586621679218016"><span class="annot"><a href="#local-6989586621679218016"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerSelectionActions"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionActions"><span class="hs-identifier hs-var">PeerSelectionActions</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>       </span><span id="readPeerSelectionTargets"><span class="annot"><span class="annottext">forall peeraddr peerconn (m :: * -&gt; *).
PeerSelectionActions peeraddr peerconn m
-&gt; STM m PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#readPeerSelectionTargets"><span class="hs-identifier hs-var hs-var">readPeerSelectionTargets</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679218016"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>       </span><span class="hs-comment">-- | Read the current set of locally or privately known root peers.</span><span>
</span><span id="line-248"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-249"></span><span>       </span><span class="hs-comment">-- In general this is expected to be updated asynchronously by some</span><span>
</span><span id="line-250"></span><span>       </span><span class="hs-comment">-- other thread. It is intended to cover the use case of peers from</span><span>
</span><span id="line-251"></span><span>       </span><span class="hs-comment">-- local configuration. It could be dynamic due to DNS resolution, or</span><span>
</span><span id="line-252"></span><span>       </span><span class="hs-comment">-- due to dynamic configuration updates.</span><span>
</span><span id="line-253"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-254"></span><span>       </span><span class="hs-comment">-- It is structured as a collection of (non-overlapping) groups of peers</span><span>
</span><span id="line-255"></span><span>       </span><span class="hs-comment">-- where we are supposed to select n from each group.</span><span>
</span><span id="line-256"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-257"></span><span>       </span><span id="readLocalRootPeers"><span class="annot"><span class="annottext">forall peeraddr peerconn (m :: * -&gt; *).
PeerSelectionActions peeraddr peerconn m
-&gt; STM m [(HotValency, WarmValency, Map peeraddr PeerAdvertise)]
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#readLocalRootPeers"><span class="hs-identifier hs-var hs-var">readLocalRootPeers</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679218016"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#HotValency"><span class="hs-identifier hs-type">HotValency</span></a></span><span>
</span><span id="line-258"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#WarmValency"><span class="hs-identifier hs-type">WarmValency</span></a></span><span>
</span><span id="line-259"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218014"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerAdvertise</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>       </span><span id="readNewInboundConnection"><span class="annot"><span class="annottext">forall peeraddr peerconn (m :: * -&gt; *).
PeerSelectionActions peeraddr peerconn m
-&gt; STM m (peeraddr, PeerSharing)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#readNewInboundConnection"><span class="hs-identifier hs-var hs-var">readNewInboundConnection</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679218016"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679218014"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerSharing</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>       </span><span class="hs-comment">-- | Read the current Peer Sharing willingness value</span><span>
</span><span id="line-264"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-265"></span><span>       </span><span class="hs-comment">-- This value comes from the Node's configuration file.</span><span>
</span><span id="line-266"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-267"></span><span>       </span><span id="peerSharing"><span class="annot"><span class="annottext">forall peeraddr peerconn (m :: * -&gt; *).
PeerSelectionActions peeraddr peerconn m -&gt; PeerSharing
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#peerSharing"><span class="hs-identifier hs-var hs-var">peerSharing</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerSharing</span></span><span class="hs-special">,</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>       </span><span class="hs-comment">-- | Get the remote's side PeerSharing value from 'peerconn'</span><span>
</span><span id="line-270"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-271"></span><span>       </span><span class="hs-comment">-- 'peerconn' ideally comes from a call to 'establishPeerConnection'.</span><span>
</span><span id="line-272"></span><span>       </span><span class="hs-comment">-- This will establish a connection and perform handshake. The returned</span><span>
</span><span id="line-273"></span><span>       </span><span class="hs-comment">-- 'peerconn' has all the versionData negotiated in the handshake,</span><span>
</span><span id="line-274"></span><span>       </span><span class="hs-comment">-- including the remote peer's 'PeerSharing' willingness information.</span><span>
</span><span id="line-275"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-276"></span><span>       </span><span id="peerConnToPeerSharing"><span class="annot"><span class="annottext">forall peeraddr peerconn (m :: * -&gt; *).
PeerSelectionActions peeraddr peerconn m -&gt; peerconn -&gt; PeerSharing
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#peerConnToPeerSharing"><span class="hs-identifier hs-var hs-var">peerConnToPeerSharing</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679218015"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerSharing</span></span><span class="hs-special">,</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span>       </span><span class="hs-comment">-- | Request a sample of public root peers.</span><span>
</span><span id="line-279"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-280"></span><span>       </span><span class="hs-comment">-- It is intended to cover use cases including:</span><span>
</span><span id="line-281"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-282"></span><span>       </span><span class="hs-comment">-- * federated relays from a DNS pool</span><span>
</span><span id="line-283"></span><span>       </span><span class="hs-comment">-- * stake pool relays published in the blockchain</span><span>
</span><span id="line-284"></span><span>       </span><span class="hs-comment">-- * a pre-distributed snapshot of stake pool relays from the blockchain</span><span>
</span><span id="line-285"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-286"></span><span>       </span><span id="requestPublicRootPeers"><span class="annot"><span class="annottext">forall peeraddr peerconn (m :: * -&gt; *).
PeerSelectionActions peeraddr peerconn m
-&gt; Int -&gt; m (Map peeraddr (PeerAdvertise, IsLedgerPeer), DiffTime)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#requestPublicRootPeers"><span class="hs-identifier hs-var hs-var">requestPublicRootPeers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679218016"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218014"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PeerAdvertise</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.LedgerPeers.Common.html#IsLedgerPeer"><span class="hs-identifier hs-type">IsLedgerPeer</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span>       </span><span class="hs-comment">-- | Request a sample of big ledger peers.</span><span>
</span><span id="line-290"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-291"></span><span>       </span><span id="requestBigLedgerPeers"><span class="annot"><span class="annottext">forall peeraddr peerconn (m :: * -&gt; *).
PeerSelectionActions peeraddr peerconn m
-&gt; Int -&gt; m (Set peeraddr, DiffTime)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#requestBigLedgerPeers"><span class="hs-identifier hs-var hs-var">requestBigLedgerPeers</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679218016"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218014"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span>       </span><span class="hs-comment">-- | The action to contact a known peer and request a sample of its</span><span>
</span><span id="line-294"></span><span>       </span><span class="hs-comment">-- known peers.</span><span>
</span><span id="line-295"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-296"></span><span>       </span><span id="requestPeerShare"><span class="annot"><span class="annottext">forall peeraddr peerconn (m :: * -&gt; *).
PeerSelectionActions peeraddr peerconn m
-&gt; PeerSharingAmount -&gt; peeraddr -&gt; m (PeerSharingResult peeraddr)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#requestPeerShare"><span class="hs-identifier hs-var hs-var">requestPeerShare</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerSharingAmount</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679218014"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679218016"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PeerSharingResult</span></span><span> </span><span class="annot"><a href="#local-6989586621679218014"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span>       </span><span class="hs-comment">-- | Core actions run by the governor to change 'PeerStatus'.</span><span>
</span><span id="line-299"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-300"></span><span>       </span><span id="peerStateActions"><span class="annot"><span class="annottext">forall peeraddr peerconn (m :: * -&gt; *).
PeerSelectionActions peeraddr peerconn m
-&gt; PeerStateActions peeraddr peerconn m
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#peerStateActions"><span class="hs-identifier hs-var hs-var">peerStateActions</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerStateActions"><span class="hs-identifier hs-type">PeerStateActions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218014"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218015"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218016"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-301"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="hs-comment">-- | Callbacks which are performed to change peer state.</span><span>
</span><span id="line-304"></span><span class="hs-comment">--</span><span>
</span><span id="line-305"></span><span class="hs-keyword">data</span><span> </span><span id="PeerStateActions"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerStateActions"><span class="hs-identifier hs-var">PeerStateActions</span></a></span></span><span> </span><span id="local-6989586621679218055"><span class="annot"><a href="#local-6989586621679218055"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679218056"><span class="annot"><a href="#local-6989586621679218056"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span id="local-6989586621679218057"><span class="annot"><a href="#local-6989586621679218057"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerStateActions"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerStateActions"><span class="hs-identifier hs-var">PeerStateActions</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-comment">-- | Monitor peer state.  Must be non-blocking.</span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-308"></span><span>    </span><span id="monitorPeerConnection"><span class="annot"><span class="annottext">forall peeraddr peerconn (m :: * -&gt; *).
PeerStateActions peeraddr peerconn m
-&gt; peerconn -&gt; STM m (PeerStatus, Maybe RepromoteDelay)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#monitorPeerConnection"><span class="hs-identifier hs-var hs-var">monitorPeerConnection</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679218056"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679218057"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerStatus"><span class="hs-identifier hs-type">PeerStatus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.ExitPolicy.html#RepromoteDelay"><span class="hs-identifier hs-type">RepromoteDelay</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>    </span><span class="hs-comment">-- | Establish new connection: cold to warm.</span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-comment">-- 'IsBigLedgerPeer' is passed from the outbound governor to the</span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-comment">-- mini-protocol callbacks.</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-315"></span><span>    </span><span id="establishPeerConnection"><span class="annot"><span class="annottext">forall peeraddr peerconn (m :: * -&gt; *).
PeerStateActions peeraddr peerconn m
-&gt; IsBigLedgerPeer -&gt; peeraddr -&gt; m peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishPeerConnection"><span class="hs-identifier hs-var hs-var">establishPeerConnection</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsBigLedgerPeer</span></span><span>
</span><span id="line-316"></span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679218055"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679218057"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218056"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-comment">-- | Activate a connection: warm to hot promotion.</span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-comment">-- 'IsBigLedgerPeer' is passed from the outbound governor to the</span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-comment">-- mini-protocol callbacks.</span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-323"></span><span>    </span><span id="activatePeerConnection"><span class="annot"><span class="annottext">forall peeraddr peerconn (m :: * -&gt; *).
PeerStateActions peeraddr peerconn m
-&gt; IsBigLedgerPeer -&gt; peerconn -&gt; m ()
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#activatePeerConnection"><span class="hs-identifier hs-var hs-var">activatePeerConnection</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsBigLedgerPeer</span></span><span>
</span><span id="line-324"></span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679218056"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679218057"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span>    </span><span class="hs-comment">-- | Deactive a peer: hot to warm demotion.</span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-328"></span><span>    </span><span id="deactivatePeerConnection"><span class="annot"><span class="annottext">forall peeraddr peerconn (m :: * -&gt; *).
PeerStateActions peeraddr peerconn m -&gt; peerconn -&gt; m ()
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#deactivatePeerConnection"><span class="hs-identifier hs-var hs-var">deactivatePeerConnection</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679218056"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679218057"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-comment">-- | Close a connection: warm to cold transition.</span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-332"></span><span>    </span><span id="closePeerConnection"><span class="annot"><span class="annottext">forall peeraddr peerconn (m :: * -&gt; *).
PeerStateActions peeraddr peerconn m -&gt; peerconn -&gt; m ()
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#closePeerConnection"><span class="hs-identifier hs-var hs-var">closePeerConnection</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679218056"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679218057"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-336"></span><span class="hs-comment">-- Peer Selection State</span><span>
</span><span id="line-337"></span><span class="hs-comment">--</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="hs-comment">-- | The internal state used by the 'peerSelectionGovernor'.</span><span>
</span><span id="line-340"></span><span class="hs-comment">--</span><span>
</span><span id="line-341"></span><span class="hs-comment">-- The local and public root sets are disjoint, and their union is the</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- overall root set.</span><span>
</span><span id="line-343"></span><span class="hs-comment">--</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- Documentation of individual fields describes some of the invariants these</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- structures should maintain. For the entire picture, see</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- 'assertPeerSelectionState'.</span><span>
</span><span id="line-347"></span><span class="hs-comment">--</span><span>
</span><span id="line-348"></span><span class="hs-keyword">data</span><span> </span><span id="PeerSelectionState"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-var">PeerSelectionState</span></a></span></span><span> </span><span id="local-6989586621679218076"><span class="annot"><a href="#local-6989586621679218076"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679218077"><span class="annot"><a href="#local-6989586621679218077"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerSelectionState"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-var">PeerSelectionState</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>       </span><span id="targets"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targets"><span class="hs-identifier hs-var hs-var">targets</span></a></span></span><span>                     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span>       </span><span class="hs-comment">-- | The current set of local root peers. This is structured as a</span><span>
</span><span id="line-353"></span><span>       </span><span class="hs-comment">-- bunch of groups, with a target for each group. This gives us a set of</span><span>
</span><span id="line-354"></span><span>       </span><span class="hs-comment">-- n-of-m choices, e.g. \&quot;pick 2 from this group and 1 from this group\&quot;.</span><span>
</span><span id="line-355"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-356"></span><span>       </span><span class="hs-comment">-- The targets must of course be achievable, and to keep things simple,</span><span>
</span><span id="line-357"></span><span>       </span><span class="hs-comment">-- the groups must be disjoint.</span><span>
</span><span id="line-358"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-359"></span><span>       </span><span id="localRootPeers"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; LocalRootPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#localRootPeers"><span class="hs-identifier hs-var hs-var">localRootPeers</span></a></span></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#LocalRootPeers"><span class="hs-identifier hs-type">LocalRootPeers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218076"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>       </span><span id="publicRootPeers"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootPeers"><span class="hs-identifier hs-var hs-var">publicRootPeers</span></a></span></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218076"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>       </span><span class="hs-comment">-- | Set of big ledger peers.</span><span>
</span><span id="line-364"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-365"></span><span>       </span><span id="bigLedgerPeers"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#bigLedgerPeers"><span class="hs-identifier hs-var hs-var">bigLedgerPeers</span></a></span></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218076"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>       </span><span class="hs-comment">-- | Known peers.</span><span>
</span><span id="line-368"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-369"></span><span>       </span><span id="knownPeers"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; KnownPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#knownPeers"><span class="hs-identifier hs-var hs-var">knownPeers</span></a></span></span><span>                  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.KnownPeers.html#KnownPeers"><span class="hs-identifier hs-type">KnownPeers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218076"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span>       </span><span class="hs-comment">-- | Established peers.</span><span>
</span><span id="line-372"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-373"></span><span>       </span><span id="establishedPeers"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn
-&gt; EstablishedPeers peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeers"><span class="hs-identifier hs-var hs-var">establishedPeers</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.EstablishedPeers.html#EstablishedPeers"><span class="hs-identifier hs-type">EstablishedPeers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218076"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218077"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>       </span><span class="hs-comment">-- | Active peers.</span><span>
</span><span id="line-376"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-377"></span><span>       </span><span id="activePeers"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#activePeers"><span class="hs-identifier hs-var hs-var">activePeers</span></a></span></span><span>                 </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218076"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span>       </span><span class="hs-comment">-- | A counter to manage the exponential backoff strategy for when to</span><span>
</span><span id="line-380"></span><span>       </span><span class="hs-comment">-- retry querying for more public root peers. It is negative for retry</span><span>
</span><span id="line-381"></span><span>       </span><span class="hs-comment">-- counts after failure, and positive for retry counts that are</span><span>
</span><span id="line-382"></span><span>       </span><span class="hs-comment">-- successful but make no progress.</span><span>
</span><span id="line-383"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-384"></span><span>       </span><span id="publicRootBackoffs"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootBackoffs"><span class="hs-identifier hs-var hs-var">publicRootBackoffs</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>       </span><span class="hs-comment">-- | The earliest time we would be prepared to request more public root</span><span>
</span><span id="line-387"></span><span>       </span><span class="hs-comment">-- peers. This is used with the 'publicRootBackoffs' to manage the</span><span>
</span><span id="line-388"></span><span>       </span><span class="hs-comment">-- exponential backoff.</span><span>
</span><span id="line-389"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-390"></span><span>       </span><span id="publicRootRetryTime"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Time
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootRetryTime"><span class="hs-identifier hs-var hs-var">publicRootRetryTime</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">,</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span>       </span><span class="hs-comment">-- | Whether a request for more public root peers is in progress.</span><span>
</span><span id="line-393"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-394"></span><span>       </span><span id="inProgressPublicRootsReq"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPublicRootsReq"><span class="hs-identifier hs-var hs-var">inProgressPublicRootsReq</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span>       </span><span class="hs-comment">-- | A counter to manage the exponential backoff strategy for when to</span><span>
</span><span id="line-397"></span><span>       </span><span class="hs-comment">-- retry querying for more public root peers. It is negative for retry</span><span>
</span><span id="line-398"></span><span>       </span><span class="hs-comment">-- counts after failure, and positive for retry counts that are</span><span>
</span><span id="line-399"></span><span>       </span><span class="hs-comment">-- successful but make no progress.</span><span>
</span><span id="line-400"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-401"></span><span>       </span><span id="bigLedgerPeerBackoffs"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#bigLedgerPeerBackoffs"><span class="hs-identifier hs-var hs-var">bigLedgerPeerBackoffs</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span>       </span><span class="hs-comment">-- | The earliest time we would be prepared to request more big ledger</span><span>
</span><span id="line-404"></span><span>       </span><span class="hs-comment">-- peers. This is used with the 'bigLedgerPeerBackoffs' to manage the</span><span>
</span><span id="line-405"></span><span>       </span><span class="hs-comment">-- exponential backoff.</span><span>
</span><span id="line-406"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-407"></span><span>       </span><span id="bigLedgerPeerRetryTime"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Time
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#bigLedgerPeerRetryTime"><span class="hs-identifier hs-var hs-var">bigLedgerPeerRetryTime</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">,</span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span>       </span><span class="hs-comment">-- | Whether a request for more big ledger peers is in progress.</span><span>
</span><span id="line-410"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-411"></span><span>       </span><span id="inProgressBigLedgerPeersReq"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressBigLedgerPeersReq"><span class="hs-identifier hs-var hs-var">inProgressBigLedgerPeersReq</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>       </span><span id="inProgressPeerShareReqs"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPeerShareReqs"><span class="hs-identifier hs-var hs-var">inProgressPeerShareReqs</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-414"></span><span>       </span><span id="inProgressPromoteCold"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPromoteCold"><span class="hs-identifier hs-var hs-var">inProgressPromoteCold</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218076"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-415"></span><span>       </span><span id="inProgressPromoteWarm"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPromoteWarm"><span class="hs-identifier hs-var hs-var">inProgressPromoteWarm</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218076"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-416"></span><span>       </span><span id="inProgressDemoteWarm"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressDemoteWarm"><span class="hs-identifier hs-var hs-var">inProgressDemoteWarm</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218076"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-417"></span><span>       </span><span id="inProgressDemoteHot"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressDemoteHot"><span class="hs-identifier hs-var hs-var">inProgressDemoteHot</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218076"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span>       </span><span class="hs-comment">-- | Peers that had an async demotion and their connections are still</span><span>
</span><span id="line-420"></span><span>       </span><span class="hs-comment">-- being closed</span><span>
</span><span id="line-421"></span><span>       </span><span id="inProgressDemoteToCold"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressDemoteToCold"><span class="hs-identifier hs-var hs-var">inProgressDemoteToCold</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218076"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span>       </span><span class="annot"><span class="hs-comment">-- | Rng for fuzzy delay</span></span><span>
</span><span id="line-424"></span><span>       </span><span id="fuzzRng"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; StdGen
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#fuzzRng"><span class="hs-identifier hs-var hs-var">fuzzRng</span></a></span></span><span>                     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span class="hs-special">,</span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span>       </span><span class="hs-comment">-- | 'PeerSelectionCounters' counters cache. Allows to only trace</span><span>
</span><span id="line-427"></span><span>       </span><span class="hs-comment">-- values when necessary.</span><span>
</span><span id="line-428"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-429"></span><span>       </span><span id="countersCache"><span class="annot"><span class="annottext">forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Cache PeerSelectionCounters
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#countersCache"><span class="hs-identifier hs-var hs-var">countersCache</span></a></span></span><span>               </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cache</span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionCounters"><span class="hs-identifier hs-type">PeerSelectionCounters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="hs-comment">--     TODO: need something like this to distinguish between lots of bad peers</span><span>
</span><span id="line-432"></span><span class="hs-comment">--     and us getting disconnected from the network locally. We don't want a</span><span>
</span><span id="line-433"></span><span class="hs-comment">--     network disconnect to cause us to flush our full known peer set by</span><span>
</span><span id="line-434"></span><span class="hs-comment">--     considering them all to have bad connectivity.</span><span>
</span><span id="line-435"></span><span class="hs-comment">--     Should also take account of DNS failures for root peer set.</span><span>
</span><span id="line-436"></span><span class="hs-comment">--     lastSuccessfulNetworkEvent :: Time</span><span>
</span><span id="line-437"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-438"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679218456"><span id="local-6989586621679218488"><span id="local-6989586621679218491"><span class="annot"><span class="annottext">Int -&gt; PeerSelectionState peeraddr peerconn -&gt; ShowS
[PeerSelectionState peeraddr peerconn] -&gt; ShowS
PeerSelectionState peeraddr peerconn -&gt; String
(Int -&gt; PeerSelectionState peeraddr peerconn -&gt; ShowS)
-&gt; (PeerSelectionState peeraddr peerconn -&gt; String)
-&gt; ([PeerSelectionState peeraddr peerconn] -&gt; ShowS)
-&gt; Show (PeerSelectionState peeraddr peerconn)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall peeraddr peerconn.
(Ord peeraddr, Show peeraddr, Show peerconn) =&gt;
Int -&gt; PeerSelectionState peeraddr peerconn -&gt; ShowS
forall peeraddr peerconn.
(Ord peeraddr, Show peeraddr, Show peerconn) =&gt;
[PeerSelectionState peeraddr peerconn] -&gt; ShowS
forall peeraddr peerconn.
(Ord peeraddr, Show peeraddr, Show peerconn) =&gt;
PeerSelectionState peeraddr peerconn -&gt; String
$cshowsPrec :: forall peeraddr peerconn.
(Ord peeraddr, Show peeraddr, Show peerconn) =&gt;
Int -&gt; PeerSelectionState peeraddr peerconn -&gt; ShowS
showsPrec :: Int -&gt; PeerSelectionState peeraddr peerconn -&gt; ShowS
$cshow :: forall peeraddr peerconn.
(Ord peeraddr, Show peeraddr, Show peerconn) =&gt;
PeerSelectionState peeraddr peerconn -&gt; String
show :: PeerSelectionState peeraddr peerconn -&gt; String
$cshowList :: forall peeraddr peerconn.
(Ord peeraddr, Show peeraddr, Show peerconn) =&gt;
[PeerSelectionState peeraddr peerconn] -&gt; ShowS
showList :: [PeerSelectionState peeraddr peerconn] -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span class="hs-comment">-- | Public 'PeerSelectionState' that can be accessed by Peer Sharing</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- mechanisms without any problem.</span><span>
</span><span id="line-442"></span><span class="hs-comment">--</span><span>
</span><span id="line-443"></span><span class="hs-comment">-- This data type should not expose too much information and keep only</span><span>
</span><span id="line-444"></span><span class="hs-comment">-- essential data needed for computing the peer sharing request result</span><span>
</span><span id="line-445"></span><span class="hs-comment">--</span><span>
</span><span id="line-446"></span><span class="hs-keyword">newtype</span><span> </span><span id="PublicPeerSelectionState"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PublicPeerSelectionState"><span class="hs-identifier hs-var">PublicPeerSelectionState</span></a></span></span><span> </span><span id="local-6989586621679218136"><span class="annot"><a href="#local-6989586621679218136"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-447"></span><span>  </span><span id="PublicPeerSelectionState"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PublicPeerSelectionState"><span class="hs-identifier hs-var">PublicPeerSelectionState</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-448"></span><span>    </span><span id="availableToShare"><span class="annot"><span class="annottext">forall peeraddr. PublicPeerSelectionState peeraddr -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#availableToShare"><span class="hs-identifier hs-var hs-var">availableToShare</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218136"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span id="local-6989586621679218139"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#emptyPublicPeerSelectionState"><span class="hs-identifier hs-type">emptyPublicPeerSelectionState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218139"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-452"></span><span>                              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PublicPeerSelectionState"><span class="hs-identifier hs-type">PublicPeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218139"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span>
</span><span id="line-453"></span><span id="emptyPublicPeerSelectionState"><span class="annot"><span class="annottext">emptyPublicPeerSelectionState :: forall peeraddr. Ord peeraddr =&gt; PublicPeerSelectionState peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#emptyPublicPeerSelectionState"><span class="hs-identifier hs-var hs-var">emptyPublicPeerSelectionState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-454"></span><span>  </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PublicPeerSelectionState"><span class="hs-identifier hs-type">PublicPeerSelectionState</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-455"></span><span>    </span><span class="annot"><span class="annottext">availableToShare :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#availableToShare"><span class="hs-identifier hs-var">availableToShare</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span class="hs-comment">-- | Convert a 'PeerSelectionState' into a public record accessible by the</span><span>
</span><span id="line-459"></span><span class="hs-comment">-- Peer Sharing mechanisms so we can know about which peers are available and</span><span>
</span><span id="line-460"></span><span class="hs-comment">-- possibly other needed context.</span><span>
</span><span id="line-461"></span><span class="hs-comment">--</span><span>
</span><span id="line-462"></span><span id="local-6989586621679218143"><span id="local-6989586621679218144"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#toPublicState"><span class="hs-identifier hs-type">toPublicState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218143"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218144"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-463"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PublicPeerSelectionState"><span class="hs-identifier hs-type">PublicPeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218143"><span class="hs-identifier hs-type">peeraddr</span></a></span></span></span><span>
</span><span id="line-464"></span><span id="toPublicState"><span class="annot"><span class="annottext">toPublicState :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn
-&gt; PublicPeerSelectionState peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#toPublicState"><span class="hs-identifier hs-var hs-var">toPublicState</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679218499"><span class="annot"><span class="annottext">KnownPeers peeraddr
knownPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; KnownPeers peeraddr
knownPeers :: KnownPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#knownPeers"><span class="hs-identifier hs-var hs-var">knownPeers</span></a></span></span><span>
</span><span id="line-465"></span><span>                                 </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-466"></span><span>   </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PublicPeerSelectionState"><span class="hs-identifier hs-type">PublicPeerSelectionState</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-467"></span><span>     </span><span class="annot"><span class="annottext">availableToShare :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#availableToShare"><span class="hs-identifier hs-var">availableToShare</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-468"></span><span>       </span><span class="annot"><span class="annottext">KnownPeers peeraddr -&gt; Set peeraddr
forall peeraddr. KnownPeers peeraddr -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.State.KnownPeers.html#getPeerSharingResponsePeers"><span class="hs-identifier hs-var">KnownPeers.getPeerSharingResponsePeers</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679218499"><span class="hs-identifier hs-var">knownPeers</span></a></span><span>
</span><span id="line-469"></span><span>   </span><span class="hs-special">}</span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span class="hs-comment">-- Peer selection counters.</span><span>
</span><span id="line-472"></span><span class="hs-comment">--</span><span>
</span><span id="line-473"></span><span class="hs-keyword">data</span><span> </span><span id="PeerSelectionCounters"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionCounters"><span class="hs-identifier hs-var">PeerSelectionCounters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerSelectionCounters"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionCounters"><span class="hs-identifier hs-var">PeerSelectionCounters</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-474"></span><span>      </span><span class="hs-comment">-- | All cold peers including ledger peers, root peers, big ledger peers</span><span>
</span><span id="line-475"></span><span>      </span><span class="hs-comment">-- and peers discovered through peer sharing.</span><span>
</span><span id="line-476"></span><span>      </span><span id="coldPeers"><span class="annot"><span class="annottext">PeerSelectionCounters -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#coldPeers"><span class="hs-identifier hs-var hs-var">coldPeers</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-477"></span><span>      </span><span class="hs-comment">-- | All warm peers including ledger peers, root peers, big ledger peers,</span><span>
</span><span id="line-478"></span><span>      </span><span class="hs-comment">-- local root peers and peers discovered through peer sharing.</span><span>
</span><span id="line-479"></span><span>      </span><span id="warmPeers"><span class="annot"><span class="annottext">PeerSelectionCounters -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#warmPeers"><span class="hs-identifier hs-var hs-var">warmPeers</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-480"></span><span>      </span><span class="hs-comment">-- | All hot peers including ledger peers, root peers, big ledger peers,</span><span>
</span><span id="line-481"></span><span>      </span><span class="hs-comment">-- local root peers and peers discovered through peer sharing.</span><span>
</span><span id="line-482"></span><span>      </span><span id="hotPeers"><span class="annot"><span class="annottext">PeerSelectionCounters -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#hotPeers"><span class="hs-identifier hs-var hs-var">hotPeers</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-483"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Cold big ledger peers.</span></span><span>
</span><span id="line-484"></span><span>      </span><span id="coldBigLedgerPeers"><span class="annot"><span class="annottext">PeerSelectionCounters -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#coldBigLedgerPeers"><span class="hs-identifier hs-var hs-var">coldBigLedgerPeers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-485"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Warm big ledger peers.</span></span><span>
</span><span id="line-486"></span><span>      </span><span id="warmBigLedgerPeers"><span class="annot"><span class="annottext">PeerSelectionCounters -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#warmBigLedgerPeers"><span class="hs-identifier hs-var hs-var">warmBigLedgerPeers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-487"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Hot big ledger peers.</span></span><span>
</span><span id="line-488"></span><span>      </span><span id="hotBigLedgerPeers"><span class="annot"><span class="annottext">PeerSelectionCounters -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#hotBigLedgerPeers"><span class="hs-identifier hs-var hs-var">hotBigLedgerPeers</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-489"></span><span>      </span><span class="hs-comment">-- | Local root peers with one entry per group. First entry is the number</span><span>
</span><span id="line-490"></span><span>      </span><span class="hs-comment">-- of warm peers in that group the second is the number of hot peers in</span><span>
</span><span id="line-491"></span><span>      </span><span class="hs-comment">-- that group.</span><span>
</span><span id="line-492"></span><span>      </span><span id="localRoots"><span class="annot"><span class="annottext">PeerSelectionCounters -&gt; [(Int, Int)]
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#localRoots"><span class="hs-identifier hs-var hs-var">localRoots</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-493"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679218509"><span id="local-6989586621679218520"><span class="annot"><span class="annottext">PeerSelectionCounters -&gt; PeerSelectionCounters -&gt; Bool
(PeerSelectionCounters -&gt; PeerSelectionCounters -&gt; Bool)
-&gt; (PeerSelectionCounters -&gt; PeerSelectionCounters -&gt; Bool)
-&gt; Eq PeerSelectionCounters
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: PeerSelectionCounters -&gt; PeerSelectionCounters -&gt; Bool
== :: PeerSelectionCounters -&gt; PeerSelectionCounters -&gt; Bool
$c/= :: PeerSelectionCounters -&gt; PeerSelectionCounters -&gt; Bool
/= :: PeerSelectionCounters -&gt; PeerSelectionCounters -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218525"><span id="local-6989586621679218537"><span id="local-6989586621679218540"><span class="annot"><span class="annottext">Int -&gt; PeerSelectionCounters -&gt; ShowS
[PeerSelectionCounters] -&gt; ShowS
PeerSelectionCounters -&gt; String
(Int -&gt; PeerSelectionCounters -&gt; ShowS)
-&gt; (PeerSelectionCounters -&gt; String)
-&gt; ([PeerSelectionCounters] -&gt; ShowS)
-&gt; Show PeerSelectionCounters
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; PeerSelectionCounters -&gt; ShowS
showsPrec :: Int -&gt; PeerSelectionCounters -&gt; ShowS
$cshow :: PeerSelectionCounters -&gt; String
show :: PeerSelectionCounters -&gt; String
$cshowList :: [PeerSelectionCounters] -&gt; ShowS
showList :: [PeerSelectionCounters] -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span id="local-6989586621679218154"><span id="local-6989586621679218155"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#peerStateToCounters"><span class="hs-identifier hs-type">peerStateToCounters</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218154"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218154"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218155"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionCounters"><span class="hs-identifier hs-type">PeerSelectionCounters</span></a></span></span></span><span>
</span><span id="line-496"></span><span id="peerStateToCounters"><span class="annot"><span class="annottext">peerStateToCounters :: forall peeraddr peerconn.
Ord peeraddr =&gt;
PeerSelectionState peeraddr peerconn -&gt; PeerSelectionCounters
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#peerStateToCounters"><span class="hs-identifier hs-var hs-var">peerStateToCounters</span></a></span></span><span> </span><span id="local-6989586621679218554"><span class="annot"><span class="annottext">st :: PeerSelectionState peeraddr peerconn
</span><a href="#local-6989586621679218554"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679218555"><span class="annot"><span class="annottext">Set peeraddr
activePeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
activePeers :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#activePeers"><span class="hs-identifier hs-var hs-var">activePeers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218556"><span class="annot"><span class="annottext">Set peeraddr
bigLedgerPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
bigLedgerPeers :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#bigLedgerPeers"><span class="hs-identifier hs-var hs-var">bigLedgerPeers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218557"><span class="annot"><span class="annottext">LocalRootPeers peeraddr
localRootPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; LocalRootPeers peeraddr
localRootPeers :: LocalRootPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#localRootPeers"><span class="hs-identifier hs-var hs-var">localRootPeers</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-497"></span><span>    </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionCounters"><span class="hs-identifier hs-type">PeerSelectionCounters</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-498"></span><span>      </span><span class="annot"><span class="annottext">coldPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#coldPeers"><span class="hs-identifier hs-var">coldPeers</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#size"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">(Set peeraddr -&gt; Int) -&gt; Set peeraddr -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218559"><span class="hs-identifier hs-var">coldPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#%5C%5C"><span class="hs-operator hs-var">Set.\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218556"><span class="hs-identifier hs-var">bigLedgerPeers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-499"></span><span>      </span><span class="annot"><span class="annottext">warmPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#warmPeers"><span class="hs-identifier hs-var">warmPeers</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#size"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">(Set peeraddr -&gt; Int) -&gt; Set peeraddr -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218561"><span class="hs-identifier hs-var">warmPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#%5C%5C"><span class="hs-operator hs-var">Set.\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218556"><span class="hs-identifier hs-var">bigLedgerPeers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-500"></span><span>      </span><span class="annot"><span class="annottext">hotPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#hotPeers"><span class="hs-identifier hs-var">hotPeers</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#size"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">(Set peeraddr -&gt; Int) -&gt; Set peeraddr -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218562"><span class="hs-identifier hs-var">hotPeersSet</span></a></span><span>  </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#%5C%5C"><span class="hs-operator hs-var">Set.\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218556"><span class="hs-identifier hs-var">bigLedgerPeers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-501"></span><span>      </span><span class="annot"><span class="annottext">coldBigLedgerPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#coldBigLedgerPeers"><span class="hs-identifier hs-var">coldBigLedgerPeers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#size"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">(Set peeraddr -&gt; Int) -&gt; Set peeraddr -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218559"><span class="hs-identifier hs-var">coldPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-operator hs-var">`Set.intersection`</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218556"><span class="hs-identifier hs-var">bigLedgerPeers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-502"></span><span>      </span><span class="annot"><span class="annottext">warmBigLedgerPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#warmBigLedgerPeers"><span class="hs-identifier hs-var">warmBigLedgerPeers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#size"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">(Set peeraddr -&gt; Int) -&gt; Set peeraddr -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218561"><span class="hs-identifier hs-var">warmPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-operator hs-var">`Set.intersection`</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218556"><span class="hs-identifier hs-var">bigLedgerPeers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-503"></span><span>      </span><span class="annot"><span class="annottext">hotBigLedgerPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#hotBigLedgerPeers"><span class="hs-identifier hs-var">hotBigLedgerPeers</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#size"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">(Set peeraddr -&gt; Int) -&gt; Set peeraddr -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218562"><span class="hs-identifier hs-var">hotPeersSet</span></a></span><span>  </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-operator hs-var">`Set.intersection`</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218556"><span class="hs-identifier hs-var">bigLedgerPeers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-504"></span><span>      </span><span class="annot"><span class="annottext">[(Int, Int)]
localRoots :: [(Int, Int)]
localRoots :: [(Int, Int)]
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#localRoots"><span class="hs-identifier hs-var hs-var">localRoots</span></a></span><span>
</span><span id="line-505"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-506"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-507"></span><span>    </span><span id="local-6989586621679218565"><span class="annot"><span class="annottext">knownPeersSet :: Set peeraddr
</span><a href="#local-6989586621679218565"><span class="hs-identifier hs-var hs-var">knownPeersSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr -&gt; Set peeraddr
forall peeraddr. KnownPeers peeraddr -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.State.KnownPeers.html#toSet"><span class="hs-identifier hs-var">KnownPeers.toSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; KnownPeers peeraddr
forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; KnownPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#knownPeers"><span class="hs-identifier hs-var">knownPeers</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn
</span><a href="#local-6989586621679218554"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>    </span><span id="local-6989586621679218567"><span class="annot"><span class="annottext">establishedPeersSet :: Set peeraddr
</span><a href="#local-6989586621679218567"><span class="hs-identifier hs-var hs-var">establishedPeersSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
forall peeraddr peerconn.
EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.State.EstablishedPeers.html#toSet"><span class="hs-identifier hs-var">EstablishedPeers.toSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn
-&gt; EstablishedPeers peeraddr peerconn
forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn
-&gt; EstablishedPeers peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeers"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn
</span><a href="#local-6989586621679218554"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>    </span><span id="local-6989586621679218559"><span class="annot"><span class="annottext">coldPeersSet :: Set peeraddr
</span><a href="#local-6989586621679218559"><span class="hs-identifier hs-var hs-var">coldPeersSet</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218565"><span class="hs-identifier hs-var">knownPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#%5C%5C"><span class="hs-operator hs-var">Set.\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218567"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span>
</span><span id="line-510"></span><span>    </span><span id="local-6989586621679218561"><span class="annot"><span class="annottext">warmPeersSet :: Set peeraddr
</span><a href="#local-6989586621679218561"><span class="hs-identifier hs-var hs-var">warmPeersSet</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218567"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#%5C%5C"><span class="hs-operator hs-var">Set.\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218555"><span class="hs-identifier hs-var">activePeers</span></a></span><span>
</span><span id="line-511"></span><span>    </span><span id="local-6989586621679218562"><span class="annot"><span class="annottext">hotPeersSet :: Set peeraddr
</span><a href="#local-6989586621679218562"><span class="hs-identifier hs-var hs-var">hotPeersSet</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218555"><span class="hs-identifier hs-var">activePeers</span></a></span><span>
</span><span id="line-512"></span><span>    </span><span id="local-6989586621679218564"><span class="annot"><span class="annottext">localRoots :: [(Int, Int)]
</span><a href="#local-6989586621679218564"><span class="hs-identifier hs-var hs-var">localRoots</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span>
</span><span id="line-513"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218569"><span class="hs-identifier hs-var">warm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218570"><span class="hs-identifier hs-var">hot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HotValency
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">WarmValency
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218571"><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218571"><span class="hs-identifier hs-var">members</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
-&gt; [(HotValency, WarmValency, Set peeraddr)]
forall peeraddr.
LocalRootPeers peeraddr
-&gt; [(HotValency, WarmValency, Set peeraddr)]
</span><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#toGroupSets"><span class="hs-identifier hs-var">LocalRootPeers.toGroupSets</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
</span><a href="#local-6989586621679218557"><span class="hs-identifier hs-var">localRootPeers</span></a></span><span>
</span><span id="line-515"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218569"><span class="annot"><span class="annottext">warm :: Int
</span><a href="#local-6989586621679218569"><span class="hs-identifier hs-var hs-var">warm</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#size"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">(Set peeraddr -&gt; Int) -&gt; Set peeraddr -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218571"><span class="hs-identifier hs-var">members</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-operator hs-var">`Set.intersection`</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218561"><span class="hs-identifier hs-var">warmPeersSet</span></a></span><span>
</span><span id="line-516"></span><span>            </span><span id="local-6989586621679218570"><span class="annot"><span class="annottext">hot :: Int
</span><a href="#local-6989586621679218570"><span class="hs-identifier hs-var hs-var">hot</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#size"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">(Set peeraddr -&gt; Int) -&gt; Set peeraddr -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218571"><span class="hs-identifier hs-var">members</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-operator hs-var">`Set.intersection`</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218562"><span class="hs-identifier hs-var">hotPeersSet</span></a></span><span>
</span><span id="line-517"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span id="local-6989586621679218166"><span id="local-6989586621679218167"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#emptyPeerSelectionState"><span class="hs-identifier hs-type">emptyPeerSelectionState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span>
</span><span id="line-520"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-521"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218166"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218167"><span class="hs-identifier hs-type">peerconn</span></a></span></span></span><span>
</span><span id="line-522"></span><span id="emptyPeerSelectionState"><span class="annot"><span class="annottext">emptyPeerSelectionState :: forall peeraddr peerconn.
StdGen -&gt; [(Int, Int)] -&gt; PeerSelectionState peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#emptyPeerSelectionState"><span class="hs-identifier hs-var hs-var">emptyPeerSelectionState</span></a></span></span><span> </span><span id="local-6989586621679218576"><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679218576"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621679218577"><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621679218577"><span class="hs-identifier hs-var">localRoots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-523"></span><span>    </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-524"></span><span>      </span><span class="annot"><span class="annottext">targets :: PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targets"><span class="hs-identifier hs-var">targets</span></a></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#nullPeerSelectionTargets"><span class="hs-identifier hs-var">nullPeerSelectionTargets</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-525"></span><span>      </span><span class="annot"><span class="annottext">localRootPeers :: LocalRootPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#localRootPeers"><span class="hs-identifier hs-var">localRootPeers</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
forall peeraddr. LocalRootPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#empty"><span class="hs-identifier hs-var">LocalRootPeers.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-526"></span><span>      </span><span class="annot"><span class="annottext">publicRootPeers :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootPeers"><span class="hs-identifier hs-var">publicRootPeers</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-527"></span><span>      </span><span class="annot"><span class="annottext">bigLedgerPeers :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#bigLedgerPeers"><span class="hs-identifier hs-var">bigLedgerPeers</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-528"></span><span>      </span><span class="annot"><span class="annottext">knownPeers :: KnownPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#knownPeers"><span class="hs-identifier hs-var">knownPeers</span></a></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
forall peeraddr. KnownPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.State.KnownPeers.html#empty"><span class="hs-identifier hs-var">KnownPeers.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-529"></span><span>      </span><span class="annot"><span class="annottext">establishedPeers :: EstablishedPeers peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeers"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
forall peeraddr perconn. EstablishedPeers peeraddr perconn
</span><a href="Ouroboros.Network.PeerSelection.State.EstablishedPeers.html#empty"><span class="hs-identifier hs-var">EstablishedPeers.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-530"></span><span>      </span><span class="annot"><span class="annottext">activePeers :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#activePeers"><span class="hs-identifier hs-var">activePeers</span></a></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-531"></span><span>      </span><span class="annot"><span class="annottext">publicRootBackoffs :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootBackoffs"><span class="hs-identifier hs-var">publicRootBackoffs</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-532"></span><span>      </span><span class="annot"><span class="annottext">publicRootRetryTime :: Time
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootRetryTime"><span class="hs-identifier hs-var">publicRootRetryTime</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Time
</span><span class="hs-identifier hs-var">Time</span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-533"></span><span>      </span><span class="annot"><span class="annottext">inProgressPublicRootsReq :: Bool
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPublicRootsReq"><span class="hs-identifier hs-var">inProgressPublicRootsReq</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-534"></span><span>      </span><span class="annot"><span class="annottext">bigLedgerPeerBackoffs :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#bigLedgerPeerBackoffs"><span class="hs-identifier hs-var">bigLedgerPeerBackoffs</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-535"></span><span>      </span><span class="annot"><span class="annottext">bigLedgerPeerRetryTime :: Time
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#bigLedgerPeerRetryTime"><span class="hs-identifier hs-var">bigLedgerPeerRetryTime</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Time
</span><span class="hs-identifier hs-var">Time</span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-536"></span><span>      </span><span class="annot"><span class="annottext">inProgressBigLedgerPeersReq :: Bool
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressBigLedgerPeersReq"><span class="hs-identifier hs-var">inProgressBigLedgerPeersReq</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-537"></span><span>      </span><span class="annot"><span class="annottext">inProgressPeerShareReqs :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPeerShareReqs"><span class="hs-identifier hs-var">inProgressPeerShareReqs</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-538"></span><span>      </span><span class="annot"><span class="annottext">inProgressPromoteCold :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPromoteCold"><span class="hs-identifier hs-var">inProgressPromoteCold</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-539"></span><span>      </span><span class="annot"><span class="annottext">inProgressPromoteWarm :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPromoteWarm"><span class="hs-identifier hs-var">inProgressPromoteWarm</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-540"></span><span>      </span><span class="annot"><span class="annottext">inProgressDemoteWarm :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressDemoteWarm"><span class="hs-identifier hs-var">inProgressDemoteWarm</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-541"></span><span>      </span><span class="annot"><span class="annottext">inProgressDemoteHot :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressDemoteHot"><span class="hs-identifier hs-var">inProgressDemoteHot</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-542"></span><span>      </span><span class="annot"><span class="annottext">inProgressDemoteToCold :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressDemoteToCold"><span class="hs-identifier hs-var">inProgressDemoteToCold</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-543"></span><span>      </span><span class="annot"><span class="annottext">fuzzRng :: StdGen
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#fuzzRng"><span class="hs-identifier hs-var">fuzzRng</span></a></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679218576"><span class="hs-identifier hs-var">rng</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-544"></span><span>      </span><span class="annot"><span class="annottext">countersCache :: Cache PeerSelectionCounters
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#countersCache"><span class="hs-identifier hs-var">countersCache</span></a></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSelectionCounters -&gt; Cache PeerSelectionCounters
forall a. a -&gt; Cache a
</span><span class="hs-identifier hs-var">Cache</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; [(Int, Int)]
-&gt; PeerSelectionCounters
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionCounters"><span class="hs-identifier hs-var">PeerSelectionCounters</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621679218577"><span class="hs-identifier hs-var">localRoots</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span id="local-6989586621679218176"><span id="local-6989586621679218177"><span id="local-6989586621679218178"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#assertPeerSelectionState"><span class="hs-identifier hs-type">assertPeerSelectionState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218176"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-549"></span><span>                         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218176"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218177"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-550"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679218178"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679218178"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-551"></span><span id="assertPeerSelectionState"><span class="annot"><span class="annottext">assertPeerSelectionState :: forall peeraddr peerconn a.
Ord peeraddr =&gt;
PeerSelectionState peeraddr peerconn -&gt; a -&gt; a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#assertPeerSelectionState"><span class="hs-identifier hs-var hs-var">assertPeerSelectionState</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679218663"><span id="local-6989586621679218664"><span id="local-6989586621679218665"><span id="local-6989586621679218666"><span id="local-6989586621679218667"><span id="local-6989586621679218668"><span id="local-6989586621679218669"><span id="local-6989586621679218670"><span id="local-6989586621679218671"><span id="local-6989586621679218672"><span id="local-6989586621679218673"><span id="local-6989586621679218674"><span id="local-6989586621679218675"><span id="local-6989586621679218676"><span id="local-6989586621679218677"><span id="local-6989586621679218678"><span id="local-6989586621679218679"><span id="local-6989586621679218680"><span id="local-6989586621679218681"><span id="local-6989586621679218682"><span id="local-6989586621679218683"><span class="annot"><span class="annottext">Bool
Int
Set peeraddr
Time
StdGen
EstablishedPeers peeraddr peerconn
KnownPeers peeraddr
LocalRootPeers peeraddr
Cache PeerSelectionCounters
PeerSelectionTargets
targets :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; PeerSelectionTargets
localRootPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; LocalRootPeers peeraddr
publicRootPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
bigLedgerPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
knownPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; KnownPeers peeraddr
establishedPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn
-&gt; EstablishedPeers peeraddr peerconn
activePeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
publicRootBackoffs :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Int
publicRootRetryTime :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Time
inProgressPublicRootsReq :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Bool
bigLedgerPeerBackoffs :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Int
bigLedgerPeerRetryTime :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Time
inProgressBigLedgerPeersReq :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Bool
inProgressPeerShareReqs :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Int
inProgressPromoteCold :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
inProgressPromoteWarm :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
inProgressDemoteWarm :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
inProgressDemoteHot :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
inProgressDemoteToCold :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
fuzzRng :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; StdGen
countersCache :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Cache PeerSelectionCounters
targets :: PeerSelectionTargets
localRootPeers :: LocalRootPeers peeraddr
publicRootPeers :: Set peeraddr
bigLedgerPeers :: Set peeraddr
knownPeers :: KnownPeers peeraddr
establishedPeers :: EstablishedPeers peeraddr peerconn
activePeers :: Set peeraddr
publicRootBackoffs :: Int
publicRootRetryTime :: Time
inProgressPublicRootsReq :: Bool
bigLedgerPeerBackoffs :: Int
bigLedgerPeerRetryTime :: Time
inProgressBigLedgerPeersReq :: Bool
inProgressPeerShareReqs :: Int
inProgressPromoteCold :: Set peeraddr
inProgressPromoteWarm :: Set peeraddr
inProgressDemoteWarm :: Set peeraddr
inProgressDemoteHot :: Set peeraddr
inProgressDemoteToCold :: Set peeraddr
fuzzRng :: StdGen
countersCache :: Cache PeerSelectionCounters
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targets"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-552"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownPeers peeraddr -&gt; Bool
forall peeraddr. Ord peeraddr =&gt; KnownPeers peeraddr -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.State.KnownPeers.html#invariant"><span class="hs-identifier hs-var">KnownPeers.invariant</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679218667"><span class="hs-identifier hs-var">knownPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn -&gt; Bool
forall peeraddr peerconn.
Ord peeraddr =&gt;
EstablishedPeers peeraddr peerconn -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.State.EstablishedPeers.html#invariant"><span class="hs-identifier hs-var">EstablishedPeers.invariant</span></a></span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
</span><a href="#local-6989586621679218668"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalRootPeers peeraddr -&gt; Bool
forall peeraddr. Ord peeraddr =&gt; LocalRootPeers peeraddr -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#invariant"><span class="hs-identifier hs-var">LocalRootPeers.invariant</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
</span><a href="#local-6989586621679218664"><span class="hs-identifier hs-var">localRootPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span>    </span><span class="hs-comment">-- The activePeers is a subset of the establishedPeers</span><span>
</span><span id="line-557"></span><span>    </span><span class="hs-comment">-- which is a subset of the known peers</span><span>
</span><span id="line-558"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#isSubsetOf"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218689"><span class="hs-identifier hs-var">activePeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218690"><span class="hs-identifier hs-var">establishedReadySet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-559"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#isSubsetOf"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218691"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218692"><span class="hs-identifier hs-var">knownPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span>   </span><span class="hs-comment">-- The localRootPeers and publicRootPeers must not overlap.</span><span>
</span><span id="line-562"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-identifier hs-var">Set.intersection</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218694"><span class="hs-identifier hs-var">localRootPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218665"><span class="hs-identifier hs-var">publicRootPeers</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span>    </span><span class="hs-comment">-- The localRootPeers are a subset of the knownPeers,</span><span>
</span><span id="line-565"></span><span>    </span><span class="hs-comment">-- and with correct source info in the knownPeers (either</span><span>
</span><span id="line-566"></span><span>    </span><span class="hs-comment">-- 'PeerSourcePublicRoot' or 'PeerSourceLocalRoot', as local and public</span><span>
</span><span id="line-567"></span><span>    </span><span class="hs-comment">-- root peers might overlap).</span><span>
</span><span id="line-568"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#isSubsetOf"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218694"><span class="hs-identifier hs-var">localRootPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218692"><span class="hs-identifier hs-var">knownPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span>    </span><span class="hs-comment">-- The publicRootPeers are a subset of the knownPeers,</span><span>
</span><span id="line-571"></span><span>    </span><span class="hs-comment">-- and with correct source info in the knownPeers.</span><span>
</span><span id="line-572"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#isSubsetOf"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218665"><span class="hs-identifier hs-var">publicRootPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218692"><span class="hs-identifier hs-var">knownPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span>    </span><span class="hs-comment">-- The targets should respect the containment relationships of the root,</span><span>
</span><span id="line-575"></span><span>    </span><span class="hs-comment">-- known, established and active peers</span><span>
</span><span id="line-576"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#sanePeerSelectionTargets"><span class="hs-identifier hs-var">sanePeerSelectionTargets</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionTargets
</span><a href="#local-6989586621679218663"><span class="hs-identifier hs-var">targets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>
</span><span id="line-578"></span><span>    </span><span class="hs-comment">-- All the local root peers are always a subset of the known peers. The</span><span>
</span><span id="line-579"></span><span>    </span><span class="hs-comment">-- target for known peers is a target from both below and above. Thus the</span><span>
</span><span id="line-580"></span><span>    </span><span class="hs-comment">-- number of local root peers must be less than or equal to the known peers</span><span>
</span><span id="line-581"></span><span>    </span><span class="hs-comment">-- target, otherwise we could get stuck.</span><span>
</span><span id="line-582"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalRootPeers peeraddr -&gt; Int
forall peeraddr. LocalRootPeers peeraddr -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#size"><span class="hs-identifier hs-var">LocalRootPeers.size</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
</span><a href="#local-6989586621679218664"><span class="hs-identifier hs-var">localRootPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfKnownPeers"><span class="hs-identifier hs-var">targetNumberOfKnownPeers</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionTargets
</span><a href="#local-6989586621679218663"><span class="hs-identifier hs-var">targets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-583"></span><span>
</span><span id="line-584"></span><span>    </span><span class="hs-comment">-- Interestingly, although the local root peers are also a subset of the</span><span>
</span><span id="line-585"></span><span>    </span><span class="hs-comment">-- root peers, the equivalent constraint does not apply to the target</span><span>
</span><span id="line-586"></span><span>    </span><span class="hs-comment">-- number of root peers. The reason is that the root peers target is only</span><span>
</span><span id="line-587"></span><span>    </span><span class="hs-comment">-- a target from below, not from above. It is ok to have more than the</span><span>
</span><span id="line-588"></span><span>    </span><span class="hs-comment">-- target number of root peers.</span><span>
</span><span id="line-589"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-590"></span><span>    </span><span class="hs-comment">--That is, we do /not/ need or want this invariant:</span><span>
</span><span id="line-591"></span><span>    </span><span class="hs-comment">--    LocalRootPeers.size   localRootPeers &lt;= targetNumberOfRootPeers</span><span>
</span><span id="line-592"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-593"></span><span>    </span><span class="hs-comment">-- It is also not necessary for all the targets to be achievable. It is</span><span>
</span><span id="line-594"></span><span>    </span><span class="hs-comment">-- just necessary that we do not get stuck. So although we have an implicit</span><span>
</span><span id="line-595"></span><span>    </span><span class="hs-comment">-- target that all local root peers become established, and a certain</span><span>
</span><span id="line-596"></span><span>    </span><span class="hs-comment">-- number of them become active, these targets do not need to be achievable.</span><span>
</span><span id="line-597"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-598"></span><span>    </span><span class="hs-comment">--That is, we do /not/ need or want this invariant:</span><span>
</span><span id="line-599"></span><span>    </span><span class="hs-comment">--    LocalRootPeers.size   localRootPeers &lt;= targetNumberOfEstablishedPeers</span><span>
</span><span id="line-600"></span><span>    </span><span class="hs-comment">--    LocalRootPeers.target localRootPeers &lt;= targetNumberOfActivePeers</span><span>
</span><span id="line-601"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-602"></span><span>
</span><span id="line-603"></span><span>    </span><span class="hs-comment">-- All currently established peers are in the availableToConnect set since</span><span>
</span><span id="line-604"></span><span>    </span><span class="hs-comment">-- the alternative is a record of failure, but these are not (yet) failed.</span><span>
</span><span id="line-605"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#isSubsetOf"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218691"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownPeers peeraddr -&gt; Set peeraddr
forall peeraddr. KnownPeers peeraddr -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.State.KnownPeers.html#availableToConnect"><span class="hs-identifier hs-var">KnownPeers.availableToConnect</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679218667"><span class="hs-identifier hs-var">knownPeers</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span>    </span><span class="hs-comment">-- No constraint for publicRootBackoffs, publicRootRetryTime</span><span>
</span><span id="line-608"></span><span>    </span><span class="hs-comment">-- or inProgressPublicRootsReq</span><span>
</span><span id="line-609"></span><span>
</span><span id="line-610"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218676"><span class="hs-identifier hs-var">inProgressPeerShareReqs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#isSubsetOf"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218677"><span class="hs-identifier hs-var">inProgressPromoteCold</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218697"><span class="hs-identifier hs-var">coldPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#isSubsetOf"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218678"><span class="hs-identifier hs-var">inProgressPromoteWarm</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218698"><span class="hs-identifier hs-var">warmPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-613"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#isSubsetOf"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218679"><span class="hs-identifier hs-var">inProgressDemoteWarm</span></a></span><span>  </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218698"><span class="hs-identifier hs-var">warmPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#isSubsetOf"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218680"><span class="hs-identifier hs-var">inProgressDemoteHot</span></a></span><span>   </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218699"><span class="hs-identifier hs-var">hotPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-615"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-identifier hs-var">Set.intersection</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218678"><span class="hs-identifier hs-var">inProgressPromoteWarm</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218679"><span class="hs-identifier hs-var">inProgressDemoteWarm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#isSubsetOf"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218681"><span class="hs-identifier hs-var">inProgressDemoteToCold</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218691"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-identifier hs-var">Set.intersection</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218681"><span class="hs-identifier hs-var">inProgressDemoteToCold</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218678"><span class="hs-identifier hs-var">inProgressPromoteWarm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-identifier hs-var">Set.intersection</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218681"><span class="hs-identifier hs-var">inProgressDemoteToCold</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218677"><span class="hs-identifier hs-var">inProgressPromoteCold</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-identifier hs-var">Set.intersection</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218681"><span class="hs-identifier hs-var">inProgressDemoteToCold</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218680"><span class="hs-identifier hs-var">inProgressDemoteHot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-identifier hs-var">Set.intersection</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218681"><span class="hs-identifier hs-var">inProgressDemoteToCold</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218679"><span class="hs-identifier hs-var">inProgressDemoteWarm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span>    </span><span class="hs-comment">-- `bigLedgerPeers` is a subset of known peers and disjoint from public and</span><span>
</span><span id="line-624"></span><span>    </span><span class="hs-comment">-- local root peers.</span><span>
</span><span id="line-625"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#isSubsetOf"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218666"><span class="hs-identifier hs-var">bigLedgerPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218692"><span class="hs-identifier hs-var">knownPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-identifier hs-var">Set.intersection</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218666"><span class="hs-identifier hs-var">bigLedgerPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218665"><span class="hs-identifier hs-var">publicRootPeers</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-identifier hs-var">Set.intersection</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218666"><span class="hs-identifier hs-var">bigLedgerPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218694"><span class="hs-identifier hs-var">localRootPeersSet</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-629"></span><span>    </span><span id="local-6989586621679218692"><span class="annot"><span class="annottext">knownPeersSet :: Set peeraddr
</span><a href="#local-6989586621679218692"><span class="hs-identifier hs-var hs-var">knownPeersSet</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr -&gt; Set peeraddr
forall peeraddr. KnownPeers peeraddr -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.State.KnownPeers.html#toSet"><span class="hs-identifier hs-var">KnownPeers.toSet</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679218667"><span class="hs-identifier hs-var">knownPeers</span></a></span><span>
</span><span id="line-630"></span><span>    </span><span id="local-6989586621679218694"><span class="annot"><span class="annottext">localRootPeersSet :: Set peeraddr
</span><a href="#local-6989586621679218694"><span class="hs-identifier hs-var hs-var">localRootPeersSet</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr -&gt; Set peeraddr
forall peeraddr. LocalRootPeers peeraddr -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#keysSet"><span class="hs-identifier hs-var">LocalRootPeers.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
</span><a href="#local-6989586621679218664"><span class="hs-identifier hs-var">localRootPeers</span></a></span><span>
</span><span id="line-631"></span><span>    </span><span id="local-6989586621679218691"><span class="annot"><span class="annottext">establishedPeersSet :: Set peeraddr
</span><a href="#local-6989586621679218691"><span class="hs-identifier hs-var hs-var">establishedPeersSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
forall peeraddr peerconn.
EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.State.EstablishedPeers.html#toSet"><span class="hs-identifier hs-var">EstablishedPeers.toSet</span></a></span><span>      </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
</span><a href="#local-6989586621679218668"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span>
</span><span id="line-632"></span><span>    </span><span id="local-6989586621679218690"><span class="annot"><span class="annottext">establishedReadySet :: Set peeraddr
</span><a href="#local-6989586621679218690"><span class="hs-identifier hs-var hs-var">establishedReadySet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
forall peeraddr peerconn.
Ord peeraddr =&gt;
EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.State.EstablishedPeers.html#readyPeers"><span class="hs-identifier hs-var">EstablishedPeers.readyPeers</span></a></span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
</span><a href="#local-6989586621679218668"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span>
</span><span id="line-633"></span><span>    </span><span id="local-6989586621679218689"><span class="annot"><span class="annottext">activePeersSet :: Set peeraddr
</span><a href="#local-6989586621679218689"><span class="hs-identifier hs-var hs-var">activePeersSet</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218669"><span class="hs-identifier hs-var">activePeers</span></a></span><span>
</span><span id="line-634"></span><span>    </span><span id="local-6989586621679218697"><span class="annot"><span class="annottext">coldPeersSet :: Set peeraddr
</span><a href="#local-6989586621679218697"><span class="hs-identifier hs-var hs-var">coldPeersSet</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218692"><span class="hs-identifier hs-var">knownPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#%5C%5C"><span class="hs-operator hs-var">Set.\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218691"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span>
</span><span id="line-635"></span><span>    </span><span id="local-6989586621679218698"><span class="annot"><span class="annottext">warmPeersSet :: Set peeraddr
</span><a href="#local-6989586621679218698"><span class="hs-identifier hs-var hs-var">warmPeersSet</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218691"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#%5C%5C"><span class="hs-operator hs-var">Set.\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218689"><span class="hs-identifier hs-var">activePeersSet</span></a></span><span>
</span><span id="line-636"></span><span>    </span><span id="local-6989586621679218699"><span class="annot"><span class="annottext">hotPeersSet :: Set peeraddr
</span><a href="#local-6989586621679218699"><span class="hs-identifier hs-var hs-var">hotPeersSet</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218689"><span class="hs-identifier hs-var">activePeersSet</span></a></span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span class="hs-comment">-- | A view of the status of each established peer, for testing and debugging.</span><span>
</span><span id="line-640"></span><span class="hs-comment">--</span><span>
</span><span id="line-641"></span><span id="local-6989586621679218196"><span id="local-6989586621679218197"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeersStatus"><span class="hs-identifier hs-type">establishedPeersStatus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218196"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-642"></span><span>                       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218196"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218197"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-643"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218196"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerStatus"><span class="hs-identifier hs-type">PeerStatus</span></a></span></span></span><span>
</span><span id="line-644"></span><span id="establishedPeersStatus"><span class="annot"><span class="annottext">establishedPeersStatus :: forall peeraddr peerconn.
Ord peeraddr =&gt;
PeerSelectionState peeraddr peerconn -&gt; Map peeraddr PeerStatus
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeersStatus"><span class="hs-identifier hs-var hs-var">establishedPeersStatus</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679218705"><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
establishedPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn
-&gt; EstablishedPeers peeraddr peerconn
establishedPeers :: EstablishedPeers peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeers"><span class="hs-identifier hs-var hs-var">establishedPeers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218706"><span class="annot"><span class="annottext">Set peeraddr
activePeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
activePeers :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#activePeers"><span class="hs-identifier hs-var hs-var">activePeers</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-645"></span><span>    </span><span class="hs-comment">-- map union-override, left to right</span><span>
</span><span id="line-646"></span><span>    </span><span class="annot"><span class="annottext">(peeraddr -&gt; PeerStatus) -&gt; Set peeraddr -&gt; Map peeraddr PeerStatus
forall k a. (k -&gt; a) -&gt; Set k -&gt; Map k a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.Internal.html#fromSet"><span class="hs-identifier hs-var">Map.fromSet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">peeraddr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PeerStatus
</span><a href="Ouroboros.Network.PeerSelection.Types.html#PeerHot"><span class="hs-identifier hs-var">PeerHot</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218706"><span class="hs-identifier hs-var">activePeers</span></a></span><span>
</span><span id="line-647"></span><span> </span><span class="annot"><span class="annottext">Map peeraddr PeerStatus
-&gt; Map peeraddr PeerStatus -&gt; Map peeraddr PeerStatus
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(peeraddr -&gt; PeerStatus) -&gt; Set peeraddr -&gt; Map peeraddr PeerStatus
forall k a. (k -&gt; a) -&gt; Set k -&gt; Map k a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.Internal.html#fromSet"><span class="hs-identifier hs-var">Map.fromSet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">peeraddr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PeerStatus
</span><a href="Ouroboros.Network.PeerSelection.Types.html#PeerWarm"><span class="hs-identifier hs-var">PeerWarm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
forall peeraddr peerconn.
EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.State.EstablishedPeers.html#toSet"><span class="hs-identifier hs-var">EstablishedPeers.toSet</span></a></span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
</span><a href="#local-6989586621679218705"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span class="hs-comment">--------------------------------</span><span>
</span><span id="line-651"></span><span class="hs-comment">-- PickPolicy wrapper function</span><span>
</span><span id="line-652"></span><span class="hs-comment">--</span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span class="hs-comment">-- | Check pre-conditions and post-conditions on the pick policies,</span><span>
</span><span id="line-655"></span><span class="hs-comment">-- and supply additional peer attributes from the current state.</span><span>
</span><span id="line-656"></span><span class="hs-comment">--</span><span>
</span><span id="line-657"></span><span id="local-6989586621679218205"><span id="local-6989586621679218206"><span id="local-6989586621679218207"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#pickPeers"><span class="hs-identifier hs-type">pickPeers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218205"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Functor"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218206"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218205"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218207"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-659"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218205"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218206"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-660"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218205"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679218206"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218205"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-661"></span><span id="pickPeers"><span class="annot"><span class="annottext">pickPeers :: forall peeraddr (m :: * -&gt; *) peerconn.
(Ord peeraddr, Functor m) =&gt;
PeerSelectionState peeraddr peerconn
-&gt; PickPolicy peeraddr m -&gt; Set peeraddr -&gt; Int -&gt; m (Set peeraddr)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#pickPeers"><span class="hs-identifier hs-var hs-var">pickPeers</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679218726"><span class="annot"><span class="annottext">LocalRootPeers peeraddr
localRootPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; LocalRootPeers peeraddr
localRootPeers :: LocalRootPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#localRootPeers"><span class="hs-identifier hs-var hs-var">localRootPeers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218727"><span class="annot"><span class="annottext">Set peeraddr
publicRootPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
publicRootPeers :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootPeers"><span class="hs-identifier hs-var hs-var">publicRootPeers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218728"><span class="annot"><span class="annottext">KnownPeers peeraddr
knownPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; KnownPeers peeraddr
knownPeers :: KnownPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#knownPeers"><span class="hs-identifier hs-var hs-var">knownPeers</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-662"></span><span>          </span><span id="local-6989586621679218729"><span class="annot"><span class="annottext">PickPolicy peeraddr m
</span><a href="#local-6989586621679218729"><span class="hs-identifier hs-var">pick</span></a></span></span><span> </span><span id="local-6989586621679218730"><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218730"><span class="hs-identifier hs-var">available</span></a></span></span><span> </span><span id="local-6989586621679218731"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218731"><span class="hs-identifier hs-var">num</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-663"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m (Set peeraddr) -&gt; m (Set peeraddr)
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679218732"><span class="hs-identifier hs-var">precondition</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Set peeraddr) -&gt; m (Set peeraddr))
-&gt; m (Set peeraddr) -&gt; m (Set peeraddr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-664"></span><span>    </span><span class="annot"><span class="annottext">(Set peeraddr -&gt; Set peeraddr)
-&gt; m (Set peeraddr) -&gt; m (Set peeraddr)
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679218733"><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218733"><span class="hs-identifier hs-var">picked</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Set peeraddr -&gt; Set peeraddr
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
</span><a href="#local-6989586621679218734"><span class="hs-identifier hs-var">postcondition</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218733"><span class="hs-identifier hs-var">picked</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218733"><span class="hs-identifier hs-var">picked</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-665"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PickPolicy peeraddr m
</span><a href="#local-6989586621679218729"><span class="hs-identifier hs-var">pick</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr -&gt; PeerSource
</span><a href="#local-6989586621679218735"><span class="hs-identifier hs-var">peerSource</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr -&gt; Int
</span><a href="#local-6989586621679218736"><span class="hs-identifier hs-var">peerConnectFailCount</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr -&gt; Bool
</span><a href="#local-6989586621679218737"><span class="hs-identifier hs-var">peerTepidFlag</span></a></span><span>
</span><span id="line-666"></span><span>               </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218730"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218738"><span class="hs-identifier hs-var">numClamped</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-668"></span><span>    </span><span id="local-6989586621679218732"><span class="annot"><span class="annottext">precondition :: Bool
</span><a href="#local-6989586621679218732"><span class="hs-identifier hs-var hs-var">precondition</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218730"><span class="hs-identifier hs-var">available</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218731"><span class="hs-identifier hs-var">num</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-669"></span><span>                        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218730"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#isSubsetOf"><span class="hs-operator hs-var">`Set.isSubsetOf`</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr -&gt; Set peeraddr
forall peeraddr. KnownPeers peeraddr -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.State.KnownPeers.html#toSet"><span class="hs-identifier hs-var">KnownPeers.toSet</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679218728"><span class="hs-identifier hs-var">knownPeers</span></a></span><span>
</span><span id="line-670"></span><span>    </span><span id="local-6989586621679218734"><span class="annot"><span class="annottext">postcondition :: Set peeraddr -&gt; Bool
</span><a href="#local-6989586621679218734"><span class="hs-identifier hs-var hs-var">postcondition</span></a></span></span><span> </span><span id="local-6989586621679218741"><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218741"><span class="hs-identifier hs-var">picked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218741"><span class="hs-identifier hs-var">picked</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>                        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#size"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218741"><span class="hs-identifier hs-var">picked</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218738"><span class="hs-identifier hs-var">numClamped</span></a></span><span>
</span><span id="line-672"></span><span>                        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218741"><span class="hs-identifier hs-var">picked</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#isSubsetOf"><span class="hs-operator hs-var">`Set.isSubsetOf`</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218730"><span class="hs-identifier hs-var">available</span></a></span><span>
</span><span id="line-673"></span><span>    </span><span id="local-6989586621679218738"><span class="annot"><span class="annottext">numClamped :: Int
</span><a href="#local-6989586621679218738"><span class="hs-identifier hs-var hs-var">numClamped</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#min"><span class="hs-identifier hs-var">min</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679218731"><span class="hs-identifier hs-var">num</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#size"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218730"><span class="hs-identifier hs-var">available</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span>    </span><span id="local-6989586621679218735"><span class="annot"><span class="annottext">peerSource :: peeraddr -&gt; PeerSource
</span><a href="#local-6989586621679218735"><span class="hs-identifier hs-var hs-var">peerSource</span></a></span></span><span> </span><span id="local-6989586621679218743"><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679218743"><span class="hs-identifier hs-var">p</span></a></span></span><span>
</span><span id="line-676"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">peeraddr -&gt; LocalRootPeers peeraddr -&gt; Bool
forall peeraddr.
Ord peeraddr =&gt;
peeraddr -&gt; LocalRootPeers peeraddr -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#member"><span class="hs-identifier hs-var">LocalRootPeers.member</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679218743"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
</span><a href="#local-6989586621679218726"><span class="hs-identifier hs-var">localRootPeers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSource
</span><a href="Ouroboros.Network.PeerSelection.Types.html#PeerSourceLocalRoot"><span class="hs-identifier hs-var">PeerSourceLocalRoot</span></a></span><span>
</span><span id="line-677"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">Set.member</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679218743"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679218727"><span class="hs-identifier hs-var">publicRootPeers</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSource
</span><a href="Ouroboros.Network.PeerSelection.Types.html#PeerSourcePublicRoot"><span class="hs-identifier hs-var">PeerSourcePublicRoot</span></a></span><span>
</span><span id="line-678"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">peeraddr -&gt; KnownPeers peeraddr -&gt; Bool
forall peeraddr.
Ord peeraddr =&gt;
peeraddr -&gt; KnownPeers peeraddr -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.State.KnownPeers.html#member"><span class="hs-identifier hs-var">KnownPeers.member</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679218743"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679218728"><span class="hs-identifier hs-var">knownPeers</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSource
</span><a href="Ouroboros.Network.PeerSelection.Types.html#PeerSourcePeerShare"><span class="hs-identifier hs-var">PeerSourcePeerShare</span></a></span><span>
</span><span id="line-679"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSource
forall {a}. a
</span><a href="#local-6989586621679218750"><span class="hs-identifier hs-var">errorUnavailable</span></a></span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span>    </span><span id="local-6989586621679218736"><span class="annot"><span class="annottext">peerConnectFailCount :: peeraddr -&gt; Int
</span><a href="#local-6989586621679218736"><span class="hs-identifier hs-var hs-var">peerConnectFailCount</span></a></span></span><span> </span><span id="local-6989586621679218751"><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679218751"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-682"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; Int
forall a. a -&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Int
forall {a}. a
</span><a href="#local-6989586621679218750"><span class="hs-identifier hs-var">errorUnavailable</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int) -&gt; Maybe Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-683"></span><span>          </span><span class="annot"><span class="annottext">peeraddr -&gt; KnownPeers peeraddr -&gt; Maybe Int
forall peeraddr.
Ord peeraddr =&gt;
peeraddr -&gt; KnownPeers peeraddr -&gt; Maybe Int
</span><a href="Ouroboros.Network.PeerSelection.State.KnownPeers.html#lookupFailCount"><span class="hs-identifier hs-var">KnownPeers.lookupFailCount</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679218751"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679218728"><span class="hs-identifier hs-var">knownPeers</span></a></span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span>    </span><span id="local-6989586621679218737"><span class="annot"><span class="annottext">peerTepidFlag :: peeraddr -&gt; Bool
</span><a href="#local-6989586621679218737"><span class="hs-identifier hs-var hs-var">peerTepidFlag</span></a></span></span><span> </span><span id="local-6989586621679218753"><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679218753"><span class="hs-identifier hs-var">p</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-686"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool -&gt; Bool
forall a. a -&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
forall {a}. a
</span><a href="#local-6989586621679218750"><span class="hs-identifier hs-var">errorUnavailable</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool) -&gt; Maybe Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-687"></span><span>          </span><span class="annot"><span class="annottext">peeraddr -&gt; KnownPeers peeraddr -&gt; Maybe Bool
forall peeraddr.
Ord peeraddr =&gt;
peeraddr -&gt; KnownPeers peeraddr -&gt; Maybe Bool
</span><a href="Ouroboros.Network.PeerSelection.State.KnownPeers.html#lookupTepidFlag"><span class="hs-identifier hs-var">KnownPeers.lookupTepidFlag</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679218753"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679218728"><span class="hs-identifier hs-var">knownPeers</span></a></span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span>    </span><span class="hs-comment">-- This error can trigger if `available` is not a subset of `knownPeers`. In</span><span>
</span><span id="line-690"></span><span>    </span><span class="hs-comment">-- practice, values supplied by callers as `available` tend to be</span><span>
</span><span id="line-691"></span><span>    </span><span class="hs-comment">-- constructed from the `PeerSelectionState` passed here, and `knownPeers`</span><span>
</span><span id="line-692"></span><span>    </span><span class="hs-comment">-- represents a superset of the peers in the state. We also check this</span><span>
</span><span id="line-693"></span><span>    </span><span class="hs-comment">-- relationship in this function's precondition.</span><span>
</span><span id="line-694"></span><span>    </span><span id="local-6989586621679218750"><span class="annot"><span class="annottext">errorUnavailable :: a
</span><a href="#local-6989586621679218750"><span class="hs-identifier hs-var hs-var">errorUnavailable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-695"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; a
forall a. (?callStack::CallStack) =&gt; String -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; a) -&gt; String -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;A pick policy requested an attribute for peer address &quot;</span></span><span>
</span><span id="line-696"></span><span>             </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; which is outside of the set given to pick from&quot;</span></span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-700"></span><span class="hs-comment">-- Peer Selection Decisions</span><span>
</span><span id="line-701"></span><span class="hs-comment">--</span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span class="hs-comment">-- | The governor is using @Guarded m (Decision m peeraddr peerconn)@ where 'm'</span><span>
</span><span id="line-705"></span><span class="hs-comment">-- is an 'STM' monad, to drive its progress.</span><span>
</span><span id="line-706"></span><span class="hs-comment">--</span><span>
</span><span id="line-707"></span><span class="hs-keyword">data</span><span> </span><span id="Guarded"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-var">Guarded</span></a></span></span><span> </span><span id="local-6989586621679218235"><span class="annot"><a href="#local-6989586621679218235"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679218236"><span class="annot"><a href="#local-6989586621679218236"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-708"></span><span>    </span><span class="hs-comment">-- | `GuardedSkip'` is used to instruct that there is no action to be made</span><span>
</span><span id="line-709"></span><span>    </span><span class="hs-comment">-- by the governor. See 'GuardedSkip'.</span><span>
</span><span id="line-710"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-711"></span><span>    </span><span id="GuardedSkip%27"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip%27"><span class="hs-identifier hs-var">GuardedSkip'</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Semigroup.html#Min"><span class="hs-identifier hs-type">Min</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span>    </span><span class="hs-comment">-- | `Guarded'` is used to provide an action through 'FirstToFinish'</span><span>
</span><span id="line-714"></span><span>    </span><span class="hs-comment">-- synchronisation, possibly with a timeout, to the governor main loop. See</span><span>
</span><span id="line-715"></span><span>    </span><span class="hs-comment">-- 'Guarded'.</span><span>
</span><span id="line-716"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-717"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Guarded%27"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-var">Guarded'</span></a></span></span><span>     </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Semigroup.html#Min"><span class="hs-identifier hs-type">Min</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FirstToFinish</span></span><span> </span><span class="annot"><a href="#local-6989586621679218235"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218236"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span class="hs-comment">-- | 'Guarded' is used to provide an action possibly with a timeout, to the</span><span>
</span><span id="line-721"></span><span class="hs-comment">-- governor main loop.</span><span>
</span><span id="line-722"></span><span class="hs-comment">--</span><span>
</span><span id="line-723"></span><span class="hs-comment">-- 'Guarded' is a pattern which which  hides the use of 'FirstToFinish' and</span><span>
</span><span id="line-724"></span><span class="hs-comment">-- 'Min' newtype wrappers.</span><span>
</span><span id="line-725"></span><span class="hs-comment">--</span><span>
</span><span id="line-726"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-type">Guarded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679218226"><span id="local-6989586621679218227"><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679218226"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218227"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-type">Guarded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218226"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218227"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-727"></span><span class="hs-keyword">pattern</span><span> </span><span id="Guarded"><span id="%24mGuarded"><span id="%24bGuarded"><span class="annot"><span class="annottext">$mGuarded :: forall {r} {m :: * -&gt; *} {a}.
Guarded m a -&gt; (Maybe Time -&gt; m a -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bGuarded :: forall (m :: * -&gt; *) a. Maybe Time -&gt; m a -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-var hs-var hs-var hs-var">Guarded</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621679218764"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218765"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-type">Guarded'</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-type">fmap</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Semigroup.html#getMin"><span class="hs-identifier hs-var">getMin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679218764"><span class="annot"><a href="#local-6989586621679218764"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FirstToFinish</span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679218765"><span class="annot"><a href="#local-6989586621679218765"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-729"></span><span>    </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-var">Guarded</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679218768"><span class="annot"><span class="annottext">Maybe Time
</span><a href="#local-6989586621679218768"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679218769"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679218769"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
forall (m :: * -&gt; *) a.
Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-var">Guarded'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time -&gt; Min Time
forall a. a -&gt; Min a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Semigroup.html#Min"><span class="hs-identifier hs-var">Min</span></a></span><span> </span><span class="annot"><span class="annottext">(Time -&gt; Min Time) -&gt; Maybe Time -&gt; Maybe (Min Time)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Time
</span><a href="#local-6989586621679218768"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m a -&gt; FirstToFinish m a
forall (m :: * -&gt; *) a. m a -&gt; FirstToFinish m a
</span><span class="hs-identifier hs-var">FirstToFinish</span></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679218769"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span>
</span><span id="line-731"></span><span class="hs-comment">-- | 'GuardedSkip' is used to instruct that there is no action to be made</span><span>
</span><span id="line-732"></span><span class="hs-comment">-- by the governor. See 'GuardedSkip'.</span><span>
</span><span id="line-733"></span><span class="hs-comment">--</span><span>
</span><span id="line-734"></span><span class="hs-comment">-- 'GuardedSkip' is a pattern which hides the usage of `Min` newtype wrapper in</span><span>
</span><span id="line-735"></span><span class="hs-comment">-- `GuardedSkip'` constructor (private).</span><span>
</span><span id="line-736"></span><span class="hs-comment">--</span><span>
</span><span id="line-737"></span><span class="hs-comment">-- Let us note that the combined value which is computed by @guardedDecisions@</span><span>
</span><span id="line-738"></span><span class="hs-comment">-- term in 'Ouroboros.Network.PeerSelection.Governor.peerSelectionGovernorLoop'</span><span>
</span><span id="line-739"></span><span class="hs-comment">-- will never return it: this is because there are monitoring decisions which</span><span>
</span><span id="line-740"></span><span class="hs-comment">-- never return this constructor, e.g.  'Monitor.targetPeers', 'Monitor.jobs',</span><span>
</span><span id="line-741"></span><span class="hs-comment">-- 'Monitor.connections', and thus the governor has always something to do.</span><span>
</span><span id="line-742"></span><span class="hs-comment">--</span><span>
</span><span id="line-743"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier hs-type">GuardedSkip</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679218244"><span id="local-6989586621679218245"><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-type">Guarded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218244"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218245"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-744"></span><span class="hs-keyword">pattern</span><span> </span><span id="GuardedSkip"><span id="%24mGuardedSkip"><span id="%24bGuardedSkip"><span class="annot"><span class="annottext">$mGuardedSkip :: forall {r} {m :: * -&gt; *} {a}.
Guarded m a -&gt; (Maybe Time -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bGuardedSkip :: forall (m :: * -&gt; *) a. Maybe Time -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier hs-var hs-var hs-var hs-var">GuardedSkip</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621679218773"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip%27"><span class="hs-identifier hs-type">GuardedSkip'</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-type">fmap</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Semigroup.html#getMin"><span class="hs-identifier hs-var">getMin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679218773"><span class="annot"><a href="#local-6989586621679218773"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-746"></span><span>    </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier hs-var">GuardedSkip</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679218775"><span class="annot"><span class="annottext">Maybe Time
</span><a href="#local-6989586621679218775"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Guarded m a
forall (m :: * -&gt; *) a. Maybe (Min Time) -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip%27"><span class="hs-identifier hs-var">GuardedSkip'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time -&gt; Min Time
forall a. a -&gt; Min a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Semigroup.html#Min"><span class="hs-identifier hs-var">Min</span></a></span><span> </span><span class="annot"><span class="annottext">(Time -&gt; Min Time) -&gt; Maybe Time -&gt; Maybe (Min Time)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Time
</span><a href="#local-6989586621679218775"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>
</span><span id="line-748"></span><span class="hs-pragma">{-# COMPLETE</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-pragma hs-type">GuardedSkip</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-pragma hs-type">Guarded</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span class="hs-comment">-- | 'Guarded' constructor is absorbing in the sense that</span><span>
</span><span id="line-751"></span><span class="hs-comment">--</span><span>
</span><span id="line-752"></span><span class="hs-comment">-- &gt; Guarded x y &lt;&gt; a = Guarded x' y'</span><span>
</span><span id="line-753"></span><span class="hs-comment">-- &gt; a &lt;&gt; Guarded x y = Guarded x' y'</span><span>
</span><span id="line-754"></span><span class="hs-comment">--</span><span>
</span><span id="line-755"></span><span class="hs-comment">-- In the algebraic sense, @'Guarded' (Just minBound) (return x)@ is a left</span><span>
</span><span id="line-756"></span><span class="hs-comment">-- absorbing element when &quot;m ~ STM m'@ for some monad @m'@.  There is no right</span><span>
</span><span id="line-757"></span><span class="hs-comment">-- absorbing element since there is no right absorbing element in @STM m'@.</span><span>
</span><span id="line-758"></span><span class="hs-comment">--</span><span>
</span><span id="line-759"></span><span class="hs-comment">-- Ref. [absorbing element](https://en.wikipedia.org/wiki/Absorbing_element)</span><span>
</span><span id="line-760"></span><span class="hs-comment">--</span><span>
</span><span id="line-761"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679218254"><span id="local-6989586621679218255"><span id="local-6989586621679218779"><span id="local-6989586621679218783"><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Alternative"><span class="hs-identifier hs-type">Alternative</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218254"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Semigroup"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-type">Guarded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218254"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218255"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-762"></span><span>  </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-type">Guarded'</span></a></span><span>     </span><span id="local-6989586621679218799"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218799"><span class="hs-identifier hs-var">ta</span></a></span></span><span> </span><span id="local-6989586621679218800"><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679218800"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679218801"><span class="annot"><span class="annottext">&lt;&gt; :: Guarded m a -&gt; Guarded m a -&gt; Guarded m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-type">Guarded'</span></a></span><span>     </span><span id="local-6989586621679218802"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218802"><span class="hs-identifier hs-var">tb</span></a></span></span><span> </span><span id="local-6989586621679218803"><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679218803"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
forall (m :: * -&gt; *) a.
Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-var">Guarded'</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218799"><span class="hs-identifier hs-var">ta</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Maybe (Min Time) -&gt; Maybe (Min Time)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218802"><span class="hs-identifier hs-var">tb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679218800"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">FirstToFinish m a -&gt; FirstToFinish m a -&gt; FirstToFinish m a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679218803"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span>  </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-type">Guarded'</span></a></span><span>     </span><span id="local-6989586621679218804"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218804"><span class="hs-identifier hs-var">ta</span></a></span></span><span> </span><span id="local-6989586621679218805"><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679218805"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip%27"><span class="hs-identifier hs-type">GuardedSkip'</span></a></span><span> </span><span id="local-6989586621679218806"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218806"><span class="hs-identifier hs-var">tb</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
forall (m :: * -&gt; *) a.
Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-var">Guarded'</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218804"><span class="hs-identifier hs-var">ta</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Maybe (Min Time) -&gt; Maybe (Min Time)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218806"><span class="hs-identifier hs-var">tb</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679218805"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-764"></span><span>  </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip%27"><span class="hs-identifier hs-type">GuardedSkip'</span></a></span><span> </span><span id="local-6989586621679218807"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218807"><span class="hs-identifier hs-var">ta</span></a></span></span><span>   </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-type">Guarded'</span></a></span><span>     </span><span id="local-6989586621679218808"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218808"><span class="hs-identifier hs-var">tb</span></a></span></span><span> </span><span id="local-6989586621679218809"><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679218809"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
forall (m :: * -&gt; *) a.
Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-var">Guarded'</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218807"><span class="hs-identifier hs-var">ta</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Maybe (Min Time) -&gt; Maybe (Min Time)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218808"><span class="hs-identifier hs-var">tb</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679218809"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-765"></span><span>  </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip%27"><span class="hs-identifier hs-type">GuardedSkip'</span></a></span><span> </span><span id="local-6989586621679218810"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218810"><span class="hs-identifier hs-var">ta</span></a></span></span><span>   </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip%27"><span class="hs-identifier hs-type">GuardedSkip'</span></a></span><span> </span><span id="local-6989586621679218811"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218811"><span class="hs-identifier hs-var">tb</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Guarded m a
forall (m :: * -&gt; *) a. Maybe (Min Time) -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip%27"><span class="hs-identifier hs-var">GuardedSkip'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218810"><span class="hs-identifier hs-var">ta</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Maybe (Min Time) -&gt; Maybe (Min Time)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679218811"><span class="hs-identifier hs-var">tb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span>
</span><span id="line-768"></span><span class="hs-keyword">data</span><span> </span><span id="Decision"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Decision"><span class="hs-identifier hs-var">Decision</span></a></span></span><span> </span><span id="local-6989586621679218260"><span class="annot"><a href="#local-6989586621679218260"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679218261"><span class="annot"><a href="#local-6989586621679218261"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679218262"><span class="annot"><a href="#local-6989586621679218262"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Decision"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Decision"><span class="hs-identifier hs-var">Decision</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-769"></span><span>         </span><span class="annot"><span class="hs-comment">-- | A trace event to classify the decision and action</span></span><span>
</span><span id="line-770"></span><span>       </span><span id="decisionTrace"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) peeraddr peerconn.
Decision m peeraddr peerconn -&gt; [TracePeerSelection peeraddr]
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#decisionTrace"><span class="hs-identifier hs-var hs-var">decisionTrace</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePeerSelection"><span class="hs-identifier hs-type">TracePeerSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218261"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-771"></span><span>
</span><span id="line-772"></span><span>         </span><span class="annot"><span class="hs-comment">-- | An updated state to use immediately</span></span><span>
</span><span id="line-773"></span><span>       </span><span id="decisionState"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) peeraddr peerconn.
Decision m peeraddr peerconn
-&gt; PeerSelectionState peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#decisionState"><span class="hs-identifier hs-var hs-var">decisionState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218261"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218262"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-774"></span><span>
</span><span id="line-775"></span><span>       </span><span class="hs-comment">-- | An optional 'Job' to execute asynchronously. This job leads to</span><span>
</span><span id="line-776"></span><span>       </span><span class="hs-comment">-- a further 'Decision'. This gives a state update to apply upon</span><span>
</span><span id="line-777"></span><span>       </span><span class="hs-comment">-- completion, but also allows chaining further job actions.</span><span>
</span><span id="line-778"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-779"></span><span>       </span><span id="decisionJobs"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) peeraddr peerconn.
Decision m peeraddr peerconn
-&gt; [Job () m (Completion m peeraddr peerconn)]
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#decisionJobs"><span class="hs-identifier hs-var hs-var">decisionJobs</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Job</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679218260"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Completion"><span class="hs-identifier hs-type">Completion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218260"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218261"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218262"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-780"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-781"></span><span>
</span><span id="line-782"></span><span class="hs-comment">-- | Decision which has access to the current time, rather than the time when</span><span>
</span><span id="line-783"></span><span class="hs-comment">-- the governor's loop blocked to make a decision.</span><span>
</span><span id="line-784"></span><span class="hs-comment">--</span><span>
</span><span id="line-785"></span><span class="hs-keyword">type</span><span> </span><span id="TimedDecision"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TimedDecision"><span class="hs-identifier hs-var">TimedDecision</span></a></span></span><span> </span><span id="local-6989586621679218816"><span class="annot"><a href="#local-6989586621679218816"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679218817"><span class="annot"><a href="#local-6989586621679218817"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679218818"><span class="annot"><a href="#local-6989586621679218818"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Decision"><span class="hs-identifier hs-type">Decision</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218816"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218817"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218818"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-786"></span><span>
</span><span id="line-787"></span><span class="hs-comment">-- | Type alias for function types which are used to create governor decisions.</span><span>
</span><span id="line-788"></span><span class="hs-comment">-- Almost all decisions are following this pattern.</span><span>
</span><span id="line-789"></span><span class="hs-comment">--</span><span>
</span><span id="line-790"></span><span class="hs-keyword">type</span><span> </span><span id="MkGuardedDecision"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#MkGuardedDecision"><span class="hs-identifier hs-var">MkGuardedDecision</span></a></span></span><span> </span><span id="local-6989586621679218819"><span class="annot"><a href="#local-6989586621679218819"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679218820"><span class="annot"><a href="#local-6989586621679218820"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span id="local-6989586621679218821"><span class="annot"><a href="#local-6989586621679218821"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-791"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionPolicy"><span class="hs-identifier hs-type">PeerSelectionPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218819"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218821"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-792"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218819"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218820"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-793"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-type">Guarded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679218821"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TimedDecision"><span class="hs-identifier hs-type">TimedDecision</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218821"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218819"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218820"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-794"></span><span>
</span><span id="line-795"></span><span>
</span><span id="line-796"></span><span class="hs-keyword">newtype</span><span> </span><span id="Completion"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Completion"><span class="hs-identifier hs-var">Completion</span></a></span></span><span> </span><span id="local-6989586621679218822"><span class="annot"><a href="#local-6989586621679218822"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679218823"><span class="annot"><a href="#local-6989586621679218823"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679218824"><span class="annot"><a href="#local-6989586621679218824"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-797"></span><span>        </span><span id="Completion"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Completion"><span class="hs-identifier hs-var">Completion</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218823"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218824"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-798"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Decision"><span class="hs-identifier hs-type">Decision</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218822"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218823"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218824"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span class="hs-keyword">data</span><span> </span><span id="TracePeerSelection"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePeerSelection"><span class="hs-identifier hs-var">TracePeerSelection</span></a></span></span><span> </span><span id="local-6989586621679218826"><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-801"></span><span>       </span><span id="TraceLocalRootPeersChanged"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceLocalRootPeersChanged"><span class="hs-identifier hs-var">TraceLocalRootPeersChanged</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#LocalRootPeers"><span class="hs-identifier hs-type">LocalRootPeers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-802"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#LocalRootPeers"><span class="hs-identifier hs-type">LocalRootPeers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-803"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-804"></span><span>     </span><span class="hs-comment">-- Churn</span><span>
</span><span id="line-805"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-806"></span><span>
</span><span id="line-807"></span><span>     </span><span class="annot"><span class="hs-comment">-- | Peer selection targets changed: old targets, new targets.</span></span><span>
</span><span id="line-808"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceTargetsChanged"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceTargetsChanged"><span class="hs-identifier hs-var">TraceTargetsChanged</span></a></span></span><span>     </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span>
</span><span id="line-809"></span><span>
</span><span id="line-810"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-811"></span><span>     </span><span class="hs-comment">-- Ledger Peers</span><span>
</span><span id="line-812"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePublicRootsRequest"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePublicRootsRequest"><span class="hs-identifier hs-var">TracePublicRootsRequest</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-815"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePublicRootsResults"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePublicRootsResults"><span class="hs-identifier hs-var">TracePublicRootsResults</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerAdvertise</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-816"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePublicRootsFailure"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePublicRootsFailure"><span class="hs-identifier hs-var">TracePublicRootsFailure</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-817"></span><span>
</span><span id="line-818"></span><span>     </span><span class="annot"><span class="hs-comment">-- | target known peers, actual known peers, selected peers</span></span><span>
</span><span id="line-819"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceForgetColdPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceForgetColdPeers"><span class="hs-identifier hs-var">TraceForgetColdPeers</span></a></span></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceBigLedgerPeersRequest"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceBigLedgerPeersRequest"><span class="hs-identifier hs-var">TraceBigLedgerPeersRequest</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-822"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceBigLedgerPeersResults"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceBigLedgerPeersResults"><span class="hs-identifier hs-var">TraceBigLedgerPeersResults</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-823"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceBigLedgerPeersFailure"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceBigLedgerPeersFailure"><span class="hs-identifier hs-var">TraceBigLedgerPeersFailure</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-824"></span><span>     </span><span class="hs-comment">-- | target known big ledger peers, actual known big ledger peers, selected</span><span>
</span><span id="line-825"></span><span>     </span><span class="hs-comment">-- peers</span><span>
</span><span id="line-826"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceForgetBigLedgerPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceForgetBigLedgerPeers"><span class="hs-identifier hs-var">TraceForgetBigLedgerPeers</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-827"></span><span>
</span><span id="line-828"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-829"></span><span>     </span><span class="hs-comment">-- Peer Sharing</span><span>
</span><span id="line-830"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-831"></span><span>
</span><span id="line-832"></span><span>     </span><span class="hs-comment">-- | target known peers, actual known peers, peers available for</span><span>
</span><span id="line-833"></span><span>     </span><span class="hs-comment">-- peer sharing, peers selected for peer sharing</span><span>
</span><span id="line-834"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePeerShareRequests"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePeerShareRequests"><span class="hs-identifier hs-var">TracePeerShareRequests</span></a></span></span><span>     </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePeerShareResults"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePeerShareResults"><span class="hs-identifier hs-var">TracePeerShareResults</span></a></span></span><span>         </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PeerSharingResult</span></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">--TODO: classify failures</span><span>
</span><span id="line-836"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePeerShareResultsFiltered"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePeerShareResultsFiltered"><span class="hs-identifier hs-var">TracePeerShareResultsFiltered</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-837"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceKnownInboundConnection"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceKnownInboundConnection"><span class="hs-identifier hs-var">TraceKnownInboundConnection</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerSharing</span></span><span>
</span><span id="line-838"></span><span>
</span><span id="line-839"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-840"></span><span>     </span><span class="hs-comment">-- Promote Cold Peers</span><span>
</span><span id="line-841"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>     </span><span class="annot"><span class="hs-comment">-- | target established, actual established, selected peers</span></span><span>
</span><span id="line-844"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteColdPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteColdPeers"><span class="hs-identifier hs-var">TracePromoteColdPeers</span></a></span></span><span>   </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-845"></span><span>     </span><span class="annot"><span class="hs-comment">-- | target local established, actual local established, selected peers</span></span><span>
</span><span id="line-846"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteColdLocalPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteColdLocalPeers"><span class="hs-identifier hs-var">TracePromoteColdLocalPeers</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#WarmValency"><span class="hs-identifier hs-type">WarmValency</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-847"></span><span>     </span><span class="hs-comment">-- promotion, reason</span><span>
</span><span id="line-848"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteColdFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteColdFailed"><span class="hs-identifier hs-var">TracePromoteColdFailed</span></a></span></span><span>  </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span>
</span><span id="line-849"></span><span>     </span><span class="annot"><span class="hs-comment">-- | target established, actual established, peer</span></span><span>
</span><span id="line-850"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteColdDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteColdDone"><span class="hs-identifier hs-var">TracePromoteColdDone</span></a></span></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-851"></span><span>
</span><span id="line-852"></span><span>     </span><span class="hs-comment">-- | target established big ledger peers, actual established big ledger</span><span>
</span><span id="line-853"></span><span>     </span><span class="hs-comment">-- peers, selected peers</span><span>
</span><span id="line-854"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteColdBigLedgerPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteColdBigLedgerPeers"><span class="hs-identifier hs-var">TracePromoteColdBigLedgerPeers</span></a></span></span><span>   </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-855"></span><span>     </span><span class="hs-comment">-- | target established big ledger peers, actual established big ledger</span><span>
</span><span id="line-856"></span><span>     </span><span class="hs-comment">-- peers, peer, delay until next promotion, reason</span><span>
</span><span id="line-857"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteColdBigLedgerPeerFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteColdBigLedgerPeerFailed"><span class="hs-identifier hs-var">TracePromoteColdBigLedgerPeerFailed</span></a></span></span><span>  </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span>
</span><span id="line-858"></span><span>     </span><span class="hs-comment">-- | target established big ledger peers, actual established big ledger</span><span>
</span><span id="line-859"></span><span>     </span><span class="hs-comment">-- peers, peer</span><span>
</span><span id="line-860"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteColdBigLedgerPeerDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteColdBigLedgerPeerDone"><span class="hs-identifier hs-var">TracePromoteColdBigLedgerPeerDone</span></a></span></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-861"></span><span>
</span><span id="line-862"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-863"></span><span>     </span><span class="hs-comment">-- Promote Warm Peers</span><span>
</span><span id="line-864"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-865"></span><span>
</span><span id="line-866"></span><span>     </span><span class="annot"><span class="hs-comment">-- | target active, actual active, selected peers</span></span><span>
</span><span id="line-867"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmPeers"><span class="hs-identifier hs-var">TracePromoteWarmPeers</span></a></span></span><span>   </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-868"></span><span>     </span><span class="annot"><span class="hs-comment">-- | Promote local peers to warm</span></span><span>
</span><span id="line-869"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmLocalPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmLocalPeers"><span class="hs-identifier hs-var">TracePromoteWarmLocalPeers</span></a></span></span><span>
</span><span id="line-870"></span><span>         </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#HotValency"><span class="hs-identifier hs-type">HotValency</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-871"></span><span>         </span><span class="hs-comment">-- ^ local per-group `(target active, actual active)`,</span><span>
</span><span id="line-872"></span><span>         </span><span class="hs-comment">-- only limited to groups which are below their target.</span><span>
</span><span id="line-873"></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ selected peers</span><span>
</span><span id="line-874"></span><span>     </span><span class="hs-comment">-- | target active, actual active, peer, reason</span><span>
</span><span id="line-875"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmFailed"><span class="hs-identifier hs-var">TracePromoteWarmFailed</span></a></span></span><span>  </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span>
</span><span id="line-876"></span><span>     </span><span class="annot"><span class="hs-comment">-- | target active, actual active, peer</span></span><span>
</span><span id="line-877"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmDone"><span class="hs-identifier hs-var">TracePromoteWarmDone</span></a></span></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-878"></span><span>     </span><span class="hs-comment">-- | aborted promotion of a warm peer; likely it was asynchronously</span><span>
</span><span id="line-879"></span><span>     </span><span class="hs-comment">-- demoted in the meantime.</span><span>
</span><span id="line-880"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-881"></span><span>     </span><span class="hs-comment">-- target active, actual active, peer</span><span>
</span><span id="line-882"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmAborted"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmAborted"><span class="hs-identifier hs-var">TracePromoteWarmAborted</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-883"></span><span>
</span><span id="line-884"></span><span>     </span><span class="hs-comment">-- | target active big ledger peers, actual active big ledger peers,</span><span>
</span><span id="line-885"></span><span>     </span><span class="hs-comment">-- selected peers</span><span>
</span><span id="line-886"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmBigLedgerPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmBigLedgerPeers"><span class="hs-identifier hs-var">TracePromoteWarmBigLedgerPeers</span></a></span></span><span>   </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-887"></span><span>     </span><span class="hs-comment">-- | target active big ledger peers, actual active big ledger peers, peer,</span><span>
</span><span id="line-888"></span><span>     </span><span class="hs-comment">-- reason</span><span>
</span><span id="line-889"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmBigLedgerPeerFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmBigLedgerPeerFailed"><span class="hs-identifier hs-var">TracePromoteWarmBigLedgerPeerFailed</span></a></span></span><span>  </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span>
</span><span id="line-890"></span><span>     </span><span class="annot"><span class="hs-comment">-- | target active big ledger peers, actual active big ledger peers, peer</span></span><span>
</span><span id="line-891"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmBigLedgerPeerDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmBigLedgerPeerDone"><span class="hs-identifier hs-var">TracePromoteWarmBigLedgerPeerDone</span></a></span></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-892"></span><span>     </span><span class="hs-comment">-- | aborted promotion of a warm big ledger peer; likely it was</span><span>
</span><span id="line-893"></span><span>     </span><span class="hs-comment">-- asynchronously demoted in the meantime.</span><span>
</span><span id="line-894"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-895"></span><span>     </span><span class="hs-comment">-- target active, actual active, peer</span><span>
</span><span id="line-896"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmBigLedgerPeerAborted"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmBigLedgerPeerAborted"><span class="hs-identifier hs-var">TracePromoteWarmBigLedgerPeerAborted</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-899"></span><span>     </span><span class="hs-comment">-- Demote Warm Peers</span><span>
</span><span id="line-900"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-901"></span><span>
</span><span id="line-902"></span><span>     </span><span class="annot"><span class="hs-comment">-- | target established, actual established, selected peers</span></span><span>
</span><span id="line-903"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteWarmPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteWarmPeers"><span class="hs-identifier hs-var">TraceDemoteWarmPeers</span></a></span></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-904"></span><span>     </span><span class="annot"><span class="hs-comment">-- | target established, actual established, peer, reason</span></span><span>
</span><span id="line-905"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteWarmFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteWarmFailed"><span class="hs-identifier hs-var">TraceDemoteWarmFailed</span></a></span></span><span>   </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span>
</span><span id="line-906"></span><span>     </span><span class="annot"><span class="hs-comment">-- | target established, actual established, peer</span></span><span>
</span><span id="line-907"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteWarmDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteWarmDone"><span class="hs-identifier hs-var">TraceDemoteWarmDone</span></a></span></span><span>     </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span>     </span><span class="hs-comment">-- | target established big ledger peers, actual established big ledger</span><span>
</span><span id="line-910"></span><span>     </span><span class="hs-comment">-- peers, selected peers</span><span>
</span><span id="line-911"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteWarmBigLedgerPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteWarmBigLedgerPeers"><span class="hs-identifier hs-var">TraceDemoteWarmBigLedgerPeers</span></a></span></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>     </span><span class="hs-comment">-- | target established big ledger peers, actual established big ledger</span><span>
</span><span id="line-913"></span><span>     </span><span class="hs-comment">-- peers, peer, reason</span><span>
</span><span id="line-914"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteWarmBigLedgerPeerFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteWarmBigLedgerPeerFailed"><span class="hs-identifier hs-var">TraceDemoteWarmBigLedgerPeerFailed</span></a></span></span><span>   </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span>
</span><span id="line-915"></span><span>     </span><span class="hs-comment">-- | target established big ledger peers, actual established big ledger</span><span>
</span><span id="line-916"></span><span>     </span><span class="hs-comment">-- peers, peer</span><span>
</span><span id="line-917"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteWarmBigLedgerPeerDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteWarmBigLedgerPeerDone"><span class="hs-identifier hs-var">TraceDemoteWarmBigLedgerPeerDone</span></a></span></span><span>     </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-918"></span><span>
</span><span id="line-919"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-920"></span><span>     </span><span class="hs-comment">-- Demote Hot Peers</span><span>
</span><span id="line-921"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-922"></span><span>
</span><span id="line-923"></span><span>     </span><span class="annot"><span class="hs-comment">-- | target active, actual active, selected peers</span></span><span>
</span><span id="line-924"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteHotPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteHotPeers"><span class="hs-identifier hs-var">TraceDemoteHotPeers</span></a></span></span><span>     </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-925"></span><span>     </span><span class="annot"><span class="hs-comment">-- | local per-group (target active, actual active), selected peers</span></span><span>
</span><span id="line-926"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteLocalHotPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteLocalHotPeers"><span class="hs-identifier hs-var">TraceDemoteLocalHotPeers</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.State.LocalRootPeers.html#HotValency"><span class="hs-identifier hs-type">HotValency</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-927"></span><span>     </span><span class="annot"><span class="hs-comment">-- | target active, actual active, peer, reason</span></span><span>
</span><span id="line-928"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteHotFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteHotFailed"><span class="hs-identifier hs-var">TraceDemoteHotFailed</span></a></span></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span>
</span><span id="line-929"></span><span>     </span><span class="annot"><span class="hs-comment">-- | target active, actual active, peer</span></span><span>
</span><span id="line-930"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteHotDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteHotDone"><span class="hs-identifier hs-var">TraceDemoteHotDone</span></a></span></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span>     </span><span class="hs-comment">-- | target active big ledger peers, actual active big ledger peers,</span><span>
</span><span id="line-933"></span><span>     </span><span class="hs-comment">-- selected peers</span><span>
</span><span id="line-934"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteHotBigLedgerPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteHotBigLedgerPeers"><span class="hs-identifier hs-var">TraceDemoteHotBigLedgerPeers</span></a></span></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-935"></span><span>     </span><span class="hs-comment">-- | target active big ledger peers, actual active big ledger peers, peer,</span><span>
</span><span id="line-936"></span><span>     </span><span class="hs-comment">-- reason</span><span>
</span><span id="line-937"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteHotBigLedgerPeerFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteHotBigLedgerPeerFailed"><span class="hs-identifier hs-var">TraceDemoteHotBigLedgerPeerFailed</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span>
</span><span id="line-938"></span><span>     </span><span class="annot"><span class="hs-comment">-- | target active big ledger peers, actual active big ledger peers, peer</span></span><span>
</span><span id="line-939"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteHotBigLedgerPeerDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteHotBigLedgerPeerDone"><span class="hs-identifier hs-var">TraceDemoteHotBigLedgerPeerDone</span></a></span></span><span>   </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-940"></span><span>
</span><span id="line-941"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-942"></span><span>     </span><span class="hs-comment">-- Async Demotions</span><span>
</span><span id="line-943"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-944"></span><span>
</span><span id="line-945"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteAsynchronous"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteAsynchronous"><span class="hs-identifier hs-var">TraceDemoteAsynchronous</span></a></span></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerStatus"><span class="hs-identifier hs-type">PeerStatus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.ExitPolicy.html#RepromoteDelay"><span class="hs-identifier hs-type">RepromoteDelay</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-946"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteLocalAsynchronous"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteLocalAsynchronous"><span class="hs-identifier hs-var">TraceDemoteLocalAsynchronous</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerStatus"><span class="hs-identifier hs-type">PeerStatus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.ExitPolicy.html#RepromoteDelay"><span class="hs-identifier hs-type">RepromoteDelay</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-947"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteBigLedgerPeersAsynchronous"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteBigLedgerPeersAsynchronous"><span class="hs-identifier hs-var">TraceDemoteBigLedgerPeersAsynchronous</span></a></span></span><span>
</span><span id="line-948"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218826"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerStatus"><span class="hs-identifier hs-type">PeerStatus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.ExitPolicy.html#RepromoteDelay"><span class="hs-identifier hs-type">RepromoteDelay</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-949"></span><span>
</span><span id="line-950"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceGovernorWakeup"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceGovernorWakeup"><span class="hs-identifier hs-var">TraceGovernorWakeup</span></a></span></span><span>
</span><span id="line-951"></span><span>
</span><span id="line-952"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-953"></span><span>     </span><span class="hs-comment">-- Churn Trace</span><span>
</span><span id="line-954"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-955"></span><span>
</span><span id="line-956"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceChurnWait"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceChurnWait"><span class="hs-identifier hs-var">TraceChurnWait</span></a></span></span><span>          </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-957"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceChurnMode"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceChurnMode"><span class="hs-identifier hs-var">TraceChurnMode</span></a></span></span><span>          </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#ChurnMode"><span class="hs-identifier hs-type">ChurnMode</span></a></span><span>
</span><span id="line-958"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679218879"><span id="local-6989586621679219071"><span id="local-6989586621679219075"><span class="annot"><span class="annottext">Int -&gt; TracePeerSelection peeraddr -&gt; ShowS
[TracePeerSelection peeraddr] -&gt; ShowS
TracePeerSelection peeraddr -&gt; String
(Int -&gt; TracePeerSelection peeraddr -&gt; ShowS)
-&gt; (TracePeerSelection peeraddr -&gt; String)
-&gt; ([TracePeerSelection peeraddr] -&gt; ShowS)
-&gt; Show (TracePeerSelection peeraddr)
forall peeraddr.
(Ord peeraddr, Show peeraddr) =&gt;
Int -&gt; TracePeerSelection peeraddr -&gt; ShowS
forall peeraddr.
(Ord peeraddr, Show peeraddr) =&gt;
[TracePeerSelection peeraddr] -&gt; ShowS
forall peeraddr.
(Ord peeraddr, Show peeraddr) =&gt;
TracePeerSelection peeraddr -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall peeraddr.
(Ord peeraddr, Show peeraddr) =&gt;
Int -&gt; TracePeerSelection peeraddr -&gt; ShowS
showsPrec :: Int -&gt; TracePeerSelection peeraddr -&gt; ShowS
$cshow :: forall peeraddr.
(Ord peeraddr, Show peeraddr) =&gt;
TracePeerSelection peeraddr -&gt; String
show :: TracePeerSelection peeraddr -&gt; String
$cshowList :: forall peeraddr.
(Ord peeraddr, Show peeraddr) =&gt;
[TracePeerSelection peeraddr] -&gt; ShowS
showList :: [TracePeerSelection peeraddr] -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span>
</span><span id="line-959"></span><span>
</span><span id="line-960"></span><span class="hs-keyword">data</span><span> </span><span id="DebugPeerSelection"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#DebugPeerSelection"><span class="hs-identifier hs-var">DebugPeerSelection</span></a></span></span><span> </span><span id="local-6989586621679219091"><span class="annot"><a href="#local-6989586621679219091"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-961"></span><span>  </span><span id="TraceGovernorState"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceGovernorState"><span class="hs-identifier hs-var">TraceGovernorState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679219093"><span class="annot"><a href="#local-6989586621679219093"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679219094"><span class="annot"><a href="#local-6989586621679219094"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-962"></span><span>                        </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679219094"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-963"></span><span>                     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span>            </span><span class="hs-comment">-- blocked time</span><span>
</span><span id="line-964"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>  </span><span class="hs-comment">-- wait time</span><span>
</span><span id="line-965"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679219093"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679219094"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-966"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#DebugPeerSelection"><span class="hs-identifier hs-type">DebugPeerSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679219093"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-967"></span><span>
</span><span id="line-968"></span><span id="local-6989586621679218287"><span id="local-6989586621679219096"><span id="local-6989586621679219098"><span id="local-6989586621679219102"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218287"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218287"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-969"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#DebugPeerSelection"><span class="hs-identifier hs-type">DebugPeerSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679218287"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-970"></span><span>
</span><span id="line-971"></span><span class="hs-keyword">data</span><span> </span><span id="ChurnMode"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#ChurnMode"><span class="hs-identifier hs-var">ChurnMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ChurnModeBulkSync"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#ChurnModeBulkSync"><span class="hs-identifier hs-var">ChurnModeBulkSync</span></a></span></span><span>
</span><span id="line-972"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="ChurnModeNormal"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#ChurnModeNormal"><span class="hs-identifier hs-var">ChurnModeNormal</span></a></span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679219107"><span id="local-6989586621679219109"><span id="local-6989586621679219112"><span class="annot"><span class="annottext">Int -&gt; ChurnMode -&gt; ShowS
[ChurnMode] -&gt; ShowS
ChurnMode -&gt; String
(Int -&gt; ChurnMode -&gt; ShowS)
-&gt; (ChurnMode -&gt; String)
-&gt; ([ChurnMode] -&gt; ShowS)
-&gt; Show ChurnMode
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; ChurnMode -&gt; ShowS
showsPrec :: Int -&gt; ChurnMode -&gt; ShowS
$cshow :: ChurnMode -&gt; String
show :: ChurnMode -&gt; String
$cshowList :: [ChurnMode] -&gt; ShowS
showList :: [ChurnMode] -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span>
</span><span id="line-973"></span><span>
</span><span id="line-974"></span></pre></body></html>