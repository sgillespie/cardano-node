<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Ouroboros.Network.BlockFetch.Decision</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ouroboros-network-0.11.0.0: A networking layer for the Ouroboros blockchain protocol</span><ul class="links" id="page-menu"><li id="quick-jump-button"><a href="#">Quick Jump</a></li><li><a href="src/Ouroboros.Network.BlockFetch.Decision.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Ouroboros.Network.BlockFetch.Decision</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Deciding what to fetch</a><ul><li><a href="#g:2">Components of the decision-making process</a></li></ul></li></ul></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:fetchDecisions">fetchDecisions</a> :: (<a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> peer, Hashable peer, HasHeader header, HeaderHash header <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> HeaderHash block) =&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecisionPolicy" title="Ouroboros.Network.BlockFetch.Decision">FetchDecisionPolicy</a> header -&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> -&gt; AnchoredFragment header -&gt; (Point block -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>) -&gt; MaxSlotNo -&gt; [(AnchoredFragment header, <a href="Ouroboros-Network-BlockFetch-Decision.html#t:PeerInfo" title="Ouroboros.Network.BlockFetch.Decision">PeerInfo</a> header peer extra)] -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.ClientState">FetchRequest</a> header), <a href="Ouroboros-Network-BlockFetch-Decision.html#t:PeerInfo" title="Ouroboros.Network.BlockFetch.Decision">PeerInfo</a> header peer extra)]</li><li class="src short"><span class="keyword">data</span> <a href="#t:FetchDecisionPolicy">FetchDecisionPolicy</a> header = <a href="#v:FetchDecisionPolicy">FetchDecisionPolicy</a> {<ul class="subs"><li><a href="#v:maxInFlightReqsPerPeer">maxInFlightReqsPerPeer</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Word.html#t:Word" title="Data.Word">Word</a></li><li><a href="#v:maxConcurrencyBulkSync">maxConcurrencyBulkSync</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Word.html#t:Word" title="Data.Word">Word</a></li><li><a href="#v:maxConcurrencyDeadline">maxConcurrencyDeadline</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Word.html#t:Word" title="Data.Word">Word</a></li><li><a href="#v:decisionLoopInterval">decisionLoopInterval</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/Data-Time-Clock.html#t:DiffTime" title="Data.Time.Clock">DiffTime</a></li><li><a href="#v:peerSalt">peerSalt</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li><a href="#v:plausibleCandidateChain">plausibleCandidateChain</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a> =&gt; AnchoredFragment header -&gt; AnchoredFragment header -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li><a href="#v:compareCandidateChains">compareCandidateChains</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a> =&gt; AnchoredFragment header -&gt; AnchoredFragment header -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ordering" title="Data.Ord">Ordering</a></li><li><a href="#v:blockFetchSize">blockFetchSize</a> :: header -&gt; <a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a></li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:FetchMode">FetchMode</a><ul class="subs"><li>= <a href="#v:FetchModeBulkSync">FetchModeBulkSync</a></li><li>| <a href="#v:FetchModeDeadline">FetchModeDeadline</a></li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:PeerInfo">PeerInfo</a> header peer extra = (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header, <a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header, <a href="Ouroboros-Network-DeltaQ.html#t:PeerGSV" title="Ouroboros.Network.DeltaQ">PeerGSV</a>, peer, extra)</li><li class="src short"><span class="keyword">type</span> <a href="#t:FetchDecision">FetchDecision</a> result = <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Either.html#t:Either" title="Data.Either">Either</a> <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecline" title="Ouroboros.Network.BlockFetch.Decision">FetchDecline</a> result</li><li class="src short"><span class="keyword">data</span> <a href="#t:FetchDecline">FetchDecline</a><ul class="subs"><li>= <a href="#v:FetchDeclineChainNotPlausible">FetchDeclineChainNotPlausible</a></li><li>| <a href="#v:FetchDeclineChainIntersectionTooDeep">FetchDeclineChainIntersectionTooDeep</a></li><li>| <a href="#v:FetchDeclineAlreadyFetched">FetchDeclineAlreadyFetched</a></li><li>| <a href="#v:FetchDeclineInFlightThisPeer">FetchDeclineInFlightThisPeer</a></li><li>| <a href="#v:FetchDeclineInFlightOtherPeer">FetchDeclineInFlightOtherPeer</a></li><li>| <a href="#v:FetchDeclinePeerShutdown">FetchDeclinePeerShutdown</a></li><li>| <a href="#v:FetchDeclinePeerStarting">FetchDeclinePeerStarting</a></li><li>| <a href="#v:FetchDeclinePeerSlow">FetchDeclinePeerSlow</a></li><li>| <a href="#v:FetchDeclineReqsInFlightLimit">FetchDeclineReqsInFlightLimit</a> !<a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Word.html#t:Word" title="Data.Word">Word</a></li><li>| <a href="#v:FetchDeclineBytesInFlightLimit">FetchDeclineBytesInFlightLimit</a> !<a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a> !<a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a> !<a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a></li><li>| <a href="#v:FetchDeclinePeerBusy">FetchDeclinePeerBusy</a> !<a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a> !<a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a> !<a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a></li><li>| <a href="#v:FetchDeclineConcurrencyLimit">FetchDeclineConcurrencyLimit</a> !<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> !<a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Word.html#t:Word" title="Data.Word">Word</a></li></ul></li><li class="src short"><a href="#v:filterPlausibleCandidates">filterPlausibleCandidates</a> :: (AnchoredFragment block -&gt; AnchoredFragment header -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>) -&gt; AnchoredFragment block -&gt; [(AnchoredFragment header, peerinfo)] -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (AnchoredFragment header), peerinfo)]</li><li class="src short"><a href="#v:selectForkSuffixes">selectForkSuffixes</a> :: (HasHeader header, HasHeader block, HeaderHash header <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> HeaderHash block) =&gt; AnchoredFragment block -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (AnchoredFragment header), peerinfo)] -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (ChainSuffix header), peerinfo)]</li><li class="src short"><a href="#v:filterNotAlreadyFetched">filterNotAlreadyFetched</a> :: (HasHeader header, HeaderHash header <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> HeaderHash block) =&gt; (Point block -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>) -&gt; MaxSlotNo -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (ChainSuffix header), peerinfo)] -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (CandidateFragments header), peerinfo)]</li><li class="src short"><a href="#v:filterNotAlreadyInFlightWithPeer">filterNotAlreadyInFlightWithPeer</a> :: HasHeader header =&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (CandidateFragments header), <a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header, peerinfo)] -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (CandidateFragments header), peerinfo)]</li><li class="src short"><a href="#v:prioritisePeerChains">prioritisePeerChains</a> :: <span class="keyword">forall</span> extra header peer. (HasHeader header, Hashable peer, <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> peer) =&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; (AnchoredFragment header -&gt; AnchoredFragment header -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ordering" title="Data.Ord">Ordering</a>) -&gt; (header -&gt; <a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a>) -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (CandidateFragments header), <a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header, <a href="Ouroboros-Network-DeltaQ.html#t:PeerGSV" title="Ouroboros.Network.DeltaQ">PeerGSV</a>, peer, extra)] -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> [AnchoredFragment header], extra)]</li><li class="src short"><a href="#v:filterNotAlreadyInFlightWithOtherPeers">filterNotAlreadyInFlightWithOtherPeers</a> :: HasHeader header =&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> [AnchoredFragment header], <a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header, <a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header, peerinfo)] -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> [AnchoredFragment header], peerinfo)]</li><li class="src short"><a href="#v:fetchRequestDecisions">fetchRequestDecisions</a> :: <span class="keyword">forall</span> extra header peer. (Hashable peer, HasHeader header, <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> peer) =&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecisionPolicy" title="Ouroboros.Network.BlockFetch.Decision">FetchDecisionPolicy</a> header -&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> [AnchoredFragment header], <a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header, <a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header, <a href="Ouroboros-Network-DeltaQ.html#t:PeerGSV" title="Ouroboros.Network.DeltaQ">PeerGSV</a>, peer, extra)] -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.ClientState">FetchRequest</a> header), extra)]</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Deciding what to fetch</h1></a><div class="top"><p class="src"><a id="v:fetchDecisions" class="def">fetchDecisions</a> :: (<a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> peer, Hashable peer, HasHeader header, HeaderHash header <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> HeaderHash block) =&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecisionPolicy" title="Ouroboros.Network.BlockFetch.Decision">FetchDecisionPolicy</a> header -&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> -&gt; AnchoredFragment header -&gt; (Point block -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>) -&gt; MaxSlotNo -&gt; [(AnchoredFragment header, <a href="Ouroboros-Network-BlockFetch-Decision.html#t:PeerInfo" title="Ouroboros.Network.BlockFetch.Decision">PeerInfo</a> header peer extra)] -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.ClientState">FetchRequest</a> header), <a href="Ouroboros-Network-BlockFetch-Decision.html#t:PeerInfo" title="Ouroboros.Network.BlockFetch.Decision">PeerInfo</a> header peer extra)] <a href="src/Ouroboros.Network.BlockFetch.Decision.html#fetchDecisions" class="link">Source</a> <a href="#v:fetchDecisions" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:FetchDecisionPolicy" class="def">FetchDecisionPolicy</a> header <a href="src/Ouroboros.Network.BlockFetch.Decision.html#FetchDecisionPolicy" class="link">Source</a> <a href="#t:FetchDecisionPolicy" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:FetchDecisionPolicy" class="def">FetchDecisionPolicy</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:maxInFlightReqsPerPeer" class="def">maxInFlightReqsPerPeer</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Word.html#t:Word" title="Data.Word">Word</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:maxConcurrencyBulkSync" class="def">maxConcurrencyBulkSync</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Word.html#t:Word" title="Data.Word">Word</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:maxConcurrencyDeadline" class="def">maxConcurrencyDeadline</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Word.html#t:Word" title="Data.Word">Word</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:decisionLoopInterval" class="def">decisionLoopInterval</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/time-1.12.2/Data-Time-Clock.html#t:DiffTime" title="Data.Time.Clock">DiffTime</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:peerSalt" class="def">peerSalt</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:plausibleCandidateChain" class="def">plausibleCandidateChain</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a> =&gt; AnchoredFragment header -&gt; AnchoredFragment header -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:compareCandidateChains" class="def">compareCandidateChains</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a> =&gt; AnchoredFragment header -&gt; AnchoredFragment header -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ordering" title="Data.Ord">Ordering</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:blockFetchSize" class="def">blockFetchSize</a> :: header -&gt; <a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a></dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:FetchMode" class="def">FetchMode</a> <a href="#t:FetchMode" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:FetchModeBulkSync" class="def">FetchModeBulkSync</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:FetchModeDeadline" class="def">FetchModeDeadline</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:FetchMode">Instances</h4><details id="i:FetchMode" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FetchMode:Show:1"></span> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a></span></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:FetchMode:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html">Ouroboros.Network.BlockFetch.ConsensusInterface</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a>] -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FetchMode:Eq:2"></span> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a></span></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:FetchMode:Eq:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-ConsensusInterface.html">Ouroboros.Network.BlockFetch.ConsensusInterface</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> -&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src" class="link">Source</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> -&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src" class="link">Source</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:PeerInfo" class="def">PeerInfo</a> header peer extra = (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header, <a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header, <a href="Ouroboros-Network-DeltaQ.html#t:PeerGSV" title="Ouroboros.Network.DeltaQ">PeerGSV</a>, peer, extra) <a href="src/Ouroboros.Network.BlockFetch.Decision.html#PeerInfo" class="link">Source</a> <a href="#t:PeerInfo" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:FetchDecision" class="def">FetchDecision</a> result = <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Either.html#t:Either" title="Data.Either">Either</a> <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecline" title="Ouroboros.Network.BlockFetch.Decision">FetchDecline</a> result <a href="src/Ouroboros.Network.BlockFetch.Decision.html#FetchDecision" class="link">Source</a> <a href="#t:FetchDecision" class="selflink">#</a></p><div class="doc"><p>Throughout the decision making process we accumulate reasons to decline
 to fetch any blocks. This type is used to wrap intermediate and final
 results.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:FetchDecline" class="def">FetchDecline</a> <a href="src/Ouroboros.Network.BlockFetch.Decision.html#FetchDecline" class="link">Source</a> <a href="#t:FetchDecline" class="selflink">#</a></p><div class="doc"><p>All the various reasons we can decide not to fetch blocks from a peer.</p><p>It is worth highlighting which of these reasons result from competition
 among upstream peers.</p><ul><li><code><a href="Ouroboros-Network-BlockFetch-Decision.html#v:FetchDeclineInFlightOtherPeer" title="Ouroboros.Network.BlockFetch.Decision">FetchDeclineInFlightOtherPeer</a></code>: decline this peer because all the
   unfetched blocks of its candidate chain have already been requested from
   other peers. This reason reflects the least-consequential competition
   among peers: the competition that determines merely which upstream peer to
   burden with the request (eg the one with the best
   <code><a href="Ouroboros-Network-BlockFetch-DeltaQ.html#v:DeltaQ" title="Ouroboros.Network.BlockFetch.DeltaQ">DeltaQ</a></code> metrics). The consequences
   are relatively minor because the unfetched blocks on this peer's candidate
   chain will be requested regardless; it's merely a question of &quot;From who?&quot;.
   (One exception: if an adversarial peer wins this competition such that the
   blocks are only requested from them, then it may be possible that this
   decision determines whether the blocks are ever <em>received</em>. But that
   depends on details of timeouts, a longer competing chain being soon
   received within those timeouts, and so on.)</li><li><code><a href="Ouroboros-Network-BlockFetch-Decision.html#v:FetchDeclineChainNotPlausible" title="Ouroboros.Network.BlockFetch.Decision">FetchDeclineChainNotPlausible</a></code>: decline this peer because the node has
   already fetched, validated, and selected a chain better than its candidate
   chain from other peers (or from the node's own block forge). Because the
   node's current selection is influenced by what blocks other peers have
   recently served (or it recently minted), this reason reflects that peers
   <em>indirectly</em> compete by serving as long of a chain as possible and as
   promptly as possible. When the tips of the peers' selections are all
   within their respective forecast horizons (see
   <code><a href="Ouroboros-Consensus-Ledger-SupportsProtocol.html#v:ledgerViewForecastAt" title="Ouroboros.Consensus.Ledger.SupportsProtocol">ledgerViewForecastAt</a></code>), then
   the length of their candidate chains will typically be the length of their
   selections, since the ChainSync is free to race ahead (in contrast, the
   BlockFetch pipeline depth is bounded such that it will, for a syncing
   node, not be able to request all blocks between the selection and the end
   of the forecast window). But if one or more of their tips is beyond the
   horizon, then the relative length of the candidate chains is more
   complicated, influenced by both the relative density of the chains'
   suffixes and the relative age of the chains' intersection with the node's
   selection (since each peer's forecast horizon is a fixed number of slots
   after the candidate's successor of that intersection).</li><li><code><a href="Ouroboros-Network-BlockFetch-Decision.html#v:FetchDeclineConcurrencyLimit" title="Ouroboros.Network.BlockFetch.Decision">FetchDeclineConcurrencyLimit</a></code>: decline this peer while the node has
   already fully allocated the artificially scarce <code>maxConcurrentFetchPeers</code>
   resource amongst its other peers. This reason reflects the
   least-fundamental competition: it's the only way a node would decline a
   candidate chain C that it would immediately switch to if C had somehow
   already been fetched (and any better current candidates hadn't). It is
   possible that this peer's candidate fragment is better than the candidate
   fragments of other peers, but that should only happen ephemerally (eg for
   a brief while immediately after first connecting to this peer).</li><li><code><a href="Ouroboros-Network-BlockFetch-Decision.html#v:FetchDeclineChainIntersectionTooDeep" title="Ouroboros.Network.BlockFetch.Decision">FetchDeclineChainIntersectionTooDeep</a></code>: decline this peer because the node's
   selection has more than <code>K</code> blocks that are not on this peer's candidate
   chain. Typically, this reason occurs after the node has been declined---ie
   lost the above competitions---for a long enough duration. This decision
   only arises if the BlockFetch decision logic wins a harmless race against
   the ChainSync client once the node's selection gets longer, since
   <code><a href="Ouroboros-Consensus-MiniProtocol-ChainSync-Client.html#v:ForkTooDeep" title="Ouroboros.Consensus.MiniProtocol.ChainSync.Client">ForkTooDeep</a></code>
   disconnects from such a peer.</li></ul></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:FetchDeclineChainNotPlausible" class="def">FetchDeclineChainNotPlausible</a></td><td class="doc"><p>This peer's candidate chain is not longer than our chain. For more
 details see
 <code><a href="Ouroboros-Consensus-MiniProtocol-BlockFetch-ClientInterface.html#v:mkBlockFetchConsensusInterface" title="Ouroboros.Consensus.MiniProtocol.BlockFetch.ClientInterface">mkBlockFetchConsensusInterface</a></code>
 which implements <code><a href="Ouroboros-Network-BlockFetch-Decision.html#v:plausibleCandidateChain" title="Ouroboros.Network.BlockFetch.Decision">plausibleCandidateChain</a></code>.</p></td></tr><tr><td class="src"><a id="v:FetchDeclineChainIntersectionTooDeep" class="def">FetchDeclineChainIntersectionTooDeep</a></td><td class="doc"><p>Switching to this peer's candidate chain would require rolling back
 more than <code>K</code> blocks.</p></td></tr><tr><td class="src"><a id="v:FetchDeclineAlreadyFetched" class="def">FetchDeclineAlreadyFetched</a></td><td class="doc"><p>Every block on this peer's candidate chain has already been fetched.</p></td></tr><tr><td class="src"><a id="v:FetchDeclineInFlightThisPeer" class="def">FetchDeclineInFlightThisPeer</a></td><td class="doc"><p>This peer's candidate chain has already been requested from this
 peer.</p></td></tr><tr><td class="src"><a id="v:FetchDeclineInFlightOtherPeer" class="def">FetchDeclineInFlightOtherPeer</a></td><td class="doc"><p>Some blocks on this peer's candidate chain have not yet been fetched,
 but all of those have already been requested from other peers.</p></td></tr><tr><td class="src"><a id="v:FetchDeclinePeerShutdown" class="def">FetchDeclinePeerShutdown</a></td><td class="doc"><p>This peer's BlockFetch client is shutting down, see
 <code><a href="Ouroboros-Network-BlockFetch-ClientState.html#v:PeerFetchStatusShutdown" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatusShutdown</a></code>.</p></td></tr><tr><td class="src"><a id="v:FetchDeclinePeerStarting" class="def">FetchDeclinePeerStarting</a></td><td class="doc"><p>Blockfetch is starting up and waiting on corresponding Chainsync.</p></td></tr><tr><td class="src"><a id="v:FetchDeclinePeerSlow" class="def">FetchDeclinePeerSlow</a></td><td class="doc"><p>This peer is in a potentially-temporary state in which it has not
 responded to us within a certain expected time limit, see
 <code><a href="Ouroboros-Network-BlockFetch-ClientState.html#v:PeerFetchStatusAberrant" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatusAberrant</a></code>.</p></td></tr><tr><td class="src"><a id="v:FetchDeclineReqsInFlightLimit" class="def">FetchDeclineReqsInFlightLimit</a> !<a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Word.html#t:Word" title="Data.Word">Word</a></td><td class="doc"><p>This peer is not under the <code><a href="Ouroboros-Network-BlockFetch-Decision.html#v:maxInFlightReqsPerPeer" title="Ouroboros.Network.BlockFetch.Decision">maxInFlightReqsPerPeer</a></code> limit.</p><p>The argument is the <code><a href="Ouroboros-Network-BlockFetch-Decision.html#v:maxInFlightReqsPerPeer" title="Ouroboros.Network.BlockFetch.Decision">maxInFlightReqsPerPeer</a></code> constant.</p></td></tr><tr><td class="src"><a id="v:FetchDeclineBytesInFlightLimit" class="def">FetchDeclineBytesInFlightLimit</a> !<a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a> !<a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a> !<a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a></td><td class="doc"><p>This peer is not under the <code><a href="Ouroboros-Network-BlockFetch-DeltaQ.html#v:inFlightBytesHighWatermark" title="Ouroboros.Network.BlockFetch.DeltaQ">inFlightBytesHighWatermark</a></code> bytes limit.</p><p>The arguments are:</p><ul><li>number of bytes currently in flight for that peer</li><li>the configured <code><a href="Ouroboros-Network-BlockFetch-DeltaQ.html#v:inFlightBytesLowWatermark" title="Ouroboros.Network.BlockFetch.DeltaQ">inFlightBytesLowWatermark</a></code> constant</li><li>the configured <code><a href="Ouroboros-Network-BlockFetch-DeltaQ.html#v:inFlightBytesHighWatermark" title="Ouroboros.Network.BlockFetch.DeltaQ">inFlightBytesHighWatermark</a></code> constant</li></ul></td></tr><tr><td class="src"><a id="v:FetchDeclinePeerBusy" class="def">FetchDeclinePeerBusy</a> !<a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a> !<a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a> !<a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a></td><td class="doc"><p>This peer is not under the <code><a href="Ouroboros-Network-BlockFetch-DeltaQ.html#v:inFlightBytesLowWatermark" title="Ouroboros.Network.BlockFetch.DeltaQ">inFlightBytesLowWatermark</a></code>.</p><p>The arguments are:</p><ul><li>number of bytes currently in flight for that peer</li><li>the configured <code><a href="Ouroboros-Network-BlockFetch-DeltaQ.html#v:inFlightBytesLowWatermark" title="Ouroboros.Network.BlockFetch.DeltaQ">inFlightBytesLowWatermark</a></code> constant</li><li>the configured <code><a href="Ouroboros-Network-BlockFetch-DeltaQ.html#v:inFlightBytesHighWatermark" title="Ouroboros.Network.BlockFetch.DeltaQ">inFlightBytesHighWatermark</a></code> constant</li></ul></td></tr><tr><td class="src"><a id="v:FetchDeclineConcurrencyLimit" class="def">FetchDeclineConcurrencyLimit</a> !<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> !<a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Word.html#t:Word" title="Data.Word">Word</a></td><td class="doc"><p>The node is not under the <code>maxConcurrentFetchPeers</code> limit.</p><p>The arguments are:</p><ul><li>the current <code><a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a></code></li><li>the corresponding configured limit constant, either
   <code><a href="Ouroboros-Network-BlockFetch-Decision.html#v:maxConcurrencyBulkSync" title="Ouroboros.Network.BlockFetch.Decision">maxConcurrencyBulkSync</a></code> or <code><a href="Ouroboros-Network-BlockFetch-Decision.html#v:maxConcurrencyDeadline" title="Ouroboros.Network.BlockFetch.Decision">maxConcurrencyDeadline</a></code></li></ul></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:FetchDecline">Instances</h4><details id="i:FetchDecline" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FetchDecline:Show:1"></span> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecline" title="Ouroboros.Network.BlockFetch.Decision">FetchDecline</a></span> <a href="src/Ouroboros.Network.BlockFetch.Decision.html#line-230" class="link">Source</a> <a href="#t:FetchDecline" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:FetchDecline:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-Decision.html">Ouroboros.Network.BlockFetch.Decision</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecline" title="Ouroboros.Network.BlockFetch.Decision">FetchDecline</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecline" title="Ouroboros.Network.BlockFetch.Decision">FetchDecline</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecline" title="Ouroboros.Network.BlockFetch.Decision">FetchDecline</a>] -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FetchDecline:Eq:2"></span> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecline" title="Ouroboros.Network.BlockFetch.Decision">FetchDecline</a></span> <a href="src/Ouroboros.Network.BlockFetch.Decision.html#line-230" class="link">Source</a> <a href="#t:FetchDecline" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:FetchDecline:Eq:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-Decision.html">Ouroboros.Network.BlockFetch.Decision</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecline" title="Ouroboros.Network.BlockFetch.Decision">FetchDecline</a> -&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecline" title="Ouroboros.Network.BlockFetch.Decision">FetchDecline</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src" class="link">Source</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecline" title="Ouroboros.Network.BlockFetch.Decision">FetchDecline</a> -&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecline" title="Ouroboros.Network.BlockFetch.Decision">FetchDecline</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src" class="link">Source</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><a href="#g:2" id="g:2"><h2>Components of the decision-making process</h2></a><div class="top"><p class="src"><a id="v:filterPlausibleCandidates" class="def">filterPlausibleCandidates</a> <a href="src/Ouroboros.Network.BlockFetch.Decision.html#filterPlausibleCandidates" class="link">Source</a> <a href="#v:filterPlausibleCandidates" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (AnchoredFragment block -&gt; AnchoredFragment header -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; AnchoredFragment block</td><td class="doc"><p>The current chain</p></td></tr><tr><td class="src">-&gt; [(AnchoredFragment header, peerinfo)]</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (AnchoredFragment header), peerinfo)]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Keep only those candidate chains that are preferred over the current
 chain. Typically, this means that their length is longer than the length of
 the current chain.</p></div></div><div class="top"><p class="src"><a id="v:selectForkSuffixes" class="def">selectForkSuffixes</a> :: (HasHeader header, HasHeader block, HeaderHash header <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> HeaderHash block) =&gt; AnchoredFragment block -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (AnchoredFragment header), peerinfo)] -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (ChainSuffix header), peerinfo)] <a href="src/Ouroboros.Network.BlockFetch.Decision.html#selectForkSuffixes" class="link">Source</a> <a href="#v:selectForkSuffixes" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:filterNotAlreadyFetched" class="def">filterNotAlreadyFetched</a> :: (HasHeader header, HeaderHash header <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> HeaderHash block) =&gt; (Point block -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>) -&gt; MaxSlotNo -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (ChainSuffix header), peerinfo)] -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (CandidateFragments header), peerinfo)] <a href="src/Ouroboros.Network.BlockFetch.Decision.html#filterNotAlreadyFetched" class="link">Source</a> <a href="#v:filterNotAlreadyFetched" class="selflink">#</a></p><div class="doc"><p>Find the fragments of the chain suffix that we still need to fetch, these
 are the fragments covering blocks that have not yet been fetched and are
 not currently in the process of being fetched from this peer.</p><p>Typically this is a single fragment forming a suffix of the chain, but in
 the general case we can get a bunch of discontiguous chain fragments.</p></div></div><div class="top"><p class="src"><a id="v:filterNotAlreadyInFlightWithPeer" class="def">filterNotAlreadyInFlightWithPeer</a> :: HasHeader header =&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (CandidateFragments header), <a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header, peerinfo)] -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (CandidateFragments header), peerinfo)] <a href="src/Ouroboros.Network.BlockFetch.Decision.html#filterNotAlreadyInFlightWithPeer" class="link">Source</a> <a href="#v:filterNotAlreadyInFlightWithPeer" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:prioritisePeerChains" class="def">prioritisePeerChains</a> :: <span class="keyword">forall</span> extra header peer. (HasHeader header, Hashable peer, <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> peer) =&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; (AnchoredFragment header -&gt; AnchoredFragment header -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ordering" title="Data.Ord">Ordering</a>) -&gt; (header -&gt; <a href="Ouroboros-Network-DeltaQ.html#t:SizeInBytes" title="Ouroboros.Network.DeltaQ">SizeInBytes</a>) -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (CandidateFragments header), <a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header, <a href="Ouroboros-Network-DeltaQ.html#t:PeerGSV" title="Ouroboros.Network.DeltaQ">PeerGSV</a>, peer, extra)] -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> [AnchoredFragment header], extra)] <a href="src/Ouroboros.Network.BlockFetch.Decision.html#prioritisePeerChains" class="link">Source</a> <a href="#v:prioritisePeerChains" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:filterNotAlreadyInFlightWithOtherPeers" class="def">filterNotAlreadyInFlightWithOtherPeers</a> :: HasHeader header =&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> [AnchoredFragment header], <a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header, <a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header, peerinfo)] -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> [AnchoredFragment header], peerinfo)] <a href="src/Ouroboros.Network.BlockFetch.Decision.html#filterNotAlreadyInFlightWithOtherPeers" class="link">Source</a> <a href="#v:filterNotAlreadyInFlightWithOtherPeers" class="selflink">#</a></p><div class="doc"><p>A penultimate step of filtering, but this time across peers, rather than
 individually for each peer. If we're following the parallel fetch
 mode then we filter out blocks that are already in-flight with other
 peers.</p><p>Note that this does <em>not</em> cover blocks that are proposed to be fetched in
 this round of decisions. That step is covered  in <code><a href="Ouroboros-Network-BlockFetch-Decision.html#v:fetchRequestDecisions" title="Ouroboros.Network.BlockFetch.Decision">fetchRequestDecisions</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:fetchRequestDecisions" class="def">fetchRequestDecisions</a> :: <span class="keyword">forall</span> extra header peer. (Hashable peer, HasHeader header, <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> peer) =&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecisionPolicy" title="Ouroboros.Network.BlockFetch.Decision">FetchDecisionPolicy</a> header -&gt; <a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchMode" title="Ouroboros.Network.BlockFetch.Decision">FetchMode</a> -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> [AnchoredFragment header], <a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchStatus" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchStatus</a> header, <a href="Ouroboros-Network-BlockFetch-ClientState.html#t:PeerFetchInFlight" title="Ouroboros.Network.BlockFetch.ClientState">PeerFetchInFlight</a> header, <a href="Ouroboros-Network-DeltaQ.html#t:PeerGSV" title="Ouroboros.Network.DeltaQ">PeerGSV</a>, peer, extra)] -&gt; [(<a href="Ouroboros-Network-BlockFetch-Decision.html#t:FetchDecision" title="Ouroboros.Network.BlockFetch.Decision">FetchDecision</a> (<a href="Ouroboros-Network-BlockFetch-ClientState.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.ClientState">FetchRequest</a> header), extra)] <a href="src/Ouroboros.Network.BlockFetch.Decision.html#fetchRequestDecisions" class="link">Source</a> <a href="#v:fetchRequestDecisions" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.1</p></div></body></html>