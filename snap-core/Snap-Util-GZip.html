<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Snap.Util.GZip</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">snap-core-1.0.5.1: Snap: A Haskell Web Framework (core interfaces and types)</span><ul class="links" id="page-menu"><li id="quick-jump-button"><a href="#">Quick Jump</a></li><li><a href="src/Snap.Util.GZip.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Snap.Util.GZip</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Helpers for running a <code>Snap</code> web handler with compression.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:withCompression">withCompression</a> :: <a href="Snap-Internal-Core.html#t:MonadSnap" title="Snap.Internal.Core">MonadSnap</a> m =&gt; m a -&gt; m ()</li><li class="src short"><a href="#v:withCompression-39-">withCompression'</a> :: <a href="Snap-Internal-Core.html#t:MonadSnap" title="Snap.Internal.Core">MonadSnap</a> m =&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/Data-Set.html#t:Set" title="Data.Set">Set</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> -&gt; m a -&gt; m ()</li><li class="src short"><a href="#v:noCompression">noCompression</a> :: <a href="Snap-Internal-Core.html#t:MonadSnap" title="Snap.Internal.Core">MonadSnap</a> m =&gt; m ()</li><li class="src short"><span class="keyword">data</span> <a href="#t:BadAcceptEncodingException">BadAcceptEncodingException</a></li><li class="src short"><a href="#v:compressibleMimeTypes">compressibleMimeTypes</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/Data-Set.html#t:Set" title="Data.Set">Set</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:withCompression" class="def">withCompression</a> <a href="src/Snap.Util.GZip.html#withCompression" class="link">Source</a> <a href="#v:withCompression" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Snap-Internal-Core.html#t:MonadSnap" title="Snap.Internal.Core">MonadSnap</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; m a</td><td class="doc"><p>the web handler to run</p></td></tr><tr><td class="src">-&gt; m ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Runs a <code>Snap</code> web handler with compression if available.</p><p>If the client has indicated support for <code>gzip</code> or <code>deflate</code> in its
 <code>Accept-Encoding</code> header, and the <code>Content-Type</code> in the response is one of
 the following types:</p><ul><li><pre>application/x-javascript</pre></li><li><pre>application/json</pre></li><li><pre>text/css</pre></li><li><pre>text/html</pre></li><li><pre>text/javascript</pre></li><li><pre>text/plain</pre></li><li><pre>text/xml</pre></li><li><pre>application/x-font-truetype</pre></li></ul><p>Then the given handler's output stream will be compressed,
 <code>Content-Encoding</code> will be set in the output headers, and the
 <code>Content-Length</code> will be cleared if it was set. (We can't process the
 stream in O(1) space if the length is known beforehand.)</p><p>The wrapped handler will be run to completion, and then the <code>Response</code>
 that's contained within the <code>Snap</code> monad state will be passed to
 <code><a href="Snap-Internal-Core.html#v:finishWith" title="Snap.Internal.Core">finishWith</a></code> to prevent further processing.</p><p>Example:</p><pre>ghci&gt; :set -XOverloadedStrings
ghci&gt; import qualified <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/Data-Map.html">Data.Map</a> as M
ghci&gt; import qualified <a href="Snap-Test.html">Snap.Test</a> as T
ghci&gt; let r = T.get &quot;/&quot; M.empty &gt;&gt; T.addHeader &quot;Accept-Encoding&quot; &quot;gzip,deflate&quot;
ghci&gt; let h = <code><a href="Snap-Internal-Core.html#v:modifyResponse" title="Snap.Internal.Core">modifyResponse</a></code> (<code><a href="Snap-Core.html#v:setContentType" title="Snap.Core">setContentType</a></code> &quot;text/plain&quot;) &gt;&gt; <code><a href="Snap-Core.html#v:writeBS" title="Snap.Core">writeBS</a></code> &quot;some text&quot;
ghci&gt; T.runHandler r h
HTTP/1.1 200 OK
content-type: text/plain
server: Snap/test
date: Fri, 08 Aug 2014 15:40:45 GMT

some text
ghci&gt; T.runHandler r (<code><a href="Snap-Util-GZip.html#v:withCompression" title="Snap.Util.GZip">withCompression</a></code> h)
HTTP/1.1 200 OK
content-type: text/plain
vary: Accept-Encoding
content-encoding: gzip
server: Snap/test
date: Fri, 08 Aug 2014 15:40:10 GMT


</pre></div></div><div class="top"><p class="src"><a id="v:withCompression-39-" class="def">withCompression'</a> <a href="src/Snap.Util.GZip.html#withCompression%27" class="link">Source</a> <a href="#v:withCompression-39-" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Snap-Internal-Core.html#t:MonadSnap" title="Snap.Internal.Core">MonadSnap</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/Data-Set.html#t:Set" title="Data.Set">Set</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a></td><td class="doc"><p>set of compressible MIME types</p></td></tr><tr><td class="src">-&gt; m a</td><td class="doc"><p>the web handler to run</p></td></tr><tr><td class="src">-&gt; m ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>The same as <code><a href="Snap-Util-GZip.html#v:withCompression" title="Snap.Util.GZip">withCompression</a></code>, with control over which MIME types to
 compress.</p></div></div><div class="top"><p class="src"><a id="v:noCompression" class="def">noCompression</a> :: <a href="Snap-Internal-Core.html#t:MonadSnap" title="Snap.Internal.Core">MonadSnap</a> m =&gt; m () <a href="src/Snap.Util.GZip.html#noCompression" class="link">Source</a> <a href="#v:noCompression" class="selflink">#</a></p><div class="doc"><p>Turn off compression by setting &quot;Content-Encoding: identity&quot; in the
 response headers. <code><a href="Snap-Util-GZip.html#v:withCompression" title="Snap.Util.GZip">withCompression</a></code> is a no-op when a content-encoding is
 already set.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:BadAcceptEncodingException" class="def">BadAcceptEncodingException</a> <a href="src/Snap.Util.GZip.html#BadAcceptEncodingException" class="link">Source</a> <a href="#t:BadAcceptEncodingException" class="selflink">#</a></p><div class="doc"><p>Thrown when the 'Accept-Encoding' request header has invalid format.</p></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:BadAcceptEncodingException">Instances</h4><details id="i:BadAcceptEncodingException" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:BadAcceptEncodingException:Exception:1"></span> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Control-Exception-Base.html#t:Exception" title="Control.Exception.Base">Exception</a> <a href="Snap-Util-GZip.html#t:BadAcceptEncodingException" title="Snap.Util.GZip">BadAcceptEncodingException</a></span> <a href="src/Snap.Util.GZip.html#line-263" class="link">Source</a> <a href="#t:BadAcceptEncodingException" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:BadAcceptEncodingException:Exception:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Snap-Util-GZip.html">Snap.Util.GZip</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:toException">toException</a> :: <a href="Snap-Util-GZip.html#t:BadAcceptEncodingException" title="Snap.Util.GZip">BadAcceptEncodingException</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Control-Exception-Base.html#t:SomeException" title="Control.Exception.Base">SomeException</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:toException" class="selflink">#</a></p><p class="src"><a href="#v:fromException">fromException</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Control-Exception-Base.html#t:SomeException" title="Control.Exception.Base">SomeException</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="Snap-Util-GZip.html#t:BadAcceptEncodingException" title="Snap.Util.GZip">BadAcceptEncodingException</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:fromException" class="selflink">#</a></p><p class="src"><a href="#v:displayException">displayException</a> :: <a href="Snap-Util-GZip.html#t:BadAcceptEncodingException" title="Snap.Util.GZip">BadAcceptEncodingException</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:displayException" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:BadAcceptEncodingException:Show:2"></span> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Snap-Util-GZip.html#t:BadAcceptEncodingException" title="Snap.Util.GZip">BadAcceptEncodingException</a></span> <a href="src/Snap.Util.GZip.html#line-258" class="link">Source</a> <a href="#t:BadAcceptEncodingException" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:BadAcceptEncodingException:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Snap-Util-GZip.html">Snap.Util.GZip</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Snap-Util-GZip.html#t:BadAcceptEncodingException" title="Snap.Util.GZip">BadAcceptEncodingException</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Snap-Util-GZip.html#t:BadAcceptEncodingException" title="Snap.Util.GZip">BadAcceptEncodingException</a> -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Snap-Util-GZip.html#t:BadAcceptEncodingException" title="Snap.Util.GZip">BadAcceptEncodingException</a>] -&gt; <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:compressibleMimeTypes" class="def">compressibleMimeTypes</a> :: <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/Data-Set.html#t:Set" title="Data.Set">Set</a> <a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> <a href="src/Snap.Util.GZip.html#compressibleMimeTypes" class="link">Source</a> <a href="#v:compressibleMimeTypes" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.1</p></div></body></html>