<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns              #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE CPP                       #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable        #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ExistentialQuantification #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts          #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings         #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables       #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Snap.Internal.Util.FileUploads</span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Functions</span></span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#handleFormUploads"><span class="hs-identifier">handleFormUploads</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#foldMultipart"><span class="hs-identifier">foldMultipart</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartFold"><span class="hs-identifier">PartFold</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FormParam"><span class="hs-identifier">FormParam</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FormFile"><span class="hs-identifier">FormFile</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#storeAsLazyByteString"><span class="hs-identifier">storeAsLazyByteString</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#withTemporaryStore"><span class="hs-identifier">withTemporaryStore</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Backwards compatible API</span></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#handleFileUploads"><span class="hs-identifier">handleFileUploads</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#handleMultipart"><span class="hs-identifier">handleMultipart</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartProcessor"><span class="hs-identifier">PartProcessor</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Uploaded parts</span></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartInfo"><span class="hs-identifier">PartInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartDisposition"><span class="hs-identifier">PartDisposition</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#toPartDisposition"><span class="hs-identifier">toPartDisposition</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Policy</span></span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><span class="hs-comment">-- *** General upload policy</span></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier">UploadPolicy</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#defaultUploadPolicy"><span class="hs-identifier">defaultUploadPolicy</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#doProcessFormInputs"><span class="hs-identifier">doProcessFormInputs</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setProcessFormInputs"><span class="hs-identifier">setProcessFormInputs</span></a></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#getMaximumFormInputSize"><span class="hs-identifier">getMaximumFormInputSize</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setMaximumFormInputSize"><span class="hs-identifier">setMaximumFormInputSize</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#getMaximumNumberOfFormInputs"><span class="hs-identifier">getMaximumNumberOfFormInputs</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setMaximumNumberOfFormInputs"><span class="hs-identifier">setMaximumNumberOfFormInputs</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#getMinimumUploadRate"><span class="hs-identifier">getMinimumUploadRate</span></a></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setMinimumUploadRate"><span class="hs-identifier">setMinimumUploadRate</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#getMinimumUploadSeconds"><span class="hs-identifier">getMinimumUploadSeconds</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setMinimumUploadSeconds"><span class="hs-identifier">setMinimumUploadSeconds</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#getUploadTimeout"><span class="hs-identifier">getUploadTimeout</span></a></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setUploadTimeout"><span class="hs-identifier">setUploadTimeout</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><span class="hs-comment">-- *** File upload policy</span></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadPolicy"><span class="hs-identifier">FileUploadPolicy</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#defaultFileUploadPolicy"><span class="hs-identifier">defaultFileUploadPolicy</span></a></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setMaximumFileSize"><span class="hs-identifier">setMaximumFileSize</span></a></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setMaximumNumberOfFiles"><span class="hs-identifier">setMaximumNumberOfFiles</span></a></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setSkipFilesWithoutNames"><span class="hs-identifier">setSkipFilesWithoutNames</span></a></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setMaximumSkippedFileSize"><span class="hs-identifier">setMaximumSkippedFileSize</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="hs-comment">-- *** Per-file upload policy</span></span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartUploadPolicy"><span class="hs-identifier">PartUploadPolicy</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#disallow"><span class="hs-identifier">disallow</span></a></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#allowWithMaximumSize"><span class="hs-identifier">allowWithMaximumSize</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Exceptions</span></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadException"><span class="hs-identifier">FileUploadException</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#fileUploadExceptionReason"><span class="hs-identifier">fileUploadExceptionReason</span></a></span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#BadPartException"><span class="hs-identifier">BadPartException</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier">PolicyViolationException</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Applicative.html"><span class="hs-identifier">Control.Applicative</span></a></span><span>              </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Alternative"><span class="hs-identifier">Alternative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator">(&lt;|&gt;)</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Applicative"><span class="hs-identifier">Applicative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier">pure</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2A%3E"><span class="hs-operator">(*&gt;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%2A"><span class="hs-operator">(&lt;*)</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Arrow.html"><span class="hs-identifier">Control.Arrow</span></a></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Arrow.html#Arrow"><span class="hs-identifier">Arrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Arrow.html#first"><span class="hs-identifier">first</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Exception.Lifted</span></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#Exception"><span class="hs-identifier">Exception</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier">SomeException</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">bracket</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">catch</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">finally</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier">fromException</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mask</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwIO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#toException"><span class="hs-identifier">toException</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception.Lifted</span></span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">try</span></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Functor"><span class="hs-identifier">Functor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier">fmap</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Monad"><span class="hs-identifier">Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier">return</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator">(&gt;&gt;=)</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#MonadPlus"><span class="hs-identifier">MonadPlus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mzero"><span class="hs-identifier">mzero</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier">forM_</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html#guard"><span class="hs-identifier">guard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#liftM"><span class="hs-identifier">liftM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Traversable.html#sequence"><span class="hs-identifier">sequence</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html#unless"><span class="hs-identifier">unless</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#void"><span class="hs-identifier">void</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#when"><span class="hs-identifier">when</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html#%3E%3D%3E"><span class="hs-operator">(&gt;=&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.IO.Class.html"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span>           </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier">liftIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Attoparsec.ByteString.Char8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Parser</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isEndOfLine</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">string</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeWhile</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Attoparsec.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Atto</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">try</span></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Char8.html"><span class="hs-identifier">Data.ByteString.Char8</span></a></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Char8.html"><span class="hs-identifier">Data.ByteString.Char8</span></a></span><span>            </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.html"><span class="hs-identifier">Data.ByteString.Internal</span></a></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#c2w"><span class="hs-identifier">c2w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html"><span class="hs-identifier">Data.ByteString.Lazy.Internal</span></a></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LB</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier">ByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#Empty"><span class="hs-identifier">Empty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#chunk"><span class="hs-identifier">chunk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.CaseInsensitive</span></span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CI</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mk</span></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Int.html"><span class="hs-identifier">Data.Int</span></a></span><span>                         </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier">Int64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>                       </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IORef</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#find"><span class="hs-identifier">find</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#map"><span class="hs-identifier">map</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator">(++)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span>                         </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insertWith"><span class="hs-identifier">insertWith</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>                       </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier">fromMaybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#isJust"><span class="hs-identifier">isJust</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#maybe"><span class="hs-identifier">maybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.html"><span class="hs-identifier">Data.Text</span></a></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.html"><span class="hs-identifier">Data.Text</span></a></span><span>                        </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.html#concat"><span class="hs-identifier">concat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#pack"><span class="hs-identifier">pack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Show.html#unpack"><span class="hs-identifier">unpack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Encoding.html"><span class="hs-identifier">Data.Text.Encoding</span></a></span><span>               </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Encoding.html#decodeUtf8"><span class="hs-identifier">decodeUtf8</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.html"><span class="hs-identifier">Data.Typeable</span></a></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier">Typeable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.html#cast"><span class="hs-identifier">cast</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Prelude.html"><span class="hs-identifier">Prelude</span></a></span><span>                          </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier">Bool</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Double"><span class="hs-identifier">Double</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Either"><span class="hs-identifier">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#FilePath"><span class="hs-identifier">FilePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier">IO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier">Ord</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier">String</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier">const</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#either"><span class="hs-identifier">either</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier">foldr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier">fst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#id"><span class="hs-identifier">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#max"><span class="hs-identifier">max</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#not"><span class="hs-identifier">not</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#otherwise"><span class="hs-identifier">otherwise</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Prim.html#seq"><span class="hs-identifier">seq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier">snd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Enum.html#succ"><span class="hs-identifier">succ</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator">($)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24%21"><span class="hs-operator">($!)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator">(.)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#%5E"><span class="hs-operator">(^)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator">(||)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Snap.Core.html"><span class="hs-identifier">Snap.Core</span></a></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Http.Types.html#HasHeaders"><span class="hs-identifier">HasHeaders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Http.Types.html#headers"><span class="hs-identifier">headers</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Types.Headers.html#Headers"><span class="hs-identifier">Headers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Core.html#MonadSnap"><span class="hs-identifier">MonadSnap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#Request"><span class="hs-identifier">Request</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Http.Types.html#rqParams"><span class="hs-identifier">rqParams</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#rqPostParams"><span class="hs-identifier">rqPostParams</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#getHeader"><span class="hs-identifier">getHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Core.html#getRequest"><span class="hs-identifier">getRequest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Core.html#getTimeoutModifier"><span class="hs-identifier">getTimeoutModifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Core.html#putRequest"><span class="hs-identifier">putRequest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Core.html#runRequestBody"><span class="hs-identifier">runRequestBody</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Snap.Internal.Parsing.html"><span class="hs-identifier">Snap.Internal.Parsing</span></a></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Parsing.html#crlf"><span class="hs-identifier">crlf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Parsing.html#fullyParse"><span class="hs-identifier">fullyParse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Parsing.html#pContentTypeWithParameters"><span class="hs-identifier">pContentTypeWithParameters</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Parsing.html#pHeaders"><span class="hs-identifier">pHeaders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Parsing.html#pValueWithParameters%27"><span class="hs-identifier">pValueWithParameters'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Snap.Types.Headers.html"><span class="hs-identifier">Snap.Types.Headers</span></a></span><span>               </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">H</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Types.Headers.html#fromList"><span class="hs-identifier">fromList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/directory-1.3.8.1/src/System.Directory.html"><span class="hs-identifier">System.Directory</span></a></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/directory-1.3.8.1/src/System.Directory.html#removeFile"><span class="hs-identifier">removeFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/template-haskell-2.20.0.0/src/System.FilePath.html"><span class="hs-identifier">System.FilePath</span></a></span><span>                  </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/filepath-1.4.100.4/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator">(&lt;/&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/System.IO.html"><span class="hs-identifier">System.IO</span></a></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Handle.Types.html#BufferMode"><span class="hs-identifier">BufferMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Handle.Types.html#NoBuffering"><span class="hs-identifier">NoBuffering</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier">Handle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Handle.html#hClose"><span class="hs-identifier">hClose</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Handle.html#hSetBuffering"><span class="hs-identifier">hSetBuffering</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/System.IO.html#openBinaryTempFile"><span class="hs-identifier">openBinaryTempFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/System.IO.Error.html"><span class="hs-identifier">System.IO.Error</span></a></span><span>                  </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/System.IO.Error.html#isDoesNotExistError"><span class="hs-identifier">isDoesNotExistError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.IO.Streams</span></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">InputStream</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MatchInfo</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TooManyBytesReadException</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">search</span></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Streams</span></span><span>                </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Streams</span></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.IO.Streams.Attoparsec</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">parseFromStream</span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.PosixCompat.Temp</span></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/unix-2.8.1.0/src/System.Posix.Temp.html#mkstemp"><span class="hs-identifier">mkstemp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- | Reads uploaded files into a temporary directory and calls a user handler</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- to process them.</span><span>
</span><span id="line-105"></span><span class="hs-comment">--</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- Note: /THE REQUEST MUST BE CORRECTLY ENCODED/. If the request's</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- @Content-type@ is not \&quot;@multipart/formdata@\&quot;, this function skips</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- processing using 'pass'.</span><span>
</span><span id="line-109"></span><span class="hs-comment">--</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- Given a temporary directory, global and file-specific upload policies, and a</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- user handler, this function consumes a request body uploaded with</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- @Content-type: multipart/form-data@. Each file is read into the temporary</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- directory, and is then passed to the user handler. After the user handler</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- runs (but before the 'Response' body is streamed to the client), the files</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- are deleted from disk; so if you want to retain or use the uploaded files in</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- the generated response, you need to move or otherwise process them.</span><span>
</span><span id="line-117"></span><span class="hs-comment">--</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- The argument passed to the user handler is a tuple:</span><span>
</span><span id="line-119"></span><span class="hs-comment">--</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- &gt; (PartInfo, Either PolicyViolationException FilePath)</span><span>
</span><span id="line-121"></span><span class="hs-comment">--</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- The first half of this tuple is a 'PartInfo', which contains the</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- information the client browser sent about the given upload part (like</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- filename, content-type, etc). The second half of this tuple is an 'Either'</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- stipulating that either:</span><span>
</span><span id="line-126"></span><span class="hs-comment">--</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- 1. the file was rejected on a policy basis because of the provided</span><span>
</span><span id="line-128"></span><span class="hs-comment">--    'PartUploadPolicy' handler</span><span>
</span><span id="line-129"></span><span class="hs-comment">--</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- 2. the file was accepted and exists at the given path.</span><span>
</span><span id="line-131"></span><span class="hs-comment">--</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- /Exceptions/</span><span>
</span><span id="line-133"></span><span class="hs-comment">--</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- If the client's upload rate passes below the configured minimum (see</span><span>
</span><span id="line-135"></span><span class="hs-comment">-- 'setMinimumUploadRate' and 'setMinimumUploadSeconds'), this function</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- terminates the connection. This setting is there to protect the server</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- against slowloris-style denial of service attacks.</span><span>
</span><span id="line-138"></span><span class="hs-comment">--</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- If the given 'UploadPolicy' stipulates that you wish form inputs to be</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- placed in the 'rqParams' parameter map (using 'setProcessFormInputs'), and</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- a form input exceeds the maximum allowable size, this function will throw a</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- 'PolicyViolationException'.</span><span>
</span><span id="line-143"></span><span class="hs-comment">--</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- If an uploaded part contains MIME headers longer than a fixed internal</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- threshold (currently 32KB), this function will throw a 'BadPartException'.</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span id="local-6989586621679117327"><span id="local-6989586621679117334"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#handleFileUploads"><span class="hs-identifier hs-type">handleFileUploads</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-148"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Core.html#MonadSnap"><span class="hs-identifier hs-type">MonadSnap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117327"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-149"></span><span>       </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>                       </span><span class="annot"><span class="hs-comment">-- ^ temporary directory</span></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ general upload policy</span></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartInfo"><span class="hs-identifier hs-type">PartInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartUploadPolicy"><span class="hs-identifier hs-type">PartUploadPolicy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ per-part upload policy</span></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartInfo"><span class="hs-identifier hs-type">PartInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-type">PolicyViolationException</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117334"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>                                      </span><span class="hs-comment">-- ^ user handler (see function</span><span>
</span><span id="line-154"></span><span>                                      </span><span class="hs-comment">-- description)</span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679117327"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679117334"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-156"></span><span id="handleFileUploads"><span class="annot"><span class="annottext">handleFileUploads :: forall (m :: * -&gt; *) a.
MonadSnap m =&gt;
FilePath
-&gt; UploadPolicy
-&gt; (PartInfo -&gt; PartUploadPolicy)
-&gt; (PartInfo -&gt; Either PolicyViolationException FilePath -&gt; IO a)
-&gt; m [a]
</span><a href="Snap.Internal.Util.FileUploads.html#handleFileUploads"><span class="hs-identifier hs-var hs-var">handleFileUploads</span></a></span></span><span> </span><span id="local-6989586621679117720"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679117720"><span class="hs-identifier hs-var">tmpdir</span></a></span></span><span> </span><span id="local-6989586621679117721"><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679117721"><span class="hs-identifier hs-var">uploadPolicy</span></a></span></span><span> </span><span id="local-6989586621679117722"><span class="annot"><span class="annottext">PartInfo -&gt; PartUploadPolicy
</span><a href="#local-6989586621679117722"><span class="hs-identifier hs-var">partPolicy</span></a></span></span><span> </span><span id="local-6989586621679117723"><span class="annot"><span class="annottext">PartInfo -&gt; Either PolicyViolationException FilePath -&gt; IO a
</span><a href="#local-6989586621679117723"><span class="hs-identifier hs-var">partHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><span class="annottext">UploadPolicy -&gt; PartProcessor a -&gt; m [a]
forall (m :: * -&gt; *) a.
MonadSnap m =&gt;
UploadPolicy -&gt; PartProcessor a -&gt; m [a]
</span><a href="Snap.Internal.Util.FileUploads.html#handleMultipart"><span class="hs-identifier hs-var">handleMultipart</span></a></span><span> </span><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679117721"><span class="hs-identifier hs-var">uploadPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">PartProcessor a
</span><a href="#local-6989586621679117724"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621679117724"><span class="annot"><span class="annottext">go :: PartProcessor a
</span><a href="#local-6989586621679117724"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679117725"><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117725"><span class="hs-identifier hs-var">partInfo</span></a></span></span><span> </span><span id="local-6989586621679117726"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679117726"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; (Int64 -&gt; IO a) -&gt; Maybe Int64 -&gt; IO a
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679117727"><span class="hs-identifier hs-var">disallowed</span></a></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; IO a
</span><a href="#local-6989586621679117728"><span class="hs-identifier hs-var">takeIt</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int64
</span><a href="#local-6989586621679117729"><span class="hs-identifier hs-var">mbFs</span></a></span><span>
</span><span id="line-161"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-162"></span><span>        </span><span id="local-6989586621679117730"><span class="annot"><span class="annottext">ctText :: ByteString
</span><a href="#local-6989586621679117730"><span class="hs-identifier hs-var hs-var">ctText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartInfo -&gt; ByteString
</span><a href="Snap.Internal.Util.FileUploads.html#partContentType"><span class="hs-identifier hs-var">partContentType</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117725"><span class="hs-identifier hs-var">partInfo</span></a></span><span>
</span><span id="line-163"></span><span>        </span><span id="local-6989586621679117733"><span class="annot"><span class="annottext">fnText :: ByteString
</span><a href="#local-6989586621679117733"><span class="hs-identifier hs-var hs-var">fnText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString -&gt; ByteString
forall a. a -&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ByteString -&gt; ByteString) -&gt; Maybe ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo -&gt; Maybe ByteString
</span><a href="Snap.Internal.Util.FileUploads.html#partFileName"><span class="hs-identifier hs-var">partFileName</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117725"><span class="hs-identifier hs-var">partInfo</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>        </span><span id="local-6989586621679117735"><span class="annot"><span class="annottext">ct :: Text
</span><a href="#local-6989586621679117735"><span class="hs-identifier hs-var hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Encoding.html#decodeUtf8"><span class="hs-identifier hs-var">TE.decodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117730"><span class="hs-identifier hs-var">ctText</span></a></span><span>
</span><span id="line-166"></span><span>        </span><span id="local-6989586621679117736"><span class="annot"><span class="annottext">fn :: Text
</span><a href="#local-6989586621679117736"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Encoding.html#decodeUtf8"><span class="hs-identifier hs-var">TE.decodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117733"><span class="hs-identifier hs-var">fnText</span></a></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartUploadPolicy"><span class="hs-identifier hs-type">PartUploadPolicy</span></a></span><span> </span><span id="local-6989586621679117729"><span class="annot"><span class="annottext">Maybe Int64
</span><a href="#local-6989586621679117729"><span class="hs-identifier hs-var">mbFs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartInfo -&gt; PartUploadPolicy
</span><a href="#local-6989586621679117722"><span class="hs-identifier hs-var">partPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117725"><span class="hs-identifier hs-var">partInfo</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>        </span><span id="local-6989586621679117728"><span class="annot"><span class="annottext">takeIt :: Int64 -&gt; IO a
</span><a href="#local-6989586621679117728"><span class="hs-identifier hs-var hs-var">takeIt</span></a></span></span><span> </span><span id="local-6989586621679117744"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679117744"><span class="hs-identifier hs-var">maxSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>            </span><span id="local-6989586621679117745"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679117745"><span class="hs-identifier hs-var">str'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; InputStream ByteString -&gt; IO (InputStream ByteString)
</span><span class="hs-identifier hs-var">Streams.throwIfProducesMoreThan</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679117744"><span class="hs-identifier hs-var">maxSize</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679117726"><span class="hs-identifier hs-var">stream</span></a></span><span>
</span><span id="line-172"></span><span>            </span><span class="annot"><span class="annottext">FilePath
-&gt; (PartInfo -&gt; Either PolicyViolationException FilePath -&gt; IO a)
-&gt; PartProcessor a
forall a.
FilePath
-&gt; (PartInfo -&gt; Either PolicyViolationException FilePath -&gt; IO a)
-&gt; PartProcessor a
</span><a href="Snap.Internal.Util.FileUploads.html#fileReader"><span class="hs-identifier hs-var">fileReader</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679117720"><span class="hs-identifier hs-var">tmpdir</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo -&gt; Either PolicyViolationException FilePath -&gt; IO a
</span><a href="#local-6989586621679117723"><span class="hs-identifier hs-var">partHandler</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117725"><span class="hs-identifier hs-var">partInfo</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679117745"><span class="hs-identifier hs-var">str'</span></a></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; (TooManyBytesReadException -&gt; IO a) -&gt; IO a
forall (m :: * -&gt; *) e a.
(MonadBaseControl IO m, Exception e) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catch`</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; TooManyBytesReadException -&gt; IO a
forall {a}. Show a =&gt; a -&gt; TooManyBytesReadException -&gt; IO a
</span><a href="#local-6989586621679117748"><span class="hs-identifier hs-var">tooMany</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679117744"><span class="hs-identifier hs-var">maxSize</span></a></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>        </span><span id="local-6989586621679117748"><span class="annot"><span class="annottext">tooMany :: a -&gt; TooManyBytesReadException -&gt; IO a
</span><a href="#local-6989586621679117748"><span class="hs-identifier hs-var hs-var">tooMany</span></a></span></span><span> </span><span id="local-6989586621679117754"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117754"><span class="hs-identifier hs-var">maxSize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TooManyBytesReadException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TooManyBytesReadException</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-175"></span><span>            </span><span class="annot"><span class="annottext">PartInfo -&gt; Either PolicyViolationException FilePath -&gt; IO a
</span><a href="#local-6989586621679117723"><span class="hs-identifier hs-var">partHandler</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117725"><span class="hs-identifier hs-var">partInfo</span></a></span><span>
</span><span id="line-176"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyViolationException
-&gt; Either PolicyViolationException FilePath
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(PolicyViolationException
 -&gt; Either PolicyViolationException FilePath)
-&gt; PolicyViolationException
-&gt; Either PolicyViolationException FilePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-177"></span><span>                         </span><span class="annot"><span class="annottext">Text -&gt; PolicyViolationException
</span><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-var">PolicyViolationException</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; PolicyViolationException)
-&gt; Text -&gt; PolicyViolationException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-178"></span><span>                         </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.html#concat"><span class="hs-identifier hs-var">T.concat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;File \&quot;&quot;</span></span><span>
</span><span id="line-179"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117736"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-180"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\&quot; exceeded maximum allowable size &quot;</span></span><span>
</span><span id="line-181"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#pack"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Text) -&gt; FilePath -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117754"><span class="hs-identifier hs-var">maxSize</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>        </span><span id="local-6989586621679117727"><span class="annot"><span class="annottext">disallowed :: IO a
</span><a href="#local-6989586621679117727"><span class="hs-identifier hs-var hs-var">disallowed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-184"></span><span>            </span><span class="annot"><span class="annottext">PartInfo -&gt; Either PolicyViolationException FilePath -&gt; IO a
</span><a href="#local-6989586621679117723"><span class="hs-identifier hs-var">partHandler</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117725"><span class="hs-identifier hs-var">partInfo</span></a></span><span>
</span><span id="line-185"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyViolationException
-&gt; Either PolicyViolationException FilePath
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(PolicyViolationException
 -&gt; Either PolicyViolationException FilePath)
-&gt; PolicyViolationException
-&gt; Either PolicyViolationException FilePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-186"></span><span>                         </span><span class="annot"><span class="annottext">Text -&gt; PolicyViolationException
</span><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-var">PolicyViolationException</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; PolicyViolationException)
-&gt; Text -&gt; PolicyViolationException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-187"></span><span>                         </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.html#concat"><span class="hs-identifier hs-var">T.concat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Policy disallowed upload of file \&quot;&quot;</span></span><span>
</span><span id="line-188"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117736"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-189"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\&quot; with content-type \&quot;&quot;</span></span><span>
</span><span id="line-190"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117735"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-191"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\&quot;&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-195"></span><span class="annot"><span class="hs-comment">-- | Contents of form field of type @file@</span></span><span>
</span><span id="line-196"></span><span class="hs-keyword">data</span><span> </span><span id="FormFile"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FormFile"><span class="hs-identifier hs-var">FormFile</span></a></span></span><span> </span><span id="local-6989586621679117359"><span class="annot"><a href="#local-6989586621679117359"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FormFile"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FormFile"><span class="hs-identifier hs-var">FormFile</span></a></span></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="formFileName"><span class="annot"><span class="annottext">forall a. FormFile a -&gt; ByteString
</span><a href="Snap.Internal.Util.FileUploads.html#formFileName"><span class="hs-identifier hs-var hs-var">formFileName</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-198"></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Name of a field</span></span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="formFileValue"><span class="annot"><span class="annottext">forall a. FormFile a -&gt; a
</span><a href="Snap.Internal.Util.FileUploads.html#formFileValue"><span class="hs-identifier hs-var hs-var">formFileValue</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679117359"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-200"></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Result of storing file</span></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679117764"><span id="local-6989586621679117768"><span class="annot"><span class="annottext">FormFile a -&gt; FormFile a -&gt; Bool
(FormFile a -&gt; FormFile a -&gt; Bool)
-&gt; (FormFile a -&gt; FormFile a -&gt; Bool) -&gt; Eq (FormFile a)
forall a. Eq a =&gt; FormFile a -&gt; FormFile a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall a. Eq a =&gt; FormFile a -&gt; FormFile a -&gt; Bool
== :: FormFile a -&gt; FormFile a -&gt; Bool
$c/= :: forall a. Eq a =&gt; FormFile a -&gt; FormFile a -&gt; Bool
/= :: FormFile a -&gt; FormFile a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679117777"><span id="local-6989586621679117782"><span id="local-6989586621679117786"><span id="local-6989586621679117790"><span id="local-6989586621679117793"><span id="local-6989586621679117796"><span id="local-6989586621679117799"><span class="annot"><span class="annottext">Eq (FormFile a)
Eq (FormFile a) =&gt;
(FormFile a -&gt; FormFile a -&gt; Ordering)
-&gt; (FormFile a -&gt; FormFile a -&gt; Bool)
-&gt; (FormFile a -&gt; FormFile a -&gt; Bool)
-&gt; (FormFile a -&gt; FormFile a -&gt; Bool)
-&gt; (FormFile a -&gt; FormFile a -&gt; Bool)
-&gt; (FormFile a -&gt; FormFile a -&gt; FormFile a)
-&gt; (FormFile a -&gt; FormFile a -&gt; FormFile a)
-&gt; Ord (FormFile a)
FormFile a -&gt; FormFile a -&gt; Bool
FormFile a -&gt; FormFile a -&gt; Ordering
FormFile a -&gt; FormFile a -&gt; FormFile a
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a. Ord a =&gt; Eq (FormFile a)
forall a. Ord a =&gt; FormFile a -&gt; FormFile a -&gt; Bool
forall a. Ord a =&gt; FormFile a -&gt; FormFile a -&gt; Ordering
forall a. Ord a =&gt; FormFile a -&gt; FormFile a -&gt; FormFile a
$ccompare :: forall a. Ord a =&gt; FormFile a -&gt; FormFile a -&gt; Ordering
compare :: FormFile a -&gt; FormFile a -&gt; Ordering
$c&lt; :: forall a. Ord a =&gt; FormFile a -&gt; FormFile a -&gt; Bool
&lt; :: FormFile a -&gt; FormFile a -&gt; Bool
$c&lt;= :: forall a. Ord a =&gt; FormFile a -&gt; FormFile a -&gt; Bool
&lt;= :: FormFile a -&gt; FormFile a -&gt; Bool
$c&gt; :: forall a. Ord a =&gt; FormFile a -&gt; FormFile a -&gt; Bool
&gt; :: FormFile a -&gt; FormFile a -&gt; Bool
$c&gt;= :: forall a. Ord a =&gt; FormFile a -&gt; FormFile a -&gt; Bool
&gt;= :: FormFile a -&gt; FormFile a -&gt; Bool
$cmax :: forall a. Ord a =&gt; FormFile a -&gt; FormFile a -&gt; FormFile a
max :: FormFile a -&gt; FormFile a -&gt; FormFile a
$cmin :: forall a. Ord a =&gt; FormFile a -&gt; FormFile a -&gt; FormFile a
min :: FormFile a -&gt; FormFile a -&gt; FormFile a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679117805"><span id="local-6989586621679117812"><span id="local-6989586621679117816"><span class="annot"><span class="annottext">Int -&gt; FormFile a -&gt; ShowS
[FormFile a] -&gt; ShowS
FormFile a -&gt; FilePath
(Int -&gt; FormFile a -&gt; ShowS)
-&gt; (FormFile a -&gt; FilePath)
-&gt; ([FormFile a] -&gt; ShowS)
-&gt; Show (FormFile a)
forall a. Show a =&gt; Int -&gt; FormFile a -&gt; ShowS
forall a. Show a =&gt; [FormFile a] -&gt; ShowS
forall a. Show a =&gt; FormFile a -&gt; FilePath
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; FilePath) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; FormFile a -&gt; ShowS
showsPrec :: Int -&gt; FormFile a -&gt; ShowS
$cshow :: forall a. Show a =&gt; FormFile a -&gt; FilePath
show :: FormFile a -&gt; FilePath
$cshowList :: forall a. Show a =&gt; [FormFile a] -&gt; ShowS
showList :: [FormFile a] -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-keyword">data</span><span> </span><span id="UploadState"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadState"><span class="hs-identifier hs-var">UploadState</span></a></span></span><span> </span><span id="local-6989586621679117372"><span class="annot"><a href="#local-6989586621679117372"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UploadState"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadState"><span class="hs-identifier hs-var">UploadState</span></a></span></span><span>
</span><span id="line-204"></span><span>     </span><span class="hs-special">{</span><span> </span><span id="numUploadedFiles"><span class="annot"><span class="annottext">forall a. UploadState a -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#numUploadedFiles"><span class="hs-identifier hs-var hs-var">numUploadedFiles</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-205"></span><span>     </span><span class="hs-special">,</span><span> </span><span id="uploadedFiles"><span class="annot"><span class="annottext">forall a. UploadState a -&gt; [FormFile a] -&gt; [FormFile a]
</span><a href="Snap.Internal.Util.FileUploads.html#uploadedFiles"><span class="hs-identifier hs-var hs-var">uploadedFiles</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FormFile"><span class="hs-identifier hs-type">FormFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117372"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FormFile"><span class="hs-identifier hs-type">FormFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117372"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">-- | Processes form data and calls provided storage function on</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- file parts.</span><span>
</span><span id="line-210"></span><span class="hs-comment">--</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- You can use this together with 'withTemporaryStore', 'storeAsLazyByteString'</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- or provide your own callback to store uploaded files.</span><span>
</span><span id="line-213"></span><span class="hs-comment">--</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- If you need to process uploaded file mime type or file name, do it in the</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- store callback function.</span><span>
</span><span id="line-216"></span><span class="hs-comment">--</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- See also 'foldMultipart'.</span><span>
</span><span id="line-218"></span><span class="hs-comment">--</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- Example using with small files which can safely be stored in memory.</span><span>
</span><span id="line-220"></span><span class="hs-comment">--</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-222"></span><span class="hs-comment">--</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- import qualified Data.ByteString.Lazy as Lazy</span><span>
</span><span id="line-224"></span><span class="hs-comment">--</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- handleSmallFiles :: MonadSnap m =&gt; [(ByteString, ByteString, Lazy.ByteString)]</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- handleSmallFiles = handleFormUploads uploadPolicy filePolicy store</span><span>
</span><span id="line-227"></span><span class="hs-comment">--</span><span>
</span><span id="line-228"></span><span class="hs-comment">--   where</span><span>
</span><span id="line-229"></span><span class="hs-comment">--     uploadPolicy = defaultUploadPolicy</span><span>
</span><span id="line-230"></span><span class="hs-comment">--     filePolicy = setMaximumFileSize (64*1024)</span><span>
</span><span id="line-231"></span><span class="hs-comment">--                  $ setMaximumNumberOfFiles 5</span><span>
</span><span id="line-232"></span><span class="hs-comment">--                    defaultUploadPolicy</span><span>
</span><span id="line-233"></span><span class="hs-comment">--     store partInfo stream = do</span><span>
</span><span id="line-234"></span><span class="hs-comment">--        content &lt;- storeAsLazyByteString partInfo stream</span><span>
</span><span id="line-235"></span><span class="hs-comment">--        let</span><span>
</span><span id="line-236"></span><span class="hs-comment">--          fileName = partFileName partInfo</span><span>
</span><span id="line-237"></span><span class="hs-comment">--          fileMime = partContentType partInfo</span><span>
</span><span id="line-238"></span><span class="hs-comment">--        in (fileName, fileMime, content)</span><span>
</span><span id="line-239"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-240"></span><span class="hs-comment">--</span><span>
</span><span id="line-241"></span><span id="local-6989586621679117376"><span id="local-6989586621679117378"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#handleFormUploads"><span class="hs-identifier hs-type">handleFormUploads</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-242"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Core.html#MonadSnap"><span class="hs-identifier hs-type">MonadSnap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117376"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-243"></span><span>       </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ general upload policy</span></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadPolicy"><span class="hs-identifier hs-type">FileUploadPolicy</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Upload policy for files</span></span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartInfo"><span class="hs-identifier hs-type">PartInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InputStream</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117378"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>                                      </span><span class="annot"><span class="hs-comment">-- ^ A file storage function</span></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679117376"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FormParam"><span class="hs-identifier hs-type">FormParam</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FormFile"><span class="hs-identifier hs-type">FormFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117378"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-248"></span><span id="handleFormUploads"><span class="annot"><span class="annottext">handleFormUploads :: forall (m :: * -&gt; *) a.
MonadSnap m =&gt;
UploadPolicy
-&gt; FileUploadPolicy
-&gt; (PartInfo -&gt; InputStream ByteString -&gt; IO a)
-&gt; m ([FormParam], [FormFile a])
</span><a href="Snap.Internal.Util.FileUploads.html#handleFormUploads"><span class="hs-identifier hs-var hs-var">handleFormUploads</span></a></span></span><span> </span><span id="local-6989586621679117828"><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679117828"><span class="hs-identifier hs-var">uploadPolicy</span></a></span></span><span> </span><span id="local-6989586621679117829"><span class="annot"><span class="annottext">FileUploadPolicy
</span><a href="#local-6989586621679117829"><span class="hs-identifier hs-var">filePolicy</span></a></span></span><span> </span><span id="local-6989586621679117830"><span class="annot"><span class="annottext">PartInfo -&gt; InputStream ByteString -&gt; IO a
</span><a href="#local-6989586621679117830"><span class="hs-identifier hs-var">partHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679117831"><span class="annot"><span class="annottext">[FormParam]
</span><a href="#local-6989586621679117831"><span class="hs-identifier hs-var">params</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679117832"><span class="annot"><span class="annottext">UploadState a
</span><a href="#local-6989586621679117832"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UploadPolicy
-&gt; PartFold (UploadState a)
-&gt; UploadState a
-&gt; m ([FormParam], UploadState a)
forall (m :: * -&gt; *) a.
MonadSnap m =&gt;
UploadPolicy -&gt; PartFold a -&gt; a -&gt; m ([FormParam], a)
</span><a href="Snap.Internal.Util.FileUploads.html#foldMultipart"><span class="hs-identifier hs-var">foldMultipart</span></a></span><span> </span><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679117828"><span class="hs-identifier hs-var">uploadPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">PartFold (UploadState a)
</span><a href="#local-6989586621679117833"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ([FormFile a] -&gt; [FormFile a]) -&gt; UploadState a
forall a. Int -&gt; ([FormFile a] -&gt; [FormFile a]) -&gt; UploadState a
</span><a href="Snap.Internal.Util.FileUploads.html#UploadState"><span class="hs-identifier hs-var">UploadState</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[FormFile a] -&gt; [FormFile a]
forall a. a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>    </span><span class="annot"><span class="annottext">([FormParam], [FormFile a]) -&gt; m ([FormParam], [FormFile a])
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FormParam]
</span><a href="#local-6989586621679117831"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UploadState a -&gt; [FormFile a] -&gt; [FormFile a]
forall a. UploadState a -&gt; [FormFile a] -&gt; [FormFile a]
</span><a href="Snap.Internal.Util.FileUploads.html#uploadedFiles"><span class="hs-identifier hs-var">uploadedFiles</span></a></span><span> </span><span class="annot"><span class="annottext">UploadState a
</span><a href="#local-6989586621679117832"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621679117833"><span class="annot"><span class="annottext">go :: PartFold (UploadState a)
</span><a href="#local-6989586621679117833"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679117838"><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117838"><span class="hs-identifier hs-var">partInfo</span></a></span></span><span> </span><span id="local-6989586621679117839"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679117839"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679117840"><span class="annot"><span class="annottext">UploadState a
</span><a href="#local-6989586621679117840"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679117841"><span class="hs-identifier hs-var">numUploads</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679117842"><span class="hs-identifier hs-var">maxFiles</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO ()
forall {a}. IO a
</span><a href="#local-6989586621679117843"><span class="hs-identifier hs-var">throwTooManyFiles</span></a></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PartInfo -&gt; Maybe ByteString
</span><a href="Snap.Internal.Util.FileUploads.html#partFileName"><span class="hs-identifier hs-var">partFileName</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117838"><span class="hs-identifier hs-var">partInfo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-256"></span><span>          </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (UploadState a)
</span><a href="#local-6989586621679117844"><span class="hs-identifier hs-var">onEmptyName</span></a></span><span>
</span><span id="line-257"></span><span>          </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (UploadState a)
</span><a href="#local-6989586621679117845"><span class="hs-identifier hs-var">takeIt</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-260"></span><span>        </span><span id="local-6989586621679117841"><span class="annot"><span class="annottext">numUploads :: Int
</span><a href="#local-6989586621679117841"><span class="hs-identifier hs-var hs-var">numUploads</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadState a -&gt; Int
forall a. UploadState a -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#numUploadedFiles"><span class="hs-identifier hs-var">numUploadedFiles</span></a></span><span> </span><span class="annot"><span class="annottext">UploadState a
</span><a href="#local-6989586621679117840"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span id="local-6989586621679117846"><span class="annot"><span class="annottext">files :: [FormFile a] -&gt; [FormFile a]
</span><a href="#local-6989586621679117846"><span class="hs-identifier hs-var hs-var">files</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadState a -&gt; [FormFile a] -&gt; [FormFile a]
forall a. UploadState a -&gt; [FormFile a] -&gt; [FormFile a]
</span><a href="Snap.Internal.Util.FileUploads.html#uploadedFiles"><span class="hs-identifier hs-var">uploadedFiles</span></a></span><span> </span><span class="annot"><span class="annottext">UploadState a
</span><a href="#local-6989586621679117840"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-262"></span><span>        </span><span id="local-6989586621679117842"><span class="annot"><span class="annottext">maxFiles :: Int
</span><a href="#local-6989586621679117842"><span class="hs-identifier hs-var hs-var">maxFiles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FileUploadPolicy -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#maxNumberOfFiles"><span class="hs-identifier hs-var">maxNumberOfFiles</span></a></span><span> </span><span class="annot"><span class="annottext">FileUploadPolicy
</span><a href="#local-6989586621679117829"><span class="hs-identifier hs-var">filePolicy</span></a></span><span>
</span><span id="line-263"></span><span>        </span><span id="local-6989586621679117848"><span class="annot"><span class="annottext">maxFileSize :: Int64
</span><a href="#local-6989586621679117848"><span class="hs-identifier hs-var hs-var">maxFileSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FileUploadPolicy -&gt; Int64
</span><a href="Snap.Internal.Util.FileUploads.html#maxFileUploadSize"><span class="hs-identifier hs-var">maxFileUploadSize</span></a></span><span> </span><span class="annot"><span class="annottext">FileUploadPolicy
</span><a href="#local-6989586621679117829"><span class="hs-identifier hs-var">filePolicy</span></a></span><span>
</span><span id="line-264"></span><span>        </span><span id="local-6989586621679117851"><span class="annot"><span class="annottext">fnText :: ByteString
</span><a href="#local-6989586621679117851"><span class="hs-identifier hs-var hs-var">fnText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString -&gt; ByteString
forall a. a -&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ByteString -&gt; ByteString) -&gt; Maybe ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo -&gt; Maybe ByteString
</span><a href="Snap.Internal.Util.FileUploads.html#partFileName"><span class="hs-identifier hs-var">partFileName</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117838"><span class="hs-identifier hs-var">partInfo</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span>        </span><span id="local-6989586621679117852"><span class="annot"><span class="annottext">fn :: Text
</span><a href="#local-6989586621679117852"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Encoding.html#decodeUtf8"><span class="hs-identifier hs-var">TE.decodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117851"><span class="hs-identifier hs-var">fnText</span></a></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>        </span><span id="local-6989586621679117845"><span class="annot"><span class="annottext">takeIt :: IO (UploadState a)
</span><a href="#local-6989586621679117845"><span class="hs-identifier hs-var hs-var">takeIt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-269"></span><span>            </span><span id="local-6989586621679117863"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679117863"><span class="hs-identifier hs-var">str'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; InputStream ByteString -&gt; IO (InputStream ByteString)
</span><span class="hs-identifier hs-var">Streams.throwIfProducesMoreThan</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679117848"><span class="hs-identifier hs-var">maxFileSize</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679117839"><span class="hs-identifier hs-var">stream</span></a></span><span>
</span><span id="line-270"></span><span>            </span><span id="local-6989586621679117864"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117864"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PartInfo -&gt; InputStream ByteString -&gt; IO a
</span><a href="#local-6989586621679117830"><span class="hs-identifier hs-var">partHandler</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117838"><span class="hs-identifier hs-var">partInfo</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679117863"><span class="hs-identifier hs-var">str'</span></a></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; (TooManyBytesReadException -&gt; IO a) -&gt; IO a
forall (m :: * -&gt; *) e a.
(MonadBaseControl IO m, Exception e) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catch`</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; TooManyBytesReadException -&gt; IO a
forall {m :: * -&gt; *} {a} {a}.
(MonadBase IO m, Show a) =&gt;
a -&gt; TooManyBytesReadException -&gt; m a
</span><a href="#local-6989586621679117865"><span class="hs-identifier hs-var">tooMany</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679117848"><span class="hs-identifier hs-var">maxFileSize</span></a></span><span>
</span><span id="line-271"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117866"><span class="annot"><span class="annottext">f :: FormFile a
</span><a href="#local-6989586621679117866"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; a -&gt; FormFile a
forall a. ByteString -&gt; a -&gt; FormFile a
</span><a href="Snap.Internal.Util.FileUploads.html#FormFile"><span class="hs-identifier hs-var">FormFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PartInfo -&gt; ByteString
</span><a href="Snap.Internal.Util.FileUploads.html#partFieldName"><span class="hs-identifier hs-var">partFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117838"><span class="hs-identifier hs-var">partInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117864"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-272"></span><span>            </span><span class="annot"><span class="annottext">UploadState a -&gt; IO (UploadState a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(UploadState a -&gt; IO (UploadState a))
-&gt; UploadState a -&gt; IO (UploadState a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([FormFile a] -&gt; [FormFile a]) -&gt; UploadState a
forall a. Int -&gt; ([FormFile a] -&gt; [FormFile a]) -&gt; UploadState a
</span><a href="Snap.Internal.Util.FileUploads.html#UploadState"><span class="hs-identifier hs-var">UploadState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Enum.html#succ"><span class="hs-identifier hs-var">succ</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679117841"><span class="hs-identifier hs-var">numUploads</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FormFile a] -&gt; [FormFile a]
</span><a href="#local-6989586621679117846"><span class="hs-identifier hs-var">files</span></a></span><span> </span><span class="annot"><span class="annottext">([FormFile a] -&gt; [FormFile a])
-&gt; ([FormFile a] -&gt; [FormFile a]) -&gt; [FormFile a] -&gt; [FormFile a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">FormFile a
</span><a href="#local-6989586621679117866"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[FormFile a] -&gt; [FormFile a] -&gt; [FormFile a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>        </span><span id="local-6989586621679117876"><span class="annot"><span class="annottext">skipIt :: Int64 -&gt; IO (UploadState a)
</span><a href="#local-6989586621679117876"><span class="hs-identifier hs-var hs-var">skipIt</span></a></span></span><span> </span><span id="local-6989586621679117877"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679117877"><span class="hs-identifier hs-var">maxSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-275"></span><span>            </span><span id="local-6989586621679117878"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679117878"><span class="hs-identifier hs-var">str'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; InputStream ByteString -&gt; IO (InputStream ByteString)
</span><span class="hs-identifier hs-var">Streams.throwIfProducesMoreThan</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679117877"><span class="hs-identifier hs-var">maxSize</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679117839"><span class="hs-identifier hs-var">stream</span></a></span><span>
</span><span id="line-276"></span><span>            </span><span class="hs-glyph">!</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InputStream ByteString -&gt; IO ()
forall a. InputStream a -&gt; IO ()
</span><span class="hs-identifier hs-var">Streams.skipToEof</span></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679117878"><span class="hs-identifier hs-var">str'</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; (TooManyBytesReadException -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) e a.
(MonadBaseControl IO m, Exception e) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catch`</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; TooManyBytesReadException -&gt; IO ()
forall {m :: * -&gt; *} {a} {a}.
(MonadBase IO m, Show a) =&gt;
a -&gt; TooManyBytesReadException -&gt; m a
</span><a href="#local-6989586621679117865"><span class="hs-identifier hs-var">tooMany</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679117877"><span class="hs-identifier hs-var">maxSize</span></a></span><span>
</span><span id="line-277"></span><span>            </span><span class="annot"><span class="annottext">UploadState a -&gt; IO (UploadState a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(UploadState a -&gt; IO (UploadState a))
-&gt; UploadState a -&gt; IO (UploadState a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([FormFile a] -&gt; [FormFile a]) -&gt; UploadState a
forall a. Int -&gt; ([FormFile a] -&gt; [FormFile a]) -&gt; UploadState a
</span><a href="Snap.Internal.Util.FileUploads.html#UploadState"><span class="hs-identifier hs-var">UploadState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Enum.html#succ"><span class="hs-identifier hs-var">succ</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679117841"><span class="hs-identifier hs-var">numUploads</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FormFile a] -&gt; [FormFile a]
</span><a href="#local-6989586621679117846"><span class="hs-identifier hs-var">files</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>        </span><span id="local-6989586621679117844"><span class="annot"><span class="annottext">onEmptyName :: IO (UploadState a)
</span><a href="#local-6989586621679117844"><span class="hs-identifier hs-var hs-var">onEmptyName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FileUploadPolicy -&gt; Bool
</span><a href="Snap.Internal.Util.FileUploads.html#skipEmptyFileName"><span class="hs-identifier hs-var">skipEmptyFileName</span></a></span><span> </span><span class="annot"><span class="annottext">FileUploadPolicy
</span><a href="#local-6989586621679117829"><span class="hs-identifier hs-var">filePolicy</span></a></span><span>
</span><span id="line-280"></span><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; IO (UploadState a)
</span><a href="#local-6989586621679117876"><span class="hs-identifier hs-var">skipIt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FileUploadPolicy -&gt; Int64
</span><a href="Snap.Internal.Util.FileUploads.html#maxEmptyFileNameSize"><span class="hs-identifier hs-var">maxEmptyFileNameSize</span></a></span><span> </span><span class="annot"><span class="annottext">FileUploadPolicy
</span><a href="#local-6989586621679117829"><span class="hs-identifier hs-var">filePolicy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IO (UploadState a)
</span><a href="#local-6989586621679117845"><span class="hs-identifier hs-var">takeIt</span></a></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span>        </span><span id="local-6989586621679117843"><span class="annot"><span class="annottext">throwTooManyFiles :: IO a
</span><a href="#local-6989586621679117843"><span class="hs-identifier hs-var hs-var">throwTooManyFiles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolicyViolationException -&gt; IO a
forall (m :: * -&gt; *) e a. (MonadBase IO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(PolicyViolationException -&gt; IO a)
-&gt; (Text -&gt; PolicyViolationException) -&gt; Text -&gt; IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; PolicyViolationException
</span><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-var">PolicyViolationException</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO a) -&gt; Text -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.html#concat"><span class="hs-identifier hs-var">T.concat</span></a></span><span>
</span><span id="line-285"></span><span>                            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;number of files exceeded the maximum of &quot;</span></span><span>
</span><span id="line-286"></span><span>                            </span><span class="hs-special">,</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#pack"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679117842"><span class="hs-identifier hs-var">maxFiles</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>        </span><span id="local-6989586621679117865"><span class="annot"><span class="annottext">tooMany :: a -&gt; TooManyBytesReadException -&gt; m a
</span><a href="#local-6989586621679117865"><span class="hs-identifier hs-var hs-var">tooMany</span></a></span></span><span> </span><span id="local-6989586621679117916"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117916"><span class="hs-identifier hs-var">maxSize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TooManyBytesReadException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TooManyBytesReadException</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-289"></span><span>            </span><span class="annot"><span class="annottext">PolicyViolationException -&gt; m a
forall (m :: * -&gt; *) e a. (MonadBase IO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(PolicyViolationException -&gt; m a)
-&gt; (Text -&gt; PolicyViolationException) -&gt; Text -&gt; m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; PolicyViolationException
</span><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-var">PolicyViolationException</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m a) -&gt; Text -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-290"></span><span>                    </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.html#concat"><span class="hs-identifier hs-var">T.concat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;File \&quot;&quot;</span></span><span>
</span><span id="line-291"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117852"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-292"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\&quot; exceeded maximum allowable size &quot;</span></span><span>
</span><span id="line-293"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#pack"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Text) -&gt; FilePath -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117916"><span class="hs-identifier hs-var">maxSize</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- | A type alias for a function that will process one of the parts of a</span><span>
</span><span id="line-298"></span><span class="hs-comment">-- @multipart/form-data@ HTTP request body with accumulator.</span><span>
</span><span id="line-299"></span><span class="hs-keyword">type</span><span> </span><span id="PartFold"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartFold"><span class="hs-identifier hs-var">PartFold</span></a></span></span><span> </span><span id="local-6989586621679117917"><span class="annot"><a href="#local-6989586621679117917"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartInfo"><span class="hs-identifier hs-type">PartInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InputStream</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679117917"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117917"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- | Given an upload policy and a function to consume uploaded \&quot;parts\&quot;,</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- consume a request body uploaded with @Content-type: multipart/form-data@.</span><span>
</span><span id="line-305"></span><span class="hs-comment">--</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- If 'setProcessFormInputs' is 'True', then parts with disposition @form-data@</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- (a form parameter) will be processed and returned as first element of</span><span>
</span><span id="line-308"></span><span class="hs-comment">-- resulting pair. Parts with other disposition will be fed to 'PartFold'</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- handler.</span><span>
</span><span id="line-310"></span><span class="hs-comment">--</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- If 'setProcessFormInputs' is 'False', then parts with any disposition will</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- be fed to 'PartFold' handler and first element of returned pair will be</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- empty. In this case it is important that you limit number of form inputs</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- and sizes of inputs in your 'PartFold' handler to avoid common DOS attacks.</span><span>
</span><span id="line-315"></span><span class="hs-comment">--</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- Note: /THE REQUEST MUST BE CORRECTLY ENCODED/. If the request's</span><span>
</span><span id="line-317"></span><span class="hs-comment">-- @Content-type@ is not \&quot;@multipart/formdata@\&quot;, this function skips</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- processing using 'pass'.</span><span>
</span><span id="line-319"></span><span class="hs-comment">--</span><span>
</span><span id="line-320"></span><span class="hs-comment">-- Most users will opt for the higher-level 'handleFileUploads', which writes</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- to temporary files, rather than 'handleMultipart'. This function should be</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- chosen, however, if you need to stream uploaded files directly to your own</span><span>
</span><span id="line-323"></span><span class="hs-comment">-- processing function: e.g. to a database or a remote service via RPC.</span><span>
</span><span id="line-324"></span><span class="hs-comment">--</span><span>
</span><span id="line-325"></span><span class="hs-comment">-- If the client's upload rate passes below the configured minimum (see</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- 'setMinimumUploadRate' and 'setMinimumUploadSeconds'), this function</span><span>
</span><span id="line-327"></span><span class="hs-comment">-- terminates the connection. This setting is there to protect the server</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- against slowloris-style denial of service attacks.</span><span>
</span><span id="line-329"></span><span class="hs-comment">--</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- /Exceptions/</span><span>
</span><span id="line-331"></span><span class="hs-comment">--</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- If the given 'UploadPolicy' stipulates that you wish form inputs to be</span><span>
</span><span id="line-333"></span><span class="hs-comment">-- processed (using 'setProcessFormInputs'), and a form input exceeds the</span><span>
</span><span id="line-334"></span><span class="hs-comment">-- maximum allowable size or the form exceeds maximum number of inputs, this</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- function will throw a 'PolicyViolationException'.</span><span>
</span><span id="line-336"></span><span class="hs-comment">--</span><span>
</span><span id="line-337"></span><span class="hs-comment">-- If an uploaded part contains MIME headers longer than a fixed internal</span><span>
</span><span id="line-338"></span><span class="hs-comment">-- threshold (currently 32KB), this function will throw a 'BadPartException'.</span><span>
</span><span id="line-339"></span><span class="hs-comment">--</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- /Since: 1.0.3.0/</span><span>
</span><span id="line-341"></span><span id="local-6989586621679117384"><span id="local-6989586621679117385"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#foldMultipart"><span class="hs-identifier hs-type">foldMultipart</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-342"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Core.html#MonadSnap"><span class="hs-identifier hs-type">MonadSnap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117384"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-343"></span><span>       </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ global upload policy</span></span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartFold"><span class="hs-identifier hs-type">PartFold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117385"><span class="hs-identifier hs-type">a</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ part processor</span></span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679117385"><span class="hs-identifier hs-type">a</span></a></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ seed accumulator</span></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679117384"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FormParam"><span class="hs-identifier hs-type">FormParam</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679117385"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-347"></span><span id="foldMultipart"><span class="annot"><span class="annottext">foldMultipart :: forall (m :: * -&gt; *) a.
MonadSnap m =&gt;
UploadPolicy -&gt; PartFold a -&gt; a -&gt; m ([FormParam], a)
</span><a href="Snap.Internal.Util.FileUploads.html#foldMultipart"><span class="hs-identifier hs-var hs-var">foldMultipart</span></a></span></span><span> </span><span id="local-6989586621679117946"><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679117946"><span class="hs-identifier hs-var">uploadPolicy</span></a></span></span><span> </span><span id="local-6989586621679117947"><span class="annot"><span class="annottext">PartFold a
</span><a href="#local-6989586621679117947"><span class="hs-identifier hs-var">origPartHandler</span></a></span></span><span> </span><span id="local-6989586621679117948"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117948"><span class="hs-identifier hs-var">zero</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621679117949"><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679117949"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Request -&gt; Headers) -&gt; m Request -&gt; m Headers
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a></span><span> </span><span class="annot"><span class="annottext">Request -&gt; Headers
forall a. HasHeaders a =&gt; a -&gt; Headers
</span><a href="Snap.Internal.Http.Types.html#headers"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">m Request
forall (m :: * -&gt; *). MonadSnap m =&gt; m Request
</span><a href="Snap.Internal.Core.html#getRequest"><span class="hs-identifier hs-var">getRequest</span></a></span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679117950"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117950"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679117951"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679117951"><span class="hs-identifier hs-var">mbBoundary</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Headers -&gt; (ByteString, Maybe ByteString)
</span><a href="Snap.Internal.Util.FileUploads.html#getContentType"><span class="hs-identifier hs-var">getContentType</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679117949"><span class="hs-identifier hs-var">hdrs</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span>    </span><span id="local-6989586621679117953"><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="#local-6989586621679117953"><span class="hs-identifier hs-var">tickleTimeout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(((Int -&gt; Int) -&gt; IO ()) -&gt; Int -&gt; IO ())
-&gt; m ((Int -&gt; Int) -&gt; IO ()) -&gt; m (Int -&gt; IO ())
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Int -&gt; Int) -&gt; IO ()) -&gt; (Int -&gt; Int -&gt; Int) -&gt; Int -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#max"><span class="hs-identifier hs-var">max</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m ((Int -&gt; Int) -&gt; IO ())
forall (m :: * -&gt; *). MonadSnap m =&gt; m ((Int -&gt; Int) -&gt; IO ())
</span><a href="Snap.Internal.Core.html#getTimeoutModifier"><span class="hs-identifier hs-var">getTimeoutModifier</span></a></span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117954"><span class="annot"><span class="annottext">bumpTimeout :: IO ()
</span><a href="#local-6989586621679117954"><span class="hs-identifier hs-var hs-var">bumpTimeout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="#local-6989586621679117953"><span class="hs-identifier hs-var">tickleTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO ()) -&gt; Int -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UploadPolicy -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#uploadTimeout"><span class="hs-identifier hs-var">uploadTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679117946"><span class="hs-identifier hs-var">uploadPolicy</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117957"><span class="annot"><span class="annottext">partHandler :: PartInfo -&gt; InputStream ByteString -&gt; a -&gt; IO (Capture a)
</span><a href="#local-6989586621679117957"><span class="hs-identifier hs-var hs-var">partHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UploadPolicy -&gt; Bool
</span><a href="Snap.Internal.Util.FileUploads.html#doProcessFormInputs"><span class="hs-identifier hs-var">doProcessFormInputs</span></a></span><span> </span><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679117946"><span class="hs-identifier hs-var">uploadPolicy</span></a></span><span>
</span><span id="line-355"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int64
-&gt; PartFold a
-&gt; PartInfo
-&gt; InputStream ByteString
-&gt; a
-&gt; IO (Capture a)
forall a.
Int64
-&gt; PartFold a
-&gt; PartInfo
-&gt; InputStream ByteString
-&gt; a
-&gt; IO (Capture a)
</span><a href="Snap.Internal.Util.FileUploads.html#captureVariableOrReadFile"><span class="hs-identifier hs-var">captureVariableOrReadFile</span></a></span><span>
</span><span id="line-356"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UploadPolicy -&gt; Int64
</span><a href="Snap.Internal.Util.FileUploads.html#getMaximumFormInputSize"><span class="hs-identifier hs-var">getMaximumFormInputSize</span></a></span><span> </span><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679117946"><span class="hs-identifier hs-var">uploadPolicy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>                                 </span><span class="annot"><span class="annottext">PartFold a
</span><a href="#local-6989586621679117947"><span class="hs-identifier hs-var">origPartHandler</span></a></span><span>
</span><span id="line-358"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679117959"><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117959"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679117960"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679117960"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679117961"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117961"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Capture a) -&gt; IO a -&gt; IO (Capture a)
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Capture a
forall a. a -&gt; Capture a
</span><a href="Snap.Internal.Util.FileUploads.html#File"><span class="hs-identifier hs-var">File</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO (Capture a)) -&gt; IO a -&gt; IO (Capture a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PartFold a
</span><a href="#local-6989586621679117947"><span class="hs-identifier hs-var">origPartHandler</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117959"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679117960"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117961"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-comment">-- not well-formed multipart? bomb out.</span><span>
</span><span id="line-361"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117950"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;multipart/form-data&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>    </span><span id="local-6989586621679117963"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117963"><span class="hs-identifier hs-var">boundary</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m ByteString
-&gt; (ByteString -&gt; m ByteString) -&gt; Maybe ByteString -&gt; m ByteString
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BadPartException -&gt; m ByteString
forall (m :: * -&gt; *) e a. (MonadBase IO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(BadPartException -&gt; m ByteString)
-&gt; BadPartException -&gt; m ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; BadPartException
</span><a href="Snap.Internal.Util.FileUploads.html#BadPartException"><span class="hs-identifier hs-var">BadPartException</span></a></span><span>
</span><span id="line-364"></span><span>                       </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;got multipart/form-data without boundary&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>                      </span><span class="annot"><span class="annottext">ByteString -&gt; m ByteString
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-366"></span><span>                      </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679117951"><span class="hs-identifier hs-var">mbBoundary</span></a></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-comment">-- RateTooSlowException will be caught and properly dealt with by</span><span>
</span><span id="line-369"></span><span>    </span><span class="hs-comment">-- runRequestBody</span><span>
</span><span id="line-370"></span><span>    </span><span class="annot"><span class="annottext">(InputStream ByteString -&gt; IO ([FormParam], a))
-&gt; m ([FormParam], a)
forall (m :: * -&gt; *) a.
MonadSnap m =&gt;
(InputStream ByteString -&gt; IO a) -&gt; m a
</span><a href="Snap.Internal.Core.html#runRequestBody"><span class="hs-identifier hs-var">runRequestBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO ()
-&gt; ByteString
-&gt; (PartInfo -&gt; InputStream ByteString -&gt; a -&gt; IO (Capture a))
-&gt; InputStream ByteString
-&gt; IO ([FormParam], a)
</span><a href="#local-6989586621679117964"><span class="hs-identifier hs-var">proc</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679117954"><span class="hs-identifier hs-var">bumpTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117963"><span class="hs-identifier hs-var">boundary</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo -&gt; InputStream ByteString -&gt; a -&gt; IO (Capture a)
</span><a href="#local-6989586621679117957"><span class="hs-identifier hs-var">partHandler</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-374"></span><span>    </span><span id="local-6989586621679117965"><span class="annot"><span class="annottext">uploadRate :: Double
</span><a href="#local-6989586621679117965"><span class="hs-identifier hs-var hs-var">uploadRate</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadPolicy -&gt; Double
</span><a href="Snap.Internal.Util.FileUploads.html#minimumUploadRate"><span class="hs-identifier hs-var">minimumUploadRate</span></a></span><span> </span><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679117946"><span class="hs-identifier hs-var">uploadPolicy</span></a></span><span>
</span><span id="line-375"></span><span>    </span><span id="local-6989586621679117967"><span class="annot"><span class="annottext">uploadSecs :: Int
</span><a href="#local-6989586621679117967"><span class="hs-identifier hs-var hs-var">uploadSecs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadPolicy -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#minimumUploadSeconds"><span class="hs-identifier hs-var">minimumUploadSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679117946"><span class="hs-identifier hs-var">uploadPolicy</span></a></span><span>
</span><span id="line-376"></span><span>    </span><span id="local-6989586621679117969"><span class="annot"><span class="annottext">maxFormVars :: Int
</span><a href="#local-6989586621679117969"><span class="hs-identifier hs-var hs-var">maxFormVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadPolicy -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#maximumNumberOfFormInputs"><span class="hs-identifier hs-var">maximumNumberOfFormInputs</span></a></span><span> </span><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679117946"><span class="hs-identifier hs-var">uploadPolicy</span></a></span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-379"></span><span>    </span><span id="local-6989586621679117964"><span class="annot"><span class="annottext">proc :: IO ()
-&gt; ByteString
-&gt; (PartInfo -&gt; InputStream ByteString -&gt; a -&gt; IO (Capture a))
-&gt; InputStream ByteString
-&gt; IO ([FormParam], a)
</span><a href="#local-6989586621679117964"><span class="hs-identifier hs-var hs-var">proc</span></a></span></span><span> </span><span id="local-6989586621679117972"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679117972"><span class="hs-identifier hs-var">bumpTimeout</span></a></span></span><span> </span><span id="local-6989586621679117973"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117973"><span class="hs-identifier hs-var">boundary</span></a></span></span><span> </span><span id="local-6989586621679117974"><span class="annot"><span class="annottext">PartInfo -&gt; InputStream ByteString -&gt; a -&gt; IO (Capture a)
</span><a href="#local-6989586621679117974"><span class="hs-identifier hs-var">partHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-380"></span><span>        </span><span class="annot"><span class="annottext">IO ()
-&gt; Double
-&gt; Int
-&gt; InputStream ByteString
-&gt; IO (InputStream ByteString)
</span><span class="hs-identifier hs-var">Streams.throwIfTooSlow</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679117972"><span class="hs-identifier hs-var">bumpTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117965"><span class="hs-identifier hs-var">uploadRate</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679117967"><span class="hs-identifier hs-var">uploadSecs</span></a></span><span> </span><span class="annot"><span class="annottext">(InputStream ByteString -&gt; IO (InputStream ByteString))
-&gt; (InputStream ByteString -&gt; IO ([FormParam], a))
-&gt; InputStream ByteString
-&gt; IO ([FormParam], a)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html#%3E%3D%3E"><span class="hs-operator hs-var">&gt;=&gt;</span></a></span><span>
</span><span id="line-381"></span><span>        </span><span class="annot"><span class="annottext">Int
-&gt; ByteString
-&gt; (PartInfo -&gt; InputStream ByteString -&gt; a -&gt; IO (Capture a))
-&gt; a
-&gt; InputStream ByteString
-&gt; IO ([FormParam], a)
forall a.
Int
-&gt; ByteString
-&gt; (PartInfo -&gt; InputStream ByteString -&gt; a -&gt; IO (Capture a))
-&gt; a
-&gt; InputStream ByteString
-&gt; IO ([FormParam], a)
</span><a href="Snap.Internal.Util.FileUploads.html#internalFoldMultipart"><span class="hs-identifier hs-var">internalFoldMultipart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679117969"><span class="hs-identifier hs-var">maxFormVars</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117973"><span class="hs-identifier hs-var">boundary</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo -&gt; InputStream ByteString -&gt; a -&gt; IO (Capture a)
</span><a href="#local-6989586621679117974"><span class="hs-identifier hs-var">partHandler</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117948"><span class="hs-identifier hs-var">zero</span></a></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-384"></span><span class="hs-comment">-- | A type alias for a function that will process one of the parts of a</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- @multipart/form-data@ HTTP request body without usinc accumulator.</span><span>
</span><span id="line-386"></span><span class="hs-keyword">type</span><span> </span><span id="PartProcessor"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartProcessor"><span class="hs-identifier hs-var">PartProcessor</span></a></span></span><span> </span><span id="local-6989586621679117977"><span class="annot"><a href="#local-6989586621679117977"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartInfo"><span class="hs-identifier hs-type">PartInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InputStream</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117977"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-390"></span><span class="hs-comment">-- | A variant of 'foldMultipart' accumulating results into a list.</span><span>
</span><span id="line-391"></span><span class="hs-comment">-- Also puts captured 'FormParam's into rqPostParams and rqParams maps.</span><span>
</span><span id="line-392"></span><span class="hs-comment">--</span><span>
</span><span id="line-393"></span><span id="local-6989586621679117338"><span id="local-6989586621679117339"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#handleMultipart"><span class="hs-identifier hs-type">handleMultipart</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-394"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Core.html#MonadSnap"><span class="hs-identifier hs-type">MonadSnap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117338"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-395"></span><span>       </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ global upload policy</span></span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartProcessor"><span class="hs-identifier hs-type">PartProcessor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117339"><span class="hs-identifier hs-type">a</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ part processor</span></span><span>
</span><span id="line-397"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679117338"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679117339"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-398"></span><span id="handleMultipart"><span class="annot"><span class="annottext">handleMultipart :: forall (m :: * -&gt; *) a.
MonadSnap m =&gt;
UploadPolicy -&gt; PartProcessor a -&gt; m [a]
</span><a href="Snap.Internal.Util.FileUploads.html#handleMultipart"><span class="hs-identifier hs-var hs-var">handleMultipart</span></a></span></span><span> </span><span id="local-6989586621679117985"><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679117985"><span class="hs-identifier hs-var">uploadPolicy</span></a></span></span><span> </span><span id="local-6989586621679117986"><span class="annot"><span class="annottext">PartProcessor a
</span><a href="#local-6989586621679117986"><span class="hs-identifier hs-var">origPartHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679117987"><span class="annot"><span class="annottext">[FormParam]
</span><a href="#local-6989586621679117987"><span class="hs-identifier hs-var">captures</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679117988"><span class="annot"><span class="annottext">[a] -&gt; [a]
</span><a href="#local-6989586621679117988"><span class="hs-identifier hs-var">files</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UploadPolicy
-&gt; PartFold ([a] -&gt; [a])
-&gt; ([a] -&gt; [a])
-&gt; m ([FormParam], [a] -&gt; [a])
forall (m :: * -&gt; *) a.
MonadSnap m =&gt;
UploadPolicy -&gt; PartFold a -&gt; a -&gt; m ([FormParam], a)
</span><a href="Snap.Internal.Util.FileUploads.html#foldMultipart"><span class="hs-identifier hs-var">foldMultipart</span></a></span><span> </span><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679117985"><span class="hs-identifier hs-var">uploadPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">PartFold ([a] -&gt; [a])
forall {c}.
PartInfo -&gt; InputStream ByteString -&gt; ([a] -&gt; c) -&gt; IO ([a] -&gt; c)
</span><a href="#local-6989586621679117989"><span class="hs-identifier hs-var">partFold</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-400"></span><span>    </span><span class="annot"><span class="annottext">[FormParam] -&gt; m ()
forall {f :: * -&gt; *}. MonadSnap f =&gt; [FormParam] -&gt; f ()
</span><a href="#local-6989586621679117990"><span class="hs-identifier hs-var">procCaptures</span></a></span><span> </span><span class="annot"><span class="annottext">[FormParam]
</span><a href="#local-6989586621679117987"><span class="hs-identifier hs-var">captures</span></a></span><span>
</span><span id="line-401"></span><span>    </span><span class="annot"><span class="annottext">[a] -&gt; m [a]
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">([a] -&gt; m [a]) -&gt; [a] -&gt; m [a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a]
</span><a href="#local-6989586621679117988"><span class="hs-identifier hs-var">files</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-404"></span><span>    </span><span id="local-6989586621679117989"><span class="annot"><span class="annottext">partFold :: PartInfo -&gt; InputStream ByteString -&gt; ([a] -&gt; c) -&gt; IO ([a] -&gt; c)
</span><a href="#local-6989586621679117989"><span class="hs-identifier hs-var hs-var">partFold</span></a></span></span><span> </span><span id="local-6989586621679117993"><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117993"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621679117994"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679117994"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621679117995"><span class="annot"><span class="annottext">[a] -&gt; c
</span><a href="#local-6989586621679117995"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-405"></span><span>      </span><span id="local-6989586621679117996"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117996"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PartProcessor a
</span><a href="#local-6989586621679117986"><span class="hs-identifier hs-var">origPartHandler</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679117993"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679117994"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-406"></span><span>      </span><span class="annot"><span class="annottext">([a] -&gt; c) -&gt; IO ([a] -&gt; c)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(([a] -&gt; c) -&gt; IO ([a] -&gt; c)) -&gt; ([a] -&gt; c) -&gt; IO ([a] -&gt; c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; c
</span><a href="#local-6989586621679117995"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">([a] -&gt; c) -&gt; ([a] -&gt; [a]) -&gt; [a] -&gt; c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117996"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; [a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-408"></span><span>    </span><span id="local-6989586621679117990"><span class="annot"><span class="annottext">procCaptures :: [FormParam] -&gt; f ()
</span><a href="#local-6989586621679117990"><span class="hs-identifier hs-var hs-var">procCaptures</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; f ()
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><a href="#local-6989586621679117990"><span class="hs-identifier hs-var">procCaptures</span></a></span><span> </span><span id="local-6989586621679118049"><span class="annot"><span class="annottext">[FormParam]
</span><a href="#local-6989586621679118049"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-410"></span><span>        </span><span id="local-6989586621679118050"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679118050"><span class="hs-identifier hs-var">rq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">f Request
forall (m :: * -&gt; *). MonadSnap m =&gt; m Request
</span><a href="Snap.Internal.Core.html#getRequest"><span class="hs-identifier hs-var">getRequest</span></a></span><span>
</span><span id="line-411"></span><span>        </span><span class="annot"><span class="annottext">Request -&gt; f ()
forall (m :: * -&gt; *). MonadSnap m =&gt; Request -&gt; m ()
</span><a href="Snap.Internal.Core.html#putRequest"><span class="hs-identifier hs-var">putRequest</span></a></span><span> </span><span class="annot"><span class="annottext">(Request -&gt; f ()) -&gt; Request -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Params -&gt; Params) -&gt; Request -&gt; Request
</span><a href="#local-6989586621679118051"><span class="hs-identifier hs-var">modifyParams</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679118052"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679118052"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(FormParam -&gt; Params -&gt; Params) -&gt; Params -&gt; [FormParam] -&gt; Params
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">FormParam -&gt; Params -&gt; Params
forall {k} {a}. Ord k =&gt; (k, a) -&gt; Map k [a] -&gt; Map k [a]
</span><a href="#local-6989586621679118053"><span class="hs-identifier hs-var">ins</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679118052"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">[FormParam]
</span><a href="#local-6989586621679118049"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679118050"><span class="hs-identifier hs-var">rq</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-414"></span><span>    </span><span id="local-6989586621679118053"><span class="annot"><span class="annottext">ins :: (k, a) -&gt; Map k [a] -&gt; Map k [a]
</span><a href="#local-6989586621679118053"><span class="hs-identifier hs-var hs-var">ins</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679118058"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679118058"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118059"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118059"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([a] -&gt; [a] -&gt; [a]) -&gt; k -&gt; [a] -&gt; Map k [a] -&gt; Map k [a]
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insertWith"><span class="hs-identifier hs-var">Map.insertWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679118060"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679118060"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118059"><span class="hs-identifier hs-var">v</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679118060"><span class="hs-identifier hs-var">ex</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679118058"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118059"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-415"></span><span>         </span><span class="hs-comment">-- prepend value if key exists, since we are folding from right</span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-418"></span><span>    </span><span id="local-6989586621679118051"><span class="annot"><span class="annottext">modifyParams :: (Params -&gt; Params) -&gt; Request -&gt; Request
</span><a href="#local-6989586621679118051"><span class="hs-identifier hs-var hs-var">modifyParams</span></a></span></span><span> </span><span id="local-6989586621679118061"><span class="annot"><span class="annottext">Params -&gt; Params
</span><a href="#local-6989586621679118061"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679118062"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679118062"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679118062"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#rqPostParams"><span class="hs-identifier hs-var">rqPostParams</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118061"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#rqPostParams"><span class="hs-identifier hs-var">rqPostParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118062"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-419"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#rqParams"><span class="hs-identifier hs-var">rqParams</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118061"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#rqParams"><span class="hs-identifier hs-var">rqParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118062"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-420"></span><span>                         </span><span class="hs-special">}</span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-423"></span><span class="hs-comment">-- | Represents the disposition type specified via the @Content-Disposition@</span><span>
</span><span id="line-424"></span><span class="hs-comment">-- header field. See &lt;https://www.ietf.org/rfc/rfc1806.txt RFC 1806&gt;.</span><span>
</span><span id="line-425"></span><span class="hs-keyword">data</span><span> </span><span id="PartDisposition"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartDisposition"><span class="hs-identifier hs-var">PartDisposition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-426"></span><span>    </span><span id="DispositionAttachment"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#DispositionAttachment"><span class="hs-identifier hs-var">DispositionAttachment</span></a></span></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ @Content-Disposition: attachment@.</span></span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DispositionFile"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#DispositionFile"><span class="hs-identifier hs-var">DispositionFile</span></a></span></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ @Content-Disposition: file@.</span></span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DispositionFormData"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#DispositionFormData"><span class="hs-identifier hs-var">DispositionFormData</span></a></span></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ @Content-Disposition: form-data@.</span></span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DispositionOther"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#DispositionOther"><span class="hs-identifier hs-var">DispositionOther</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Any other value.</span></span><span>
</span><span id="line-430"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679118068"><span id="local-6989586621679118071"><span class="annot"><span class="annottext">PartDisposition -&gt; PartDisposition -&gt; Bool
(PartDisposition -&gt; PartDisposition -&gt; Bool)
-&gt; (PartDisposition -&gt; PartDisposition -&gt; Bool)
-&gt; Eq PartDisposition
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: PartDisposition -&gt; PartDisposition -&gt; Bool
== :: PartDisposition -&gt; PartDisposition -&gt; Bool
$c/= :: PartDisposition -&gt; PartDisposition -&gt; Bool
/= :: PartDisposition -&gt; PartDisposition -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118075"><span id="local-6989586621679118079"><span id="local-6989586621679118083"><span class="annot"><span class="annottext">Int -&gt; PartDisposition -&gt; ShowS
[PartDisposition] -&gt; ShowS
PartDisposition -&gt; FilePath
(Int -&gt; PartDisposition -&gt; ShowS)
-&gt; (PartDisposition -&gt; FilePath)
-&gt; ([PartDisposition] -&gt; ShowS)
-&gt; Show PartDisposition
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; FilePath) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; PartDisposition -&gt; ShowS
showsPrec :: Int -&gt; PartDisposition -&gt; ShowS
$cshow :: PartDisposition -&gt; FilePath
show :: PartDisposition -&gt; FilePath
$cshowList :: [PartDisposition] -&gt; ShowS
showList :: [PartDisposition] -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-434"></span><span class="hs-comment">-- | 'PartInfo' contains information about a \&quot;part\&quot; in a request uploaded</span><span>
</span><span id="line-435"></span><span class="hs-comment">-- with @Content-type: multipart/form-data@.</span><span>
</span><span id="line-436"></span><span class="hs-keyword">data</span><span> </span><span id="PartInfo"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartInfo"><span class="hs-identifier hs-var">PartInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-437"></span><span>  </span><span id="PartInfo"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartInfo"><span class="hs-identifier hs-var">PartInfo</span></a></span></span><span>
</span><span id="line-438"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="partFieldName"><span class="annot"><span class="annottext">PartInfo -&gt; ByteString
</span><a href="Snap.Internal.Util.FileUploads.html#partFieldName"><span class="hs-identifier hs-var hs-var">partFieldName</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-comment">-- ^ Field name associated with this part (i.e., the name specified with</span><span>
</span><span id="line-440"></span><span>    </span><span class="hs-comment">-- @\&lt;input name=\&quot;partFieldName\&quot; ...@).</span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="partFileName"><span class="annot"><span class="annottext">PartInfo -&gt; Maybe ByteString
</span><a href="Snap.Internal.Util.FileUploads.html#partFileName"><span class="hs-identifier hs-var hs-var">partFileName</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Name of the uploaded file.</span></span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="partContentType"><span class="annot"><span class="annottext">PartInfo -&gt; ByteString
</span><a href="Snap.Internal.Util.FileUploads.html#partContentType"><span class="hs-identifier hs-var hs-var">partContentType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-444"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Content type of this part.</span></span><span>
</span><span id="line-445"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="partDisposition"><span class="annot"><span class="annottext">PartInfo -&gt; PartDisposition
</span><a href="Snap.Internal.Util.FileUploads.html#partDisposition"><span class="hs-identifier hs-var hs-var">partDisposition</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartDisposition"><span class="hs-identifier hs-type">PartDisposition</span></a></span><span>
</span><span id="line-446"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Disposition type of this part. See 'PartDisposition'.</span></span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="partHeaders"><span class="annot"><span class="annottext">PartInfo -&gt; Headers
</span><a href="Snap.Internal.Util.FileUploads.html#partHeaders"><span class="hs-identifier hs-var hs-var">partHeaders</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Snap.Types.Headers.html#Headers"><span class="hs-identifier hs-type">Headers</span></a></span><span>
</span><span id="line-448"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Remaining headers associated with this part.</span></span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679118088"><span id="local-6989586621679118098"><span id="local-6989586621679118102"><span class="annot"><span class="annottext">Int -&gt; PartInfo -&gt; ShowS
[PartInfo] -&gt; ShowS
PartInfo -&gt; FilePath
(Int -&gt; PartInfo -&gt; ShowS)
-&gt; (PartInfo -&gt; FilePath) -&gt; ([PartInfo] -&gt; ShowS) -&gt; Show PartInfo
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; FilePath) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; PartInfo -&gt; ShowS
showsPrec :: Int -&gt; PartInfo -&gt; ShowS
$cshow :: PartInfo -&gt; FilePath
show :: PartInfo -&gt; FilePath
$cshowList :: [PartInfo] -&gt; ShowS
showList :: [PartInfo] -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-454"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#toPartDisposition"><span class="hs-identifier hs-type">toPartDisposition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartDisposition"><span class="hs-identifier hs-type">PartDisposition</span></a></span><span>
</span><span id="line-455"></span><span id="toPartDisposition"><span class="annot"><span class="annottext">toPartDisposition :: ByteString -&gt; PartDisposition
</span><a href="Snap.Internal.Util.FileUploads.html#toPartDisposition"><span class="hs-identifier hs-var hs-var">toPartDisposition</span></a></span></span><span> </span><span id="local-6989586621679118104"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118104"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118104"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;attachment&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartDisposition
</span><a href="Snap.Internal.Util.FileUploads.html#DispositionAttachment"><span class="hs-identifier hs-var">DispositionAttachment</span></a></span><span>
</span><span id="line-456"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118104"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;file&quot;</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartDisposition
</span><a href="Snap.Internal.Util.FileUploads.html#DispositionFile"><span class="hs-identifier hs-var">DispositionFile</span></a></span><span>
</span><span id="line-457"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118104"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;form-data&quot;</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartDisposition
</span><a href="Snap.Internal.Util.FileUploads.html#DispositionFormData"><span class="hs-identifier hs-var">DispositionFormData</span></a></span><span>
</span><span id="line-458"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; PartDisposition
</span><a href="Snap.Internal.Util.FileUploads.html#DispositionOther"><span class="hs-identifier hs-var">DispositionOther</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118104"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-462"></span><span class="hs-comment">-- | All of the exceptions defined in this package inherit from</span><span>
</span><span id="line-463"></span><span class="hs-comment">-- 'FileUploadException', so if you write</span><span>
</span><span id="line-464"></span><span class="hs-comment">--</span><span>
</span><span id="line-465"></span><span class="hs-comment">-- &gt; foo `catch` \(e :: FileUploadException) -&gt; ...</span><span>
</span><span id="line-466"></span><span class="hs-comment">--</span><span>
</span><span id="line-467"></span><span class="hs-comment">-- you can catch a 'BadPartException', a 'PolicyViolationException', etc.</span><span>
</span><span id="line-468"></span><span class="hs-keyword">data</span><span> </span><span id="FileUploadException"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadException"><span class="hs-identifier hs-var">FileUploadException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679118105"><span class="annot"><a href="#local-6989586621679118105"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#ExceptionWithReason"><span class="hs-identifier hs-type">ExceptionWithReason</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118105"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118105"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-469"></span><span>                           </span><span id="WrappedFileUploadException"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#WrappedFileUploadException"><span class="hs-identifier hs-var">WrappedFileUploadException</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679118105"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-470"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-474"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#Exception"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117452"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="ExceptionWithReason"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#ExceptionWithReason"><span class="hs-identifier hs-var">ExceptionWithReason</span></a></span></span><span> </span><span id="local-6989586621679117452"><span class="annot"><a href="#local-6989586621679117452"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-475"></span><span>    </span><span id="exceptionReason"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#exceptionReason"><span class="hs-identifier hs-type">exceptionReason</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679117452"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-479"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679118110"><span id="local-6989586621679118115"><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadException"><span class="hs-identifier hs-type">FileUploadException</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-480"></span><span>    </span><span id="local-6989586621679118117"><span class="annot"><span class="annottext">show :: FileUploadException -&gt; FilePath
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#WrappedFileUploadException"><span class="hs-identifier hs-type">WrappedFileUploadException</span></a></span><span> </span><span id="local-6989586621679118121"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679118121"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">e -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679118121"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-484"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679118127"><span id="local-6989586621679118131"><span id="local-6989586621679118134"><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#Exception"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadException"><span class="hs-identifier hs-type">FileUploadException</span></a></span></span></span></span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-488"></span><span class="annot"><span class="hs-comment">-- | Human-readable error message corresponding to the 'FileUploadException'.</span></span><span>
</span><span id="line-489"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#fileUploadExceptionReason"><span class="hs-identifier hs-type">fileUploadExceptionReason</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadException"><span class="hs-identifier hs-type">FileUploadException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-490"></span><span id="fileUploadExceptionReason"><span class="annot"><span class="annottext">fileUploadExceptionReason :: FileUploadException -&gt; Text
</span><a href="Snap.Internal.Util.FileUploads.html#fileUploadExceptionReason"><span class="hs-identifier hs-var hs-var">fileUploadExceptionReason</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#WrappedFileUploadException"><span class="hs-identifier hs-type">WrappedFileUploadException</span></a></span><span> </span><span id="local-6989586621679118140"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679118140"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">e -&gt; Text
forall e. ExceptionWithReason e =&gt; e -&gt; Text
</span><a href="Snap.Internal.Util.FileUploads.html#exceptionReason"><span class="hs-identifier hs-var">exceptionReason</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679118140"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-494"></span><span id="local-6989586621679117459"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#uploadExceptionToException"><span class="hs-identifier hs-type">uploadExceptionToException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#ExceptionWithReason"><span class="hs-identifier hs-type">ExceptionWithReason</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117459"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679117459"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span></span><span>
</span><span id="line-495"></span><span id="uploadExceptionToException"><span class="annot"><span class="annottext">uploadExceptionToException :: forall e. ExceptionWithReason e =&gt; e -&gt; SomeException
</span><a href="Snap.Internal.Util.FileUploads.html#uploadExceptionToException"><span class="hs-identifier hs-var hs-var">uploadExceptionToException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FileUploadException -&gt; SomeException
forall e. Exception e =&gt; e -&gt; SomeException
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#toException"><span class="hs-identifier hs-var">toException</span></a></span><span> </span><span class="annot"><span class="annottext">(FileUploadException -&gt; SomeException)
-&gt; (e -&gt; FileUploadException) -&gt; e -&gt; SomeException
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; FileUploadException
forall e.
(ExceptionWithReason e, Show e) =&gt;
e -&gt; FileUploadException
</span><a href="Snap.Internal.Util.FileUploads.html#WrappedFileUploadException"><span class="hs-identifier hs-var">WrappedFileUploadException</span></a></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-499"></span><span id="local-6989586621679117462"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#uploadExceptionFromException"><span class="hs-identifier hs-type">uploadExceptionFromException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#ExceptionWithReason"><span class="hs-identifier hs-type">ExceptionWithReason</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117462"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117462"><span class="hs-identifier hs-type">e</span></a></span></span><span>
</span><span id="line-500"></span><span id="uploadExceptionFromException"><span class="annot"><span class="annottext">uploadExceptionFromException :: forall e. ExceptionWithReason e =&gt; SomeException -&gt; Maybe e
</span><a href="Snap.Internal.Util.FileUploads.html#uploadExceptionFromException"><span class="hs-identifier hs-var hs-var">uploadExceptionFromException</span></a></span></span><span> </span><span id="local-6989586621679118157"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679118157"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-501"></span><span>    </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#WrappedFileUploadException"><span class="hs-identifier hs-type">WrappedFileUploadException</span></a></span><span> </span><span id="local-6989586621679118164"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679118164"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe FileUploadException
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var">fromException</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679118157"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-502"></span><span>    </span><span class="annot"><span class="annottext">e -&gt; Maybe e
forall a b. (Typeable a, Typeable b) =&gt; a -&gt; Maybe b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.html#cast"><span class="hs-identifier hs-var">cast</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679118164"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-506"></span><span class="annot"><span class="hs-comment">-- | Thrown when a part is invalid in some way (e.g. the headers are too large).</span></span><span>
</span><span id="line-507"></span><span class="hs-keyword">data</span><span> </span><span id="BadPartException"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#BadPartException"><span class="hs-identifier hs-var">BadPartException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BadPartException"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#BadPartException"><span class="hs-identifier hs-var">BadPartException</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-508"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Human-readable error message corresponding to the 'BadPartException'.</span></span><span>
</span><span id="line-509"></span><span>  </span><span id="badPartExceptionReason"><span class="annot"><span class="annottext">BadPartException -&gt; Text
</span><a href="Snap.Internal.Util.FileUploads.html#badPartExceptionReason"><span class="hs-identifier hs-var hs-var">badPartExceptionReason</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-510"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-511"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679118174"><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#Exception"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#BadPartException"><span class="hs-identifier hs-type">BadPartException</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-514"></span><span>    </span><span id="local-6989586621679118178"><span class="annot"><span class="annottext">toException :: BadPartException -&gt; SomeException
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#toException"><span class="hs-identifier hs-var hs-var hs-var hs-var">toException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BadPartException -&gt; SomeException
forall e. ExceptionWithReason e =&gt; e -&gt; SomeException
</span><a href="Snap.Internal.Util.FileUploads.html#uploadExceptionToException"><span class="hs-identifier hs-var">uploadExceptionToException</span></a></span><span>
</span><span id="line-515"></span><span>    </span><span id="local-6989586621679118180"><span class="annot"><span class="annottext">fromException :: SomeException -&gt; Maybe BadPartException
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe BadPartException
forall e. ExceptionWithReason e =&gt; SomeException -&gt; Maybe e
</span><a href="Snap.Internal.Util.FileUploads.html#uploadExceptionFromException"><span class="hs-identifier hs-var">uploadExceptionFromException</span></a></span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#ExceptionWithReason"><span class="hs-identifier hs-type">ExceptionWithReason</span></a></span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#BadPartException"><span class="hs-identifier hs-type">BadPartException</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-518"></span><span>    </span><span id="local-6989586621679118186"><span class="annot"><span class="annottext">exceptionReason :: BadPartException -&gt; Text
</span><a href="Snap.Internal.Util.FileUploads.html#exceptionReason"><span class="hs-identifier hs-var hs-var hs-var hs-var">exceptionReason</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#BadPartException"><span class="hs-identifier hs-type">BadPartException</span></a></span><span> </span><span id="local-6989586621679118187"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118187"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.html#concat"><span class="hs-identifier hs-var">T.concat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Bad part: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118187"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679118189"><span id="local-6989586621679118193"><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#BadPartException"><span class="hs-identifier hs-type">BadPartException</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-521"></span><span>  </span><span id="local-6989586621679118196"><span class="annot"><span class="annottext">show :: BadPartException -&gt; FilePath
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; FilePath)
-&gt; (BadPartException -&gt; Text) -&gt; BadPartException -&gt; FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">BadPartException -&gt; Text
forall e. ExceptionWithReason e =&gt; e -&gt; Text
</span><a href="Snap.Internal.Util.FileUploads.html#exceptionReason"><span class="hs-identifier hs-var">exceptionReason</span></a></span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-525"></span><span class="annot"><span class="hs-comment">-- | Thrown when an 'UploadPolicy' or 'PartUploadPolicy' is violated.</span></span><span>
</span><span id="line-526"></span><span class="hs-keyword">data</span><span> </span><span id="PolicyViolationException"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-var">PolicyViolationException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PolicyViolationException"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-var">PolicyViolationException</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-527"></span><span>      </span><span class="hs-comment">-- | Human-readable error message corresponding to the</span><span>
</span><span id="line-528"></span><span>      </span><span class="hs-comment">-- 'PolicyViolationException'.</span><span>
</span><span id="line-529"></span><span>      </span><span id="policyViolationExceptionReason"><span class="annot"><span class="annottext">PolicyViolationException -&gt; Text
</span><a href="Snap.Internal.Util.FileUploads.html#policyViolationExceptionReason"><span class="hs-identifier hs-var hs-var">policyViolationExceptionReason</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-530"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679118206"><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#Exception"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-type">PolicyViolationException</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-533"></span><span>    </span><span id="local-6989586621679118210"><span class="annot"><span class="annottext">toException :: PolicyViolationException -&gt; SomeException
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#toException"><span class="hs-identifier hs-var hs-var hs-var hs-var">toException</span></a></span></span><span> </span><span id="local-6989586621679118211"><span class="annot"><span class="annottext">e :: PolicyViolationException
</span><a href="#local-6989586621679118211"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-type">PolicyViolationException</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-534"></span><span>        </span><span class="annot"><span class="annottext">PolicyViolationException -&gt; SomeException
forall e. ExceptionWithReason e =&gt; e -&gt; SomeException
</span><a href="Snap.Internal.Util.FileUploads.html#uploadExceptionToException"><span class="hs-identifier hs-var">uploadExceptionToException</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyViolationException
</span><a href="#local-6989586621679118211"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-535"></span><span>    </span><span id="local-6989586621679118213"><span class="annot"><span class="annottext">fromException :: SomeException -&gt; Maybe PolicyViolationException
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe PolicyViolationException
forall e. ExceptionWithReason e =&gt; SomeException -&gt; Maybe e
</span><a href="Snap.Internal.Util.FileUploads.html#uploadExceptionFromException"><span class="hs-identifier hs-var">uploadExceptionFromException</span></a></span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#ExceptionWithReason"><span class="hs-identifier hs-type">ExceptionWithReason</span></a></span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-type">PolicyViolationException</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-538"></span><span>    </span><span id="local-6989586621679118218"><span class="annot"><span class="annottext">exceptionReason :: PolicyViolationException -&gt; Text
</span><a href="Snap.Internal.Util.FileUploads.html#exceptionReason"><span class="hs-identifier hs-var hs-var hs-var hs-var">exceptionReason</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-type">PolicyViolationException</span></a></span><span> </span><span id="local-6989586621679118219"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118219"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-539"></span><span>        </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.html#concat"><span class="hs-identifier hs-var">T.concat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;File upload policy violation: &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118219"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679118221"><span id="local-6989586621679118225"><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-type">PolicyViolationException</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-542"></span><span>  </span><span id="local-6989586621679118230"><span class="annot"><span class="annottext">show :: PolicyViolationException -&gt; FilePath
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-type">PolicyViolationException</span></a></span><span> </span><span id="local-6989586621679118231"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118231"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;File upload policy violation: &quot;</span></span><span>
</span><span id="line-543"></span><span>                                            </span><span class="annot"><span class="annottext">FilePath -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118231"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-547"></span><span class="hs-comment">-- | 'UploadPolicy' controls overall policy decisions relating to</span><span>
</span><span id="line-548"></span><span class="hs-comment">-- @multipart/form-data@ uploads, specifically:</span><span>
</span><span id="line-549"></span><span class="hs-comment">--</span><span>
</span><span id="line-550"></span><span class="hs-comment">-- * whether to treat parts without filenames as form input (reading them into</span><span>
</span><span id="line-551"></span><span class="hs-comment">--   the 'rqParams' map)</span><span>
</span><span id="line-552"></span><span class="hs-comment">--</span><span>
</span><span id="line-553"></span><span class="hs-comment">-- * because form input is read into memory, the maximum size of a form input</span><span>
</span><span id="line-554"></span><span class="hs-comment">--   read in this manner, and the maximum number of form inputs</span><span>
</span><span id="line-555"></span><span class="hs-comment">--</span><span>
</span><span id="line-556"></span><span class="hs-comment">-- * the minimum upload rate a client must maintain before we kill the</span><span>
</span><span id="line-557"></span><span class="hs-comment">--   connection; if very low-bitrate uploads were allowed then a Snap server</span><span>
</span><span id="line-558"></span><span class="hs-comment">--   would be vulnerable to a trivial denial-of-service using a</span><span>
</span><span id="line-559"></span><span class="hs-comment">--   \&quot;slowloris\&quot;-type attack</span><span>
</span><span id="line-560"></span><span class="hs-comment">--</span><span>
</span><span id="line-561"></span><span class="hs-comment">-- * the minimum number of seconds which must elapse before we start killing</span><span>
</span><span id="line-562"></span><span class="hs-comment">--   uploads for having too low an upload rate.</span><span>
</span><span id="line-563"></span><span class="hs-comment">--</span><span>
</span><span id="line-564"></span><span class="hs-comment">-- * the amount of time we should wait before timing out the connection</span><span>
</span><span id="line-565"></span><span class="hs-comment">--   whenever we receive input from the client.</span><span>
</span><span id="line-566"></span><span class="hs-keyword">data</span><span> </span><span id="UploadPolicy"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-var">UploadPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UploadPolicy"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-var">UploadPolicy</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-567"></span><span>      </span><span id="processFormInputs"><span class="annot"><span class="annottext">UploadPolicy -&gt; Bool
</span><a href="Snap.Internal.Util.FileUploads.html#processFormInputs"><span class="hs-identifier hs-var hs-var">processFormInputs</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-568"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="maximumFormInputSize"><span class="annot"><span class="annottext">UploadPolicy -&gt; Int64
</span><a href="Snap.Internal.Util.FileUploads.html#maximumFormInputSize"><span class="hs-identifier hs-var hs-var">maximumFormInputSize</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span>
</span><span id="line-569"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="maximumNumberOfFormInputs"><span class="annot"><span class="annottext">UploadPolicy -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#maximumNumberOfFormInputs"><span class="hs-identifier hs-var hs-var">maximumNumberOfFormInputs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-570"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="minimumUploadRate"><span class="annot"><span class="annottext">UploadPolicy -&gt; Double
</span><a href="Snap.Internal.Util.FileUploads.html#minimumUploadRate"><span class="hs-identifier hs-var hs-var">minimumUploadRate</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span>
</span><span id="line-571"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="minimumUploadSeconds"><span class="annot"><span class="annottext">UploadPolicy -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#minimumUploadSeconds"><span class="hs-identifier hs-var hs-var">minimumUploadSeconds</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-572"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="uploadTimeout"><span class="annot"><span class="annottext">UploadPolicy -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#uploadTimeout"><span class="hs-identifier hs-var hs-var">uploadTimeout</span></a></span></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-573"></span><span class="hs-special">}</span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-577"></span><span class="hs-comment">-- | A reasonable set of defaults for upload policy. The default policy is:</span><span>
</span><span id="line-578"></span><span class="hs-comment">--</span><span>
</span><span id="line-579"></span><span class="hs-comment">--   [@maximum form input size@]                128kB</span><span>
</span><span id="line-580"></span><span class="hs-comment">--</span><span>
</span><span id="line-581"></span><span class="hs-comment">--   [@maximum number of form inputs@]          10</span><span>
</span><span id="line-582"></span><span class="hs-comment">--</span><span>
</span><span id="line-583"></span><span class="hs-comment">--   [@minimum upload rate@]                    1kB/s</span><span>
</span><span id="line-584"></span><span class="hs-comment">--</span><span>
</span><span id="line-585"></span><span class="hs-comment">--   [@seconds before rate limiting kicks in@]  10</span><span>
</span><span id="line-586"></span><span class="hs-comment">--</span><span>
</span><span id="line-587"></span><span class="hs-comment">--   [@inactivity timeout@]                     20 seconds</span><span>
</span><span id="line-588"></span><span class="hs-comment">--</span><span>
</span><span id="line-589"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#defaultUploadPolicy"><span class="hs-identifier hs-type">defaultUploadPolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span>
</span><span id="line-590"></span><span id="defaultUploadPolicy"><span class="annot"><span class="annottext">defaultUploadPolicy :: UploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#defaultUploadPolicy"><span class="hs-identifier hs-var hs-var">defaultUploadPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int64 -&gt; Int -&gt; Double -&gt; Int -&gt; Int -&gt; UploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-var">UploadPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679118234"><span class="hs-identifier hs-var">maxSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118235"><span class="hs-identifier hs-var">maxNum</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118236"><span class="hs-identifier hs-var">minRate</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118237"><span class="hs-identifier hs-var">minSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118238"><span class="hs-identifier hs-var">tout</span></a></span><span>
</span><span id="line-591"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-592"></span><span>    </span><span id="local-6989586621679118234"><span class="annot"><span class="annottext">maxSize :: Int64
</span><a href="#local-6989586621679118234"><span class="hs-identifier hs-var hs-var">maxSize</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Int64 -&gt; Int -&gt; Int64
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#%5E"><span class="hs-operator hs-var">^</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">17</span></span><span class="hs-glyph">::</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>    </span><span id="local-6989586621679118235"><span class="annot"><span class="annottext">maxNum :: Int
</span><a href="#local-6989586621679118235"><span class="hs-identifier hs-var hs-var">maxNum</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span>
</span><span id="line-594"></span><span>    </span><span id="local-6989586621679118236"><span class="annot"><span class="annottext">minRate :: Double
</span><a href="#local-6989586621679118236"><span class="hs-identifier hs-var hs-var">minRate</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1000</span></span><span>
</span><span id="line-595"></span><span>    </span><span id="local-6989586621679118237"><span class="annot"><span class="annottext">minSeconds :: Int
</span><a href="#local-6989586621679118237"><span class="hs-identifier hs-var hs-var">minSeconds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span>
</span><span id="line-596"></span><span>    </span><span id="local-6989586621679118238"><span class="annot"><span class="annottext">tout :: Int
</span><a href="#local-6989586621679118238"><span class="hs-identifier hs-var hs-var">tout</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-600"></span><span class="hs-comment">-- | Does this upload policy stipulate that we want to treat parts without</span><span>
</span><span id="line-601"></span><span class="hs-comment">-- filenames as form input?</span><span>
</span><span id="line-602"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#doProcessFormInputs"><span class="hs-identifier hs-type">doProcessFormInputs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-603"></span><span id="doProcessFormInputs"><span class="annot"><span class="annottext">doProcessFormInputs :: UploadPolicy -&gt; Bool
</span><a href="Snap.Internal.Util.FileUploads.html#doProcessFormInputs"><span class="hs-identifier hs-var hs-var">doProcessFormInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadPolicy -&gt; Bool
</span><a href="Snap.Internal.Util.FileUploads.html#processFormInputs"><span class="hs-identifier hs-var">processFormInputs</span></a></span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-607"></span><span class="annot"><span class="hs-comment">-- | Set the upload policy for treating parts without filenames as form input.</span></span><span>
</span><span id="line-608"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setProcessFormInputs"><span class="hs-identifier hs-type">setProcessFormInputs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span>
</span><span id="line-609"></span><span id="setProcessFormInputs"><span class="annot"><span class="annottext">setProcessFormInputs :: Bool -&gt; UploadPolicy -&gt; UploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#setProcessFormInputs"><span class="hs-identifier hs-var hs-var">setProcessFormInputs</span></a></span></span><span> </span><span id="local-6989586621679118249"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679118249"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679118250"><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679118250"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679118250"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#processFormInputs"><span class="hs-identifier hs-var">processFormInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118249"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-613"></span><span class="hs-comment">-- | Get the maximum size of a form input which will be read into our</span><span>
</span><span id="line-614"></span><span class="hs-comment">--   'rqParams' map.</span><span>
</span><span id="line-615"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#getMaximumFormInputSize"><span class="hs-identifier hs-type">getMaximumFormInputSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span>
</span><span id="line-616"></span><span id="getMaximumFormInputSize"><span class="annot"><span class="annottext">getMaximumFormInputSize :: UploadPolicy -&gt; Int64
</span><a href="Snap.Internal.Util.FileUploads.html#getMaximumFormInputSize"><span class="hs-identifier hs-var hs-var">getMaximumFormInputSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadPolicy -&gt; Int64
</span><a href="Snap.Internal.Util.FileUploads.html#maximumFormInputSize"><span class="hs-identifier hs-var">maximumFormInputSize</span></a></span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-620"></span><span class="hs-comment">-- | Set the maximum size of a form input which will be read into our</span><span>
</span><span id="line-621"></span><span class="hs-comment">--   'rqParams' map.</span><span>
</span><span id="line-622"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setMaximumFormInputSize"><span class="hs-identifier hs-type">setMaximumFormInputSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span>
</span><span id="line-623"></span><span id="setMaximumFormInputSize"><span class="annot"><span class="annottext">setMaximumFormInputSize :: Int64 -&gt; UploadPolicy -&gt; UploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#setMaximumFormInputSize"><span class="hs-identifier hs-var hs-var">setMaximumFormInputSize</span></a></span></span><span> </span><span id="local-6989586621679118251"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679118251"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679118252"><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679118252"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679118252"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#maximumFormInputSize"><span class="hs-identifier hs-var">maximumFormInputSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118251"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-627"></span><span class="hs-comment">-- | Get the maximum size of a form input which will be read into our</span><span>
</span><span id="line-628"></span><span class="hs-comment">--   'rqParams' map.</span><span>
</span><span id="line-629"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#getMaximumNumberOfFormInputs"><span class="hs-identifier hs-type">getMaximumNumberOfFormInputs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-630"></span><span id="getMaximumNumberOfFormInputs"><span class="annot"><span class="annottext">getMaximumNumberOfFormInputs :: UploadPolicy -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#getMaximumNumberOfFormInputs"><span class="hs-identifier hs-var hs-var">getMaximumNumberOfFormInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadPolicy -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#maximumNumberOfFormInputs"><span class="hs-identifier hs-var">maximumNumberOfFormInputs</span></a></span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-634"></span><span class="hs-comment">-- | Set the maximum size of a form input which will be read into our</span><span>
</span><span id="line-635"></span><span class="hs-comment">--   'rqParams' map.</span><span>
</span><span id="line-636"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setMaximumNumberOfFormInputs"><span class="hs-identifier hs-type">setMaximumNumberOfFormInputs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span>
</span><span id="line-637"></span><span id="setMaximumNumberOfFormInputs"><span class="annot"><span class="annottext">setMaximumNumberOfFormInputs :: Int -&gt; UploadPolicy -&gt; UploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#setMaximumNumberOfFormInputs"><span class="hs-identifier hs-var hs-var">setMaximumNumberOfFormInputs</span></a></span></span><span> </span><span id="local-6989586621679118253"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118253"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679118254"><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679118254"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679118254"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#maximumNumberOfFormInputs"><span class="hs-identifier hs-var">maximumNumberOfFormInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118253"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span>
</span><span id="line-640"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-641"></span><span class="hs-comment">-- | Get the minimum rate (in /bytes\/second/) a client must maintain before</span><span>
</span><span id="line-642"></span><span class="hs-comment">--   we kill the connection.</span><span>
</span><span id="line-643"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#getMinimumUploadRate"><span class="hs-identifier hs-type">getMinimumUploadRate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span>
</span><span id="line-644"></span><span id="getMinimumUploadRate"><span class="annot"><span class="annottext">getMinimumUploadRate :: UploadPolicy -&gt; Double
</span><a href="Snap.Internal.Util.FileUploads.html#getMinimumUploadRate"><span class="hs-identifier hs-var hs-var">getMinimumUploadRate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadPolicy -&gt; Double
</span><a href="Snap.Internal.Util.FileUploads.html#minimumUploadRate"><span class="hs-identifier hs-var">minimumUploadRate</span></a></span><span>
</span><span id="line-645"></span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-648"></span><span class="hs-comment">-- | Set the minimum rate (in /bytes\/second/) a client must maintain before</span><span>
</span><span id="line-649"></span><span class="hs-comment">--   we kill the connection.</span><span>
</span><span id="line-650"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setMinimumUploadRate"><span class="hs-identifier hs-type">setMinimumUploadRate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span>
</span><span id="line-651"></span><span id="setMinimumUploadRate"><span class="annot"><span class="annottext">setMinimumUploadRate :: Double -&gt; UploadPolicy -&gt; UploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#setMinimumUploadRate"><span class="hs-identifier hs-var hs-var">setMinimumUploadRate</span></a></span></span><span> </span><span id="local-6989586621679118255"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118255"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679118256"><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679118256"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679118256"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#minimumUploadRate"><span class="hs-identifier hs-var">minimumUploadRate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118255"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-655"></span><span class="hs-comment">-- | Get the amount of time which must elapse before we begin enforcing the</span><span>
</span><span id="line-656"></span><span class="hs-comment">--   upload rate minimum</span><span>
</span><span id="line-657"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#getMinimumUploadSeconds"><span class="hs-identifier hs-type">getMinimumUploadSeconds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-658"></span><span id="getMinimumUploadSeconds"><span class="annot"><span class="annottext">getMinimumUploadSeconds :: UploadPolicy -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#getMinimumUploadSeconds"><span class="hs-identifier hs-var hs-var">getMinimumUploadSeconds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadPolicy -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#minimumUploadSeconds"><span class="hs-identifier hs-var">minimumUploadSeconds</span></a></span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-662"></span><span class="hs-comment">-- | Set the amount of time which must elapse before we begin enforcing the</span><span>
</span><span id="line-663"></span><span class="hs-comment">--   upload rate minimum</span><span>
</span><span id="line-664"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setMinimumUploadSeconds"><span class="hs-identifier hs-type">setMinimumUploadSeconds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span>
</span><span id="line-665"></span><span id="setMinimumUploadSeconds"><span class="annot"><span class="annottext">setMinimumUploadSeconds :: Int -&gt; UploadPolicy -&gt; UploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#setMinimumUploadSeconds"><span class="hs-identifier hs-var hs-var">setMinimumUploadSeconds</span></a></span></span><span> </span><span id="local-6989586621679118257"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118257"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679118258"><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679118258"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679118258"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#minimumUploadSeconds"><span class="hs-identifier hs-var">minimumUploadSeconds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118257"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-669"></span><span class="hs-comment">-- | Get the \&quot;upload timeout\&quot;. Whenever input is received from the client,</span><span>
</span><span id="line-670"></span><span class="hs-comment">--   the connection timeout is set this many seconds in the future.</span><span>
</span><span id="line-671"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#getUploadTimeout"><span class="hs-identifier hs-type">getUploadTimeout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-672"></span><span id="getUploadTimeout"><span class="annot"><span class="annottext">getUploadTimeout :: UploadPolicy -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#getUploadTimeout"><span class="hs-identifier hs-var hs-var">getUploadTimeout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadPolicy -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#uploadTimeout"><span class="hs-identifier hs-var">uploadTimeout</span></a></span><span>
</span><span id="line-673"></span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-676"></span><span class="annot"><span class="hs-comment">-- | Set the upload timeout.</span></span><span>
</span><span id="line-677"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setUploadTimeout"><span class="hs-identifier hs-type">setUploadTimeout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#UploadPolicy"><span class="hs-identifier hs-type">UploadPolicy</span></a></span><span>
</span><span id="line-678"></span><span id="setUploadTimeout"><span class="annot"><span class="annottext">setUploadTimeout :: Int -&gt; UploadPolicy -&gt; UploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#setUploadTimeout"><span class="hs-identifier hs-var hs-var">setUploadTimeout</span></a></span></span><span> </span><span id="local-6989586621679118259"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118259"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679118260"><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679118260"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UploadPolicy
</span><a href="#local-6989586621679118260"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#uploadTimeout"><span class="hs-identifier hs-var">uploadTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118259"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-682"></span><span>
</span><span id="line-683"></span><span class="hs-comment">-- | File upload policy, if any policy is violated then</span><span>
</span><span id="line-684"></span><span class="hs-comment">-- 'PolicyViolationException' is thrown</span><span>
</span><span id="line-685"></span><span class="hs-keyword">data</span><span> </span><span id="FileUploadPolicy"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadPolicy"><span class="hs-identifier hs-var">FileUploadPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FileUploadPolicy"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadPolicy"><span class="hs-identifier hs-var">FileUploadPolicy</span></a></span></span><span>
</span><span id="line-686"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="maxFileUploadSize"><span class="annot"><span class="annottext">FileUploadPolicy -&gt; Int64
</span><a href="Snap.Internal.Util.FileUploads.html#maxFileUploadSize"><span class="hs-identifier hs-var hs-var">maxFileUploadSize</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span>
</span><span id="line-687"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="maxNumberOfFiles"><span class="annot"><span class="annottext">FileUploadPolicy -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#maxNumberOfFiles"><span class="hs-identifier hs-var hs-var">maxNumberOfFiles</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-688"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="skipEmptyFileName"><span class="annot"><span class="annottext">FileUploadPolicy -&gt; Bool
</span><a href="Snap.Internal.Util.FileUploads.html#skipEmptyFileName"><span class="hs-identifier hs-var hs-var">skipEmptyFileName</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-689"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="maxEmptyFileNameSize"><span class="annot"><span class="annottext">FileUploadPolicy -&gt; Int64
</span><a href="Snap.Internal.Util.FileUploads.html#maxEmptyFileNameSize"><span class="hs-identifier hs-var hs-var">maxEmptyFileNameSize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span>
</span><span id="line-690"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span class="hs-comment">-- | A default 'FileUploadPolicy'</span><span>
</span><span id="line-693"></span><span class="hs-comment">--</span><span>
</span><span id="line-694"></span><span class="hs-comment">--   [@maximum file size@]             1MB</span><span>
</span><span id="line-695"></span><span class="hs-comment">--</span><span>
</span><span id="line-696"></span><span class="hs-comment">--   [@maximum number of files@]       10</span><span>
</span><span id="line-697"></span><span class="hs-comment">--</span><span>
</span><span id="line-698"></span><span class="hs-comment">--   [@skip files without name@]       yes</span><span>
</span><span id="line-699"></span><span class="hs-comment">--</span><span>
</span><span id="line-700"></span><span class="hs-comment">--   [@maximum size of skipped file@]  0</span><span>
</span><span id="line-701"></span><span class="hs-comment">--</span><span>
</span><span id="line-702"></span><span class="hs-comment">--</span><span>
</span><span id="line-703"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#defaultFileUploadPolicy"><span class="hs-identifier hs-type">defaultFileUploadPolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadPolicy"><span class="hs-identifier hs-type">FileUploadPolicy</span></a></span><span>
</span><span id="line-704"></span><span id="defaultFileUploadPolicy"><span class="annot"><span class="annottext">defaultFileUploadPolicy :: FileUploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#defaultFileUploadPolicy"><span class="hs-identifier hs-var hs-var">defaultFileUploadPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int -&gt; Bool -&gt; Int64 -&gt; FileUploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#FileUploadPolicy"><span class="hs-identifier hs-var">FileUploadPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679118262"><span class="hs-identifier hs-var">maxFileSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118263"><span class="hs-identifier hs-var">maxFiles</span></a></span><span>
</span><span id="line-705"></span><span>                                           </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679118264"><span class="hs-identifier hs-var">skipEmptyName</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679118265"><span class="hs-identifier hs-var">maxEmptySize</span></a></span><span>
</span><span id="line-706"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-707"></span><span>    </span><span id="local-6989586621679118262"><span class="annot"><span class="annottext">maxFileSize :: Int64
</span><a href="#local-6989586621679118262"><span class="hs-identifier hs-var hs-var">maxFileSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">1048576</span></span><span> </span><span class="hs-comment">-- 1MB</span><span>
</span><span id="line-708"></span><span>    </span><span id="local-6989586621679118263"><span class="annot"><span class="annottext">maxFiles :: Int
</span><a href="#local-6989586621679118263"><span class="hs-identifier hs-var hs-var">maxFiles</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span>
</span><span id="line-709"></span><span>    </span><span id="local-6989586621679118264"><span class="annot"><span class="annottext">skipEmptyName :: Bool
</span><a href="#local-6989586621679118264"><span class="hs-identifier hs-var hs-var">skipEmptyName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-710"></span><span>    </span><span id="local-6989586621679118265"><span class="annot"><span class="annottext">maxEmptySize :: Int64
</span><a href="#local-6989586621679118265"><span class="hs-identifier hs-var hs-var">maxEmptySize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span class="annot"><span class="hs-comment">-- | Maximum size of single uploaded file.</span></span><span>
</span><span id="line-713"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setMaximumFileSize"><span class="hs-identifier hs-type">setMaximumFileSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadPolicy"><span class="hs-identifier hs-type">FileUploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadPolicy"><span class="hs-identifier hs-type">FileUploadPolicy</span></a></span><span>
</span><span id="line-714"></span><span id="setMaximumFileSize"><span class="annot"><span class="annottext">setMaximumFileSize :: Int64 -&gt; FileUploadPolicy -&gt; FileUploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#setMaximumFileSize"><span class="hs-identifier hs-var hs-var">setMaximumFileSize</span></a></span></span><span> </span><span id="local-6989586621679118269"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679118269"><span class="hs-identifier hs-var">maxSize</span></a></span></span><span> </span><span id="local-6989586621679118270"><span class="annot"><span class="annottext">FileUploadPolicy
</span><a href="#local-6989586621679118270"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-715"></span><span>    </span><span class="annot"><span class="annottext">FileUploadPolicy
</span><a href="#local-6989586621679118270"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#maxFileUploadSize"><span class="hs-identifier hs-var">maxFileUploadSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118269"><span class="hs-identifier hs-type">maxSize</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span class="annot"><span class="hs-comment">-- | Maximum number of uploaded files.</span></span><span>
</span><span id="line-718"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setMaximumNumberOfFiles"><span class="hs-identifier hs-type">setMaximumNumberOfFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadPolicy"><span class="hs-identifier hs-type">FileUploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadPolicy"><span class="hs-identifier hs-type">FileUploadPolicy</span></a></span><span>
</span><span id="line-719"></span><span id="setMaximumNumberOfFiles"><span class="annot"><span class="annottext">setMaximumNumberOfFiles :: Int -&gt; FileUploadPolicy -&gt; FileUploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#setMaximumNumberOfFiles"><span class="hs-identifier hs-var hs-var">setMaximumNumberOfFiles</span></a></span></span><span> </span><span id="local-6989586621679118271"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118271"><span class="hs-identifier hs-var">maxFiles</span></a></span></span><span> </span><span id="local-6989586621679118272"><span class="annot"><span class="annottext">FileUploadPolicy
</span><a href="#local-6989586621679118272"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-720"></span><span>    </span><span class="annot"><span class="annottext">FileUploadPolicy
</span><a href="#local-6989586621679118272"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#maxNumberOfFiles"><span class="hs-identifier hs-var">maxNumberOfFiles</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118271"><span class="hs-identifier hs-type">maxFiles</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-721"></span><span>
</span><span id="line-722"></span><span class="hs-comment">-- | Skip files with empty file names.</span><span>
</span><span id="line-723"></span><span class="hs-comment">--</span><span>
</span><span id="line-724"></span><span class="hs-comment">-- If set, parts without filenames will not be fed to storage function.</span><span>
</span><span id="line-725"></span><span class="hs-comment">--</span><span>
</span><span id="line-726"></span><span class="hs-comment">-- HTML5 form data encoding standard states that form input fields of type</span><span>
</span><span id="line-727"></span><span class="hs-comment">-- file, without value set, are encoded same way as if file with empty body,</span><span>
</span><span id="line-728"></span><span class="hs-comment">-- empty file name, and type @application/octet-stream@ was set as value.</span><span>
</span><span id="line-729"></span><span class="hs-comment">--</span><span>
</span><span id="line-730"></span><span class="hs-comment">-- You most likely want to use this with zero bytes allowed to avoid storing</span><span>
</span><span id="line-731"></span><span class="hs-comment">-- such fields (see 'setMaximumSkippedFileSize').</span><span>
</span><span id="line-732"></span><span class="hs-comment">--</span><span>
</span><span id="line-733"></span><span class="hs-comment">-- By default files without names are skipped.</span><span>
</span><span id="line-734"></span><span class="hs-comment">--</span><span>
</span><span id="line-735"></span><span class="hs-comment">-- /Since: 1.0.3.0/</span><span>
</span><span id="line-736"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setSkipFilesWithoutNames"><span class="hs-identifier hs-type">setSkipFilesWithoutNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadPolicy"><span class="hs-identifier hs-type">FileUploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadPolicy"><span class="hs-identifier hs-type">FileUploadPolicy</span></a></span><span>
</span><span id="line-737"></span><span id="setSkipFilesWithoutNames"><span class="annot"><span class="annottext">setSkipFilesWithoutNames :: Bool -&gt; FileUploadPolicy -&gt; FileUploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#setSkipFilesWithoutNames"><span class="hs-identifier hs-var hs-var">setSkipFilesWithoutNames</span></a></span></span><span> </span><span id="local-6989586621679118273"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679118273"><span class="hs-identifier hs-var">shouldSkip</span></a></span></span><span> </span><span id="local-6989586621679118274"><span class="annot"><span class="annottext">FileUploadPolicy
</span><a href="#local-6989586621679118274"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-738"></span><span>    </span><span class="annot"><span class="annottext">FileUploadPolicy
</span><a href="#local-6989586621679118274"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#skipEmptyFileName"><span class="hs-identifier hs-var">skipEmptyFileName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118273"><span class="hs-identifier hs-type">shouldSkip</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-739"></span><span>
</span><span id="line-740"></span><span class="hs-comment">-- | Maximum size of file without name which can be skipped.</span><span>
</span><span id="line-741"></span><span class="hs-comment">--</span><span>
</span><span id="line-742"></span><span class="hs-comment">-- Ignored if 'setSkipFilesWithoutNames' is @False@.</span><span>
</span><span id="line-743"></span><span class="hs-comment">--</span><span>
</span><span id="line-744"></span><span class="hs-comment">-- If skipped file is larger than this setting then 'FileUploadException'</span><span>
</span><span id="line-745"></span><span class="hs-comment">-- is thrown.</span><span>
</span><span id="line-746"></span><span class="hs-comment">--</span><span>
</span><span id="line-747"></span><span class="hs-comment">-- By default maximum file size is 0.</span><span>
</span><span id="line-748"></span><span class="hs-comment">--</span><span>
</span><span id="line-749"></span><span class="hs-comment">-- /Since: 1.0.3.0/</span><span>
</span><span id="line-750"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#setMaximumSkippedFileSize"><span class="hs-identifier hs-type">setMaximumSkippedFileSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadPolicy"><span class="hs-identifier hs-type">FileUploadPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FileUploadPolicy"><span class="hs-identifier hs-type">FileUploadPolicy</span></a></span><span>
</span><span id="line-751"></span><span id="setMaximumSkippedFileSize"><span class="annot"><span class="annottext">setMaximumSkippedFileSize :: Int64 -&gt; FileUploadPolicy -&gt; FileUploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#setMaximumSkippedFileSize"><span class="hs-identifier hs-var hs-var">setMaximumSkippedFileSize</span></a></span></span><span> </span><span id="local-6989586621679118275"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679118275"><span class="hs-identifier hs-var">maxSize</span></a></span></span><span> </span><span id="local-6989586621679118276"><span class="annot"><span class="annottext">FileUploadPolicy
</span><a href="#local-6989586621679118276"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-752"></span><span>    </span><span class="annot"><span class="annottext">FileUploadPolicy
</span><a href="#local-6989586621679118276"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#maxEmptyFileNameSize"><span class="hs-identifier hs-var">maxEmptyFileNameSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118275"><span class="hs-identifier hs-type">maxSize</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-753"></span><span>
</span><span id="line-754"></span><span>
</span><span id="line-755"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-756"></span><span class="hs-comment">-- | Upload policy can be set on an \&quot;general\&quot; basis (using 'UploadPolicy'),</span><span>
</span><span id="line-757"></span><span class="hs-comment">--   but handlers can also make policy decisions on individual files\/parts</span><span>
</span><span id="line-758"></span><span class="hs-comment">--   uploaded. For each part uploaded, handlers can decide:</span><span>
</span><span id="line-759"></span><span class="hs-comment">--</span><span>
</span><span id="line-760"></span><span class="hs-comment">-- * whether to allow the file upload at all</span><span>
</span><span id="line-761"></span><span class="hs-comment">--</span><span>
</span><span id="line-762"></span><span class="hs-comment">-- * the maximum size of uploaded files, if allowed</span><span>
</span><span id="line-763"></span><span class="hs-keyword">data</span><span> </span><span id="PartUploadPolicy"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartUploadPolicy"><span class="hs-identifier hs-var">PartUploadPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PartUploadPolicy"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartUploadPolicy"><span class="hs-identifier hs-var">PartUploadPolicy</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>
</span><span id="line-765"></span><span>
</span><span id="line-766"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-767"></span><span class="annot"><span class="hs-comment">-- | Disallows the file to be uploaded.</span></span><span>
</span><span id="line-768"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#disallow"><span class="hs-identifier hs-type">disallow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartUploadPolicy"><span class="hs-identifier hs-type">PartUploadPolicy</span></a></span><span>
</span><span id="line-769"></span><span id="disallow"><span class="annot"><span class="annottext">disallow :: PartUploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#disallow"><span class="hs-identifier hs-var hs-var">disallow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int64 -&gt; PartUploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#PartUploadPolicy"><span class="hs-identifier hs-var">PartUploadPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int64
forall a. Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span>
</span><span id="line-772"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-773"></span><span class="annot"><span class="hs-comment">-- | Allows the file to be uploaded, with maximum size /n/ in bytes.</span></span><span>
</span><span id="line-774"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#allowWithMaximumSize"><span class="hs-identifier hs-type">allowWithMaximumSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartUploadPolicy"><span class="hs-identifier hs-type">PartUploadPolicy</span></a></span><span>
</span><span id="line-775"></span><span id="allowWithMaximumSize"><span class="annot"><span class="annottext">allowWithMaximumSize :: Int64 -&gt; PartUploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#allowWithMaximumSize"><span class="hs-identifier hs-var hs-var">allowWithMaximumSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int64 -&gt; PartUploadPolicy
</span><a href="Snap.Internal.Util.FileUploads.html#PartUploadPolicy"><span class="hs-identifier hs-var">PartUploadPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int64 -&gt; PartUploadPolicy)
-&gt; (Int64 -&gt; Maybe Int64) -&gt; Int64 -&gt; PartUploadPolicy
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Maybe Int64
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span>
</span><span id="line-778"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-779"></span><span class="annot"><span class="hs-comment">-- | Stores file body in memory as Lazy ByteString.</span></span><span>
</span><span id="line-780"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#storeAsLazyByteString"><span class="hs-identifier hs-type">storeAsLazyByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InputStream</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">LB.ByteString</span></a></span><span>
</span><span id="line-781"></span><span id="storeAsLazyByteString"><span class="annot"><span class="annottext">storeAsLazyByteString :: InputStream ByteString -&gt; IO ByteString
</span><a href="Snap.Internal.Util.FileUploads.html#storeAsLazyByteString"><span class="hs-identifier hs-var hs-var">storeAsLazyByteString</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118277"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118277"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-782"></span><span>   </span><span id="local-6989586621679118278"><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621679118278"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((ByteString -&gt; ByteString)
 -&gt; ByteString -&gt; ByteString -&gt; ByteString)
-&gt; (ByteString -&gt; ByteString)
-&gt; InputStream ByteString
-&gt; IO (ByteString -&gt; ByteString)
forall s a. (s -&gt; a -&gt; s) -&gt; s -&gt; InputStream a -&gt; IO s
</span><span class="hs-identifier hs-var">Streams.fold</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679118280"><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621679118280"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679118281"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118281"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621679118280"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#chunk"><span class="hs-identifier hs-var">LB.chunk</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118281"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
forall a. a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118277"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-783"></span><span>   </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ByteString) -&gt; ByteString -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621679118278"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#Empty"><span class="hs-identifier hs-var">LB.Empty</span></a></span><span>
</span><span id="line-784"></span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-787"></span><span class="hs-comment">-- | Store files in a temporary directory, and clean up on function exit.</span><span>
</span><span id="line-788"></span><span class="hs-comment">--</span><span>
</span><span id="line-789"></span><span class="hs-comment">-- Files are safe to move until function exists.</span><span>
</span><span id="line-790"></span><span class="hs-comment">--</span><span>
</span><span id="line-791"></span><span class="hs-comment">-- If asynchronous exception is thrown during cleanup, temporary files may</span><span>
</span><span id="line-792"></span><span class="hs-comment">-- remain.</span><span>
</span><span id="line-793"></span><span class="hs-comment">--</span><span>
</span><span id="line-794"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-795"></span><span class="hs-comment">-- uploadsHandler = withTemporaryStore &quot;/var/tmp&quot; &quot;upload-&quot; $ \store -&gt; do</span><span>
</span><span id="line-796"></span><span class="hs-comment">--     (inputs, files) &lt;- handleFormUploads defaultUploadpolicy</span><span>
</span><span id="line-797"></span><span class="hs-comment">--                                          defaultFileUploadPolicy</span><span>
</span><span id="line-798"></span><span class="hs-comment">--                                          (const store)</span><span>
</span><span id="line-799"></span><span class="hs-comment">--     saveFiles files</span><span>
</span><span id="line-800"></span><span class="hs-comment">--</span><span>
</span><span id="line-801"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-802"></span><span class="hs-comment">--</span><span>
</span><span id="line-803"></span><span id="local-6989586621679117475"><span id="local-6989586621679117476"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#withTemporaryStore"><span class="hs-identifier hs-type">withTemporaryStore</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-804"></span><span>    </span><span class="annot"><a href="Snap.Internal.Core.html#MonadSnap"><span class="hs-identifier hs-type">MonadSnap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117475"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-805"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ temporary directory</span></span><span>
</span><span id="line-806"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ file name pattern</span></span><span>
</span><span id="line-807"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InputStream</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679117475"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117476"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-808"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Action taking store function</span></span><span>
</span><span id="line-809"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679117475"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117476"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-810"></span><span id="withTemporaryStore"><span class="annot"><span class="annottext">withTemporaryStore :: forall (m :: * -&gt; *) a.
MonadSnap m =&gt;
FilePath
-&gt; FilePath
-&gt; ((InputStream ByteString -&gt; IO FilePath) -&gt; m a)
-&gt; m a
</span><a href="Snap.Internal.Util.FileUploads.html#withTemporaryStore"><span class="hs-identifier hs-var hs-var">withTemporaryStore</span></a></span></span><span> </span><span id="local-6989586621679118291"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118291"><span class="hs-identifier hs-var">tempdir</span></a></span></span><span> </span><span id="local-6989586621679118292"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118292"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621679118293"><span class="annot"><span class="annottext">(InputStream ByteString -&gt; IO FilePath) -&gt; m a
</span><a href="#local-6989586621679118293"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-811"></span><span>    </span><span id="local-6989586621679118294"><span class="annot"><span class="annottext">IORef [FilePath]
</span><a href="#local-6989586621679118294"><span class="hs-identifier hs-var">ioref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef [FilePath]) -&gt; m (IORef [FilePath])
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (IORef [FilePath]) -&gt; m (IORef [FilePath]))
-&gt; IO (IORef [FilePath]) -&gt; m (IORef [FilePath])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; IO (IORef [FilePath])
forall a. a -&gt; IO (IORef a)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">IORef.newIORef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-812"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-813"></span><span>      </span><span id="local-6989586621679118297"><span class="annot"><span class="annottext">modifyIORef' :: IORef a -&gt; (a -&gt; a) -&gt; IO ()
</span><a href="#local-6989586621679118297"><span class="hs-identifier hs-var hs-var">modifyIORef'</span></a></span></span><span> </span><span id="local-6989586621679118298"><span class="annot"><span class="annottext">IORef a
</span><a href="#local-6989586621679118298"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679118299"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679118299"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- ghc 7.4 does not have modifyIORef'</span><span>
</span><span id="line-814"></span><span>          </span><span id="local-6989586621679118300"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118300"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef a -&gt; IO a
forall a. IORef a -&gt; IO a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">IORef.readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef a
</span><a href="#local-6989586621679118298"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-815"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118302"><span class="annot"><span class="annottext">x' :: a
</span><a href="#local-6989586621679118302"><span class="hs-identifier hs-var hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679118299"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118300"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-816"></span><span>          </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118302"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; IO () -&gt; IO ()
forall a b. a -&gt; b -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Prim.html#seq"><span class="hs-operator hs-var">`seq`</span></a></span><span> </span><span class="annot"><span class="annottext">IORef a -&gt; a -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IORef.html#writeIORef"><span class="hs-identifier hs-var">IORef.writeIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef a
</span><a href="#local-6989586621679118298"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118302"><span class="hs-identifier hs-var">x'</span></a></span><span>
</span><span id="line-817"></span><span>
</span><span id="line-818"></span><span>      </span><span id="local-6989586621679118311"><span class="annot"><span class="annottext">go :: InputStream ByteString -&gt; IO FilePath
</span><a href="#local-6989586621679118311"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679118312"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118312"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-819"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679118313"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118313"><span class="hs-identifier hs-var">fn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118314"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679118314"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; IO (FilePath, Handle)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/System.IO.html#openBinaryTempFile"><span class="hs-identifier hs-var">openBinaryTempFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118291"><span class="hs-identifier hs-var">tempdir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118292"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-820"></span><span>          </span><span class="annot"><span class="annottext">IORef [FilePath] -&gt; ([FilePath] -&gt; [FilePath]) -&gt; IO ()
forall {a}. IORef a -&gt; (a -&gt; a) -&gt; IO ()
</span><a href="#local-6989586621679118297"><span class="hs-identifier hs-var">modifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [FilePath]
</span><a href="#local-6989586621679118294"><span class="hs-identifier hs-var">ioref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118313"><span class="hs-identifier hs-var">fn</span></a></span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; [FilePath]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-821"></span><span>          </span><span class="annot"><span class="annottext">Handle -&gt; BufferMode -&gt; IO ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Handle.html#hSetBuffering"><span class="hs-identifier hs-var">hSetBuffering</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679118314"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">BufferMode
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Handle.Types.html#NoBuffering"><span class="hs-identifier hs-var">NoBuffering</span></a></span><span>
</span><span id="line-822"></span><span>          </span><span id="local-6989586621679118315"><span class="annot"><span class="annottext">OutputStream ByteString
</span><a href="#local-6989586621679118315"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO (OutputStream ByteString)
</span><span class="hs-identifier hs-var">Streams.handleToOutputStream</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679118314"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-823"></span><span>          </span><span class="annot"><span class="annottext">InputStream ByteString -&gt; OutputStream ByteString -&gt; IO ()
forall a. InputStream a -&gt; OutputStream a -&gt; IO ()
</span><span class="hs-identifier hs-var">Streams.connect</span></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118312"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">OutputStream ByteString
</span><a href="#local-6989586621679118315"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-824"></span><span>          </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Handle.html#hClose"><span class="hs-identifier hs-var">hClose</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679118314"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-825"></span><span>          </span><span class="annot"><span class="annottext">FilePath -&gt; IO FilePath
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118313"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span>      </span><span id="local-6989586621679118329"><span class="annot"><span class="annottext">cleanup :: m ()
</span><a href="#local-6989586621679118329"><span class="hs-identifier hs-var hs-var">cleanup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-828"></span><span>          </span><span id="local-6989586621679118330"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679118330"><span class="hs-identifier hs-var">files</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef [FilePath] -&gt; IO [FilePath]
forall a. IORef a -&gt; IO a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">IORef.readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [FilePath]
</span><a href="#local-6989586621679118294"><span class="hs-identifier hs-var">ioref</span></a></span><span>
</span><span id="line-829"></span><span>          </span><span class="annot"><span class="annottext">[FilePath] -&gt; (FilePath -&gt; IO ()) -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679118330"><span class="hs-identifier hs-var">files</span></a></span><span> </span><span class="annot"><span class="annottext">((FilePath -&gt; IO ()) -&gt; IO ()) -&gt; (FilePath -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679118331"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118331"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-830"></span><span>             </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/directory-1.3.8.1/src/System.Directory.html#removeFile"><span class="hs-identifier hs-var">removeFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118331"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; (IOError -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) e a.
(MonadBaseControl IO m, Exception e) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catch`</span></span><span> </span><span class="annot"><span class="annottext">IOError -&gt; IO ()
forall {f :: * -&gt; *}. MonadBase IO f =&gt; IOError -&gt; f ()
</span><a href="#local-6989586621679118332"><span class="hs-identifier hs-var">handleExists</span></a></span><span>
</span><span id="line-831"></span><span>      </span><span id="local-6989586621679118332"><span class="annot"><span class="annottext">handleExists :: IOError -&gt; f ()
</span><a href="#local-6989586621679118332"><span class="hs-identifier hs-var hs-var">handleExists</span></a></span></span><span> </span><span id="local-6989586621679118348"><span class="annot"><span class="annottext">IOError
</span><a href="#local-6989586621679118348"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; f () -&gt; f ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOError -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/System.IO.Error.html#isDoesNotExistError"><span class="hs-identifier hs-var">isDoesNotExistError</span></a></span><span> </span><span class="annot"><span class="annottext">IOError
</span><a href="#local-6989586621679118348"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(f () -&gt; f ()) -&gt; f () -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IOError -&gt; f ()
forall (m :: * -&gt; *) e a. (MonadBase IO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">IOError
</span><a href="#local-6989586621679118348"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-832"></span><span>
</span><span id="line-833"></span><span>    </span><span class="annot"><span class="annottext">(InputStream ByteString -&gt; IO FilePath) -&gt; m a
</span><a href="#local-6989586621679118293"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString -&gt; IO FilePath
</span><a href="#local-6989586621679118311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; m () -&gt; m a
forall (m :: * -&gt; *) a b.
MonadBaseControl IO m =&gt;
m a -&gt; m b -&gt; m a
</span><span class="hs-operator hs-var">`finally`</span></span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679118329"><span class="hs-identifier hs-var">cleanup</span></a></span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span>
</span><span id="line-836"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-837"></span><span class="hs-comment">-- private exports follow. FIXME: organize</span><span>
</span><span id="line-838"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-839"></span><span>
</span><span id="line-840"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-841"></span><span id="local-6989586621679117423"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#captureVariableOrReadFile"><span class="hs-identifier hs-type">captureVariableOrReadFile</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-842"></span><span>       </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span>                                   </span><span class="annot"><span class="hs-comment">-- ^ maximum size of form input</span></span><span>
</span><span id="line-843"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartFold"><span class="hs-identifier hs-type">PartFold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117423"><span class="hs-identifier hs-type">a</span></a></span><span>                              </span><span class="annot"><span class="hs-comment">-- ^ file reading code</span></span><span>
</span><span id="line-844"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartInfo"><span class="hs-identifier hs-type">PartInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InputStream</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-845"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679117423"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-846"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#Capture"><span class="hs-identifier hs-type">Capture</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117423"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-847"></span><span id="captureVariableOrReadFile"><span class="annot"><span class="annottext">captureVariableOrReadFile :: forall a.
Int64
-&gt; PartFold a
-&gt; PartInfo
-&gt; InputStream ByteString
-&gt; a
-&gt; IO (Capture a)
</span><a href="Snap.Internal.Util.FileUploads.html#captureVariableOrReadFile"><span class="hs-identifier hs-var hs-var">captureVariableOrReadFile</span></a></span></span><span> </span><span id="local-6989586621679118353"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679118353"><span class="hs-identifier hs-var">maxSize</span></a></span></span><span> </span><span id="local-6989586621679118354"><span class="annot"><span class="annottext">PartFold a
</span><a href="#local-6989586621679118354"><span class="hs-identifier hs-var">fileHandler</span></a></span></span><span> </span><span id="local-6989586621679118355"><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679118355"><span class="hs-identifier hs-var">partInfo</span></a></span></span><span> </span><span id="local-6989586621679118356"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118356"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span id="local-6989586621679118357"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118357"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-848"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679118358"><span class="hs-identifier hs-var">isFile</span></a></span><span>
</span><span id="line-849"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Capture a) -&gt; IO a -&gt; IO (Capture a)
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Capture a
forall a. a -&gt; Capture a
</span><a href="Snap.Internal.Util.FileUploads.html#File"><span class="hs-identifier hs-var">File</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO (Capture a)) -&gt; IO a -&gt; IO (Capture a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PartFold a
</span><a href="#local-6989586621679118354"><span class="hs-identifier hs-var">fileHandler</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679118355"><span class="hs-identifier hs-var">partInfo</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118356"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118357"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-850"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IO (Capture a)
forall {a}. IO (Capture a)
</span><a href="#local-6989586621679118359"><span class="hs-identifier hs-var">variable</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Capture a)
-&gt; (TooManyBytesReadException -&gt; IO (Capture a)) -&gt; IO (Capture a)
forall (m :: * -&gt; *) e a.
(MonadBaseControl IO m, Exception e) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catch`</span></span><span> </span><span class="annot"><span class="annottext">TooManyBytesReadException -&gt; IO (Capture a)
forall {m :: * -&gt; *} {a}.
MonadBase IO m =&gt;
TooManyBytesReadException -&gt; m a
</span><a href="#local-6989586621679118360"><span class="hs-identifier hs-var">handler</span></a></span><span>
</span><span id="line-851"></span><span>
</span><span id="line-852"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-853"></span><span>    </span><span id="local-6989586621679118358"><span class="annot"><span class="annottext">isFile :: Bool
</span><a href="#local-6989586621679118358"><span class="hs-identifier hs-var hs-var">isFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PartInfo -&gt; Maybe ByteString
</span><a href="Snap.Internal.Util.FileUploads.html#partFileName"><span class="hs-identifier hs-var">partFileName</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679118355"><span class="hs-identifier hs-var">partInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span>
</span><span id="line-854"></span><span>             </span><span class="annot"><span class="annottext">PartInfo -&gt; PartDisposition
</span><a href="Snap.Internal.Util.FileUploads.html#partDisposition"><span class="hs-identifier hs-var">partDisposition</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679118355"><span class="hs-identifier hs-var">partInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PartDisposition -&gt; PartDisposition -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">PartDisposition
</span><a href="Snap.Internal.Util.FileUploads.html#DispositionFile"><span class="hs-identifier hs-var">DispositionFile</span></a></span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span>    </span><span id="local-6989586621679118359"><span class="annot"><span class="annottext">variable :: IO (Capture a)
</span><a href="#local-6989586621679118359"><span class="hs-identifier hs-var hs-var">variable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-857"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679118366"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118366"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString) -&gt; IO [ByteString] -&gt; IO ByteString
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.html#concat"><span class="hs-identifier hs-var">S.concat</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [ByteString] -&gt; IO ByteString)
-&gt; IO [ByteString] -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-858"></span><span>             </span><span class="annot"><span class="annottext">Int64 -&gt; InputStream ByteString -&gt; IO (InputStream ByteString)
</span><span class="hs-identifier hs-var">Streams.throwIfProducesMoreThan</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679118353"><span class="hs-identifier hs-var">maxSize</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118356"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="annot"><span class="annottext">IO (InputStream ByteString)
-&gt; (InputStream ByteString -&gt; IO [ByteString]) -&gt; IO [ByteString]
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString -&gt; IO [ByteString]
forall a. InputStream a -&gt; IO [a]
</span><span class="hs-identifier hs-var">Streams.toList</span></span><span>
</span><span id="line-859"></span><span>        </span><span class="annot"><span class="annottext">Capture a -&gt; IO (Capture a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Capture a -&gt; IO (Capture a)) -&gt; Capture a -&gt; IO (Capture a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Capture a
forall a. ByteString -&gt; ByteString -&gt; Capture a
</span><a href="Snap.Internal.Util.FileUploads.html#Capture"><span class="hs-identifier hs-var">Capture</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118370"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118366"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-860"></span><span>
</span><span id="line-861"></span><span>    </span><span id="local-6989586621679118370"><span class="annot"><span class="annottext">fieldName :: ByteString
</span><a href="#local-6989586621679118370"><span class="hs-identifier hs-var hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartInfo -&gt; ByteString
</span><a href="Snap.Internal.Util.FileUploads.html#partFieldName"><span class="hs-identifier hs-var">partFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679118355"><span class="hs-identifier hs-var">partInfo</span></a></span><span>
</span><span id="line-862"></span><span>
</span><span id="line-863"></span><span>    </span><span id="local-6989586621679118360"><span class="annot"><span class="annottext">handler :: TooManyBytesReadException -&gt; m a
</span><a href="#local-6989586621679118360"><span class="hs-identifier hs-var hs-var">handler</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TooManyBytesReadException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TooManyBytesReadException</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-864"></span><span>        </span><span class="annot"><span class="annottext">PolicyViolationException -&gt; m a
forall (m :: * -&gt; *) e a. (MonadBase IO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(PolicyViolationException -&gt; m a)
-&gt; PolicyViolationException -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; PolicyViolationException
</span><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-var">PolicyViolationException</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; PolicyViolationException)
-&gt; Text -&gt; PolicyViolationException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-865"></span><span>                </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.html#concat"><span class="hs-identifier hs-var">T.concat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;form input '&quot;</span></span><span>
</span><span id="line-866"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Encoding.html#decodeUtf8"><span class="hs-identifier hs-var">TE.decodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118370"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-867"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;' exceeded maximum permissible size (&quot;</span></span><span>
</span><span id="line-868"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#pack"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Text) -&gt; FilePath -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679118353"><span class="hs-identifier hs-var">maxSize</span></a></span><span>
</span><span id="line-869"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; bytes)&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-870"></span><span>
</span><span id="line-871"></span><span>
</span><span id="line-872"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-873"></span><span class="hs-keyword">data</span><span> </span><span id="Capture"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#Capture"><span class="hs-identifier hs-var">Capture</span></a></span></span><span> </span><span id="local-6989586621679117424"><span class="annot"><a href="#local-6989586621679117424"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Capture"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#Capture"><span class="hs-identifier hs-var">Capture</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-874"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="File"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#File"><span class="hs-identifier hs-var">File</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679117424"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-875"></span><span>
</span><span id="line-876"></span><span>
</span><span id="line-877"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-878"></span><span id="local-6989586621679117351"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#fileReader"><span class="hs-identifier hs-type">fileReader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-879"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartInfo"><span class="hs-identifier hs-type">PartInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-type">PolicyViolationException</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117351"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-880"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartProcessor"><span class="hs-identifier hs-type">PartProcessor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117351"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-881"></span><span id="fileReader"><span class="annot"><span class="annottext">fileReader :: forall a.
FilePath
-&gt; (PartInfo -&gt; Either PolicyViolationException FilePath -&gt; IO a)
-&gt; PartProcessor a
</span><a href="Snap.Internal.Util.FileUploads.html#fileReader"><span class="hs-identifier hs-var hs-var">fileReader</span></a></span></span><span> </span><span id="local-6989586621679118392"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118392"><span class="hs-identifier hs-var">tmpdir</span></a></span></span><span> </span><span id="local-6989586621679118393"><span class="annot"><span class="annottext">PartInfo -&gt; Either PolicyViolationException FilePath -&gt; IO a
</span><a href="#local-6989586621679118393"><span class="hs-identifier hs-var">partProc</span></a></span></span><span> </span><span id="local-6989586621679118394"><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679118394"><span class="hs-identifier hs-var">partInfo</span></a></span></span><span> </span><span id="local-6989586621679118395"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118395"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-882"></span><span>    </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; ((FilePath, Handle) -&gt; IO a) -&gt; IO a
forall a.
FilePath -&gt; FilePath -&gt; ((FilePath, Handle) -&gt; IO a) -&gt; IO a
</span><a href="Snap.Internal.Util.FileUploads.html#withTempFile"><span class="hs-identifier hs-var">withTempFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118392"><span class="hs-identifier hs-var">tmpdir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;snap-upload-&quot;</span></span><span> </span><span class="annot"><span class="annottext">(((FilePath, Handle) -&gt; IO a) -&gt; IO a)
-&gt; ((FilePath, Handle) -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679118397"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118397"><span class="hs-identifier hs-var">fn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118398"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679118398"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-883"></span><span>        </span><span class="annot"><span class="annottext">Handle -&gt; BufferMode -&gt; IO ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Handle.html#hSetBuffering"><span class="hs-identifier hs-var">hSetBuffering</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679118398"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">BufferMode
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Handle.Types.html#NoBuffering"><span class="hs-identifier hs-var">NoBuffering</span></a></span><span>
</span><span id="line-884"></span><span>        </span><span id="local-6989586621679118399"><span class="annot"><span class="annottext">OutputStream ByteString
</span><a href="#local-6989586621679118399"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO (OutputStream ByteString)
</span><span class="hs-identifier hs-var">Streams.handleToOutputStream</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679118398"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-885"></span><span>        </span><span class="annot"><span class="annottext">InputStream ByteString -&gt; OutputStream ByteString -&gt; IO ()
forall a. InputStream a -&gt; OutputStream a -&gt; IO ()
</span><span class="hs-identifier hs-var">Streams.connect</span></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118395"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">OutputStream ByteString
</span><a href="#local-6989586621679118399"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-886"></span><span>        </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Handle.html#hClose"><span class="hs-identifier hs-var">hClose</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679118398"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-887"></span><span>        </span><span class="annot"><span class="annottext">PartInfo -&gt; Either PolicyViolationException FilePath -&gt; IO a
</span><a href="#local-6989586621679118393"><span class="hs-identifier hs-var">partProc</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679118394"><span class="hs-identifier hs-var">partInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Either PolicyViolationException FilePath -&gt; IO a)
-&gt; Either PolicyViolationException FilePath -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Either PolicyViolationException FilePath
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118397"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-888"></span><span>
</span><span id="line-889"></span><span>
</span><span id="line-890"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-891"></span><span class="hs-keyword">data</span><span> </span><span id="MultipartState"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#MultipartState"><span class="hs-identifier hs-var">MultipartState</span></a></span></span><span> </span><span id="local-6989586621679117510"><span class="annot"><a href="#local-6989586621679117510"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MultipartState"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#MultipartState"><span class="hs-identifier hs-var">MultipartState</span></a></span></span><span>
</span><span id="line-892"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="numFormVars"><span class="annot"><span class="annottext">forall a. MultipartState a -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#numFormVars"><span class="hs-identifier hs-var hs-var">numFormVars</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-893"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="numFormFiles"><span class="annot"><span class="annottext">forall a. MultipartState a -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#numFormFiles"><span class="hs-identifier hs-var hs-var">numFormFiles</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-894"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="capturedFields"><span class="annot"><span class="annottext">forall a. MultipartState a -&gt; [FormParam] -&gt; [FormParam]
</span><a href="Snap.Internal.Util.FileUploads.html#capturedFields"><span class="hs-identifier hs-var hs-var">capturedFields</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FormParam"><span class="hs-identifier hs-type">FormParam</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FormParam"><span class="hs-identifier hs-type">FormParam</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-895"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="accumulator"><span class="annot"><span class="annottext">forall a. MultipartState a -&gt; a
</span><a href="Snap.Internal.Util.FileUploads.html#accumulator"><span class="hs-identifier hs-var hs-var">accumulator</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679117510"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-896"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-899"></span><span class="annot"><span class="hs-comment">-- | A form parameter name-value pair</span></span><span>
</span><span id="line-900"></span><span class="hs-keyword">type</span><span> </span><span id="FormParam"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FormParam"><span class="hs-identifier hs-var">FormParam</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-901"></span><span>
</span><span id="line-902"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-903"></span><span id="local-6989586621679117516"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#addCapture"><span class="hs-identifier hs-type">addCapture</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#MultipartState"><span class="hs-identifier hs-type">MultipartState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117516"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#MultipartState"><span class="hs-identifier hs-type">MultipartState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117516"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-904"></span><span id="addCapture"><span class="annot"><span class="annottext">addCapture :: forall a.
ByteString -&gt; ByteString -&gt; MultipartState a -&gt; MultipartState a
</span><a href="Snap.Internal.Util.FileUploads.html#addCapture"><span class="hs-identifier hs-var hs-var">addCapture</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118406"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118406"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118407"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118407"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118408"><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118408"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-905"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118409"><span class="annot"><span class="annottext">kv :: FormParam
</span><a href="#local-6989586621679118409"><span class="hs-identifier hs-var hs-var">kv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118406"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118407"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-906"></span><span>      </span><span id="local-6989586621679118410"><span class="annot"><span class="annottext">f :: [FormParam] -&gt; [FormParam]
</span><a href="#local-6989586621679118410"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MultipartState a -&gt; [FormParam] -&gt; [FormParam]
forall a. MultipartState a -&gt; [FormParam] -&gt; [FormParam]
</span><a href="Snap.Internal.Util.FileUploads.html#capturedFields"><span class="hs-identifier hs-var">capturedFields</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118408"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">([FormParam] -&gt; [FormParam])
-&gt; ([FormParam] -&gt; [FormParam]) -&gt; [FormParam] -&gt; [FormParam]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">FormParam
</span><a href="#local-6989586621679118409"><span class="hs-identifier hs-var">kv</span></a></span><span class="hs-special">]</span><span class="annot"><span class="annottext">[FormParam] -&gt; [FormParam] -&gt; [FormParam]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-907"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679118412"><span class="annot"><span class="annottext">ms' :: MultipartState a
</span><a href="#local-6989586621679118412"><span class="hs-identifier hs-var hs-var">ms'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118408"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#capturedFields"><span class="hs-identifier hs-var">capturedFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118410"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-908"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#numFormVars"><span class="hs-identifier hs-var">numFormVars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Enum.html#succ"><span class="hs-identifier hs-type">succ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#numFormVars"><span class="hs-identifier hs-var">numFormVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118408"><span class="hs-identifier hs-type">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-909"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118412"><span class="hs-identifier hs-var">ms'</span></a></span><span>
</span><span id="line-910"></span><span>
</span><span id="line-911"></span><span>
</span><span id="line-912"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-913"></span><span id="local-6989586621679117432"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#internalFoldMultipart"><span class="hs-identifier hs-type">internalFoldMultipart</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-914"></span><span>       </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>           </span><span class="annot"><span class="hs-comment">-- ^ max num fields</span></span><span>
</span><span id="line-915"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>                                     </span><span class="annot"><span class="hs-comment">-- ^ boundary value</span></span><span>
</span><span id="line-916"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartInfo"><span class="hs-identifier hs-type">PartInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InputStream</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679117432"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#Capture"><span class="hs-identifier hs-type">Capture</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117432"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ part processor</span></span><span>
</span><span id="line-917"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679117432"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-918"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InputStream</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-919"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#FormParam"><span class="hs-identifier hs-type">FormParam</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679117432"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-920"></span><span id="internalFoldMultipart"><span class="annot"><span class="annottext">internalFoldMultipart :: forall a.
Int
-&gt; ByteString
-&gt; (PartInfo -&gt; InputStream ByteString -&gt; a -&gt; IO (Capture a))
-&gt; a
-&gt; InputStream ByteString
-&gt; IO ([FormParam], a)
</span><a href="Snap.Internal.Util.FileUploads.html#internalFoldMultipart"><span class="hs-identifier hs-var hs-var">internalFoldMultipart</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118413"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118413"><span class="hs-identifier hs-var">maxFormVars</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118414"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118414"><span class="hs-identifier hs-var">boundary</span></a></span></span><span> </span><span id="local-6989586621679118415"><span class="annot"><span class="annottext">PartInfo -&gt; InputStream ByteString -&gt; a -&gt; IO (Capture a)
</span><a href="#local-6989586621679118415"><span class="hs-identifier hs-var">clientHandler</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118416"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118416"><span class="hs-identifier hs-var">zeroAcc</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118417"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118417"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ([FormParam], a)
</span><a href="#local-6989586621679118418"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-921"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-922"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-923"></span><span>    </span><span id="local-6989586621679118419"><span class="annot"><span class="annottext">initialState :: MultipartState a
</span><a href="#local-6989586621679118419"><span class="hs-identifier hs-var hs-var">initialState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ([FormParam] -&gt; [FormParam]) -&gt; a -&gt; MultipartState a
forall a.
Int -&gt; Int -&gt; ([FormParam] -&gt; [FormParam]) -&gt; a -&gt; MultipartState a
</span><a href="Snap.Internal.Util.FileUploads.html#MultipartState"><span class="hs-identifier hs-var">MultipartState</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[FormParam] -&gt; [FormParam]
forall a. a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118416"><span class="hs-identifier hs-var">zeroAcc</span></a></span><span>
</span><span id="line-924"></span><span>
</span><span id="line-925"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-926"></span><span>    </span><span id="local-6989586621679118418"><span class="annot"><span class="annottext">go :: IO ([FormParam], a)
</span><a href="#local-6989586621679118418"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-927"></span><span>        </span><span class="hs-comment">-- swallow the first boundary</span><span>
</span><span id="line-928"></span><span>        </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Parser ByteString -&gt; InputStream ByteString -&gt; IO ByteString
forall r. Parser r -&gt; InputStream ByteString -&gt; IO r
</span><span class="hs-identifier hs-var">parseFromStream</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString
</span><a href="#local-6989586621679118424"><span class="hs-identifier hs-var">parseFirstBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118414"><span class="hs-identifier hs-var">boundary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118417"><span class="hs-identifier hs-var">stream</span></a></span><span>
</span><span id="line-929"></span><span>        </span><span id="local-6989586621679118425"><span class="annot"><span class="annottext">InputStream MatchInfo
</span><a href="#local-6989586621679118425"><span class="hs-identifier hs-var">bmstream</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; InputStream ByteString -&gt; IO (InputStream MatchInfo)
</span><span class="hs-identifier hs-var">search</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621679118426"><span class="hs-identifier hs-var">fullBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118414"><span class="hs-identifier hs-var">boundary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118417"><span class="hs-identifier hs-var">stream</span></a></span><span>
</span><span id="line-930"></span><span>        </span><span id="local-6989586621679118427"><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118427"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(InputStream ByteString
 -&gt; MultipartState a -&gt; IO (MultipartState a))
-&gt; InputStream MatchInfo
-&gt; MultipartState a
-&gt; IO (MultipartState a)
forall a.
(InputStream ByteString
 -&gt; MultipartState a -&gt; IO (MultipartState a))
-&gt; InputStream MatchInfo
-&gt; MultipartState a
-&gt; IO (MultipartState a)
</span><a href="Snap.Internal.Util.FileUploads.html#foldParts"><span class="hs-identifier hs-var">foldParts</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString -&gt; MultipartState a -&gt; IO (MultipartState a)
</span><a href="#local-6989586621679118429"><span class="hs-identifier hs-var">goPart</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream MatchInfo
</span><a href="#local-6989586621679118425"><span class="hs-identifier hs-var">bmstream</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118419"><span class="hs-identifier hs-var">initialState</span></a></span><span>
</span><span id="line-931"></span><span>        </span><span class="annot"><span class="annottext">([FormParam], a) -&gt; IO ([FormParam], a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(([FormParam], a) -&gt; IO ([FormParam], a))
-&gt; ([FormParam], a) -&gt; IO ([FormParam], a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultipartState a -&gt; [FormParam] -&gt; [FormParam]
forall a. MultipartState a -&gt; [FormParam] -&gt; [FormParam]
</span><a href="Snap.Internal.Util.FileUploads.html#capturedFields"><span class="hs-identifier hs-var">capturedFields</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118427"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MultipartState a -&gt; a
forall a. MultipartState a -&gt; a
</span><a href="Snap.Internal.Util.FileUploads.html#accumulator"><span class="hs-identifier hs-var">accumulator</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118427"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-932"></span><span>
</span><span id="line-933"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-934"></span><span>    </span><span id="local-6989586621679118433"><span class="annot"><span class="annottext">pBoundary :: ByteString -&gt; Parser ByteString
</span><a href="#local-6989586621679118433"><span class="hs-identifier hs-var hs-var">pBoundary</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118434"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118434"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser ByteString -&gt; Parser ByteString
forall i a. Parser i a -&gt; Parser i a
</span><span class="hs-identifier hs-var">Atto.try</span></span><span> </span><span class="annot"><span class="annottext">(Parser ByteString -&gt; Parser ByteString)
-&gt; Parser ByteString -&gt; Parser ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-935"></span><span>      </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString
</span><span class="hs-identifier hs-var">string</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;--&quot;</span></span><span>
</span><span id="line-936"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString
</span><span class="hs-identifier hs-var">string</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118434"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-939"></span><span>    </span><span id="local-6989586621679118426"><span class="annot"><span class="annottext">fullBoundary :: ByteString -&gt; ByteString
</span><a href="#local-6989586621679118426"><span class="hs-identifier hs-var hs-var">fullBoundary</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118437"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118437"><span class="hs-identifier hs-var">b</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.html#concat"><span class="hs-identifier hs-var">S.concat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;\r\n&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;--&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118437"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-940"></span><span>    </span><span id="local-6989586621679118439"><span class="annot"><span class="annottext">pLine :: Parser ByteString
</span><a href="#local-6989586621679118439"><span class="hs-identifier hs-var hs-var">pLine</span></a></span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser ByteString
</span><span class="hs-identifier hs-var">takeWhile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Char -&gt; Bool) -&gt; Char -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Bool
</span><span class="hs-identifier hs-var">isEndOfLine</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Bool) -&gt; (Char -&gt; Word8) -&gt; Char -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Word8
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#c2w"><span class="hs-identifier hs-var">c2w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Parser ByteString -&gt; Parser ByteString -&gt; Parser ByteString
forall a b.
Parser ByteString a -&gt; Parser ByteString b -&gt; Parser ByteString a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%2A"><span class="hs-operator hs-var">&lt;*</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString
</span><a href="Snap.Internal.Util.FileUploads.html#eol"><span class="hs-identifier hs-var">eol</span></a></span><span>
</span><span id="line-941"></span><span>    </span><span id="local-6989586621679118424"><span class="annot"><span class="annottext">parseFirstBoundary :: ByteString -&gt; Parser ByteString
</span><a href="#local-6989586621679118424"><span class="hs-identifier hs-var hs-var">parseFirstBoundary</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118443"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118443"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString
</span><a href="#local-6989586621679118433"><span class="hs-identifier hs-var">pBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118443"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString -&gt; Parser ByteString -&gt; Parser ByteString
forall a.
Parser ByteString a -&gt; Parser ByteString a -&gt; Parser ByteString a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parser ByteString
</span><a href="#local-6989586621679118439"><span class="hs-identifier hs-var">pLine</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString -&gt; Parser ByteString -&gt; Parser ByteString
forall a b.
Parser ByteString a -&gt; Parser ByteString b -&gt; Parser ByteString b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString
</span><a href="#local-6989586621679118424"><span class="hs-identifier hs-var">parseFirstBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118443"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-942"></span><span>
</span><span id="line-943"></span><span>
</span><span id="line-944"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-945"></span><span>    </span><span id="local-6989586621679118447"><span class="annot"><span class="annottext">takeHeaders :: InputStream ByteString -&gt; IO Headers
</span><a href="#local-6989586621679118447"><span class="hs-identifier hs-var hs-var">takeHeaders</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118448"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118448"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Headers
</span><a href="#local-6989586621679118449"><span class="hs-identifier hs-var">hdrs</span></a></span><span> </span><span class="annot"><span class="annottext">IO Headers
-&gt; (TooManyBytesReadException -&gt; IO Headers) -&gt; IO Headers
forall (m :: * -&gt; *) e a.
(MonadBaseControl IO m, Exception e) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catch`</span></span><span> </span><span class="annot"><span class="annottext">TooManyBytesReadException -&gt; IO Headers
forall {m :: * -&gt; *} {a}.
MonadBase IO m =&gt;
TooManyBytesReadException -&gt; m a
</span><a href="#local-6989586621679118450"><span class="hs-identifier hs-var">handler</span></a></span><span>
</span><span id="line-946"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-947"></span><span>        </span><span id="local-6989586621679118449"><span class="annot"><span class="annottext">hdrs :: IO Headers
</span><a href="#local-6989586621679118449"><span class="hs-identifier hs-var hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-948"></span><span>            </span><span id="local-6989586621679118453"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118453"><span class="hs-identifier hs-var">str'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; InputStream ByteString -&gt; IO (InputStream ByteString)
</span><span class="hs-identifier hs-var">Streams.throwIfProducesMoreThan</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="Snap.Internal.Util.FileUploads.html#mAX_HDRS_SIZE"><span class="hs-identifier hs-var">mAX_HDRS_SIZE</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118448"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-949"></span><span>            </span><span class="annot"><span class="annottext">([FormParam] -&gt; Headers) -&gt; IO [FormParam] -&gt; IO Headers
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a></span><span> </span><span class="annot"><span class="annottext">[FormParam] -&gt; Headers
</span><a href="Snap.Internal.Util.FileUploads.html#toHeaders"><span class="hs-identifier hs-var">toHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [FormParam] -&gt; IO Headers) -&gt; IO [FormParam] -&gt; IO Headers
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Parser [FormParam] -&gt; InputStream ByteString -&gt; IO [FormParam]
forall r. Parser r -&gt; InputStream ByteString -&gt; IO r
</span><span class="hs-identifier hs-var">parseFromStream</span></span><span> </span><span class="annot"><span class="annottext">Parser [FormParam]
</span><a href="Snap.Internal.Util.FileUploads.html#pHeadersWithSeparator"><span class="hs-identifier hs-var">pHeadersWithSeparator</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118453"><span class="hs-identifier hs-var">str'</span></a></span><span>
</span><span id="line-950"></span><span>
</span><span id="line-951"></span><span>        </span><span id="local-6989586621679118450"><span class="annot"><span class="annottext">handler :: TooManyBytesReadException -&gt; m a
</span><a href="#local-6989586621679118450"><span class="hs-identifier hs-var hs-var">handler</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TooManyBytesReadException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TooManyBytesReadException</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-952"></span><span>            </span><span class="annot"><span class="annottext">BadPartException -&gt; m a
forall (m :: * -&gt; *) e a. (MonadBase IO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(BadPartException -&gt; m a) -&gt; BadPartException -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; BadPartException
</span><a href="Snap.Internal.Util.FileUploads.html#BadPartException"><span class="hs-identifier hs-var">BadPartException</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;headers exceeded maximum size&quot;</span></span><span>
</span><span id="line-953"></span><span>
</span><span id="line-954"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-955"></span><span>    </span><span id="local-6989586621679118429"><span class="annot"><span class="annottext">goPart :: InputStream ByteString -&gt; MultipartState a -&gt; IO (MultipartState a)
</span><a href="#local-6989586621679118429"><span class="hs-identifier hs-var hs-var">goPart</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118477"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118477"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118478"><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118478"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-956"></span><span>        </span><span id="local-6989586621679118479"><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679118479"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InputStream ByteString -&gt; IO Headers
</span><a href="#local-6989586621679118447"><span class="hs-identifier hs-var">takeHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118477"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-957"></span><span>
</span><span id="line-958"></span><span>        </span><span class="hs-comment">-- are we using mixed?</span><span>
</span><span id="line-959"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679118480"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118480"><span class="hs-identifier hs-var">contentType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118481"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679118481"><span class="hs-identifier hs-var">mboundary</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Headers -&gt; (ByteString, Maybe ByteString)
</span><a href="Snap.Internal.Util.FileUploads.html#getContentType"><span class="hs-identifier hs-var">getContentType</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679118479"><span class="hs-identifier hs-var">hdrs</span></a></span><span>
</span><span id="line-960"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679118482"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118482"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118483"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679118483"><span class="hs-identifier hs-var">fileName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118484"><span class="annot"><span class="annottext">PartDisposition
</span><a href="#local-6989586621679118484"><span class="hs-identifier hs-var">disposition</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Headers -&gt; (ByteString, Maybe ByteString, PartDisposition)
</span><a href="Snap.Internal.Util.FileUploads.html#getFieldHeaderInfo"><span class="hs-identifier hs-var">getFieldHeaderInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679118479"><span class="hs-identifier hs-var">hdrs</span></a></span><span>
</span><span id="line-961"></span><span>
</span><span id="line-962"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118480"><span class="hs-identifier hs-var">contentType</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;multipart/mixed&quot;</span></span><span>
</span><span id="line-963"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IO (MultipartState a)
-&gt; (ByteString -&gt; IO (MultipartState a))
-&gt; Maybe ByteString
-&gt; IO (MultipartState a)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BadPartException -&gt; IO (MultipartState a)
forall (m :: * -&gt; *) e a. (MonadBase IO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(BadPartException -&gt; IO (MultipartState a))
-&gt; BadPartException -&gt; IO (MultipartState a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; BadPartException
</span><a href="Snap.Internal.Util.FileUploads.html#BadPartException"><span class="hs-identifier hs-var">BadPartException</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; BadPartException) -&gt; Text -&gt; BadPartException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-964"></span><span>                      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;got multipart/mixed without boundary&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-965"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
-&gt; InputStream ByteString
-&gt; MultipartState a
-&gt; ByteString
-&gt; IO (MultipartState a)
</span><a href="#local-6989586621679118486"><span class="hs-identifier hs-var">processMixed</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118482"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118477"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118478"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-966"></span><span>                     </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679118481"><span class="hs-identifier hs-var">mboundary</span></a></span><span>
</span><span id="line-967"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-968"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118487"><span class="annot"><span class="annottext">info :: PartInfo
</span><a href="#local-6989586621679118487"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; Maybe ByteString
-&gt; ByteString
-&gt; PartDisposition
-&gt; Headers
-&gt; PartInfo
</span><a href="Snap.Internal.Util.FileUploads.html#PartInfo"><span class="hs-identifier hs-var">PartInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118482"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679118483"><span class="hs-identifier hs-var">fileName</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118480"><span class="hs-identifier hs-var">contentType</span></a></span><span> </span><span class="annot"><span class="annottext">PartDisposition
</span><a href="#local-6989586621679118484"><span class="hs-identifier hs-var">disposition</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679118479"><span class="hs-identifier hs-var">hdrs</span></a></span><span>
</span><span id="line-969"></span><span>              </span><span class="annot"><span class="annottext">PartInfo
-&gt; InputStream ByteString
-&gt; MultipartState a
-&gt; IO (MultipartState a)
</span><a href="#local-6989586621679118488"><span class="hs-identifier hs-var">handlePart</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679118487"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118477"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118478"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-970"></span><span>
</span><span id="line-971"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-972"></span><span>    </span><span id="local-6989586621679118488"><span class="annot"><span class="annottext">handlePart :: PartInfo
-&gt; InputStream ByteString
-&gt; MultipartState a
-&gt; IO (MultipartState a)
</span><a href="#local-6989586621679118488"><span class="hs-identifier hs-var hs-var">handlePart</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118496"><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679118496"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118497"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118497"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118498"><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118498"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-973"></span><span>      </span><span id="local-6989586621679118499"><span class="annot"><span class="annottext">Capture a
</span><a href="#local-6989586621679118499"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PartInfo -&gt; InputStream ByteString -&gt; a -&gt; IO (Capture a)
</span><a href="#local-6989586621679118415"><span class="hs-identifier hs-var">clientHandler</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679118496"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118497"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultipartState a -&gt; a
forall a. MultipartState a -&gt; a
</span><a href="Snap.Internal.Util.FileUploads.html#accumulator"><span class="hs-identifier hs-var">accumulator</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118498"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-974"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Capture a
</span><a href="#local-6989586621679118499"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-975"></span><span>        </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#Capture"><span class="hs-identifier hs-type">Capture</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118500"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118500"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118501"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118501"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-976"></span><span>           </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118413"><span class="hs-identifier hs-var">maxFormVars</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a -&gt; Int
forall a. MultipartState a -&gt; Int
</span><a href="Snap.Internal.Util.FileUploads.html#numFormVars"><span class="hs-identifier hs-var">numFormVars</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118498"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO ()
forall {a}. IO a
</span><a href="#local-6989586621679118503"><span class="hs-identifier hs-var">throwTooMuchVars</span></a></span><span>
</span><span id="line-977"></span><span>           </span><span class="annot"><span class="annottext">MultipartState a -&gt; IO (MultipartState a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(MultipartState a -&gt; IO (MultipartState a))
-&gt; MultipartState a -&gt; IO (MultipartState a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; MultipartState a -&gt; MultipartState a
forall a.
ByteString -&gt; ByteString -&gt; MultipartState a -&gt; MultipartState a
</span><a href="Snap.Internal.Util.FileUploads.html#addCapture"><span class="hs-identifier hs-var">addCapture</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118500"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118501"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118498"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-978"></span><span>        </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#File"><span class="hs-identifier hs-type">File</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118504"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118504"><span class="hs-identifier hs-var">newAcc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MultipartState a -&gt; IO (MultipartState a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(MultipartState a -&gt; IO (MultipartState a))
-&gt; MultipartState a -&gt; IO (MultipartState a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118498"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#accumulator"><span class="hs-identifier hs-var">accumulator</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118504"><span class="hs-identifier hs-type">newAcc</span></a></span><span>
</span><span id="line-979"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#numFormFiles"><span class="hs-identifier hs-var">numFormFiles</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Enum.html#succ"><span class="hs-identifier hs-type">succ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#numFormFiles"><span class="hs-identifier hs-var">numFormFiles</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118498"><span class="hs-identifier hs-type">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-980"></span><span>                                     </span><span class="hs-special">}</span><span>
</span><span id="line-981"></span><span>
</span><span id="line-982"></span><span>    </span><span id="local-6989586621679118503"><span class="annot"><span class="annottext">throwTooMuchVars :: IO a
</span><a href="#local-6989586621679118503"><span class="hs-identifier hs-var hs-var">throwTooMuchVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-983"></span><span>        </span><span class="annot"><span class="annottext">PolicyViolationException -&gt; IO a
forall (m :: * -&gt; *) e a. (MonadBase IO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(PolicyViolationException -&gt; IO a)
-&gt; (Text -&gt; PolicyViolationException) -&gt; Text -&gt; IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; PolicyViolationException
</span><a href="Snap.Internal.Util.FileUploads.html#PolicyViolationException"><span class="hs-identifier hs-var">PolicyViolationException</span></a></span><span>
</span><span id="line-984"></span><span>        </span><span class="annot"><span class="annottext">(Text -&gt; IO a) -&gt; Text -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.html#concat"><span class="hs-identifier hs-var">T.concat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;number of form inputs exceeded maximum of &quot;</span></span><span>
</span><span id="line-985"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#pack"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Text) -&gt; FilePath -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118413"><span class="hs-identifier hs-var">maxFormVars</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-986"></span><span>
</span><span id="line-987"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-988"></span><span>    </span><span id="local-6989586621679118486"><span class="annot"><span class="annottext">processMixed :: ByteString
-&gt; InputStream ByteString
-&gt; MultipartState a
-&gt; ByteString
-&gt; IO (MultipartState a)
</span><a href="#local-6989586621679118486"><span class="hs-identifier hs-var hs-var">processMixed</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118518"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118518"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118519"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118519"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118520"><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118520"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118521"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118521"><span class="hs-identifier hs-var">mixedBoundary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-989"></span><span>        </span><span class="hs-comment">-- swallow the first boundary</span><span>
</span><span id="line-990"></span><span>        </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Parser ByteString -&gt; InputStream ByteString -&gt; IO ByteString
forall r. Parser r -&gt; InputStream ByteString -&gt; IO r
</span><span class="hs-identifier hs-var">parseFromStream</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString
</span><a href="#local-6989586621679118424"><span class="hs-identifier hs-var">parseFirstBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118521"><span class="hs-identifier hs-var">mixedBoundary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118519"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-991"></span><span>        </span><span id="local-6989586621679118522"><span class="annot"><span class="annottext">InputStream MatchInfo
</span><a href="#local-6989586621679118522"><span class="hs-identifier hs-var">bm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; InputStream ByteString -&gt; IO (InputStream MatchInfo)
</span><span class="hs-identifier hs-var">search</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621679118426"><span class="hs-identifier hs-var">fullBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118521"><span class="hs-identifier hs-var">mixedBoundary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118519"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-992"></span><span>        </span><span class="annot"><span class="annottext">(InputStream ByteString
 -&gt; MultipartState a -&gt; IO (MultipartState a))
-&gt; InputStream MatchInfo
-&gt; MultipartState a
-&gt; IO (MultipartState a)
forall a.
(InputStream ByteString
 -&gt; MultipartState a -&gt; IO (MultipartState a))
-&gt; InputStream MatchInfo
-&gt; MultipartState a
-&gt; IO (MultipartState a)
</span><a href="Snap.Internal.Util.FileUploads.html#foldParts"><span class="hs-identifier hs-var">foldParts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
-&gt; InputStream ByteString
-&gt; MultipartState a
-&gt; IO (MultipartState a)
</span><a href="#local-6989586621679118523"><span class="hs-identifier hs-var">mixedStream</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118518"><span class="hs-identifier hs-var">fieldName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InputStream MatchInfo
</span><a href="#local-6989586621679118522"><span class="hs-identifier hs-var">bm</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118520"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-993"></span><span>
</span><span id="line-994"></span><span>
</span><span id="line-995"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-996"></span><span>    </span><span id="local-6989586621679118523"><span class="annot"><span class="annottext">mixedStream :: ByteString
-&gt; InputStream ByteString
-&gt; MultipartState a
-&gt; IO (MultipartState a)
</span><a href="#local-6989586621679118523"><span class="hs-identifier hs-var hs-var">mixedStream</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118525"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118525"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118526"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118526"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118527"><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118527"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-997"></span><span>        </span><span id="local-6989586621679118528"><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679118528"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InputStream ByteString -&gt; IO Headers
</span><a href="#local-6989586621679118447"><span class="hs-identifier hs-var">takeHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118526"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-998"></span><span>
</span><span id="line-999"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679118529"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118529"><span class="hs-identifier hs-var">contentType</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Headers -&gt; (ByteString, Maybe ByteString)
</span><a href="Snap.Internal.Util.FileUploads.html#getContentType"><span class="hs-identifier hs-var">getContentType</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679118528"><span class="hs-identifier hs-var">hdrs</span></a></span><span>
</span><span id="line-1000"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118530"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679118530"><span class="hs-identifier hs-var">fileName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118531"><span class="annot"><span class="annottext">PartDisposition
</span><a href="#local-6989586621679118531"><span class="hs-identifier hs-var">disposition</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Headers -&gt; (ByteString, Maybe ByteString, PartDisposition)
</span><a href="Snap.Internal.Util.FileUploads.html#getFieldHeaderInfo"><span class="hs-identifier hs-var">getFieldHeaderInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679118528"><span class="hs-identifier hs-var">hdrs</span></a></span><span>
</span><span id="line-1001"></span><span>
</span><span id="line-1002"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118532"><span class="annot"><span class="annottext">info :: PartInfo
</span><a href="#local-6989586621679118532"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; Maybe ByteString
-&gt; ByteString
-&gt; PartDisposition
-&gt; Headers
-&gt; PartInfo
</span><a href="Snap.Internal.Util.FileUploads.html#PartInfo"><span class="hs-identifier hs-var">PartInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118525"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679118530"><span class="hs-identifier hs-var">fileName</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118529"><span class="hs-identifier hs-var">contentType</span></a></span><span> </span><span class="annot"><span class="annottext">PartDisposition
</span><a href="#local-6989586621679118531"><span class="hs-identifier hs-var">disposition</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679118528"><span class="hs-identifier hs-var">hdrs</span></a></span><span>
</span><span id="line-1003"></span><span>        </span><span class="annot"><span class="annottext">PartInfo
-&gt; InputStream ByteString
-&gt; MultipartState a
-&gt; IO (MultipartState a)
</span><a href="#local-6989586621679118488"><span class="hs-identifier hs-var">handlePart</span></a></span><span> </span><span class="annot"><span class="annottext">PartInfo
</span><a href="#local-6989586621679118532"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118526"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118527"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span>
</span><span id="line-1006"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1007"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#getContentType"><span class="hs-identifier hs-type">getContentType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Types.Headers.html#Headers"><span class="hs-identifier hs-type">Headers</span></a></span><span>
</span><span id="line-1008"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1009"></span><span id="getContentType"><span class="annot"><span class="annottext">getContentType :: Headers -&gt; (ByteString, Maybe ByteString)
</span><a href="Snap.Internal.Util.FileUploads.html#getContentType"><span class="hs-identifier hs-var hs-var">getContentType</span></a></span></span><span> </span><span id="local-6989586621679118533"><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679118533"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118534"><span class="hs-identifier hs-var">contentType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679118535"><span class="hs-identifier hs-var">boundary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1010"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1011"></span><span>    </span><span id="local-6989586621679118543"><span class="annot"><span class="annottext">contentTypeValue :: ByteString
</span><a href="#local-6989586621679118543"><span class="hs-identifier hs-var hs-var">contentTypeValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString -&gt; ByteString
forall a. a -&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;text/plain&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ByteString -&gt; ByteString) -&gt; Maybe ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1012"></span><span>                       </span><span class="annot"><span class="annottext">CI ByteString -&gt; Headers -&gt; Maybe ByteString
forall a. HasHeaders a =&gt; CI ByteString -&gt; a -&gt; Maybe ByteString
</span><a href="Snap.Internal.Http.Types.html#getHeader"><span class="hs-identifier hs-var">getHeader</span></a></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;content-type&quot;</span></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679118533"><span class="hs-identifier hs-var">hdrs</span></a></span><span>
</span><span id="line-1013"></span><span>
</span><span id="line-1014"></span><span>    </span><span id="local-6989586621679118544"><span class="annot"><span class="annottext">eCT :: Either FilePath (ByteString, [(CI ByteString, ByteString)])
</span><a href="#local-6989586621679118544"><span class="hs-identifier hs-var hs-var">eCT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; Parser (ByteString, [(CI ByteString, ByteString)])
-&gt; Either FilePath (ByteString, [(CI ByteString, ByteString)])
forall a. ByteString -&gt; Parser a -&gt; Either FilePath a
</span><a href="Snap.Internal.Parsing.html#fullyParse"><span class="hs-identifier hs-var">fullyParse</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118543"><span class="hs-identifier hs-var">contentTypeValue</span></a></span><span> </span><span class="annot"><span class="annottext">Parser (ByteString, [(CI ByteString, ByteString)])
</span><a href="Snap.Internal.Parsing.html#pContentTypeWithParameters"><span class="hs-identifier hs-var">pContentTypeWithParameters</span></a></span><span>
</span><span id="line-1015"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679118534"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118534"><span class="hs-identifier hs-var">contentType</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118546"><span class="annot"><span class="annottext">[(CI ByteString, ByteString)]
</span><a href="#local-6989586621679118546"><span class="hs-identifier hs-var">params</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; (ByteString, [(CI ByteString, ByteString)]))
-&gt; ((ByteString, [(CI ByteString, ByteString)])
    -&gt; (ByteString, [(CI ByteString, ByteString)]))
-&gt; Either FilePath (ByteString, [(CI ByteString, ByteString)])
-&gt; (ByteString, [(CI ByteString, ByteString)])
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ByteString, [(CI ByteString, ByteString)])
-&gt; FilePath -&gt; (ByteString, [(CI ByteString, ByteString)])
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;text/plain&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ByteString, [(CI ByteString, ByteString)])
-&gt; (ByteString, [(CI ByteString, ByteString)])
forall a. a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Either FilePath (ByteString, [(CI ByteString, ByteString)])
</span><a href="#local-6989586621679118544"><span class="hs-identifier hs-var">eCT</span></a></span><span>
</span><span id="line-1016"></span><span>
</span><span id="line-1017"></span><span>    </span><span id="local-6989586621679118535"><span class="annot"><span class="annottext">boundary :: Maybe ByteString
</span><a href="#local-6989586621679118535"><span class="hs-identifier hs-var hs-var">boundary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CI ByteString -&gt; [(CI ByteString, ByteString)] -&gt; Maybe ByteString
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="Snap.Internal.Util.FileUploads.html#findParam"><span class="hs-identifier hs-var">findParam</span></a></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;boundary&quot;</span></span><span> </span><span class="annot"><span class="annottext">[(CI ByteString, ByteString)]
</span><a href="#local-6989586621679118546"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-1018"></span><span>
</span><span id="line-1019"></span><span>
</span><span id="line-1020"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1021"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#getFieldHeaderInfo"><span class="hs-identifier hs-type">getFieldHeaderInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Types.Headers.html#Headers"><span class="hs-identifier hs-type">Headers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#PartDisposition"><span class="hs-identifier hs-type">PartDisposition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1022"></span><span id="getFieldHeaderInfo"><span class="annot"><span class="annottext">getFieldHeaderInfo :: Headers -&gt; (ByteString, Maybe ByteString, PartDisposition)
</span><a href="Snap.Internal.Util.FileUploads.html#getFieldHeaderInfo"><span class="hs-identifier hs-var hs-var">getFieldHeaderInfo</span></a></span></span><span> </span><span id="local-6989586621679118554"><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679118554"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118555"><span class="hs-identifier hs-var">fieldName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679118556"><span class="hs-identifier hs-var">fileName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PartDisposition
</span><a href="#local-6989586621679118557"><span class="hs-identifier hs-var">disposition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1023"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1024"></span><span>    </span><span id="local-6989586621679118562"><span class="annot"><span class="annottext">contentDispositionValue :: ByteString
</span><a href="#local-6989586621679118562"><span class="hs-identifier hs-var hs-var">contentDispositionValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString -&gt; ByteString
forall a. a -&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;unknown&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ByteString -&gt; ByteString) -&gt; Maybe ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1025"></span><span>                              </span><span class="annot"><span class="annottext">CI ByteString -&gt; Headers -&gt; Maybe ByteString
forall a. HasHeaders a =&gt; CI ByteString -&gt; a -&gt; Maybe ByteString
</span><a href="Snap.Internal.Http.Types.html#getHeader"><span class="hs-identifier hs-var">getHeader</span></a></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;content-disposition&quot;</span></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621679118554"><span class="hs-identifier hs-var">hdrs</span></a></span><span>
</span><span id="line-1026"></span><span>
</span><span id="line-1027"></span><span>    </span><span id="local-6989586621679118563"><span class="annot"><span class="annottext">eDisposition :: Either FilePath (ByteString, [(CI ByteString, ByteString)])
</span><a href="#local-6989586621679118563"><span class="hs-identifier hs-var hs-var">eDisposition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; Parser (ByteString, [(CI ByteString, ByteString)])
-&gt; Either FilePath (ByteString, [(CI ByteString, ByteString)])
forall a. ByteString -&gt; Parser a -&gt; Either FilePath a
</span><a href="Snap.Internal.Parsing.html#fullyParse"><span class="hs-identifier hs-var">fullyParse</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118562"><span class="hs-identifier hs-var">contentDispositionValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Parser (ByteString, [(CI ByteString, ByteString)])
 -&gt; Either FilePath (ByteString, [(CI ByteString, ByteString)]))
-&gt; Parser (ByteString, [(CI ByteString, ByteString)])
-&gt; Either FilePath (ByteString, [(CI ByteString, ByteString)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool)
-&gt; Parser (ByteString, [(CI ByteString, ByteString)])
</span><a href="Snap.Internal.Parsing.html#pValueWithParameters%27"><span class="hs-identifier hs-var">pValueWithParameters'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Char -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1028"></span><span>
</span><span id="line-1029"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679118565"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118565"><span class="hs-identifier hs-var">dispositionType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118566"><span class="annot"><span class="annottext">[(CI ByteString, ByteString)]
</span><a href="#local-6989586621679118566"><span class="hs-identifier hs-var">dispositionParameters</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1030"></span><span>        </span><span class="annot"><span class="annottext">(FilePath -&gt; (ByteString, [(CI ByteString, ByteString)]))
-&gt; ((ByteString, [(CI ByteString, ByteString)])
    -&gt; (ByteString, [(CI ByteString, ByteString)]))
-&gt; Either FilePath (ByteString, [(CI ByteString, ByteString)])
-&gt; (ByteString, [(CI ByteString, ByteString)])
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ByteString, [(CI ByteString, ByteString)])
-&gt; FilePath -&gt; (ByteString, [(CI ByteString, ByteString)])
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;unknown&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ByteString, [(CI ByteString, ByteString)])
-&gt; (ByteString, [(CI ByteString, ByteString)])
forall a. a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Either FilePath (ByteString, [(CI ByteString, ByteString)])
</span><a href="#local-6989586621679118563"><span class="hs-identifier hs-var">eDisposition</span></a></span><span>
</span><span id="line-1031"></span><span>
</span><span id="line-1032"></span><span>    </span><span id="local-6989586621679118557"><span class="annot"><span class="annottext">disposition :: PartDisposition
</span><a href="#local-6989586621679118557"><span class="hs-identifier hs-var hs-var">disposition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; PartDisposition
</span><a href="Snap.Internal.Util.FileUploads.html#toPartDisposition"><span class="hs-identifier hs-var">toPartDisposition</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118565"><span class="hs-identifier hs-var">dispositionType</span></a></span><span>
</span><span id="line-1033"></span><span>
</span><span id="line-1034"></span><span>    </span><span id="local-6989586621679118555"><span class="annot"><span class="annottext">fieldName :: ByteString
</span><a href="#local-6989586621679118555"><span class="hs-identifier hs-var hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString -&gt; ByteString
forall a. a -&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ByteString -&gt; ByteString) -&gt; Maybe ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CI ByteString -&gt; [(CI ByteString, ByteString)] -&gt; Maybe ByteString
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="Snap.Internal.Util.FileUploads.html#findParam"><span class="hs-identifier hs-var">findParam</span></a></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;name&quot;</span></span><span> </span><span class="annot"><span class="annottext">[(CI ByteString, ByteString)]
</span><a href="#local-6989586621679118566"><span class="hs-identifier hs-var">dispositionParameters</span></a></span><span>
</span><span id="line-1035"></span><span>
</span><span id="line-1036"></span><span>    </span><span id="local-6989586621679118556"><span class="annot"><span class="annottext">fileName :: Maybe ByteString
</span><a href="#local-6989586621679118556"><span class="hs-identifier hs-var hs-var">fileName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CI ByteString -&gt; [(CI ByteString, ByteString)] -&gt; Maybe ByteString
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="Snap.Internal.Util.FileUploads.html#findParam"><span class="hs-identifier hs-var">findParam</span></a></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;filename&quot;</span></span><span> </span><span class="annot"><span class="annottext">[(CI ByteString, ByteString)]
</span><a href="#local-6989586621679118566"><span class="hs-identifier hs-var">dispositionParameters</span></a></span><span>
</span><span id="line-1037"></span><span>
</span><span id="line-1038"></span><span>
</span><span id="line-1039"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1040"></span><span id="local-6989586621679117546"><span id="local-6989586621679117547"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#findParam"><span class="hs-identifier hs-type">findParam</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117546"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679117546"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679117546"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679117547"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117547"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-1041"></span><span id="findParam"><span class="annot"><span class="annottext">findParam :: forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="Snap.Internal.Util.FileUploads.html#findParam"><span class="hs-identifier hs-var hs-var">findParam</span></a></span></span><span> </span><span id="local-6989586621679118582"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118582"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, b) -&gt; b) -&gt; Maybe (a, b) -&gt; Maybe b
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; b
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (a, b) -&gt; Maybe b)
-&gt; ([(a, b)] -&gt; Maybe (a, b)) -&gt; [(a, b)] -&gt; Maybe b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((a, b) -&gt; Bool) -&gt; [(a, b)] -&gt; Maybe (a, b)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#find"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118582"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Bool) -&gt; ((a, b) -&gt; a) -&gt; (a, b) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; a
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1042"></span><span>
</span><span id="line-1043"></span><span>
</span><span id="line-1044"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1045"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#partStream"><span class="hs-identifier hs-type">partStream</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InputStream</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MatchInfo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InputStream</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1046"></span><span id="partStream"><span class="annot"><span class="annottext">partStream :: InputStream MatchInfo -&gt; IO (InputStream ByteString)
</span><a href="Snap.Internal.Util.FileUploads.html#partStream"><span class="hs-identifier hs-var hs-var">partStream</span></a></span></span><span> </span><span id="local-6989586621679118584"><span class="annot"><span class="annottext">InputStream MatchInfo
</span><a href="#local-6989586621679118584"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Maybe ByteString) -&gt; IO (InputStream ByteString)
forall a. IO (Maybe a) -&gt; IO (InputStream a)
</span><span class="hs-identifier hs-var">Streams.makeInputStream</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe ByteString)
</span><a href="#local-6989586621679118586"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-1047"></span><span>
</span><span id="line-1048"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1049"></span><span>    </span><span id="local-6989586621679118586"><span class="annot"><span class="annottext">go :: IO (Maybe ByteString)
</span><a href="#local-6989586621679118586"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1050"></span><span>        </span><span id="local-6989586621679118592"><span class="annot"><span class="annottext">Maybe MatchInfo
</span><a href="#local-6989586621679118592"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InputStream MatchInfo -&gt; IO (Maybe MatchInfo)
forall a. InputStream a -&gt; IO (Maybe a)
</span><span class="hs-identifier hs-var">Streams.read</span></span><span> </span><span class="annot"><span class="annottext">InputStream MatchInfo
</span><a href="#local-6989586621679118584"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-1051"></span><span>        </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; IO (Maybe ByteString)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe ByteString -&gt; IO (Maybe ByteString))
-&gt; Maybe ByteString -&gt; IO (Maybe ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MatchInfo
</span><a href="#local-6989586621679118592"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MatchInfo
-&gt; (MatchInfo -&gt; Maybe ByteString) -&gt; Maybe ByteString
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">MatchInfo -&gt; Maybe ByteString
forall {m :: * -&gt; *}. MonadPlus m =&gt; MatchInfo -&gt; m ByteString
</span><a href="#local-6989586621679118594"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1052"></span><span>
</span><span id="line-1053"></span><span>    </span><span id="local-6989586621679118594"><span class="annot"><span class="annottext">f :: MatchInfo -&gt; m ByteString
</span><a href="#local-6989586621679118594"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NoMatch</span></span><span> </span><span id="local-6989586621679118614"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118614"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; m ByteString
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679118614"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1054"></span><span>    </span><span class="annot"><a href="#local-6989586621679118594"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">MatchInfo
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m ByteString
forall a. m a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mzero"><span class="hs-identifier hs-var">mzero</span></a></span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span>
</span><span id="line-1057"></span><span>
</span><span id="line-1058"></span><span>
</span><span id="line-1059"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1060"></span><span class="hs-comment">-- | Assuming we've already identified the boundary value and split the input</span><span>
</span><span id="line-1061"></span><span class="hs-comment">-- up into parts which match and parts which don't, run the given 'ByteString'</span><span>
</span><span id="line-1062"></span><span class="hs-comment">-- InputStream over each part and grab a list of the resulting values.</span><span>
</span><span id="line-1063"></span><span class="hs-comment">--</span><span>
</span><span id="line-1064"></span><span class="hs-comment">-- TODO/FIXME: fix description</span><span>
</span><span id="line-1065"></span><span id="local-6989586621679117522"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#foldParts"><span class="hs-identifier hs-type">foldParts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InputStream</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#MultipartState"><span class="hs-identifier hs-type">MultipartState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117522"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#MultipartState"><span class="hs-identifier hs-type">MultipartState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117522"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1066"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InputStream</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MatchInfo</span></span><span>
</span><span id="line-1067"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#MultipartState"><span class="hs-identifier hs-type">MultipartState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117522"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1068"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#MultipartState"><span class="hs-identifier hs-type">MultipartState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117522"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1069"></span><span id="foldParts"><span class="annot"><span class="annottext">foldParts :: forall a.
(InputStream ByteString
 -&gt; MultipartState a -&gt; IO (MultipartState a))
-&gt; InputStream MatchInfo
-&gt; MultipartState a
-&gt; IO (MultipartState a)
</span><a href="Snap.Internal.Util.FileUploads.html#foldParts"><span class="hs-identifier hs-var hs-var">foldParts</span></a></span></span><span> </span><span id="local-6989586621679118615"><span class="annot"><span class="annottext">InputStream ByteString -&gt; MultipartState a -&gt; IO (MultipartState a)
</span><a href="#local-6989586621679118615"><span class="hs-identifier hs-var">partFunc</span></a></span></span><span> </span><span id="local-6989586621679118616"><span class="annot"><span class="annottext">InputStream MatchInfo
</span><a href="#local-6989586621679118616"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MultipartState a -&gt; IO (MultipartState a)
</span><a href="#local-6989586621679118617"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-1070"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1071"></span><span>    </span><span id="local-6989586621679118623"><span class="annot"><span class="annottext">part :: MultipartState a
-&gt; InputStream ByteString -&gt; IO (Maybe (MultipartState a))
</span><a href="#local-6989586621679118623"><span class="hs-identifier hs-var hs-var">part</span></a></span></span><span> </span><span id="local-6989586621679118624"><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118624"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679118625"><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118625"><span class="hs-identifier hs-var">pStream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1072"></span><span>        </span><span id="local-6989586621679118626"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679118626"><span class="hs-identifier hs-var">isLast</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Parser Bool -&gt; InputStream ByteString -&gt; IO Bool
forall r. Parser r -&gt; InputStream ByteString -&gt; IO r
</span><span class="hs-identifier hs-var">parseFromStream</span></span><span> </span><span class="annot"><span class="annottext">Parser Bool
</span><a href="#local-6989586621679118627"><span class="hs-identifier hs-var">pBoundaryEnd</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118625"><span class="hs-identifier hs-var">pStream</span></a></span><span>
</span><span id="line-1073"></span><span>
</span><span id="line-1074"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679118626"><span class="hs-identifier hs-var">isLast</span></a></span><span>
</span><span id="line-1075"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe (MultipartState a) -&gt; IO (Maybe (MultipartState a))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (MultipartState a)
forall a. Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1076"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1077"></span><span>              </span><span class="hs-glyph">!</span><span id="local-6989586621679118628"><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118628"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InputStream ByteString -&gt; MultipartState a -&gt; IO (MultipartState a)
</span><a href="#local-6989586621679118615"><span class="hs-identifier hs-var">partFunc</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118625"><span class="hs-identifier hs-var">pStream</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118624"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1078"></span><span>              </span><span class="annot"><span class="annottext">InputStream ByteString -&gt; IO ()
forall a. InputStream a -&gt; IO ()
</span><span class="hs-identifier hs-var">Streams.skipToEof</span></span><span> </span><span class="annot"><span class="annottext">InputStream ByteString
</span><a href="#local-6989586621679118625"><span class="hs-identifier hs-var">pStream</span></a></span><span>
</span><span id="line-1079"></span><span>              </span><span class="annot"><span class="annottext">Maybe (MultipartState a) -&gt; IO (Maybe (MultipartState a))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (MultipartState a) -&gt; IO (Maybe (MultipartState a)))
-&gt; Maybe (MultipartState a) -&gt; IO (Maybe (MultipartState a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a -&gt; Maybe (MultipartState a)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118628"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1080"></span><span>
</span><span id="line-1081"></span><span>    </span><span id="local-6989586621679118617"><span class="annot"><span class="annottext">go :: MultipartState a -&gt; IO (MultipartState a)
</span><a href="#local-6989586621679118617"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679118632"><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118632"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1082"></span><span>      </span><span id="local-6989586621679118633"><span class="annot"><span class="annottext">Maybe (MultipartState a)
</span><a href="#local-6989586621679118633"><span class="hs-identifier hs-var">cap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InputStream MatchInfo -&gt; IO (InputStream ByteString)
</span><a href="Snap.Internal.Util.FileUploads.html#partStream"><span class="hs-identifier hs-var">partStream</span></a></span><span> </span><span class="annot"><span class="annottext">InputStream MatchInfo
</span><a href="#local-6989586621679118616"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="annot"><span class="annottext">IO (InputStream ByteString)
-&gt; (InputStream ByteString -&gt; IO (Maybe (MultipartState a)))
-&gt; IO (Maybe (MultipartState a))
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
-&gt; InputStream ByteString -&gt; IO (Maybe (MultipartState a))
</span><a href="#local-6989586621679118623"><span class="hs-identifier hs-var">part</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118632"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1083"></span><span>      </span><span class="annot"><span class="annottext">IO (MultipartState a)
-&gt; (MultipartState a -&gt; IO (MultipartState a))
-&gt; Maybe (MultipartState a)
-&gt; IO (MultipartState a)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultipartState a -&gt; IO (MultipartState a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">MultipartState a
</span><a href="#local-6989586621679118632"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MultipartState a -&gt; IO (MultipartState a)
</span><a href="#local-6989586621679118617"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (MultipartState a)
</span><a href="#local-6989586621679118633"><span class="hs-identifier hs-var">cap</span></a></span><span>
</span><span id="line-1084"></span><span>
</span><span id="line-1085"></span><span>    </span><span id="local-6989586621679118627"><span class="annot"><span class="annottext">pBoundaryEnd :: Parser Bool
</span><a href="#local-6989586621679118627"><span class="hs-identifier hs-var hs-var">pBoundaryEnd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parser ByteString
</span><a href="Snap.Internal.Util.FileUploads.html#eol"><span class="hs-identifier hs-var">eol</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString -&gt; Parser Bool -&gt; Parser Bool
forall a b.
Parser ByteString a -&gt; Parser ByteString b -&gt; Parser ByteString b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Parser Bool
forall a. a -&gt; Parser ByteString a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Parser Bool -&gt; Parser Bool -&gt; Parser Bool
forall a.
Parser ByteString a -&gt; Parser ByteString a -&gt; Parser ByteString a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString
</span><span class="hs-identifier hs-var">string</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;--&quot;</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString -&gt; Parser Bool -&gt; Parser Bool
forall a b.
Parser ByteString a -&gt; Parser ByteString b -&gt; Parser ByteString b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Parser Bool
forall a. a -&gt; Parser ByteString a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1086"></span><span>
</span><span id="line-1087"></span><span>
</span><span id="line-1088"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1089"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#eol"><span class="hs-identifier hs-type">eol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-1090"></span><span id="eol"><span class="annot"><span class="annottext">eol :: Parser ByteString
</span><a href="Snap.Internal.Util.FileUploads.html#eol"><span class="hs-identifier hs-var hs-var">eol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString
</span><span class="hs-identifier hs-var">string</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Parser ByteString -&gt; Parser ByteString -&gt; Parser ByteString
forall a.
Parser ByteString a -&gt; Parser ByteString a -&gt; Parser ByteString a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString
</span><span class="hs-identifier hs-var">string</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;\r\n&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1091"></span><span>
</span><span id="line-1092"></span><span>
</span><span id="line-1093"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1094"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#pHeadersWithSeparator"><span class="hs-identifier hs-type">pHeadersWithSeparator</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">,</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1095"></span><span id="pHeadersWithSeparator"><span class="annot"><span class="annottext">pHeadersWithSeparator :: Parser [FormParam]
</span><a href="Snap.Internal.Util.FileUploads.html#pHeadersWithSeparator"><span class="hs-identifier hs-var hs-var">pHeadersWithSeparator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser [FormParam]
</span><a href="Snap.Internal.Parsing.html#pHeaders"><span class="hs-identifier hs-var">pHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Parser [FormParam] -&gt; Parser ByteString -&gt; Parser [FormParam]
forall a b.
Parser ByteString a -&gt; Parser ByteString b -&gt; Parser ByteString a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%2A"><span class="hs-operator hs-var">&lt;*</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString
</span><a href="Snap.Internal.Parsing.html#crlf"><span class="hs-identifier hs-var">crlf</span></a></span><span>
</span><span id="line-1096"></span><span>
</span><span id="line-1097"></span><span>
</span><span id="line-1098"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1099"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#toHeaders"><span class="hs-identifier hs-type">toHeaders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">,</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Types.Headers.html#Headers"><span class="hs-identifier hs-type">Headers</span></a></span><span>
</span><span id="line-1100"></span><span id="toHeaders"><span class="annot"><span class="annottext">toHeaders :: [FormParam] -&gt; Headers
</span><a href="Snap.Internal.Util.FileUploads.html#toHeaders"><span class="hs-identifier hs-var hs-var">toHeaders</span></a></span></span><span> </span><span id="local-6989586621679118640"><span class="annot"><span class="annottext">[FormParam]
</span><a href="#local-6989586621679118640"><span class="hs-identifier hs-var">kvps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(CI ByteString, ByteString)] -&gt; Headers
</span><a href="Snap.Types.Headers.html#fromList"><span class="hs-identifier hs-var">H.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(CI ByteString, ByteString)]
</span><a href="#local-6989586621679118641"><span class="hs-identifier hs-var">kvps'</span></a></span><span>
</span><span id="line-1101"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1102"></span><span>    </span><span id="local-6989586621679118641"><span class="annot"><span class="annottext">kvps' :: [(CI ByteString, ByteString)]
</span><a href="#local-6989586621679118641"><span class="hs-identifier hs-var hs-var">kvps'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FormParam -&gt; (CI ByteString, ByteString))
-&gt; [FormParam] -&gt; [(CI ByteString, ByteString)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ByteString -&gt; CI ByteString)
-&gt; FormParam -&gt; (CI ByteString, ByteString)
forall b c d. (b -&gt; c) -&gt; (b, d) -&gt; (c, d)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Arrow.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; CI ByteString
forall s. FoldCase s =&gt; s -&gt; CI s
</span><span class="hs-identifier hs-var">CI.mk</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FormParam]
</span><a href="#local-6989586621679118640"><span class="hs-identifier hs-var">kvps</span></a></span><span>
</span><span id="line-1103"></span><span>
</span><span id="line-1104"></span><span>
</span><span id="line-1105"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1106"></span><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#mAX_HDRS_SIZE"><span class="hs-identifier hs-type">mAX_HDRS_SIZE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span>
</span><span id="line-1107"></span><span id="mAX_HDRS_SIZE"><span class="annot"><span class="annottext">mAX_HDRS_SIZE :: Int64
</span><a href="Snap.Internal.Util.FileUploads.html#mAX_HDRS_SIZE"><span class="hs-identifier hs-var hs-var">mAX_HDRS_SIZE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">32768</span></span><span>
</span><span id="line-1108"></span><span>
</span><span id="line-1109"></span><span>
</span><span id="line-1110"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-1111"></span><span id="local-6989586621679117509"><span class="annot"><a href="Snap.Internal.Util.FileUploads.html#withTempFile"><span class="hs-identifier hs-type">withTempFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-1112"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-1113"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117509"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1114"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117509"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1115"></span><span id="withTempFile"><span class="annot"><span class="annottext">withTempFile :: forall a.
FilePath -&gt; FilePath -&gt; ((FilePath, Handle) -&gt; IO a) -&gt; IO a
</span><a href="Snap.Internal.Util.FileUploads.html#withTempFile"><span class="hs-identifier hs-var hs-var">withTempFile</span></a></span></span><span> </span><span id="local-6989586621679118647"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118647"><span class="hs-identifier hs-var">tmpl</span></a></span></span><span> </span><span id="local-6989586621679118648"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118648"><span class="hs-identifier hs-var">temp</span></a></span></span><span> </span><span id="local-6989586621679118649"><span class="annot"><span class="annottext">(FilePath, Handle) -&gt; IO a
</span><a href="#local-6989586621679118649"><span class="hs-identifier hs-var">handler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1116"></span><span>    </span><span class="annot"><span class="annottext">((forall a. IO a -&gt; IO a) -&gt; IO a) -&gt; IO a
forall (m :: * -&gt; *) b.
MonadBaseControl IO m =&gt;
((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">mask</span></span><span> </span><span class="annot"><span class="annottext">(((forall a. IO a -&gt; IO a) -&gt; IO a) -&gt; IO a)
-&gt; ((forall a. IO a -&gt; IO a) -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679118650"><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><a href="#local-6989586621679118650"><span class="hs-identifier hs-var">restore</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (FilePath, Handle)
-&gt; ((FilePath, Handle) -&gt; IO [()])
-&gt; ((FilePath, Handle) -&gt; IO a)
-&gt; IO a
forall (m :: * -&gt; *) a b c.
MonadBaseControl IO m =&gt;
m a -&gt; (a -&gt; m b) -&gt; (a -&gt; m c) -&gt; m c
</span><span class="hs-identifier hs-var">bracket</span></span><span> </span><span class="annot"><span class="annottext">IO (FilePath, Handle)
</span><a href="#local-6989586621679118651"><span class="hs-identifier hs-var">make</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath, Handle) -&gt; IO [()]
</span><a href="#local-6989586621679118652"><span class="hs-identifier hs-var">cleanup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO a -&gt; IO a
forall a. IO a -&gt; IO a
</span><a href="#local-6989586621679118650"><span class="hs-identifier hs-var">restore</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO a)
-&gt; ((FilePath, Handle) -&gt; IO a) -&gt; (FilePath, Handle) -&gt; IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath, Handle) -&gt; IO a
</span><a href="#local-6989586621679118649"><span class="hs-identifier hs-var">handler</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1117"></span><span>
</span><span id="line-1118"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1119"></span><span>    </span><span id="local-6989586621679118651"><span class="annot"><span class="annottext">make :: IO (FilePath, Handle)
</span><a href="#local-6989586621679118651"><span class="hs-identifier hs-var hs-var">make</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (FilePath, Handle)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/unix-2.8.1.0/src/System.Posix.Temp.html#mkstemp"><span class="hs-identifier hs-var">mkstemp</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO (FilePath, Handle))
-&gt; FilePath -&gt; IO (FilePath, Handle)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118647"><span class="hs-identifier hs-var">tmpl</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/filepath-1.4.100.4/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118648"><span class="hs-identifier hs-var">temp</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;XXXXXXX&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1120"></span><span>    </span><span id="local-6989586621679118652"><span class="annot"><span class="annottext">cleanup :: (FilePath, Handle) -&gt; IO [()]
</span><a href="#local-6989586621679118652"><span class="hs-identifier hs-var hs-var">cleanup</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679118658"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118658"><span class="hs-identifier hs-var">fp</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679118659"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679118659"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IO ()] -&gt; IO [()]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; [m a] -&gt; m [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Traversable.html#sequence"><span class="hs-identifier hs-var">sequence</span></a></span><span> </span><span class="annot"><span class="annottext">([IO ()] -&gt; IO [()]) -&gt; [IO ()] -&gt; IO [()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; [IO ()] -&gt; [IO ()]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall {z}. IO z -&gt; IO ()
</span><a href="#local-6989586621679118660"><span class="hs-identifier hs-var">gobble</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Handle.html#hClose"><span class="hs-identifier hs-var">hClose</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679118659"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/directory-1.3.8.1/src/System.Directory.html#removeFile"><span class="hs-identifier hs-var">removeFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679118658"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1121"></span><span>
</span><span id="line-1122"></span><span>    </span><span id="local-6989586621679117585"><span class="annot"><a href="#local-6989586621679118661"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117585"><span class="hs-identifier hs-type">z</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679117585"><span class="hs-identifier hs-type">z</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1123"></span><span>    </span><span id="local-6989586621679118661"><span class="annot"><span class="annottext">t :: forall z. IO z -&gt; IO (Either SomeException z)
</span><a href="#local-6989586621679118661"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO z -&gt; IO (Either SomeException z)
forall (m :: * -&gt; *) e a.
(MonadBaseControl IO m, Exception e) =&gt;
m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">E.try</span></span><span>
</span><span id="line-1124"></span><span>
</span><span id="line-1125"></span><span>    </span><span id="local-6989586621679118660"><span class="annot"><span class="annottext">gobble :: IO z -&gt; IO ()
</span><a href="#local-6989586621679118660"><span class="hs-identifier hs-var hs-var">gobble</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Either SomeException z) -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either SomeException z) -&gt; IO ())
-&gt; (IO z -&gt; IO (Either SomeException z)) -&gt; IO z -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IO z -&gt; IO (Either SomeException z)
forall z. IO z -&gt; IO (Either SomeException z)
</span><a href="#local-6989586621679118661"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1126"></span></pre></body></html>