<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Snap.Internal.Test.Assertions</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>              </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#liftM"><span class="hs-identifier">liftM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Builder.html"><span class="hs-identifier">Data.ByteString.Builder</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Builder.html#toLazyByteString"><span class="hs-identifier">toLazyByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Char8.html"><span class="hs-identifier">Data.ByteString.Char8</span></a></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Char8.html"><span class="hs-identifier">Data.ByteString.Char8</span></a></span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Char8.html"><span class="hs-identifier">Data.ByteString.Lazy.Char8</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier">fromJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Snap.Internal.Http.Types.html"><span class="hs-identifier">Snap.Internal.Http.Types</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Http.Types.html#Response"><span class="hs-identifier">Response</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Snap.Internal.Http.Types.html#rspBody"><span class="hs-identifier">rspBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#rspStatus"><span class="hs-identifier">rspStatus</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#getHeader"><span class="hs-identifier">getHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#rspBodyToEnum"><span class="hs-identifier">rspBodyToEnum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Streams</span></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Streams</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Test.HUnit</span></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Assertion</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">assertBool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">assertEqual</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Text.Regex.Posix</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(=~)</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if !MIN_VERSION_base(4,8,0)
</span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Monoid</span><span>                </span><span class="hs-special">(</span><span class="hs-identifier">mconcat</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- | Given a 'Response', return its body as a 'ByteString'.</span><span>
</span><span id="line-22"></span><span class="hs-comment">--</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- Example:</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- ghci&gt; 'getResponseBody' 'emptyResponse'</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- \&quot;\&quot;</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-29"></span><span class="hs-comment">--</span><span>
</span><span id="line-30"></span><span class="annot"><a href="Snap.Internal.Test.Assertions.html#getResponseBody"><span class="hs-identifier hs-type">getResponseBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-31"></span><span id="getResponseBody"><span class="annot"><span class="annottext">getResponseBody :: Response -&gt; IO ByteString
</span><a href="Snap.Internal.Test.Assertions.html#getResponseBody"><span class="hs-identifier hs-var hs-var">getResponseBody</span></a></span></span><span> </span><span id="local-6989586621679113617"><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679113617"><span class="hs-identifier hs-var">rsp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679113618"><span class="annot"><span class="annottext">OutputStream Builder
</span><a href="#local-6989586621679113618"><span class="hs-identifier hs-var">os</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679113619"><span class="annot"><span class="annottext">IO [Builder]
</span><a href="#local-6989586621679113619"><span class="hs-identifier hs-var">grab</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (OutputStream Builder, IO [Builder])
forall c. IO (OutputStream c, IO [c])
</span><span class="hs-identifier hs-var">Streams.listOutputStream</span></span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="annottext">OutputStream Builder -&gt; IO ()
</span><a href="#local-6989586621679113621"><span class="hs-identifier hs-var">enum</span></a></span><span> </span><span class="annot"><span class="annottext">OutputStream Builder
</span><a href="#local-6989586621679113618"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><span class="annottext">([Builder] -&gt; ByteString) -&gt; IO [Builder] -&gt; IO ByteString
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a></span><span> </span><span class="annot"><span class="annottext">[Builder] -&gt; ByteString
</span><a href="#local-6989586621679113622"><span class="hs-identifier hs-var">toBS</span></a></span><span> </span><span class="annot"><span class="annottext">IO [Builder]
</span><a href="#local-6989586621679113619"><span class="hs-identifier hs-var">grab</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-37"></span><span>    </span><span id="local-6989586621679113621"><span class="annot"><span class="annottext">enum :: OutputStream Builder -&gt; IO ()
</span><a href="#local-6989586621679113621"><span class="hs-identifier hs-var hs-var">enum</span></a></span></span><span> </span><span id="local-6989586621679113624"><span class="annot"><span class="annottext">OutputStream Builder
</span><a href="#local-6989586621679113624"><span class="hs-identifier hs-var">os</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-38"></span><span>        </span><span id="local-6989586621679113625"><span class="annot"><span class="annottext">OutputStream Builder
</span><a href="#local-6989586621679113625"><span class="hs-identifier hs-var">os'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ResponseBody -&gt; StreamProc
</span><a href="Snap.Internal.Http.Types.html#rspBodyToEnum"><span class="hs-identifier hs-var">rspBodyToEnum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Response -&gt; ResponseBody
</span><a href="Snap.Internal.Http.Types.html#rspBody"><span class="hs-identifier hs-var">rspBody</span></a></span><span> </span><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679113617"><span class="hs-identifier hs-var">rsp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OutputStream Builder
</span><a href="#local-6989586621679113624"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-39"></span><span>        </span><span class="annot"><span class="annottext">Maybe Builder -&gt; OutputStream Builder -&gt; IO ()
forall a. Maybe a -&gt; OutputStream a -&gt; IO ()
</span><span class="hs-identifier hs-var">Streams.write</span></span><span> </span><span class="annot"><span class="annottext">Maybe Builder
forall a. Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">OutputStream Builder
</span><a href="#local-6989586621679113625"><span class="hs-identifier hs-var">os'</span></a></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span>    </span><span id="local-6989586621679113622"><span class="annot"><span class="annottext">toBS :: [Builder] -&gt; ByteString
</span><a href="#local-6989586621679113622"><span class="hs-identifier hs-var hs-var">toBS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.html#concat"><span class="hs-identifier hs-var">S.concat</span></a></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString)
-&gt; ([Builder] -&gt; [ByteString]) -&gt; [Builder] -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.html#toChunks"><span class="hs-identifier hs-var">L.toChunks</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; [ByteString])
-&gt; ([Builder] -&gt; ByteString) -&gt; [Builder] -&gt; [ByteString]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; ByteString
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Builder.html#toLazyByteString"><span class="hs-identifier hs-var">toLazyByteString</span></a></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; ByteString)
-&gt; ([Builder] -&gt; Builder) -&gt; [Builder] -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Builder] -&gt; Builder
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- | Given a 'Response', assert that its HTTP status code is 200 (success).</span><span>
</span><span id="line-46"></span><span class="hs-comment">--</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- Example:</span><span>
</span><span id="line-48"></span><span class="hs-comment">--</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- ghci&gt; :set -XOverloadedStrings</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- ghci&gt; import qualified &quot;Test.HUnit&quot; as T</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- ghci&gt; let test = T.runTestTT . T.TestCase</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- ghci&gt; test $ 'assertSuccess' 'Snap.Core.emptyResponse'</span><span>
</span><span id="line-54"></span><span class="hs-comment">-- Cases: 1  Tried: 1  Errors: 0  Failures: 0</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- Counts {cases = 1, tried = 1, errors = 0, failures = 0}</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- ghci&gt; test $ 'assertSuccess' ('Snap.Core.setResponseStatus' 500 \&quot;Internal Server Error\&quot; 'Snap.Core.emptyResponse')</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- ### Failure:</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- Expected success (200) but got (500)</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- expected: 200</span><span>
</span><span id="line-60"></span><span class="hs-comment">--  but got: 500</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- Cases: 1  Tried: 1  Errors: 0  Failures: 1</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- Counts {cases = 1, tried = 1, errors = 0, failures = 1}</span><span>
</span><span id="line-63"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-64"></span><span class="annot"><a href="Snap.Internal.Test.Assertions.html#assertSuccess"><span class="hs-identifier hs-type">assertSuccess</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Assertion</span></span><span>
</span><span id="line-65"></span><span id="assertSuccess"><span class="annot"><span class="annottext">assertSuccess :: Response -&gt; IO ()
</span><a href="Snap.Internal.Test.Assertions.html#assertSuccess"><span class="hs-identifier hs-var hs-var">assertSuccess</span></a></span></span><span> </span><span id="local-6989586621679113633"><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679113633"><span class="hs-identifier hs-var">rsp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; Int -&gt; IO ()
forall a. (HasCallStack, Eq a, Show a) =&gt; String -&gt; a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">assertEqual</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113634"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">200</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113635"><span class="hs-identifier hs-var">status</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-67"></span><span>    </span><span id="local-6989586621679113634"><span class="annot"><span class="annottext">message :: String
</span><a href="#local-6989586621679113634"><span class="hs-identifier hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected success (200) but got (&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113635"><span class="hs-identifier hs-var">status</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-68"></span><span>    </span><span id="local-6989586621679113635"><span class="annot"><span class="annottext">status :: Int
</span><a href="#local-6989586621679113635"><span class="hs-identifier hs-var hs-var">status</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Response -&gt; Int
</span><a href="Snap.Internal.Http.Types.html#rspStatus"><span class="hs-identifier hs-var">rspStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679113633"><span class="hs-identifier hs-var">rsp</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- | Given a 'Response', assert that its HTTP status code is 404 (Not Found).</span><span>
</span><span id="line-73"></span><span class="hs-comment">--</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- Example:</span><span>
</span><span id="line-75"></span><span class="hs-comment">--</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- ghci&gt; :set -XOverloadedStrings</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- ghci&gt; 'assert404' $ 'Snap.Core.setResponseStatus' 404 \&quot;Not Found\&quot; 'Snap.Core.emptyResponse'</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- ghci&gt; 'assert404' 'Snap.Core.emptyResponse'</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- *** Exception: HUnitFailure \&quot;Expected Not Found (404) but got (200)\\nexpected: 404\\n but got: 200\&quot;</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-82"></span><span class="annot"><a href="Snap.Internal.Test.Assertions.html#assert404"><span class="hs-identifier hs-type">assert404</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Assertion</span></span><span>
</span><span id="line-83"></span><span id="assert404"><span class="annot"><span class="annottext">assert404 :: Response -&gt; IO ()
</span><a href="Snap.Internal.Test.Assertions.html#assert404"><span class="hs-identifier hs-var hs-var">assert404</span></a></span></span><span> </span><span id="local-6989586621679113643"><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679113643"><span class="hs-identifier hs-var">rsp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; Int -&gt; IO ()
forall a. (HasCallStack, Eq a, Show a) =&gt; String -&gt; a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">assertEqual</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113644"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">404</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113645"><span class="hs-identifier hs-var">status</span></a></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-85"></span><span>    </span><span id="local-6989586621679113644"><span class="annot"><span class="annottext">message :: String
</span><a href="#local-6989586621679113644"><span class="hs-identifier hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected Not Found (404) but got (&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113645"><span class="hs-identifier hs-var">status</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-86"></span><span>    </span><span id="local-6989586621679113645"><span class="annot"><span class="annottext">status :: Int
</span><a href="#local-6989586621679113645"><span class="hs-identifier hs-var hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Response -&gt; Int
</span><a href="Snap.Internal.Http.Types.html#rspStatus"><span class="hs-identifier hs-var">rspStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679113643"><span class="hs-identifier hs-var">rsp</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- | Given a 'Response', assert that its HTTP status code is between 300 and 399</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- (a redirect), and that the Location header of the 'Response' points to the</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- specified URI.</span><span>
</span><span id="line-93"></span><span class="hs-comment">--</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- Example:</span><span>
</span><span id="line-95"></span><span class="hs-comment">--</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- ghci&gt; :set -XOverloadedStrings</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- ghci&gt; let r' = 'Snap.Core.setResponseStatus' 301 \&quot;Moved Permanently\&quot; 'Snap.Core.emptyResponse'</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- ghci&gt; let r  = 'Snap.Core.setHeader' \&quot;Location\&quot; \&quot;www.example.com\&quot; r'</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- ghci&gt; 'assertRedirectTo' \&quot;www.example.com\&quot; r</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- ghci&gt; 'assertRedirectTo' \&quot;www.example.com\&quot; 'Snap.Core.emptyResponse'</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- *** Exception: HUnitFailure \&quot;Expected redirect but got status code (200)\&quot;</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-104"></span><span class="annot"><a href="Snap.Internal.Test.Assertions.html#assertRedirectTo"><span class="hs-identifier hs-type">assertRedirectTo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>     </span><span class="hs-comment">-- ^ The Response should redirect to this</span><span>
</span><span id="line-105"></span><span>                                   </span><span class="hs-comment">-- URI</span><span>
</span><span id="line-106"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span>
</span><span id="line-107"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Assertion</span></span><span>
</span><span id="line-108"></span><span id="assertRedirectTo"><span class="annot"><span class="annottext">assertRedirectTo :: ByteString -&gt; Response -&gt; IO ()
</span><a href="Snap.Internal.Test.Assertions.html#assertRedirectTo"><span class="hs-identifier hs-var hs-var">assertRedirectTo</span></a></span></span><span> </span><span id="local-6989586621679113651"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679113651"><span class="hs-identifier hs-var">uri</span></a></span></span><span> </span><span id="local-6989586621679113652"><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679113652"><span class="hs-identifier hs-var">rsp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><span class="annottext">Response -&gt; IO ()
</span><a href="Snap.Internal.Test.Assertions.html#assertRedirect"><span class="hs-identifier hs-var">assertRedirect</span></a></span><span> </span><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679113652"><span class="hs-identifier hs-var">rsp</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ByteString -&gt; ByteString -&gt; IO ()
forall a. (HasCallStack, Eq a, Show a) =&gt; String -&gt; a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">assertEqual</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113654"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679113651"><span class="hs-identifier hs-var">uri</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679113655"><span class="hs-identifier hs-var">rspUri</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-113"></span><span>    </span><span id="local-6989586621679113655"><span class="annot"><span class="annottext">rspUri :: ByteString
</span><a href="#local-6989586621679113655"><span class="hs-identifier hs-var hs-var">rspUri</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; ByteString
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe ByteString -&gt; ByteString) -&gt; Maybe ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CI ByteString -&gt; Response -&gt; Maybe ByteString
forall a. HasHeaders a =&gt; CI ByteString -&gt; a -&gt; Maybe ByteString
</span><a href="Snap.Internal.Http.Types.html#getHeader"><span class="hs-identifier hs-var">getHeader</span></a></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Location&quot;</span></span><span> </span><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679113652"><span class="hs-identifier hs-var">rsp</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span id="local-6989586621679113654"><span class="annot"><span class="annottext">message :: String
</span><a href="#local-6989586621679113654"><span class="hs-identifier hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected redirect to &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679113651"><span class="hs-identifier hs-var">uri</span></a></span><span>
</span><span id="line-115"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; but got redirected to &quot;</span></span><span>
</span><span id="line-116"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679113655"><span class="hs-identifier hs-var">rspUri</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; instead&quot;</span></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- | Given a 'Response', assert that its HTTP status code is between 300 and 399</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- (a redirect).</span><span>
</span><span id="line-122"></span><span class="hs-comment">--</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- Example:</span><span>
</span><span id="line-124"></span><span class="hs-comment">--</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- ghci&gt; :set -XOverloadedStrings</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- ghci&gt; 'assertRedirect' $ 'Snap.Core.setResponseStatus' 301 \&quot;Moved Permanently\&quot; 'Snap.Core.emptyResponse'</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- ghci&gt; 'assertRedirect' 'Snap.Core.emptyResponse'</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- *** Exception: HUnitFailure \&quot;Expected redirect but got status code (200)\&quot;</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-131"></span><span class="annot"><a href="Snap.Internal.Test.Assertions.html#assertRedirect"><span class="hs-identifier hs-type">assertRedirect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Assertion</span></span><span>
</span><span id="line-132"></span><span id="assertRedirect"><span class="annot"><span class="annottext">assertRedirect :: Response -&gt; IO ()
</span><a href="Snap.Internal.Test.Assertions.html#assertRedirect"><span class="hs-identifier hs-var hs-var">assertRedirect</span></a></span></span><span> </span><span id="local-6989586621679113672"><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679113672"><span class="hs-identifier hs-var">rsp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; String -&gt; Bool -&gt; IO ()
String -&gt; Bool -&gt; IO ()
</span><span class="hs-identifier hs-var">assertBool</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113673"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">300</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113675"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113675"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">399</span></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679113673"><span class="annot"><span class="annottext">message :: String
</span><a href="#local-6989586621679113673"><span class="hs-identifier hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected redirect but got status code (&quot;</span></span><span>
</span><span id="line-135"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679113675"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621679113675"><span class="annot"><span class="annottext">status :: Int
</span><a href="#local-6989586621679113675"><span class="hs-identifier hs-var hs-var">status</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Response -&gt; Int
</span><a href="Snap.Internal.Http.Types.html#rspStatus"><span class="hs-identifier hs-var">rspStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679113672"><span class="hs-identifier hs-var">rsp</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- | Given a 'Response', assert that its body matches the given regular</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- expression.</span><span>
</span><span id="line-142"></span><span class="hs-comment">--</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- Example:</span><span>
</span><span id="line-144"></span><span class="hs-comment">--</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- ghci&gt; :set -XOverloadedStrings</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- ghci&gt; import qualified &quot;System.IO.Streams&quot; as Streams</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- ghci&gt; import qualified &quot;Data.ByteString.Builder&quot; as Builder</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- ghci&gt; :{</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- ghci| let r = 'Snap.Core.setResponseBody'</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- ghci|         (\out -&gt; do</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- ghci|             Streams.write (Just $ Builder.byteString \&quot;Hello, world!\&quot;) out</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- ghci|             return out)</span><span>
</span><span id="line-154"></span><span class="hs-comment">-- ghci|         'Snap.Core.emptyResponse'</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- ghci| :}</span><span>
</span><span id="line-156"></span><span class="hs-comment">-- ghci&gt; 'assertBodyContains' \&quot;^Hello\&quot; r</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- ghci&gt; 'assertBodyContains' \&quot;Bye\&quot; r</span><span>
</span><span id="line-158"></span><span class="hs-comment">-- *** Exception: HUnitFailure &quot;Expected body to match regexp \\\&quot;\\\&quot;Bye\\\&quot;\\\&quot;, but didn\'t&quot;</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-160"></span><span class="annot"><a href="Snap.Internal.Test.Assertions.html#assertBodyContains"><span class="hs-identifier hs-type">assertBodyContains</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Regexp that will match the body content</span></span><span>
</span><span id="line-161"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Snap.Internal.Http.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span>
</span><span id="line-162"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Assertion</span></span><span>
</span><span id="line-163"></span><span id="assertBodyContains"><span class="annot"><span class="annottext">assertBodyContains :: ByteString -&gt; Response -&gt; IO ()
</span><a href="Snap.Internal.Test.Assertions.html#assertBodyContains"><span class="hs-identifier hs-var hs-var">assertBodyContains</span></a></span></span><span> </span><span id="local-6989586621679113682"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679113682"><span class="hs-identifier hs-var">match</span></a></span></span><span> </span><span id="local-6989586621679113683"><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679113683"><span class="hs-identifier hs-var">rsp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621679113684"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679113684"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ByteString
</span><a href="Snap.Internal.Test.Assertions.html#getResponseBody"><span class="hs-identifier hs-var">getResponseBody</span></a></span><span> </span><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679113683"><span class="hs-identifier hs-var">rsp</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="annottext">HasCallStack =&gt; String -&gt; Bool -&gt; IO ()
String -&gt; Bool -&gt; IO ()
</span><span class="hs-identifier hs-var">assertBool</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113685"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679113684"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall source source1 target.
(RegexMaker Regex CompOption ExecOption source,
 RegexContext Regex source1 target) =&gt;
source1 -&gt; source -&gt; target
</span><span class="hs-operator hs-var">=~</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679113682"><span class="hs-identifier hs-var">match</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621679113685"><span class="annot"><span class="annottext">message :: String
</span><a href="#local-6989586621679113685"><span class="hs-identifier hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected body to match regexp \&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679113682"><span class="hs-identifier hs-var">match</span></a></span><span>
</span><span id="line-168"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot;, but didn't&quot;</span></span><span>
</span><span id="line-169"></span></pre></body></html>