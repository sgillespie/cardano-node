<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- Module      : EpochBoundary</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- Description : Functions and definitions for rules at epoch boundary.</span><span>
</span><span id="line-20"></span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- This modules implements the necessary functions for the changes that can happen at epoch boundaries.</span><span>
</span><span id="line-22"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Ledger.EpochBoundary</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier">Stake</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#sumAllStake"><span class="hs-identifier">sumAllStake</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#sumStakePerPool"><span class="hs-identifier">sumStakePerPool</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier">SnapShot</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier">SnapShots</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#emptySnapShot"><span class="hs-identifier">emptySnapShot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#emptySnapShots"><span class="hs-identifier">emptySnapShots</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#poolStake"><span class="hs-identifier">poolStake</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#maxPool"><span class="hs-identifier">maxPool</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#maxPool%27"><span class="hs-identifier">maxPool'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#calculatePoolDistr"><span class="hs-identifier">calculatePoolDistr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#calculatePoolDistr%27"><span class="hs-identifier">calculatePoolDistr'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#calculatePoolStake"><span class="hs-identifier">calculatePoolStake</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssStakeMarkL"><span class="hs-identifier">ssStakeMarkL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssStakeMarkPoolDistrL"><span class="hs-identifier">ssStakeMarkPoolDistrL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssStakeSetL"><span class="hs-identifier">ssStakeSetL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssStakeGoL"><span class="hs-identifier">ssStakeGoL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssFeeL"><span class="hs-identifier">ssFeeL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssStakeL"><span class="hs-identifier">ssStakeL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssStakeDistrL"><span class="hs-identifier">ssStakeDistrL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssDelegationsL"><span class="hs-identifier">ssDelegationsL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssPoolParamsL"><span class="hs-identifier">ssPoolParamsL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">where</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.html"><span class="hs-identifier">Cardano.Ledger.BaseTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.BaseTypes.html#BoundedRational"><span class="hs-identifier">BoundedRational</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.html#NonNegativeInterval"><span class="hs-identifier">NonNegativeInterval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Binary</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><span class="hs-identifier">DecCBOR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">decCBOR</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><span class="hs-identifier">DecShareCBOR</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><span class="hs-identifier">EncCBOR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">encCBOR</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><span class="hs-identifier">Interns</span></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><span class="hs-identifier">decNoShareCBOR</span></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><span class="hs-identifier">decSharePlusLensCBOR</span></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><span class="hs-identifier">decodeRecordNamedT</span></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><span class="hs-identifier">encodeListLen</span></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><span class="hs-identifier">toMemptyLens</span></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html"><span class="hs-identifier">Cardano.Ledger.Coin</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier">Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier">CompactForm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#coinToRational"><span class="hs-identifier">coinToRational</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#rationalToCoinViaFloor"><span class="hs-identifier">rationalToCoinViaFloor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Compactible.html"><span class="hs-identifier">Cardano.Ledger.Compactible</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Core.html"><span class="hs-identifier">Cardano.Ledger.Core</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Credential.html"><span class="hs-identifier">Cardano.Ledger.Credential</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier">Credential</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Crypto.html"><span class="hs-identifier">Cardano.Ledger.Crypto</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Crypto.html#Crypto"><span class="hs-identifier">Crypto</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Keys.html"><span class="hs-identifier">Cardano.Ledger.Keys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier">KeyHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyRole"><span class="hs-identifier">KeyRole</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.PoolDistr.html"><span class="hs-identifier">Cardano.Ledger.PoolDistr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.PoolDistr.html#IndividualPoolStake"><span class="hs-identifier">IndividualPoolStake</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.PoolDistr.html#PoolDistr"><span class="hs-identifier">PoolDistr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.PoolParams.html"><span class="hs-identifier">Cardano.Ledger.PoolParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.PoolParams.html#PoolParams"><span class="hs-identifier">PoolParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.PoolParams.html#ppVrf"><span class="hs-identifier">ppVrf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Val.html"><span class="hs-identifier">Cardano.Ledger.Val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Val.html#%3C%2B%3E"><span class="hs-operator">(&lt;+&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/deepseq-1.4.8.1/src/Control.DeepSeq.html"><span class="hs-identifier">Control.DeepSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/deepseq-1.4.8.1/src/Control.DeepSeq.html#NFData"><span class="hs-identifier">NFData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Trans.html"><span class="hs-identifier">Control.Monad.Trans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier">lift</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">KeyValue</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">object</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pairs</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.=)</span></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Default.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Default</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">def</span></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Ratio.html"><span class="hs-identifier">Data.Ratio</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#%25"><span class="hs-operator">(%)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.html"><span class="hs-identifier">Data.Typeable</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.VMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">VMap</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html"><span class="hs-identifier">GHC.Word</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word64"><span class="hs-identifier">Word64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Lens.Micro</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Lens'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lens</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(^.)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_2</span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">NoThunks.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AllowThunksIn</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">NoThunks</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Numeric.Natural.html"><span class="hs-identifier">Numeric.Natural</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-bignum-1.3/src/GHC.Num.Natural.html#Natural"><span class="hs-identifier">Natural</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="annot"><span class="hs-comment">-- | Type of stake as map from hash key to coins associated.</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">newtype</span><span> </span><span id="Stake"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-var">Stake</span></a></span></span><span> </span><span id="local-6989586621679500686"><span class="annot"><a href="#local-6989586621679500686"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Stake"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-var">Stake</span></a></span></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AunStake%3AStake"><span class="annot"><span class="annottext">forall c.
Stake c -&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AunStake%3AStake"><span class="hs-identifier hs-var hs-var">unStake</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">VMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VP</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500686"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679501230"><span id="local-6989586621679501240"><span id="local-6989586621679501244"><span class="annot"><span class="annottext">Int -&gt; Stake c -&gt; ShowS
[Stake c] -&gt; ShowS
Stake c -&gt; String
(Int -&gt; Stake c -&gt; ShowS)
-&gt; (Stake c -&gt; String) -&gt; ([Stake c] -&gt; ShowS) -&gt; Show (Stake c)
forall c. Int -&gt; Stake c -&gt; ShowS
forall c. [Stake c] -&gt; ShowS
forall c. Stake c -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall c. Int -&gt; Stake c -&gt; ShowS
showsPrec :: Int -&gt; Stake c -&gt; ShowS
$cshow :: forall c. Stake c -&gt; String
show :: Stake c -&gt; String
$cshowList :: forall c. [Stake c] -&gt; ShowS
showList :: [Stake c] -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679501254"><span id="local-6989586621679501261"><span class="annot"><span class="annottext">Stake c -&gt; Stake c -&gt; Bool
(Stake c -&gt; Stake c -&gt; Bool)
-&gt; (Stake c -&gt; Stake c -&gt; Bool) -&gt; Eq (Stake c)
forall c. Stake c -&gt; Stake c -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall c. Stake c -&gt; Stake c -&gt; Bool
== :: Stake c -&gt; Stake c -&gt; Bool
$c/= :: forall c. Stake c -&gt; Stake c -&gt; Bool
/= :: Stake c -&gt; Stake c -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679501279"><span class="annot"><span class="annottext">Stake c -&gt; ()
(Stake c -&gt; ()) -&gt; NFData (Stake c)
forall c. Stake c -&gt; ()
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: forall c. Stake c -&gt; ()
rnf :: Stake c -&gt; ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/deepseq-1.4.8.1/src/Control.DeepSeq.html#NFData"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679501292"><span id="local-6989586621679501294"><span class="annot"><span class="annottext">(forall x. Stake c -&gt; Rep (Stake c) x)
-&gt; (forall x. Rep (Stake c) x -&gt; Stake c) -&gt; Generic (Stake c)
forall x. Rep (Stake c) x -&gt; Stake c
forall x. Stake c -&gt; Rep (Stake c) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall c x. Rep (Stake c) x -&gt; Stake c
forall c x. Stake c -&gt; Rep (Stake c) x
$cfrom :: forall c x. Stake c -&gt; Rep (Stake c) x
from :: forall x. Stake c -&gt; Rep (Stake c) x
$cto :: forall c x. Rep (Stake c) x -&gt; Stake c
to :: forall x. Rep (Stake c) x -&gt; Stake c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679501299"><span id="local-6989586621679501308"><span id="local-6989586621679501316"><span id="local-6989586621679501324"><span id="local-6989586621679501332"><span class="annot"><span class="annottext">[Stake c] -&gt; Value
[Stake c] -&gt; Encoding
Stake c -&gt; Bool
Stake c -&gt; Value
Stake c -&gt; Encoding
(Stake c -&gt; Value)
-&gt; (Stake c -&gt; Encoding)
-&gt; ([Stake c] -&gt; Value)
-&gt; ([Stake c] -&gt; Encoding)
-&gt; (Stake c -&gt; Bool)
-&gt; ToJSON (Stake c)
forall c. Crypto c =&gt; [Stake c] -&gt; Value
forall c. Crypto c =&gt; [Stake c] -&gt; Encoding
forall c. Crypto c =&gt; Stake c -&gt; Bool
forall c. Crypto c =&gt; Stake c -&gt; Value
forall c. Crypto c =&gt; Stake c -&gt; Encoding
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; (a -&gt; Bool)
-&gt; ToJSON a
$ctoJSON :: forall c. Crypto c =&gt; Stake c -&gt; Value
toJSON :: Stake c -&gt; Value
$ctoEncoding :: forall c. Crypto c =&gt; Stake c -&gt; Encoding
toEncoding :: Stake c -&gt; Encoding
$ctoJSONList :: forall c. Crypto c =&gt; [Stake c] -&gt; Value
toJSONList :: [Stake c] -&gt; Value
$ctoEncodingList :: forall c. Crypto c =&gt; [Stake c] -&gt; Encoding
toEncodingList :: [Stake c] -&gt; Encoding
$comitField :: forall c. Crypto c =&gt; Stake c -&gt; Bool
omitField :: Stake c -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span id="local-6989586621679501350"><span id="local-6989586621679501361"><span id="local-6989586621679501371"><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679500772"><span class="annot"><a href="#local-6989586621679500772"><span class="hs-keyword hs-type">newtype</span></a></span></span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500772"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoThunks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500772"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span id="local-6989586621679501412"><span id="local-6989586621679501426"><span id="local-6989586621679501439"><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679500789"><span class="annot"><a href="#local-6989586621679500789"><span class="hs-keyword hs-type">newtype</span></a></span></span><span> </span><span class="hs-keyword">instance</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Crypto.html#Crypto"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500789"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EncCBOR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500789"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679500800"><span id="local-6989586621679501468"><span class="annot"><a href="Cardano.Ledger.Crypto.html#Crypto"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500800"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecShareCBOR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500800"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Share"><span class="annot"><span class="hs-identifier hs-var">Share</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500800"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Share</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VP</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500800"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>  </span><span id="local-6989586621679501482"><span class="annot"><span class="annottext">getShare :: Stake c -&gt; Share (Stake c)
</span><a href="#local-6989586621679501482"><span class="hs-identifier hs-var hs-var hs-var hs-var">getShare</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking c) (CompactForm Coin)
-&gt; Share (VMap VB VP (Credential 'Staking c) (CompactForm Coin))
VMap VB VP (Credential 'Staking c) (CompactForm Coin)
-&gt; Interns (Credential 'Staking c)
forall a. DecShareCBOR a =&gt; a -&gt; Share a
</span><span class="hs-identifier hs-var">getShare</span></span><span> </span><span class="annot"><span class="annottext">(VMap VB VP (Credential 'Staking c) (CompactForm Coin)
 -&gt; Interns (Credential 'Staking c))
-&gt; (Stake c
    -&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin))
-&gt; Stake c
-&gt; Interns (Credential 'Staking c)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Stake c -&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
forall c.
Stake c -&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AunStake%3AStake"><span class="hs-identifier hs-var">unStake</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span id="local-6989586621679501493"><span class="annot"><span class="annottext">decShareCBOR :: forall s. Share (Stake c) -&gt; Decoder s (Stake c)
</span><a href="#local-6989586621679501493"><span class="hs-identifier hs-var hs-var hs-var hs-var">decShareCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VMap VB VP (Credential 'Staking c) (CompactForm Coin) -&gt; Stake c)
-&gt; Decoder
     s (VMap VB VP (Credential 'Staking c) (CompactForm Coin))
-&gt; Decoder s (Stake c)
forall a b. (a -&gt; b) -&gt; Decoder s a -&gt; Decoder s b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking c) (CompactForm Coin) -&gt; Stake c
forall c.
VMap VB VP (Credential 'Staking c) (CompactForm Coin) -&gt; Stake c
</span><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-var">Stake</span></a></span><span> </span><span class="annot"><span class="annottext">(Decoder s (VMap VB VP (Credential 'Staking c) (CompactForm Coin))
 -&gt; Decoder s (Stake c))
-&gt; (Interns (Credential 'Staking c)
    -&gt; Decoder
         s (VMap VB VP (Credential 'Staking c) (CompactForm Coin)))
-&gt; Interns (Credential 'Staking c)
-&gt; Decoder s (Stake c)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Share (VMap VB VP (Credential 'Staking c) (CompactForm Coin))
-&gt; Decoder
     s (VMap VB VP (Credential 'Staking c) (CompactForm Coin))
Interns (Credential 'Staking c)
-&gt; Decoder
     s (VMap VB VP (Credential 'Staking c) (CompactForm Coin))
forall a s. DecShareCBOR a =&gt; Share a -&gt; Decoder s a
forall s.
Share (VMap VB VP (Credential 'Staking c) (CompactForm Coin))
-&gt; Decoder
     s (VMap VB VP (Credential 'Staking c) (CompactForm Coin))
</span><span class="hs-identifier hs-var">decShareCBOR</span></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span id="local-6989586621679500814"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#sumAllStake"><span class="hs-identifier hs-type">sumAllStake</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500814"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span></span><span>
</span><span id="line-106"></span><span id="sumAllStake"><span class="annot"><span class="annottext">sumAllStake :: forall c. Stake c -&gt; Coin
</span><a href="Cardano.Ledger.EpochBoundary.html#sumAllStake"><span class="hs-identifier hs-var hs-var">sumAllStake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Coin
forall a. Compactible a =&gt; CompactForm a -&gt; a
</span><a href="Cardano.Ledger.Compactible.html#fromCompact"><span class="hs-identifier hs-var">fromCompact</span></a></span><span> </span><span class="annot"><span class="annottext">(CompactForm Coin -&gt; Coin)
-&gt; (Stake c -&gt; CompactForm Coin) -&gt; Stake c -&gt; Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; CompactForm Coin
</span><a href="Cardano.Ledger.Coin.html#CompactCoin"><span class="hs-identifier hs-var">CompactCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; CompactForm Coin)
-&gt; (Stake c -&gt; Word64) -&gt; Stake c -&gt; CompactForm Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; CompactForm Coin -&gt; Word64)
-&gt; Word64
-&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
-&gt; Word64
forall (vv :: * -&gt; *) v a (kv :: * -&gt; *) k.
Vector vv v =&gt;
(a -&gt; v -&gt; a) -&gt; a -&gt; VMap kv vv k v -&gt; a
</span><span class="hs-identifier hs-var">VMap.foldl</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679501505"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679501505"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Coin.html#CompactCoin"><span class="hs-identifier hs-type">CompactCoin</span></a></span><span> </span><span id="local-6989586621679501506"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679501506"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679501505"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679501506"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(VMap VB VP (Credential 'Staking c) (CompactForm Coin) -&gt; Word64)
-&gt; (Stake c
    -&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin))
-&gt; Stake c
-&gt; Word64
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Stake c -&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
forall c.
Stake c -&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AunStake%3AStake"><span class="hs-identifier hs-var">unStake</span></a></span><span>
</span><span id="line-107"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#sumAllStake"><span class="hs-pragma hs-type">sumAllStake</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="annot"><span class="hs-comment">-- | Get stake of one pool</span></span><span>
</span><span id="line-110"></span><span id="local-6989586621679500826"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#poolStake"><span class="hs-identifier hs-type">poolStake</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500826"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">VMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500826"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500826"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500826"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500826"><span class="hs-identifier hs-type">c</span></a></span></span><span>
</span><span id="line-115"></span><span id="poolStake"><span class="annot"><span class="annottext">poolStake :: forall c.
KeyHash 'StakePool c
-&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
-&gt; Stake c
-&gt; Stake c
</span><a href="Cardano.Ledger.EpochBoundary.html#poolStake"><span class="hs-identifier hs-var hs-var">poolStake</span></a></span></span><span> </span><span id="local-6989586621679501518"><span class="annot"><span class="annottext">KeyHash 'StakePool c
</span><a href="#local-6989586621679501518"><span class="hs-identifier hs-var">hk</span></a></span></span><span> </span><span id="local-6989586621679501519"><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="#local-6989586621679501519"><span class="hs-identifier hs-var">delegs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span id="local-6989586621679501520"><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking c) (CompactForm Coin)
</span><a href="#local-6989586621679501520"><span class="hs-identifier hs-var">stake</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-comment">-- Stake $ (eval (dom (delegs &#9655; setSingleton hk) &#9665; stake))</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking c) (CompactForm Coin) -&gt; Stake c
forall c.
VMap VB VP (Credential 'Staking c) (CompactForm Coin) -&gt; Stake c
</span><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-var">Stake</span></a></span><span> </span><span class="annot"><span class="annottext">(VMap VB VP (Credential 'Staking c) (CompactForm Coin) -&gt; Stake c)
-&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin) -&gt; Stake c
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Credential 'Staking c -&gt; CompactForm Coin -&gt; Bool)
-&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
-&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
forall (kv :: * -&gt; *) k (vv :: * -&gt; *) v.
(Vector kv k, Vector vv v) =&gt;
(k -&gt; v -&gt; Bool) -&gt; VMap kv vv k v -&gt; VMap kv vv k v
</span><span class="hs-identifier hs-var">VMap.filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679501522"><span class="annot"><span class="annottext">Credential 'Staking c
</span><a href="#local-6989586621679501522"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Credential 'Staking c
-&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
-&gt; Maybe (KeyHash 'StakePool c)
forall k (kv :: * -&gt; *) (vv :: * -&gt; *) v.
(Ord k, Vector kv k, Vector vv v) =&gt;
k -&gt; VMap kv vv k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">VMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking c
</span><a href="#local-6989586621679501522"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="#local-6989586621679501519"><span class="hs-identifier hs-var">delegs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (KeyHash 'StakePool c)
-&gt; Maybe (KeyHash 'StakePool c) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool c -&gt; Maybe (KeyHash 'StakePool c)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool c
</span><a href="#local-6989586621679501518"><span class="hs-identifier hs-var">hk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking c) (CompactForm Coin)
</span><a href="#local-6989586621679501520"><span class="hs-identifier hs-var">stake</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span id="local-6989586621679500843"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#sumStakePerPool"><span class="hs-identifier hs-type">sumStakePerPool</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">VMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500843"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500843"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500843"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500843"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span></span><span>
</span><span id="line-123"></span><span id="sumStakePerPool"><span class="annot"><span class="annottext">sumStakePerPool :: forall c.
VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
-&gt; Stake c -&gt; Map (KeyHash 'StakePool c) Coin
</span><a href="Cardano.Ledger.EpochBoundary.html#sumStakePerPool"><span class="hs-identifier hs-var hs-var">sumStakePerPool</span></a></span></span><span> </span><span id="local-6989586621679501535"><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="#local-6989586621679501535"><span class="hs-identifier hs-var">delegs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span id="local-6989586621679501536"><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking c) (CompactForm Coin)
</span><a href="#local-6989586621679501536"><span class="hs-identifier hs-var">stake</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map (KeyHash 'StakePool c) Coin
 -&gt; Credential 'Staking c
 -&gt; CompactForm Coin
 -&gt; Map (KeyHash 'StakePool c) Coin)
-&gt; Map (KeyHash 'StakePool c) Coin
-&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
-&gt; Map (KeyHash 'StakePool c) Coin
forall (kv :: * -&gt; *) k (vv :: * -&gt; *) v a.
(Vector kv k, Vector vv v) =&gt;
(a -&gt; k -&gt; v -&gt; a) -&gt; a -&gt; VMap kv vv k v -&gt; a
</span><span class="hs-identifier hs-var">VMap.foldlWithKey</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool c) Coin
-&gt; Credential 'Staking c
-&gt; CompactForm Coin
-&gt; Map (KeyHash 'StakePool c) Coin
</span><a href="#local-6989586621679501538"><span class="hs-identifier hs-var">accum</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool c) Coin
forall k a. Map k a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking c) (CompactForm Coin)
</span><a href="#local-6989586621679501536"><span class="hs-identifier hs-var">stake</span></a></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-125"></span><span>    </span><span id="local-6989586621679501538"><span class="annot"><span class="annottext">accum :: Map (KeyHash 'StakePool c) Coin
-&gt; Credential 'Staking c
-&gt; CompactForm Coin
-&gt; Map (KeyHash 'StakePool c) Coin
</span><a href="#local-6989586621679501538"><span class="hs-identifier hs-var hs-var">accum</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679501540"><span class="annot"><span class="annottext">Map (KeyHash 'StakePool c) Coin
</span><a href="#local-6989586621679501540"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679501541"><span class="annot"><span class="annottext">Credential 'Staking c
</span><a href="#local-6989586621679501541"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span id="local-6989586621679501542"><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679501542"><span class="hs-identifier hs-var">compactCoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-126"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Credential 'Staking c
-&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
-&gt; Maybe (KeyHash 'StakePool c)
forall k (kv :: * -&gt; *) (vv :: * -&gt; *) v.
(Ord k, Vector kv k, Vector vv v) =&gt;
k -&gt; VMap kv vv k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">VMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking c
</span><a href="#local-6989586621679501541"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="#local-6989586621679501535"><span class="hs-identifier hs-var">delegs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="annottext">Maybe (KeyHash 'StakePool c)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool c) Coin
</span><a href="#local-6989586621679501540"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679501543"><span class="annot"><span class="annottext">KeyHash 'StakePool c
</span><a href="#local-6989586621679501543"><span class="hs-identifier hs-var">kh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Coin -&gt; Coin)
-&gt; KeyHash 'StakePool c
-&gt; Coin
-&gt; Map (KeyHash 'StakePool c) Coin
-&gt; Map (KeyHash 'StakePool c) Coin
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.Internal.html#insertWith"><span class="hs-identifier hs-var">Map.insertWith</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="Cardano.Ledger.Val.html#%3C%2B%3E"><span class="hs-operator hs-var">(&lt;+&gt;)</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool c
</span><a href="#local-6989586621679501543"><span class="hs-identifier hs-var">kh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Coin
forall a. Compactible a =&gt; CompactForm a -&gt; a
</span><a href="Cardano.Ledger.Compactible.html#fromCompact"><span class="hs-identifier hs-var">fromCompact</span></a></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679501542"><span class="hs-identifier hs-var">compactCoin</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool c) Coin
</span><a href="#local-6989586621679501540"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="annot"><span class="hs-comment">-- | Calculate maximal pool reward</span></span><span>
</span><span id="line-131"></span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#maxPool%27"><span class="hs-identifier hs-type">maxPool'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.html#NonNegativeInterval"><span class="hs-identifier hs-type">NonNegativeInterval</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-bignum-1.3/src/GHC.Num.Natural.html#Natural"><span class="hs-identifier hs-type">Natural</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#Rational"><span class="hs-identifier hs-type">Rational</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-136"></span><span>  </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#Rational"><span class="hs-identifier hs-type">Rational</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-138"></span><span id="maxPool%27"><span class="annot"><span class="annottext">maxPool' :: NonNegativeInterval
-&gt; Natural -&gt; Coin -&gt; Rational -&gt; Rational -&gt; Coin
</span><a href="Cardano.Ledger.EpochBoundary.html#maxPool%27"><span class="hs-identifier hs-var hs-var">maxPool'</span></a></span></span><span> </span><span id="local-6989586621679501545"><span class="annot"><span class="annottext">NonNegativeInterval
</span><a href="#local-6989586621679501545"><span class="hs-identifier hs-var">a0</span></a></span></span><span> </span><span id="local-6989586621679501546"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679501546"><span class="hs-identifier hs-var">nOpt</span></a></span></span><span> </span><span id="local-6989586621679501547"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679501547"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679501548"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501548"><span class="hs-identifier hs-var">sigma</span></a></span></span><span> </span><span id="local-6989586621679501549"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501549"><span class="hs-identifier hs-var">pR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Coin
</span><a href="Cardano.Ledger.Coin.html#rationalToCoinViaFloor"><span class="hs-identifier hs-var">rationalToCoinViaFloor</span></a></span><span> </span><span class="annot"><span class="annottext">(Rational -&gt; Coin) -&gt; Rational -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501550"><span class="hs-identifier hs-var">factor1</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501552"><span class="hs-identifier hs-var">factor2</span></a></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621679501553"><span class="annot"><span class="annottext">z0 :: Rational
</span><a href="#local-6989586621679501553"><span class="hs-identifier hs-var hs-var">z0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Rational
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#%25"><span class="hs-operator hs-var">%</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679501546"><span class="hs-identifier hs-var">nOpt</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621679501554"><span class="annot"><span class="annottext">sigma' :: Rational
</span><a href="#local-6989586621679501554"><span class="hs-identifier hs-var hs-var">sigma'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#min"><span class="hs-identifier hs-var">min</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501548"><span class="hs-identifier hs-var">sigma</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501553"><span class="hs-identifier hs-var">z0</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621679501556"><span class="annot"><span class="annottext">p' :: Rational
</span><a href="#local-6989586621679501556"><span class="hs-identifier hs-var hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#min"><span class="hs-identifier hs-var">min</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501549"><span class="hs-identifier hs-var">pR</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501553"><span class="hs-identifier hs-var">z0</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span id="local-6989586621679501550"><span class="annot"><span class="annottext">factor1 :: Rational
</span><a href="#local-6989586621679501550"><span class="hs-identifier hs-var hs-var">factor1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Rational
</span><a href="Cardano.Ledger.Coin.html#coinToRational"><span class="hs-identifier hs-var">coinToRational</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679501547"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#%2F"><span class="hs-operator hs-var">/</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">NonNegativeInterval -&gt; Rational
forall r. BoundedRational r =&gt; r -&gt; Rational
</span><a href="Cardano.Ledger.BaseTypes.html#unboundRational"><span class="hs-identifier hs-var">unboundRational</span></a></span><span> </span><span class="annot"><span class="annottext">NonNegativeInterval
</span><a href="#local-6989586621679501545"><span class="hs-identifier hs-var">a0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>    </span><span id="local-6989586621679501552"><span class="annot"><span class="annottext">factor2 :: Rational
</span><a href="#local-6989586621679501552"><span class="hs-identifier hs-var hs-var">factor2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501554"><span class="hs-identifier hs-var">sigma'</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501556"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">NonNegativeInterval -&gt; Rational
forall r. BoundedRational r =&gt; r -&gt; Rational
</span><a href="Cardano.Ledger.BaseTypes.html#unboundRational"><span class="hs-identifier hs-var">unboundRational</span></a></span><span> </span><span class="annot"><span class="annottext">NonNegativeInterval
</span><a href="#local-6989586621679501545"><span class="hs-identifier hs-var">a0</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501559"><span class="hs-identifier hs-var">factor3</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621679501559"><span class="annot"><span class="annottext">factor3 :: Rational
</span><a href="#local-6989586621679501559"><span class="hs-identifier hs-var hs-var">factor3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501554"><span class="hs-identifier hs-var">sigma'</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501556"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501560"><span class="hs-identifier hs-var">factor4</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#%2F"><span class="hs-operator hs-var">/</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501553"><span class="hs-identifier hs-var">z0</span></a></span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621679501560"><span class="annot"><span class="annottext">factor4 :: Rational
</span><a href="#local-6989586621679501560"><span class="hs-identifier hs-var hs-var">factor4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501553"><span class="hs-identifier hs-var">z0</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501554"><span class="hs-identifier hs-var">sigma'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#%2F"><span class="hs-operator hs-var">/</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501553"><span class="hs-identifier hs-var">z0</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="annot"><span class="hs-comment">-- | Version of `maxPool'` that extracts `ppA0L` and `ppNOptL` from a `PParams`</span></span><span>
</span><span id="line-149"></span><span id="local-6989586621679500865"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#maxPool"><span class="hs-identifier hs-type">maxPool</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Core.PParams.html#EraPParams"><span class="hs-identifier hs-type">EraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500865"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">PParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500865"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-153"></span><span>  </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#Rational"><span class="hs-identifier hs-type">Rational</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#Rational"><span class="hs-identifier hs-type">Rational</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span></span><span>
</span><span id="line-156"></span><span id="maxPool"><span class="annot"><span class="annottext">maxPool :: forall era.
EraPParams era =&gt;
PParams era -&gt; Coin -&gt; Rational -&gt; Rational -&gt; Coin
</span><a href="Cardano.Ledger.EpochBoundary.html#maxPool"><span class="hs-identifier hs-var hs-var">maxPool</span></a></span></span><span> </span><span id="local-6989586621679501570"><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679501570"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span id="local-6989586621679501571"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679501571"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679501572"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501572"><span class="hs-identifier hs-var">sigma</span></a></span></span><span> </span><span id="local-6989586621679501573"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501573"><span class="hs-identifier hs-var">pR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonNegativeInterval
-&gt; Natural -&gt; Coin -&gt; Rational -&gt; Rational -&gt; Coin
</span><a href="Cardano.Ledger.EpochBoundary.html#maxPool%27"><span class="hs-identifier hs-var">maxPool'</span></a></span><span> </span><span class="annot"><span class="annottext">NonNegativeInterval
</span><a href="#local-6989586621679501574"><span class="hs-identifier hs-var">a0</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679501575"><span class="hs-identifier hs-var">nOpt</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679501571"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501572"><span class="hs-identifier hs-var">sigma</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679501573"><span class="hs-identifier hs-var">pR</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621679501574"><span class="annot"><span class="annottext">a0 :: NonNegativeInterval
</span><a href="#local-6989586621679501574"><span class="hs-identifier hs-var hs-var">a0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679501570"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
-&gt; Getting NonNegativeInterval (PParams era) NonNegativeInterval
-&gt; NonNegativeInterval
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting NonNegativeInterval (PParams era) NonNegativeInterval
forall era.
EraPParams era =&gt;
Lens' (PParams era) NonNegativeInterval
Lens' (PParams era) NonNegativeInterval
</span><a href="Cardano.Ledger.Core.PParams.html#ppA0L"><span class="hs-identifier hs-var">ppA0L</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span id="local-6989586621679501575"><span class="annot"><span class="annottext">nOpt :: Natural
</span><a href="#local-6989586621679501575"><span class="hs-identifier hs-var hs-var">nOpt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679501570"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era -&gt; Getting Natural (PParams era) Natural -&gt; Natural
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Natural (PParams era) Natural
forall era. EraPParams era =&gt; Lens' (PParams era) Natural
Lens' (PParams era) Natural
</span><a href="Cardano.Ledger.Core.PParams.html#ppNOptL"><span class="hs-identifier hs-var">ppNOptL</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="annot"><span class="hs-comment">-- | Snapshot of the stake distribution.</span></span><span>
</span><span id="line-162"></span><span class="hs-keyword">data</span><span> </span><span id="SnapShot"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-var">SnapShot</span></a></span></span><span> </span><span id="local-6989586621679500877"><span class="annot"><a href="#local-6989586621679500877"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SnapShot"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-var">SnapShot</span></a></span></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AssStake%3ASnapShot"><span class="annot"><span class="annottext">forall c. SnapShot c -&gt; Stake c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStake%3ASnapShot"><span class="hs-identifier hs-var hs-var">ssStake</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500877"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AssDelegations%3ASnapShot"><span class="annot"><span class="annottext">forall c.
SnapShot c
-&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssDelegations%3ASnapShot"><span class="hs-identifier hs-var hs-var">ssDelegations</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500877"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500877"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AssPoolParams%3ASnapShot"><span class="annot"><span class="annottext">forall c.
SnapShot c -&gt; VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssPoolParams%3ASnapShot"><span class="hs-identifier hs-var hs-var">ssPoolParams</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500877"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.PoolParams.html#PoolParams"><span class="hs-identifier hs-type">PoolParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500877"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679501581"><span id="local-6989586621679501593"><span id="local-6989586621679501597"><span class="annot"><span class="annottext">Int -&gt; SnapShot c -&gt; ShowS
[SnapShot c] -&gt; ShowS
SnapShot c -&gt; String
(Int -&gt; SnapShot c -&gt; ShowS)
-&gt; (SnapShot c -&gt; String)
-&gt; ([SnapShot c] -&gt; ShowS)
-&gt; Show (SnapShot c)
forall c. Int -&gt; SnapShot c -&gt; ShowS
forall c. [SnapShot c] -&gt; ShowS
forall c. SnapShot c -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall c. Int -&gt; SnapShot c -&gt; ShowS
showsPrec :: Int -&gt; SnapShot c -&gt; ShowS
$cshow :: forall c. SnapShot c -&gt; String
show :: SnapShot c -&gt; String
$cshowList :: forall c. [SnapShot c] -&gt; ShowS
showList :: [SnapShot c] -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679501602"><span id="local-6989586621679501610"><span class="annot"><span class="annottext">SnapShot c -&gt; SnapShot c -&gt; Bool
(SnapShot c -&gt; SnapShot c -&gt; Bool)
-&gt; (SnapShot c -&gt; SnapShot c -&gt; Bool) -&gt; Eq (SnapShot c)
forall c. SnapShot c -&gt; SnapShot c -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall c. SnapShot c -&gt; SnapShot c -&gt; Bool
== :: SnapShot c -&gt; SnapShot c -&gt; Bool
$c/= :: forall c. SnapShot c -&gt; SnapShot c -&gt; Bool
/= :: SnapShot c -&gt; SnapShot c -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679501618"><span id="local-6989586621679501620"><span class="annot"><span class="annottext">(forall x. SnapShot c -&gt; Rep (SnapShot c) x)
-&gt; (forall x. Rep (SnapShot c) x -&gt; SnapShot c)
-&gt; Generic (SnapShot c)
forall x. Rep (SnapShot c) x -&gt; SnapShot c
forall x. SnapShot c -&gt; Rep (SnapShot c) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall c x. Rep (SnapShot c) x -&gt; SnapShot c
forall c x. SnapShot c -&gt; Rep (SnapShot c) x
$cfrom :: forall c x. SnapShot c -&gt; Rep (SnapShot c) x
from :: forall x. SnapShot c -&gt; Rep (SnapShot c) x
$cto :: forall c x. Rep (SnapShot c) x -&gt; SnapShot c
to :: forall x. Rep (SnapShot c) x -&gt; SnapShot c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679500931"><span id="local-6989586621679501624"><span id="local-6989586621679501628"><span id="local-6989586621679501634"><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500931"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoThunks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500931"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679500948"><span id="local-6989586621679501695"><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/deepseq-1.4.8.1/src/Control.DeepSeq.html#NFData"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500948"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-174"></span><span>  </span><span id="local-6989586621679500950"><span id="local-6989586621679501731"><span id="local-6989586621679501735"><span class="annot"><a href="Cardano.Ledger.Crypto.html#Crypto"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500950"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">EncCBOR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500950"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-177"></span><span>  </span><span id="local-6989586621679501758"><span class="annot"><span class="annottext">encCBOR :: SnapShot c -&gt; Encoding
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">encCBOR</span></span></span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span>
</span><span id="line-179"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:ssStake:SnapShot :: forall c. SnapShot c -&gt; Stake c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStake%3ASnapShot"><span class="hs-identifier hs-var">ssStake</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679501759"><span class="annot"><span class="annottext">Stake c
</span><a href="#local-6989586621679501759"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-180"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:ssDelegations:SnapShot :: forall c.
SnapShot c
-&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssDelegations%3ASnapShot"><span class="hs-identifier hs-var">ssDelegations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679501760"><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="#local-6989586621679501760"><span class="hs-identifier hs-var">d</span></a></span></span><span>
</span><span id="line-181"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:ssPoolParams:SnapShot :: forall c.
SnapShot c -&gt; VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssPoolParams%3ASnapShot"><span class="hs-identifier hs-var">ssPoolParams</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679501761"><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
</span><a href="#local-6989586621679501761"><span class="hs-identifier hs-var">p</span></a></span></span><span>
</span><span id="line-182"></span><span>      </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-183"></span><span>      </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">encodeListLen</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">3</span></span><span>
</span><span id="line-184"></span><span>        </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Stake c -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><span class="hs-identifier hs-var">encCBOR</span></span><span> </span><span class="annot"><span class="annottext">Stake c
</span><a href="#local-6989586621679501759"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-185"></span><span>        </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
-&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><span class="hs-identifier hs-var">encCBOR</span></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="#local-6989586621679501760"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-186"></span><span>        </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool c) (PoolParams c) -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><span class="hs-identifier hs-var">encCBOR</span></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
</span><a href="#local-6989586621679501761"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679500958"><span id="local-6989586621679501767"><span id="local-6989586621679501771"><span class="annot"><a href="Cardano.Ledger.Crypto.html#Crypto"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500958"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecShareCBOR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500958"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-keyword">type</span><span>
</span><span id="line-190"></span><span>    </span><span id="Share"><span class="annot"><span class="hs-identifier hs-var">Share</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500958"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Interns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500958"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Interns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679500958"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>  </span><span id="local-6989586621679501808"><span class="annot"><span class="annottext">decSharePlusCBOR :: forall s. StateT (Share (SnapShot c)) (Decoder s) (SnapShot c)
</span><a href="#local-6989586621679501808"><span class="hs-identifier hs-var hs-var hs-var hs-var">decSharePlusCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; (SnapShot c -&gt; Int)
-&gt; StateT (Share (SnapShot c)) (Decoder s) (SnapShot c)
-&gt; StateT (Share (SnapShot c)) (Decoder s) (SnapShot c)
forall (m :: (* -&gt; *) -&gt; * -&gt; *) s a.
(MonadTrans m, Monad (m (Decoder s))) =&gt;
Text -&gt; (a -&gt; Int) -&gt; m (Decoder s) a -&gt; m (Decoder s) a
</span><span class="hs-identifier hs-var">decodeRecordNamedT</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;SnapShot&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SnapShot c -&gt; Int
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT (Share (SnapShot c)) (Decoder s) (SnapShot c)
 -&gt; StateT (Share (SnapShot c)) (Decoder s) (SnapShot c))
-&gt; StateT (Share (SnapShot c)) (Decoder s) (SnapShot c)
-&gt; StateT (Share (SnapShot c)) (Decoder s) (SnapShot c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621679501811"><span class="annot"><span class="annottext">Stake c
</span><a href="#local-6989586621679501811"><span class="hs-identifier hs-var">ssStake</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens'
  (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
  (Share (Stake c))
-&gt; StateT
     (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
     (Decoder s)
     (Stake c)
forall b bs s.
DecShareCBOR b =&gt;
Lens' bs (Share b) -&gt; StateT bs (Decoder s) b
</span><span class="hs-identifier hs-var">decSharePlusLensCBOR</span></span><span> </span><span class="annot"><span class="annottext">(Share (Stake c) -&gt; f (Share (Stake c)))
-&gt; (Interns (Credential 'Staking c),
    Interns (KeyHash 'StakePool c))
-&gt; f (Interns (Credential 'Staking c),
      Interns (KeyHash 'StakePool c))
(Interns (Credential 'Staking c)
 -&gt; f (Interns (Credential 'Staking c)))
-&gt; (Interns (Credential 'Staking c),
    Interns (KeyHash 'StakePool c))
-&gt; f (Interns (Credential 'Staking c),
      Interns (KeyHash 'StakePool c))
forall s t a b. Field1 s t a b =&gt; Lens s t a b
Lens'
  (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
  (Share (Stake c))
Lens
  (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
  (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
  (Interns (Credential 'Staking c))
  (Interns (Credential 'Staking c))
</span><span class="hs-identifier hs-var">_1</span></span><span>
</span><span id="line-194"></span><span>    </span><span id="local-6989586621679501816"><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="#local-6989586621679501816"><span class="hs-identifier hs-var">ssDelegations</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
  (Decoder s)
  (VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c))
StateT
  (Share (VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)))
  (Decoder s)
  (VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c))
forall s.
StateT
  (Share (VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)))
  (Decoder s)
  (VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c))
forall a s. DecShareCBOR a =&gt; StateT (Share a) (Decoder s) a
</span><span class="hs-identifier hs-var">decSharePlusCBOR</span></span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621679501817"><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
</span><a href="#local-6989586621679501817"><span class="hs-identifier hs-var">ssPoolParams</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens'
  (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
  (Share (VMap VB VB (KeyHash 'StakePool c) (PoolParams c)))
-&gt; StateT
     (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
     (Decoder s)
     (VMap VB VB (KeyHash 'StakePool c) (PoolParams c))
forall b bs s.
DecShareCBOR b =&gt;
Lens' bs (Share b) -&gt; StateT bs (Decoder s) b
</span><span class="hs-identifier hs-var">decSharePlusLensCBOR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens'
  (Interns (KeyHash 'StakePool c), Interns (PoolParams c))
  (Interns (KeyHash 'StakePool c))
-&gt; Lens'
     (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
     (Interns (KeyHash 'StakePool c))
-&gt; Lens'
     (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
     (Interns (KeyHash 'StakePool c), Interns (PoolParams c))
forall a b c. Monoid a =&gt; Lens' a b -&gt; Lens' c b -&gt; Lens' c a
</span><span class="hs-identifier hs-var">toMemptyLens</span></span><span> </span><span class="annot"><span class="annottext">(Interns (KeyHash 'StakePool c)
 -&gt; f (Interns (KeyHash 'StakePool c)))
-&gt; (Interns (KeyHash 'StakePool c), Interns (PoolParams c))
-&gt; f (Interns (KeyHash 'StakePool c), Interns (PoolParams c))
forall s t a b. Field1 s t a b =&gt; Lens s t a b
Lens'
  (Interns (KeyHash 'StakePool c), Interns (PoolParams c))
  (Interns (KeyHash 'StakePool c))
</span><span class="hs-identifier hs-var">_1</span></span><span> </span><span class="annot"><span class="annottext">(Interns (KeyHash 'StakePool c)
 -&gt; f (Interns (KeyHash 'StakePool c)))
-&gt; (Interns (Credential 'Staking c),
    Interns (KeyHash 'StakePool c))
-&gt; f (Interns (Credential 'Staking c),
      Interns (KeyHash 'StakePool c))
forall s t a b. Field2 s t a b =&gt; Lens s t a b
Lens'
  (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
  (Interns (KeyHash 'StakePool c))
</span><span class="hs-identifier hs-var">_2</span></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><span class="annottext">SnapShot c
-&gt; StateT
     (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
     (Decoder s)
     (SnapShot c)
forall a.
a
-&gt; StateT
     (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
     (Decoder s)
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Stake c
$sel:ssStake:SnapShot :: Stake c
ssStake :: Stake c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStake%3ASnapShot"><span class="hs-identifier hs-var hs-var">ssStake</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
$sel:ssDelegations:SnapShot :: VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
ssDelegations :: VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssDelegations%3ASnapShot"><span class="hs-identifier hs-var hs-var">ssDelegations</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
$sel:ssPoolParams:SnapShot :: VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
ssPoolParams :: VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssPoolParams%3ASnapShot"><span class="hs-identifier hs-var hs-var">ssPoolParams</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679501008"><span id="local-6989586621679501834"><span id="local-6989586621679501838"><span id="local-6989586621679501841"><span class="annot"><a href="Cardano.Ledger.Crypto.html#Crypto"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501008"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501008"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-199"></span><span>  </span><span id="local-6989586621679501848"><span class="annot"><span class="annottext">toJSON :: SnapShot c -&gt; Value
</span><a href="#local-6989586621679501848"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span> </span><span class="annot"><span class="annottext">([Pair] -&gt; Value) -&gt; (SnapShot c -&gt; [Pair]) -&gt; SnapShot c -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot c -&gt; [Pair]
forall e a c. (KeyValue e a, Crypto c) =&gt; SnapShot c -&gt; [a]
</span><a href="Cardano.Ledger.EpochBoundary.html#toSnapShotPair"><span class="hs-identifier hs-var">toSnapShotPair</span></a></span><span>
</span><span id="line-200"></span><span>  </span><span id="local-6989586621679501856"><span class="annot"><span class="annottext">toEncoding :: SnapShot c -&gt; Encoding
</span><a href="#local-6989586621679501856"><span class="hs-identifier hs-var hs-var hs-var hs-var">toEncoding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Series -&gt; Encoding
</span><span class="hs-identifier hs-var">pairs</span></span><span> </span><span class="annot"><span class="annottext">(Series -&gt; Encoding)
-&gt; (SnapShot c -&gt; Series) -&gt; SnapShot c -&gt; Encoding
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Series] -&gt; Series
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">([Series] -&gt; Series)
-&gt; (SnapShot c -&gt; [Series]) -&gt; SnapShot c -&gt; Series
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot c -&gt; [Series]
forall e a c. (KeyValue e a, Crypto c) =&gt; SnapShot c -&gt; [a]
</span><a href="Cardano.Ledger.EpochBoundary.html#toSnapShotPair"><span class="hs-identifier hs-var">toSnapShotPair</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span id="local-6989586621679501014"><span id="local-6989586621679501015"><span id="local-6989586621679501016"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#toSnapShotPair"><span class="hs-identifier hs-type">toSnapShotPair</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">KeyValue</span></span><span> </span><span class="annot"><a href="#local-6989586621679501014"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501015"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Crypto.html#Crypto"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501016"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501016"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679501015"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-203"></span><span id="toSnapShotPair"><span class="annot"><span class="annottext">toSnapShotPair :: forall e a c. (KeyValue e a, Crypto c) =&gt; SnapShot c -&gt; [a]
</span><a href="Cardano.Ledger.EpochBoundary.html#toSnapShotPair"><span class="hs-identifier hs-var hs-var">toSnapShotPair</span></a></span></span><span> </span><span id="local-6989586621679501880"><span class="annot"><span class="annottext">ss :: SnapShot c
</span><a href="#local-6989586621679501880"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><span class="annottext">Stake c
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679501881"><span id="local-6989586621679501882"><span id="local-6989586621679501883"><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
Stake c
$sel:ssStake:SnapShot :: forall c. SnapShot c -&gt; Stake c
$sel:ssDelegations:SnapShot :: forall c.
SnapShot c
-&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
$sel:ssPoolParams:SnapShot :: forall c.
SnapShot c -&gt; VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
ssStake :: Stake c
ssDelegations :: VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
ssPoolParams :: VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStake%3ASnapShot"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679501880"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-205"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;stake&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Stake c -&gt; a
forall v. ToJSON v =&gt; Key -&gt; v -&gt; a
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Stake c
</span><a href="#local-6989586621679501881"><span class="hs-identifier hs-var">ssStake</span></a></span><span>
</span><span id="line-206"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;delegations&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key
-&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c) -&gt; a
forall v. ToJSON v =&gt; Key -&gt; v -&gt; a
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="#local-6989586621679501882"><span class="hs-identifier hs-var">ssDelegations</span></a></span><span>
</span><span id="line-207"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;poolParams&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; VMap VB VB (KeyHash 'StakePool c) (PoolParams c) -&gt; a
forall v. ToJSON v =&gt; Key -&gt; v -&gt; a
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
</span><a href="#local-6989586621679501883"><span class="hs-identifier hs-var">ssPoolParams</span></a></span><span>
</span><span id="line-208"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- | Snapshots of the stake distribution.</span><span>
</span><span id="line-211"></span><span class="hs-comment">--</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- Note that ssStakeMark and ssStakeMarkPoolDistr are lazy on</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- purpose since we only want to force the thunk after one stability window</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- when we know that they are stable (so that we do not compute them if we do not have to).</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- See more info in the [Optimize TICKF ADR](https://github.com/intersectmbo/cardano-ledger/blob/master/docs/adr/2022-12-12_007-optimize-ledger-view.md)</span><span>
</span><span id="line-216"></span><span class="hs-keyword">data</span><span> </span><span id="SnapShots"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-var">SnapShots</span></a></span></span><span> </span><span id="local-6989586621679501030"><span class="annot"><a href="#local-6989586621679501030"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SnapShots"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-var">SnapShots</span></a></span></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AssStakeMark%3ASnapShots"><span class="annot"><span class="annottext">forall c. SnapShots c -&gt; SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeMark%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeMark</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501030"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-comment">-- Lazy on purpose</span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AssStakeMarkPoolDistr%3ASnapShots"><span class="annot"><span class="annottext">forall c. SnapShots c -&gt; PoolDistr c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeMarkPoolDistr%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeMarkPoolDistr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.PoolDistr.html#PoolDistr"><span class="hs-identifier hs-type">PoolDistr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501030"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-comment">-- Lazy on purpose</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AssStakeSet%3ASnapShots"><span class="annot"><span class="annottext">forall c. SnapShots c -&gt; SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeSet%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeSet</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501030"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AssStakeGo%3ASnapShots"><span class="annot"><span class="annottext">forall c. SnapShots c -&gt; SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeGo%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeGo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501030"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AssFee%3ASnapShots"><span class="annot"><span class="annottext">forall c. SnapShots c -&gt; Coin
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssFee%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssFee</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679501891"><span id="local-6989586621679501901"><span id="local-6989586621679501905"><span class="annot"><span class="annottext">Int -&gt; SnapShots c -&gt; ShowS
[SnapShots c] -&gt; ShowS
SnapShots c -&gt; String
(Int -&gt; SnapShots c -&gt; ShowS)
-&gt; (SnapShots c -&gt; String)
-&gt; ([SnapShots c] -&gt; ShowS)
-&gt; Show (SnapShots c)
forall c. Int -&gt; SnapShots c -&gt; ShowS
forall c. [SnapShots c] -&gt; ShowS
forall c. SnapShots c -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall c. Int -&gt; SnapShots c -&gt; ShowS
showsPrec :: Int -&gt; SnapShots c -&gt; ShowS
$cshow :: forall c. SnapShots c -&gt; String
show :: SnapShots c -&gt; String
$cshowList :: forall c. [SnapShots c] -&gt; ShowS
showList :: [SnapShots c] -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679501908"><span id="local-6989586621679501917"><span class="annot"><span class="annottext">SnapShots c -&gt; SnapShots c -&gt; Bool
(SnapShots c -&gt; SnapShots c -&gt; Bool)
-&gt; (SnapShots c -&gt; SnapShots c -&gt; Bool) -&gt; Eq (SnapShots c)
forall c. SnapShots c -&gt; SnapShots c -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall c. SnapShots c -&gt; SnapShots c -&gt; Bool
== :: SnapShots c -&gt; SnapShots c -&gt; Bool
$c/= :: forall c. SnapShots c -&gt; SnapShots c -&gt; Bool
/= :: SnapShots c -&gt; SnapShots c -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679501921"><span id="local-6989586621679501923"><span class="annot"><span class="annottext">(forall x. SnapShots c -&gt; Rep (SnapShots c) x)
-&gt; (forall x. Rep (SnapShots c) x -&gt; SnapShots c)
-&gt; Generic (SnapShots c)
forall x. Rep (SnapShots c) x -&gt; SnapShots c
forall x. SnapShots c -&gt; Rep (SnapShots c) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall c x. Rep (SnapShots c) x -&gt; SnapShots c
forall c x. SnapShots c -&gt; Rep (SnapShots c) x
$cfrom :: forall c x. SnapShots c -&gt; Rep (SnapShots c) x
from :: forall x. SnapShots c -&gt; Rep (SnapShots c) x
$cto :: forall c x. Rep (SnapShots c) x -&gt; SnapShots c
to :: forall x. Rep (SnapShots c) x -&gt; SnapShots c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679501927"><span id="local-6989586621679501936"><span id="local-6989586621679501944"><span class="annot"><span class="annottext">Context -&gt; SnapShots c -&gt; IO (Maybe ThunkInfo)
Proxy (SnapShots c) -&gt; String
(Context -&gt; SnapShots c -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; SnapShots c -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (SnapShots c) -&gt; String)
-&gt; NoThunks (SnapShots c)
forall c.
Typeable c =&gt;
Context -&gt; SnapShots c -&gt; IO (Maybe ThunkInfo)
forall c. Typeable c =&gt; Proxy (SnapShots c) -&gt; String
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
$cnoThunks :: forall c.
Typeable c =&gt;
Context -&gt; SnapShots c -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; SnapShots c -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall c.
Typeable c =&gt;
Context -&gt; SnapShots c -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; SnapShots c -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: forall c. Typeable c =&gt; Proxy (SnapShots c) -&gt; String
showTypeOf :: Proxy (SnapShots c) -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AllowThunksIn</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;ssStakeMark&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;ssStakeMarkPoolDistr&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501030"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679501060"><span id="local-6989586621679502059"><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/deepseq-1.4.8.1/src/Control.DeepSeq.html#NFData"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501060"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-229"></span><span>  </span><span id="local-6989586621679501062"><span id="local-6989586621679502090"><span id="local-6989586621679502094"><span class="annot"><a href="Cardano.Ledger.Crypto.html#Crypto"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501062"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-230"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">EncCBOR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501062"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-232"></span><span>  </span><span id="local-6989586621679502105"><span class="annot"><span class="annottext">encCBOR :: SnapShots c -&gt; Encoding
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">encCBOR</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679502106"><span class="annot"><span class="annottext">SnapShot c
$sel:ssStakeMark:SnapShots :: forall c. SnapShots c -&gt; SnapShot c
ssStakeMark :: SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeMark%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeMark</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679502107"><span class="annot"><span class="annottext">SnapShot c
$sel:ssStakeSet:SnapShots :: forall c. SnapShots c -&gt; SnapShot c
ssStakeSet :: SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeSet%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeSet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679502108"><span class="annot"><span class="annottext">SnapShot c
$sel:ssStakeGo:SnapShots :: forall c. SnapShots c -&gt; SnapShot c
ssStakeGo :: SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeGo%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeGo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679502109"><span class="annot"><span class="annottext">Coin
$sel:ssFee:SnapShots :: forall c. SnapShots c -&gt; Coin
ssFee :: Coin
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssFee%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssFee</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-233"></span><span>    </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">encodeListLen</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">4</span></span><span>
</span><span id="line-234"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot c -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><span class="hs-identifier hs-var">encCBOR</span></span><span> </span><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502106"><span class="hs-identifier hs-var">ssStakeMark</span></a></span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-comment">-- We intentionaly do not serialize the redundant ssStakeMarkPoolDistr</span><span>
</span><span id="line-236"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot c -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><span class="hs-identifier hs-var">encCBOR</span></span><span> </span><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502107"><span class="hs-identifier hs-var">ssStakeSet</span></a></span><span>
</span><span id="line-237"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot c -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><span class="hs-identifier hs-var">encCBOR</span></span><span> </span><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502108"><span class="hs-identifier hs-var">ssStakeGo</span></a></span><span>
</span><span id="line-238"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><span class="hs-identifier hs-var">encCBOR</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679502109"><span class="hs-identifier hs-var">ssFee</span></a></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679501067"><span id="local-6989586621679502117"><span id="local-6989586621679502121"><span class="annot"><a href="Cardano.Ledger.Crypto.html#Crypto"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501067"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecCBOR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501067"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-241"></span><span>  </span><span id="local-6989586621679502126"><span class="annot"><span class="annottext">decCBOR :: forall s. Decoder s (SnapShots c)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">decCBOR</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Decoder s (SnapShots c)
forall a s. DecShareCBOR a =&gt; Decoder s a
</span><span class="hs-identifier hs-var">decNoShareCBOR</span></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679501068"><span id="local-6989586621679502132"><span id="local-6989586621679502135"><span class="annot"><a href="Cardano.Ledger.Crypto.html#Crypto"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501068"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecShareCBOR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501068"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Share"><span class="annot"><span class="hs-identifier hs-var">Share</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501068"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Share</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501068"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>  </span><span id="local-6989586621679502160"><span class="annot"><span class="annottext">decSharePlusCBOR :: forall s. StateT (Share (SnapShots c)) (Decoder s) (SnapShots c)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">decSharePlusCBOR</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; (SnapShots c -&gt; Int)
-&gt; StateT (Share (SnapShots c)) (Decoder s) (SnapShots c)
-&gt; StateT (Share (SnapShots c)) (Decoder s) (SnapShots c)
forall (m :: (* -&gt; *) -&gt; * -&gt; *) s a.
(MonadTrans m, Monad (m (Decoder s))) =&gt;
Text -&gt; (a -&gt; Int) -&gt; m (Decoder s) a -&gt; m (Decoder s) a
</span><span class="hs-identifier hs-var">decodeRecordNamedT</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;SnapShots&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SnapShots c -&gt; Int
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT (Share (SnapShots c)) (Decoder s) (SnapShots c)
 -&gt; StateT (Share (SnapShots c)) (Decoder s) (SnapShots c))
-&gt; StateT (Share (SnapShots c)) (Decoder s) (SnapShots c)
-&gt; StateT (Share (SnapShots c)) (Decoder s) (SnapShots c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679502161"><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502161"><span class="hs-identifier hs-var">ssStakeMark</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
  (Decoder s)
  (SnapShot c)
StateT (Share (SnapShot c)) (Decoder s) (SnapShot c)
forall s. StateT (Share (SnapShot c)) (Decoder s) (SnapShot c)
forall a s. DecShareCBOR a =&gt; StateT (Share a) (Decoder s) a
</span><span class="hs-identifier hs-var">decSharePlusCBOR</span></span><span>
</span><span id="line-247"></span><span>    </span><span id="local-6989586621679502162"><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502162"><span class="hs-identifier hs-var">ssStakeSet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
  (Decoder s)
  (SnapShot c)
StateT (Share (SnapShot c)) (Decoder s) (SnapShot c)
forall s. StateT (Share (SnapShot c)) (Decoder s) (SnapShot c)
forall a s. DecShareCBOR a =&gt; StateT (Share a) (Decoder s) a
</span><span class="hs-identifier hs-var">decSharePlusCBOR</span></span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621679502163"><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502163"><span class="hs-identifier hs-var">ssStakeGo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
  (Decoder s)
  (SnapShot c)
StateT (Share (SnapShot c)) (Decoder s) (SnapShot c)
forall s. StateT (Share (SnapShot c)) (Decoder s) (SnapShot c)
forall a s. DecShareCBOR a =&gt; StateT (Share a) (Decoder s) a
</span><span class="hs-identifier hs-var">decSharePlusCBOR</span></span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621679502164"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679502164"><span class="hs-identifier hs-var">ssFee</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Coin
-&gt; StateT
     (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
     (Decoder s)
     Coin
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a
-&gt; StateT
     (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
     m
     a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Coin
forall s. Decoder s Coin
forall a s. DecCBOR a =&gt; Decoder s a
</span><span class="hs-identifier hs-var">decCBOR</span></span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679502165"><span class="annot"><span class="annottext">ssStakeMarkPoolDistr :: PoolDistr c
</span><a href="#local-6989586621679502165"><span class="hs-identifier hs-var hs-var">ssStakeMarkPoolDistr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapShot c -&gt; PoolDistr c
forall c. SnapShot c -&gt; PoolDistr c
</span><a href="Cardano.Ledger.EpochBoundary.html#calculatePoolDistr"><span class="hs-identifier hs-var">calculatePoolDistr</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502161"><span class="hs-identifier hs-var">ssStakeMark</span></a></span><span>
</span><span id="line-251"></span><span>    </span><span class="annot"><span class="annottext">SnapShots c
-&gt; StateT
     (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
     (Decoder s)
     (SnapShots c)
forall a.
a
-&gt; StateT
     (Interns (Credential 'Staking c), Interns (KeyHash 'StakePool c))
     (Decoder s)
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">SnapShot c
$sel:ssStakeMark:SnapShots :: SnapShot c
ssStakeMark :: SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeMark%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeMark</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PoolDistr c
$sel:ssStakeMarkPoolDistr:SnapShots :: PoolDistr c
ssStakeMarkPoolDistr :: PoolDistr c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeMarkPoolDistr%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeMarkPoolDistr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SnapShot c
$sel:ssStakeSet:SnapShots :: SnapShot c
ssStakeSet :: SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeSet%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SnapShot c
$sel:ssStakeGo:SnapShots :: SnapShot c
ssStakeGo :: SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeGo%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeGo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin
$sel:ssFee:SnapShots :: Coin
ssFee :: Coin
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssFee%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssFee</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679501081"><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501081"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-254"></span><span>  </span><span id="local-6989586621679502169"><span class="annot"><span class="annottext">def :: SnapShots c
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">def</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapShots c
forall c. SnapShots c
</span><a href="Cardano.Ledger.EpochBoundary.html#emptySnapShots"><span class="hs-identifier hs-var">emptySnapShots</span></a></span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679501083"><span id="local-6989586621679502174"><span id="local-6989586621679502178"><span id="local-6989586621679502181"><span class="annot"><a href="Cardano.Ledger.Crypto.html#Crypto"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501083"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501083"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-257"></span><span>  </span><span id="local-6989586621679502187"><span class="annot"><span class="annottext">toJSON :: SnapShots c -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span> </span><span class="annot"><span class="annottext">([Pair] -&gt; Value)
-&gt; (SnapShots c -&gt; [Pair]) -&gt; SnapShots c -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShots c -&gt; [Pair]
forall e a crypto.
(KeyValue e a, Crypto crypto) =&gt;
SnapShots crypto -&gt; [a]
</span><a href="Cardano.Ledger.EpochBoundary.html#toSnapShotsPair"><span class="hs-identifier hs-var">toSnapShotsPair</span></a></span><span>
</span><span id="line-258"></span><span>  </span><span id="local-6989586621679502192"><span class="annot"><span class="annottext">toEncoding :: SnapShots c -&gt; Encoding
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toEncoding</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Series -&gt; Encoding
</span><span class="hs-identifier hs-var">pairs</span></span><span> </span><span class="annot"><span class="annottext">(Series -&gt; Encoding)
-&gt; (SnapShots c -&gt; Series) -&gt; SnapShots c -&gt; Encoding
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Series] -&gt; Series
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">([Series] -&gt; Series)
-&gt; (SnapShots c -&gt; [Series]) -&gt; SnapShots c -&gt; Series
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShots c -&gt; [Series]
forall e a crypto.
(KeyValue e a, Crypto crypto) =&gt;
SnapShots crypto -&gt; [a]
</span><a href="Cardano.Ledger.EpochBoundary.html#toSnapShotsPair"><span class="hs-identifier hs-var">toSnapShotsPair</span></a></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span id="local-6989586621679501084"><span id="local-6989586621679501085"><span id="local-6989586621679501086"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#toSnapShotsPair"><span class="hs-identifier hs-type">toSnapShotsPair</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">KeyValue</span></span><span> </span><span class="annot"><a href="#local-6989586621679501084"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501085"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Crypto.html#Crypto"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501086"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501086"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679501085"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-261"></span><span id="toSnapShotsPair"><span class="annot"><span class="annottext">toSnapShotsPair :: forall e a crypto.
(KeyValue e a, Crypto crypto) =&gt;
SnapShots crypto -&gt; [a]
</span><a href="Cardano.Ledger.EpochBoundary.html#toSnapShotsPair"><span class="hs-identifier hs-var hs-var">toSnapShotsPair</span></a></span></span><span> </span><span id="local-6989586621679502208"><span class="annot"><span class="annottext">ss :: SnapShots crypto
</span><a href="#local-6989586621679502208"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="annottext">SnapShot crypto
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PoolDistr crypto
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SnapShot crypto
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SnapShot crypto
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-comment">-- ssStakeMarkPoolDistr is omitted on purpose</span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679502209"><span class="annot"><span class="annottext">SnapShot crypto
$sel:ssStakeMark:SnapShots :: forall c. SnapShots c -&gt; SnapShot c
ssStakeMark :: SnapShot crypto
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeMark%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeMark</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679502210"><span class="annot"><span class="annottext">SnapShot crypto
$sel:ssStakeSet:SnapShots :: forall c. SnapShots c -&gt; SnapShot c
ssStakeSet :: SnapShot crypto
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeSet%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeSet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679502211"><span class="annot"><span class="annottext">SnapShot crypto
$sel:ssStakeGo:SnapShots :: forall c. SnapShots c -&gt; SnapShot c
ssStakeGo :: SnapShot crypto
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeGo%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeGo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679502212"><span class="annot"><span class="annottext">Coin
$sel:ssFee:SnapShots :: forall c. SnapShots c -&gt; Coin
ssFee :: Coin
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssFee%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssFee</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapShots crypto
</span><a href="#local-6989586621679502208"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-264"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;pstakeMark&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; SnapShot crypto -&gt; a
forall v. ToJSON v =&gt; Key -&gt; v -&gt; a
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">SnapShot crypto
</span><a href="#local-6989586621679502209"><span class="hs-identifier hs-var">ssStakeMark</span></a></span><span>
</span><span id="line-265"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;pstakeSet&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; SnapShot crypto -&gt; a
forall v. ToJSON v =&gt; Key -&gt; v -&gt; a
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">SnapShot crypto
</span><a href="#local-6989586621679502210"><span class="hs-identifier hs-var">ssStakeSet</span></a></span><span>
</span><span id="line-266"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;pstakeGo&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; SnapShot crypto -&gt; a
forall v. ToJSON v =&gt; Key -&gt; v -&gt; a
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">SnapShot crypto
</span><a href="#local-6989586621679502211"><span class="hs-identifier hs-var">ssStakeGo</span></a></span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;feeSS&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Coin -&gt; a
forall v. ToJSON v =&gt; Key -&gt; v -&gt; a
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679502212"><span class="hs-identifier hs-var">ssFee</span></a></span><span>
</span><span id="line-268"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span id="local-6989586621679501090"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#emptySnapShot"><span class="hs-identifier hs-type">emptySnapShot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501090"><span class="hs-identifier hs-type">c</span></a></span></span><span>
</span><span id="line-271"></span><span id="emptySnapShot"><span class="annot"><span class="annottext">emptySnapShot :: forall c. SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#emptySnapShot"><span class="hs-identifier hs-var hs-var">emptySnapShot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stake c
-&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
-&gt; VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
-&gt; SnapShot c
forall c.
Stake c
-&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
-&gt; VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
-&gt; SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-var">SnapShot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking c) (CompactForm Coin) -&gt; Stake c
forall c.
VMap VB VP (Credential 'Staking c) (CompactForm Coin) -&gt; Stake c
</span><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-var">Stake</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking c) (CompactForm Coin)
forall (kv :: * -&gt; *) k (vv :: * -&gt; *) v.
(Vector kv k, Vector vv v) =&gt;
VMap kv vv k v
</span><span class="hs-identifier hs-var">VMap.empty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
forall (kv :: * -&gt; *) k (vv :: * -&gt; *) v.
(Vector kv k, Vector vv v) =&gt;
VMap kv vv k v
</span><span class="hs-identifier hs-var">VMap.empty</span></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
forall (kv :: * -&gt; *) k (vv :: * -&gt; *) v.
(Vector kv k, Vector vv v) =&gt;
VMap kv vv k v
</span><span class="hs-identifier hs-var">VMap.empty</span></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span id="local-6989586621679502221"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#emptySnapShots"><span class="hs-identifier hs-type">emptySnapShots</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679502221"><span class="hs-identifier hs-type">c</span></a></span></span><span>
</span><span id="line-274"></span><span id="emptySnapShots"><span class="annot"><span class="annottext">emptySnapShots :: forall c. SnapShots c
</span><a href="Cardano.Ledger.EpochBoundary.html#emptySnapShots"><span class="hs-identifier hs-var hs-var">emptySnapShots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><span class="annottext">SnapShot c
-&gt; PoolDistr c -&gt; SnapShot c -&gt; SnapShot c -&gt; Coin -&gt; SnapShots c
forall c.
SnapShot c
-&gt; PoolDistr c -&gt; SnapShot c -&gt; SnapShot c -&gt; Coin -&gt; SnapShots c
</span><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-var">SnapShots</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot c
forall c. SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#emptySnapShot"><span class="hs-identifier hs-var">emptySnapShot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SnapShot c -&gt; PoolDistr c
forall c. SnapShot c -&gt; PoolDistr c
</span><a href="Cardano.Ledger.EpochBoundary.html#calculatePoolDistr"><span class="hs-identifier hs-var">calculatePoolDistr</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot c
forall c. SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#emptySnapShot"><span class="hs-identifier hs-var">emptySnapShot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SnapShot c
forall c. SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#emptySnapShot"><span class="hs-identifier hs-var">emptySnapShot</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot c
forall c. SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#emptySnapShot"><span class="hs-identifier hs-var">emptySnapShot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="hs-comment">-- =======================================</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="annot"><span class="hs-comment">-- | Sum up the Coin (as CompactForm Coin = Word64) for each StakePool</span></span><span>
</span><span id="line-280"></span><span id="local-6989586621679501097"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#calculatePoolStake"><span class="hs-identifier hs-type">calculatePoolStake</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501097"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">VMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501097"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501097"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-283"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501097"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501097"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span></span><span>
</span><span id="line-285"></span><span id="calculatePoolStake"><span class="annot"><span class="annottext">calculatePoolStake :: forall c.
(KeyHash 'StakePool c -&gt; Bool)
-&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
-&gt; Stake c
-&gt; Map (KeyHash 'StakePool c) Word64
</span><a href="Cardano.Ledger.EpochBoundary.html#calculatePoolStake"><span class="hs-identifier hs-var hs-var">calculatePoolStake</span></a></span></span><span> </span><span id="local-6989586621679502231"><span class="annot"><span class="annottext">KeyHash 'StakePool c -&gt; Bool
</span><a href="#local-6989586621679502231"><span class="hs-identifier hs-var">includeHash</span></a></span></span><span> </span><span id="local-6989586621679502232"><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="#local-6989586621679502232"><span class="hs-identifier hs-var">delegs</span></a></span></span><span> </span><span id="local-6989586621679502233"><span class="annot"><span class="annottext">Stake c
</span><a href="#local-6989586621679502233"><span class="hs-identifier hs-var">stake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map (KeyHash 'StakePool c) Word64
 -&gt; Credential 'Staking c
 -&gt; KeyHash 'StakePool c
 -&gt; Map (KeyHash 'StakePool c) Word64)
-&gt; Map (KeyHash 'StakePool c) Word64
-&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
-&gt; Map (KeyHash 'StakePool c) Word64
forall (kv :: * -&gt; *) k (vv :: * -&gt; *) v a.
(Vector kv k, Vector vv v) =&gt;
(a -&gt; k -&gt; v -&gt; a) -&gt; a -&gt; VMap kv vv k v -&gt; a
</span><span class="hs-identifier hs-var">VMap.foldlWithKey</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool c) Word64
-&gt; Credential 'Staking c
-&gt; KeyHash 'StakePool c
-&gt; Map (KeyHash 'StakePool c) Word64
</span><a href="#local-6989586621679502234"><span class="hs-identifier hs-var">accum</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool c) Word64
forall k a. Map k a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="#local-6989586621679502232"><span class="hs-identifier hs-var">delegs</span></a></span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-287"></span><span>    </span><span id="local-6989586621679502234"><span class="annot"><span class="annottext">accum :: Map (KeyHash 'StakePool c) Word64
-&gt; Credential 'Staking c
-&gt; KeyHash 'StakePool c
-&gt; Map (KeyHash 'StakePool c) Word64
</span><a href="#local-6989586621679502234"><span class="hs-identifier hs-var hs-var">accum</span></a></span></span><span> </span><span id="local-6989586621679502235"><span class="annot"><span class="annottext">Map (KeyHash 'StakePool c) Word64
</span><a href="#local-6989586621679502235"><span class="hs-identifier hs-var">ans</span></a></span></span><span> </span><span id="local-6989586621679502236"><span class="annot"><span class="annottext">Credential 'Staking c
</span><a href="#local-6989586621679502236"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span id="local-6989586621679502237"><span class="annot"><span class="annottext">KeyHash 'StakePool c
</span><a href="#local-6989586621679502237"><span class="hs-identifier hs-var">keyHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-288"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool c -&gt; Bool
</span><a href="#local-6989586621679502231"><span class="hs-identifier hs-var">includeHash</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool c
</span><a href="#local-6989586621679502237"><span class="hs-identifier hs-var">keyHash</span></a></span><span>
</span><span id="line-289"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Credential 'Staking c
-&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
-&gt; Maybe (CompactForm Coin)
forall k (kv :: * -&gt; *) (vv :: * -&gt; *) v.
(Ord k, Vector kv k, Vector vv v) =&gt;
k -&gt; VMap kv vv k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">VMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking c
</span><a href="#local-6989586621679502236"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stake c -&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
forall c.
Stake c -&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AunStake%3AStake"><span class="hs-identifier hs-var">unStake</span></a></span><span> </span><span class="annot"><span class="annottext">Stake c
</span><a href="#local-6989586621679502233"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-290"></span><span>          </span><span class="annot"><span class="annottext">Maybe (CompactForm Coin)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool c) Word64
</span><a href="#local-6989586621679502235"><span class="hs-identifier hs-var">ans</span></a></span><span>
</span><span id="line-291"></span><span>          </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Coin.html#CompactCoin"><span class="hs-identifier hs-type">CompactCoin</span></a></span><span> </span><span id="local-6989586621679502238"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679502238"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Word64 -&gt; Word64)
-&gt; KeyHash 'StakePool c
-&gt; Word64
-&gt; Map (KeyHash 'StakePool c) Word64
-&gt; Map (KeyHash 'StakePool c) Word64
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.Internal.html#insertWith"><span class="hs-identifier hs-var">Map.insertWith</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">(+)</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool c
</span><a href="#local-6989586621679502237"><span class="hs-identifier hs-var">keyHash</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679502238"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool c) Word64
</span><a href="#local-6989586621679502235"><span class="hs-identifier hs-var">ans</span></a></span><span>
</span><span id="line-292"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool c) Word64
</span><a href="#local-6989586621679502235"><span class="hs-identifier hs-var">ans</span></a></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span id="local-6989586621679501077"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#calculatePoolDistr"><span class="hs-identifier hs-type">calculatePoolDistr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501077"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.PoolDistr.html#PoolDistr"><span class="hs-identifier hs-type">PoolDistr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501077"><span class="hs-identifier hs-type">c</span></a></span></span><span>
</span><span id="line-295"></span><span id="calculatePoolDistr"><span class="annot"><span class="annottext">calculatePoolDistr :: forall c. SnapShot c -&gt; PoolDistr c
</span><a href="Cardano.Ledger.EpochBoundary.html#calculatePoolDistr"><span class="hs-identifier hs-var hs-var">calculatePoolDistr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(KeyHash 'StakePool c -&gt; Bool) -&gt; SnapShot c -&gt; PoolDistr c
forall c.
(KeyHash 'StakePool c -&gt; Bool) -&gt; SnapShot c -&gt; PoolDistr c
</span><a href="Cardano.Ledger.EpochBoundary.html#calculatePoolDistr%27"><span class="hs-identifier hs-var">calculatePoolDistr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; KeyHash 'StakePool c -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#calculatePoolDistr%27"><span class="hs-identifier hs-type">calculatePoolDistr'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679501100"><span class="annot"><a href="#local-6989586621679501100"><span class="hs-identifier hs-type">c</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501100"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501100"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.PoolDistr.html#PoolDistr"><span class="hs-identifier hs-type">PoolDistr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501100"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-298"></span><span id="calculatePoolDistr%27"><span class="annot"><span class="annottext">calculatePoolDistr' :: forall c.
(KeyHash 'StakePool c -&gt; Bool) -&gt; SnapShot c -&gt; PoolDistr c
</span><a href="Cardano.Ledger.EpochBoundary.html#calculatePoolDistr%27"><span class="hs-identifier hs-var hs-var">calculatePoolDistr'</span></a></span></span><span> </span><span id="local-6989586621679502248"><span class="annot"><span class="annottext">KeyHash 'StakePool c -&gt; Bool
</span><a href="#local-6989586621679502248"><span class="hs-identifier hs-var">includeHash</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span id="local-6989586621679502249"><span class="annot"><span class="annottext">Stake c
</span><a href="#local-6989586621679502249"><span class="hs-identifier hs-var">stake</span></a></span></span><span> </span><span id="local-6989586621679502250"><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="#local-6989586621679502250"><span class="hs-identifier hs-var">delegs</span></a></span></span><span> </span><span id="local-6989586621679502251"><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
</span><a href="#local-6989586621679502251"><span class="hs-identifier hs-var">poolParams</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span id="local-6989586621679502252"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679502252"><span class="hs-identifier hs-var">total</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stake c -&gt; Coin
forall c. Stake c -&gt; Coin
</span><a href="Cardano.Ledger.EpochBoundary.html#sumAllStake"><span class="hs-identifier hs-var">sumAllStake</span></a></span><span> </span><span class="annot"><span class="annottext">Stake c
</span><a href="#local-6989586621679502249"><span class="hs-identifier hs-var">stake</span></a></span><span>
</span><span id="line-300"></span><span>      </span><span class="hs-comment">-- total could be zero (in particular when shrinking)</span><span>
</span><span id="line-301"></span><span>      </span><span class="annot"><a href="#local-6989586621679502253"><span class="hs-identifier hs-type">nonZeroTotal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-bignum-1.3/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span>
</span><span id="line-302"></span><span>      </span><span id="local-6989586621679502253"><span class="annot"><span class="annottext">nonZeroTotal :: Integer
</span><a href="#local-6989586621679502253"><span class="hs-identifier hs-var hs-var">nonZeroTotal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679502252"><span class="hs-identifier hs-var">total</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679502252"><span class="hs-identifier hs-var">total</span></a></span><span>
</span><span id="line-303"></span><span>      </span><span class="annot"><a href="#local-6989586621679502254"><span class="hs-identifier hs-type">poolStakeMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501100"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span>
</span><span id="line-304"></span><span>      </span><span id="local-6989586621679502254"><span class="annot"><span class="annottext">poolStakeMap :: Map (KeyHash 'StakePool c) Word64
</span><a href="#local-6989586621679502254"><span class="hs-identifier hs-var hs-var">poolStakeMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(KeyHash 'StakePool c -&gt; Bool)
-&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
-&gt; Stake c
-&gt; Map (KeyHash 'StakePool c) Word64
forall c.
(KeyHash 'StakePool c -&gt; Bool)
-&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
-&gt; Stake c
-&gt; Map (KeyHash 'StakePool c) Word64
</span><a href="Cardano.Ledger.EpochBoundary.html#calculatePoolStake"><span class="hs-identifier hs-var">calculatePoolStake</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool c -&gt; Bool
</span><a href="#local-6989586621679502248"><span class="hs-identifier hs-var">includeHash</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="#local-6989586621679502250"><span class="hs-identifier hs-var">delegs</span></a></span><span> </span><span class="annot"><span class="annottext">Stake c
</span><a href="#local-6989586621679502249"><span class="hs-identifier hs-var">stake</span></a></span><span>
</span><span id="line-305"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool c) (IndividualPoolStake c) -&gt; PoolDistr c
forall c.
Map (KeyHash 'StakePool c) (IndividualPoolStake c) -&gt; PoolDistr c
</span><a href="Cardano.Ledger.PoolDistr.html#PoolDistr"><span class="hs-identifier hs-var">PoolDistr</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (KeyHash 'StakePool c) (IndividualPoolStake c) -&gt; PoolDistr c)
-&gt; Map (KeyHash 'StakePool c) (IndividualPoolStake c)
-&gt; PoolDistr c
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-306"></span><span>        </span><span class="annot"><span class="annottext">(Word64 -&gt; PoolParams c -&gt; IndividualPoolStake c)
-&gt; Map (KeyHash 'StakePool c) Word64
-&gt; Map (KeyHash 'StakePool c) (PoolParams c)
-&gt; Map (KeyHash 'StakePool c) (IndividualPoolStake c)
forall k a b c.
Ord k =&gt;
(a -&gt; b -&gt; c) -&gt; Map k a -&gt; Map k b -&gt; Map k c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.Internal.html#intersectionWith"><span class="hs-identifier hs-var">Map.intersectionWith</span></a></span><span>
</span><span id="line-307"></span><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679502257"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679502257"><span class="hs-identifier hs-var">word64</span></a></span></span><span> </span><span id="local-6989586621679502258"><span class="annot"><span class="annottext">PoolParams c
</span><a href="#local-6989586621679502258"><span class="hs-identifier hs-var">poolparam</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Hash c (VerKeyVRF c) -&gt; IndividualPoolStake c
forall c. Rational -&gt; Hash c (VerKeyVRF c) -&gt; IndividualPoolStake c
</span><a href="Cardano.Ledger.PoolDistr.html#IndividualPoolStake"><span class="hs-identifier hs-var">IndividualPoolStake</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#toInteger"><span class="hs-identifier hs-var">toInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679502257"><span class="hs-identifier hs-var">word64</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Rational
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#%25"><span class="hs-operator hs-var">%</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679502253"><span class="hs-identifier hs-var">nonZeroTotal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolParams c -&gt; Hash c (VerKeyVRF c)
forall c. PoolParams c -&gt; Hash c (VerKeyVRF c)
</span><a href="Cardano.Ledger.PoolParams.html#ppVrf"><span class="hs-identifier hs-var">ppVrf</span></a></span><span> </span><span class="annot"><span class="annottext">PoolParams c
</span><a href="#local-6989586621679502258"><span class="hs-identifier hs-var">poolparam</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>          </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool c) Word64
</span><a href="#local-6989586621679502254"><span class="hs-identifier hs-var">poolStakeMap</span></a></span><span>
</span><span id="line-309"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
-&gt; Map (KeyHash 'StakePool c) (PoolParams c)
forall (kv :: * -&gt; *) k (vv :: * -&gt; *) v.
(Vector kv k, Vector vv v) =&gt;
VMap kv vv k v -&gt; Map k v
</span><span class="hs-identifier hs-var">VMap.toMap</span></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
</span><a href="#local-6989586621679502251"><span class="hs-identifier hs-var">poolParams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="hs-comment">-- ======================================================</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- Lenses</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- ===============================================</span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="hs-comment">-- SnapShots</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span id="local-6989586621679501118"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssStakeMarkL"><span class="hs-identifier hs-type">ssStakeMarkL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501118"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501118"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-318"></span><span id="ssStakeMarkL"><span class="annot"><span class="annottext">ssStakeMarkL :: forall c (f :: * -&gt; *).
Functor f =&gt;
(SnapShot c -&gt; f (SnapShot c)) -&gt; SnapShots c -&gt; f (SnapShots c)
</span><a href="Cardano.Ledger.EpochBoundary.html#ssStakeMarkL"><span class="hs-identifier hs-var hs-var">ssStakeMarkL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShots c -&gt; SnapShot c)
-&gt; (SnapShots c -&gt; SnapShot c -&gt; SnapShots c)
-&gt; Lens (SnapShots c) (SnapShots c) (SnapShot c) (SnapShot c)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><span class="hs-identifier hs-var">lens</span></span><span> </span><span class="annot"><span class="annottext">SnapShots c -&gt; SnapShot c
forall c. SnapShots c -&gt; SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeMark%3ASnapShots"><span class="hs-identifier hs-var">ssStakeMark</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679502263"><span class="annot"><span class="annottext">SnapShots c
</span><a href="#local-6989586621679502263"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679502264"><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502264"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShots c
</span><a href="#local-6989586621679502263"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeMark%3ASnapShots"><span class="hs-identifier hs-var">ssStakeMark</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679502264"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span id="local-6989586621679501125"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssStakeMarkPoolDistrL"><span class="hs-identifier hs-type">ssStakeMarkPoolDistrL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501125"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.PoolDistr.html#PoolDistr"><span class="hs-identifier hs-type">PoolDistr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501125"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-321"></span><span id="ssStakeMarkPoolDistrL"><span class="annot"><span class="annottext">ssStakeMarkPoolDistrL :: forall c (f :: * -&gt; *).
Functor f =&gt;
(PoolDistr c -&gt; f (PoolDistr c)) -&gt; SnapShots c -&gt; f (SnapShots c)
</span><a href="Cardano.Ledger.EpochBoundary.html#ssStakeMarkPoolDistrL"><span class="hs-identifier hs-var hs-var">ssStakeMarkPoolDistrL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShots c -&gt; PoolDistr c)
-&gt; (SnapShots c -&gt; PoolDistr c -&gt; SnapShots c)
-&gt; Lens (SnapShots c) (SnapShots c) (PoolDistr c) (PoolDistr c)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><span class="hs-identifier hs-var">lens</span></span><span> </span><span class="annot"><span class="annottext">SnapShots c -&gt; PoolDistr c
forall c. SnapShots c -&gt; PoolDistr c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeMarkPoolDistr%3ASnapShots"><span class="hs-identifier hs-var">ssStakeMarkPoolDistr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679502267"><span class="annot"><span class="annottext">SnapShots c
</span><a href="#local-6989586621679502267"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679502268"><span class="annot"><span class="annottext">PoolDistr c
</span><a href="#local-6989586621679502268"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShots c
</span><a href="#local-6989586621679502267"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeMarkPoolDistr%3ASnapShots"><span class="hs-identifier hs-var">ssStakeMarkPoolDistr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679502268"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span id="local-6989586621679502269"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssStakeSetL"><span class="hs-identifier hs-type">ssStakeSetL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679502269"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679502269"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-324"></span><span id="ssStakeSetL"><span class="annot"><span class="annottext">ssStakeSetL :: forall c (f :: * -&gt; *).
Functor f =&gt;
(SnapShot c -&gt; f (SnapShot c)) -&gt; SnapShots c -&gt; f (SnapShots c)
</span><a href="Cardano.Ledger.EpochBoundary.html#ssStakeSetL"><span class="hs-identifier hs-var hs-var">ssStakeSetL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShots c -&gt; SnapShot c)
-&gt; (SnapShots c -&gt; SnapShot c -&gt; SnapShots c)
-&gt; Lens (SnapShots c) (SnapShots c) (SnapShot c) (SnapShot c)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><span class="hs-identifier hs-var">lens</span></span><span> </span><span class="annot"><span class="annottext">SnapShots c -&gt; SnapShot c
forall c. SnapShots c -&gt; SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeSet%3ASnapShots"><span class="hs-identifier hs-var">ssStakeSet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679502272"><span class="annot"><span class="annottext">SnapShots c
</span><a href="#local-6989586621679502272"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679502273"><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502273"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShots c
</span><a href="#local-6989586621679502272"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeSet%3ASnapShots"><span class="hs-identifier hs-var">ssStakeSet</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679502273"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span id="local-6989586621679502274"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssStakeGoL"><span class="hs-identifier hs-type">ssStakeGoL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679502274"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679502274"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-327"></span><span id="ssStakeGoL"><span class="annot"><span class="annottext">ssStakeGoL :: forall c (f :: * -&gt; *).
Functor f =&gt;
(SnapShot c -&gt; f (SnapShot c)) -&gt; SnapShots c -&gt; f (SnapShots c)
</span><a href="Cardano.Ledger.EpochBoundary.html#ssStakeGoL"><span class="hs-identifier hs-var hs-var">ssStakeGoL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShots c -&gt; SnapShot c)
-&gt; (SnapShots c -&gt; SnapShot c -&gt; SnapShots c)
-&gt; Lens (SnapShots c) (SnapShots c) (SnapShot c) (SnapShot c)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><span class="hs-identifier hs-var">lens</span></span><span> </span><span class="annot"><span class="annottext">SnapShots c -&gt; SnapShot c
forall c. SnapShots c -&gt; SnapShot c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeGo%3ASnapShots"><span class="hs-identifier hs-var">ssStakeGo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679502277"><span class="annot"><span class="annottext">SnapShots c
</span><a href="#local-6989586621679502277"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679502278"><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502278"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShots c
</span><a href="#local-6989586621679502277"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStakeGo%3ASnapShots"><span class="hs-identifier hs-var">ssStakeGo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679502278"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span id="local-6989586621679501132"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssFeeL"><span class="hs-identifier hs-type">ssFeeL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501132"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span></span><span>
</span><span id="line-330"></span><span id="ssFeeL"><span class="annot"><span class="annottext">ssFeeL :: forall c (f :: * -&gt; *).
Functor f =&gt;
(Coin -&gt; f Coin) -&gt; SnapShots c -&gt; f (SnapShots c)
</span><a href="Cardano.Ledger.EpochBoundary.html#ssFeeL"><span class="hs-identifier hs-var hs-var">ssFeeL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShots c -&gt; Coin)
-&gt; (SnapShots c -&gt; Coin -&gt; SnapShots c)
-&gt; Lens (SnapShots c) (SnapShots c) Coin Coin
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><span class="hs-identifier hs-var">lens</span></span><span> </span><span class="annot"><span class="annottext">SnapShots c -&gt; Coin
forall c. SnapShots c -&gt; Coin
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssFee%3ASnapShots"><span class="hs-identifier hs-var">ssFee</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679502281"><span class="annot"><span class="annottext">SnapShots c
</span><a href="#local-6989586621679502281"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679502282"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679502282"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShots c
</span><a href="#local-6989586621679502281"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssFee%3ASnapShots"><span class="hs-identifier hs-var">ssFee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679502282"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="hs-comment">-- SnapShot</span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span id="local-6989586621679501135"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssStakeL"><span class="hs-identifier hs-type">ssStakeL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501135"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501135"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-335"></span><span id="ssStakeL"><span class="annot"><span class="annottext">ssStakeL :: forall c (f :: * -&gt; *).
Functor f =&gt;
(Stake c -&gt; f (Stake c)) -&gt; SnapShot c -&gt; f (SnapShot c)
</span><a href="Cardano.Ledger.EpochBoundary.html#ssStakeL"><span class="hs-identifier hs-var hs-var">ssStakeL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShot c -&gt; Stake c)
-&gt; (SnapShot c -&gt; Stake c -&gt; SnapShot c)
-&gt; Lens (SnapShot c) (SnapShot c) (Stake c) (Stake c)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><span class="hs-identifier hs-var">lens</span></span><span> </span><span class="annot"><span class="annottext">SnapShot c -&gt; Stake c
forall c. SnapShot c -&gt; Stake c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStake%3ASnapShot"><span class="hs-identifier hs-var">ssStake</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679502285"><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502285"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679502286"><span class="annot"><span class="annottext">Stake c
</span><a href="#local-6989586621679502286"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502285"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStake%3ASnapShot"><span class="hs-identifier hs-var">ssStake</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679502286"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span id="local-6989586621679501138"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssStakeDistrL"><span class="hs-identifier hs-type">ssStakeDistrL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501138"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VP</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501138"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-338"></span><span id="ssStakeDistrL"><span class="annot"><span class="annottext">ssStakeDistrL :: forall c (f :: * -&gt; *).
Functor f =&gt;
(VMap VB VP (Credential 'Staking c) (CompactForm Coin)
 -&gt; f (VMap VB VP (Credential 'Staking c) (CompactForm Coin)))
-&gt; SnapShot c -&gt; f (SnapShot c)
</span><a href="Cardano.Ledger.EpochBoundary.html#ssStakeDistrL"><span class="hs-identifier hs-var hs-var">ssStakeDistrL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShot c
 -&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin))
-&gt; (SnapShot c
    -&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
    -&gt; SnapShot c)
-&gt; Lens
     (SnapShot c)
     (SnapShot c)
     (VMap VB VP (Credential 'Staking c) (CompactForm Coin))
     (VMap VB VP (Credential 'Staking c) (CompactForm Coin))
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><span class="hs-identifier hs-var">lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stake c -&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
forall c.
Stake c -&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AunStake%3AStake"><span class="hs-identifier hs-var">unStake</span></a></span><span> </span><span class="annot"><span class="annottext">(Stake c -&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin))
-&gt; (SnapShot c -&gt; Stake c)
-&gt; SnapShot c
-&gt; VMap VB VP (Credential 'Staking c) (CompactForm Coin)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot c -&gt; Stake c
forall c. SnapShot c -&gt; Stake c
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStake%3ASnapShot"><span class="hs-identifier hs-var">ssStake</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679502289"><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502289"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679502290"><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking c) (CompactForm Coin)
</span><a href="#local-6989586621679502290"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502289"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssStake%3ASnapShot"><span class="hs-identifier hs-var">ssStake</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679502290"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span id="local-6989586621679501141"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssDelegationsL"><span class="hs-identifier hs-type">ssDelegationsL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501141"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501141"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501141"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-341"></span><span id="ssDelegationsL"><span class="annot"><span class="annottext">ssDelegationsL :: forall c (f :: * -&gt; *).
Functor f =&gt;
(VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
 -&gt; f (VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)))
-&gt; SnapShot c -&gt; f (SnapShot c)
</span><a href="Cardano.Ledger.EpochBoundary.html#ssDelegationsL"><span class="hs-identifier hs-var hs-var">ssDelegationsL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShot c
 -&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c))
-&gt; (SnapShot c
    -&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
    -&gt; SnapShot c)
-&gt; Lens
     (SnapShot c)
     (SnapShot c)
     (VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c))
     (VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c))
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><span class="hs-identifier hs-var">lens</span></span><span> </span><span class="annot"><span class="annottext">SnapShot c
-&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
forall c.
SnapShot c
-&gt; VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssDelegations%3ASnapShot"><span class="hs-identifier hs-var">ssDelegations</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679502293"><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502293"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679502294"><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking c) (KeyHash 'StakePool c)
</span><a href="#local-6989586621679502294"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502293"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssDelegations%3ASnapShot"><span class="hs-identifier hs-var">ssDelegations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679502294"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span id="local-6989586621679501144"><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#ssPoolParamsL"><span class="hs-identifier hs-type">ssPoolParamsL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501144"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VB</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501144"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.PoolParams.html#PoolParams"><span class="hs-identifier hs-type">PoolParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679501144"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-344"></span><span id="ssPoolParamsL"><span class="annot"><span class="annottext">ssPoolParamsL :: forall c (f :: * -&gt; *).
Functor f =&gt;
(VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
 -&gt; f (VMap VB VB (KeyHash 'StakePool c) (PoolParams c)))
-&gt; SnapShot c -&gt; f (SnapShot c)
</span><a href="Cardano.Ledger.EpochBoundary.html#ssPoolParamsL"><span class="hs-identifier hs-var hs-var">ssPoolParamsL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShot c -&gt; VMap VB VB (KeyHash 'StakePool c) (PoolParams c))
-&gt; (SnapShot c
    -&gt; VMap VB VB (KeyHash 'StakePool c) (PoolParams c) -&gt; SnapShot c)
-&gt; Lens
     (SnapShot c)
     (SnapShot c)
     (VMap VB VB (KeyHash 'StakePool c) (PoolParams c))
     (VMap VB VB (KeyHash 'StakePool c) (PoolParams c))
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><span class="hs-identifier hs-var">lens</span></span><span> </span><span class="annot"><span class="annottext">SnapShot c -&gt; VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
forall c.
SnapShot c -&gt; VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
</span><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssPoolParams%3ASnapShot"><span class="hs-identifier hs-var">ssPoolParams</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679502297"><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502297"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679502298"><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool c) (PoolParams c)
</span><a href="#local-6989586621679502298"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShot c
</span><a href="#local-6989586621679502297"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.EpochBoundary.html#%24sel%3AssPoolParams%3ASnapShot"><span class="hs-identifier hs-var">ssPoolParams</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679502298"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-345"></span></pre></body></html>