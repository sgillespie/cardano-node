<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE PackageImports #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span class="hs-cpp">

#if !defined(mingw32_HOST_OS)
</span><span class="hs-cpp">#define UNIX
</span><span class="hs-cpp">#endif
</span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Tracer.Utils</span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#applyBrake"><span class="hs-identifier">applyBrake</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#askNodeId"><span class="hs-identifier">askNodeId</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#askNodeName"><span class="hs-identifier">askNodeName</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#askNodeNameRaw"><span class="hs-identifier">askNodeNameRaw</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#beforeProgramStops"><span class="hs-identifier">beforeProgramStops</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#connIdToNodeId"><span class="hs-identifier">connIdToNodeId</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#initAcceptedMetrics"><span class="hs-identifier">initAcceptedMetrics</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#initConnectedNodes"><span class="hs-identifier">initConnectedNodes</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#initConnectedNodesNames"><span class="hs-identifier">initConnectedNodesNames</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#initDataPointRequestors"><span class="hs-identifier">initDataPointRequestors</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#initProtocolsBrake"><span class="hs-identifier">initProtocolsBrake</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#lift2M"><span class="hs-identifier">lift2M</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#lift3M"><span class="hs-identifier">lift3M</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#forMM"><span class="hs-identifier">forMM</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#forMM_"><span class="hs-identifier">forMM_</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#nl"><span class="hs-identifier">nl</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#runInLoop"><span class="hs-identifier">runInLoop</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Utils.html#showProblemIfAny"><span class="hs-identifier">showProblemIfAny</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#if MIN_VERSION_base(4,18,0)
</span><span class="hs-comment">-- Do not know why.</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Applicative.html"><span class="hs-identifier">Control.Applicative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#liftA3"><span class="hs-identifier">liftA3</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Applicative</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">liftA2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">liftA3</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Concurrent.html"><span class="hs-identifier">Control.Concurrent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#killThread"><span class="hs-identifier">killThread</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#mkWeakThreadId"><span class="hs-identifier">mkWeakThreadId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#myThreadId"><span class="hs-identifier">myThreadId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Control.Concurrent.Extra.html"><span class="hs-identifier">Control.Concurrent.Extra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Control.Concurrent.Extra.html#Lock"><span class="hs-identifier">Lock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.html"><span class="hs-identifier">Control.Concurrent.STM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#atomically"><span class="hs-identifier">atomically</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TVar.html"><span class="hs-identifier">Control.Concurrent.STM.TVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TVar.html#modifyTVar%27"><span class="hs-identifier">modifyTVar'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#newTVarIO"><span class="hs-identifier">newTVarIO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#readTVarIO"><span class="hs-identifier">readTVarIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Exception.html"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Exception.html#SomeAsyncException"><span class="hs-identifier">SomeAsyncException</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier">SomeException</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Exception.Base.html#finally"><span class="hs-identifier">finally</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier">fromException</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>                   </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Exception.Base.html#try"><span class="hs-identifier">try</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Exception.Base.html#tryJust"><span class="hs-identifier">tryJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier">forM_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Control.Monad.Extra.html"><span class="hs-identifier">Control.Monad.Extra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Control.Monad.Extra.html#whenJustM"><span class="hs-identifier">whenJustM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="hs-string">&quot;contra-tracer&quot;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-node/cardano-node/dist-newstyle/build/x86_64-linux/ghc-9.6.3/trace-dispatcher-2.5.2/doc/html/trace-dispatcher/src/Control.Tracer.html"><span class="hs-identifier">Control.Tracer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/dkmky2ci646kg44ca5yvqjsbpllsmy3f-contra-tracer-lib-contra-tracer-0.1.0.2-haddock-doc/share/doc/contra-tracer/html/src/Control.Tracer.html#showTracing"><span class="hs-identifier">showTracing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/dkmky2ci646kg44ca5yvqjsbpllsmy3f-contra-tracer-lib-contra-tracer-0.1.0.2-haddock-doc/share/doc/contra-tracer/html/src/Control.Tracer.html#stdoutTracer"><span class="hs-identifier">stdoutTracer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/dkmky2ci646kg44ca5yvqjsbpllsmy3f-contra-tracer-lib-contra-tracer-0.1.0.2-haddock-doc/share/doc/contra-tracer/html/src/Control.Tracer.html#traceWith"><span class="hs-identifier">traceWith</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Bimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(!&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bimap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BM</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.List.Extra.html"><span class="hs-identifier">Data.List.Extra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.List.Extra.html#dropPrefix"><span class="hs-identifier">dropPrefix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.List.Extra.html#dropSuffix"><span class="hs-identifier">dropSuffix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.List.Extra.html#replace"><span class="hs-identifier">replace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.html"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.Tuple.Extra.html"><span class="hs-identifier">Data.Tuple.Extra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.Tuple.Extra.html#uncurry3"><span class="hs-identifier">uncurry3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/System.IO.html"><span class="hs-identifier">System.IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Handle.html#hFlush"><span class="hs-identifier">hFlush</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.StdHandles.html#stdout"><span class="hs-identifier">stdout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/System.Mem.Weak.html"><span class="hs-identifier">System.Mem.Weak</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Weak.html#deRefWeak"><span class="hs-identifier">deRefWeak</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/abkp85z71nz8ki0x114j4v8v90gng4mq-signal-lib-signal-0.1.0.4-haddock-doc/share/doc/signal/html/src/System.Signal.html"><span class="hs-identifier">System.Signal</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/System.Time.Extra.html"><span class="hs-identifier">System.Time.Extra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/System.Time.Extra.html#sleep"><span class="hs-identifier">sleep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///home/runner/work/cardano-node/cardano-node/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cardano-node-8.8.0/doc/html/cardano-node/src/Cardano.Node.Startup.html"><span class="hs-identifier">Cardano.Node.Startup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-node/cardano-node/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cardano-node-8.8.0/doc/html/cardano-node/src/Cardano.Node.Startup.html#NodeInfo"><span class="hs-identifier">NodeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Socket</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ConnectionId</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Tracer.Configuration.html"><span class="hs-identifier">Cardano.Tracer.Configuration</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Tracer.Environment.html"><span class="hs-identifier">Cardano.Tracer.Environment</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Tracer.Handlers.RTView.Update.Utils.html"><span class="hs-identifier">Cardano.Tracer.Handlers.RTView.Update.Utils</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Tracer.Types.html"><span class="hs-identifier">Cardano.Tracer.Types</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">-- | Run monadic action in a loop. If there's an exception,</span><span>
</span><span id="line-72"></span><span class="hs-comment">--   it will re-run the action again, after pause that grows.</span><span>
</span><span id="line-73"></span><span class="annot"><a href="Cardano.Tracer.Utils.html#runInLoop"><span class="hs-identifier hs-type">runInLoop</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>           </span><span class="annot"><span class="hs-comment">-- ^ An IO-action that can throw an exception.</span></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Tracer.Configuration.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Tracer's verbosity.</span></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Local socket.</span></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Current delay, in seconds.</span></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span id="runInLoop"><span class="annot"><span class="annottext">runInLoop :: IO () -&gt; Maybe Verbosity -&gt; String -&gt; Word -&gt; IO ()
</span><a href="Cardano.Tracer.Utils.html#runInLoop"><span class="hs-identifier hs-var hs-var">runInLoop</span></a></span></span><span> </span><span id="local-6989586621679627569"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679627569"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span id="local-6989586621679627570"><span class="annot"><span class="annottext">Maybe Verbosity
</span><a href="#local-6989586621679627570"><span class="hs-identifier hs-var">verb</span></a></span></span><span> </span><span id="local-6989586621679627571"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679627571"><span class="hs-identifier hs-var">localSocket</span></a></span></span><span> </span><span id="local-6989586621679627572"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679627572"><span class="hs-identifier hs-var">prevDelay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><span class="annottext">(SomeException -&gt; Maybe SomeException)
-&gt; IO () -&gt; IO (Either SomeException ())
forall e b a.
Exception e =&gt;
(e -&gt; Maybe b) -&gt; IO a -&gt; IO (Either b a)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Exception.Base.html#tryJust"><span class="hs-identifier hs-var">tryJust</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe SomeException
</span><a href="#local-6989586621679627573"><span class="hs-identifier hs-var">excludeAsyncExceptions</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679627569"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either SomeException ())
-&gt; (Either SomeException () -&gt; IO ()) -&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679627574"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679627574"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-82"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Verbosity
</span><a href="#local-6989586621679627570"><span class="hs-identifier hs-var">verb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-83"></span><span>        </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="Cardano.Tracer.Configuration.html#Minimum"><span class="hs-identifier hs-var">Minimum</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>        </span><span class="annot"><span class="annottext">Maybe Verbosity
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="Cardano.Tracer.Utils.html#logTrace"><span class="hs-identifier hs-var">logTrace</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cardano-tracer, connection with &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679627571"><span class="hs-identifier hs-var">localSocket</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; failed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679627574"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-85"></span><span>      </span><span class="annot"><span class="annottext">Seconds -&gt; IO ()
</span><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/System.Time.Extra.html#sleep"><span class="hs-identifier hs-var">sleep</span></a></span><span> </span><span class="annot"><span class="annottext">(Seconds -&gt; IO ()) -&gt; Seconds -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Seconds
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679627578"><span class="hs-identifier hs-var">currentDelay</span></a></span><span>
</span><span id="line-86"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; Maybe Verbosity -&gt; String -&gt; Word -&gt; IO ()
</span><a href="Cardano.Tracer.Utils.html#runInLoop"><span class="hs-identifier hs-var">runInLoop</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679627569"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Verbosity
</span><a href="#local-6989586621679627570"><span class="hs-identifier hs-var">verb</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679627571"><span class="hs-identifier hs-var">localSocket</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679627578"><span class="hs-identifier hs-var">currentDelay</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-89"></span><span>  </span><span id="local-6989586621679627573"><span class="annot"><span class="annottext">excludeAsyncExceptions :: SomeException -&gt; Maybe SomeException
</span><a href="#local-6989586621679627573"><span class="hs-identifier hs-var hs-var">excludeAsyncExceptions</span></a></span></span><span> </span><span id="local-6989586621679627581"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679627581"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe SomeAsyncException
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var">fromException</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679627581"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-91"></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Exception.html#SomeAsyncException"><span class="hs-identifier hs-type">SomeAsyncException</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe SomeException
forall a. Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-92"></span><span>      </span><span class="annot"><span class="annottext">Maybe SomeAsyncException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe SomeException
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679627581"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621679627578"><span class="annot"><span class="annottext">currentDelay :: Word
</span><a href="#local-6989586621679627578"><span class="hs-identifier hs-var hs-var">currentDelay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679627572"><span class="hs-identifier hs-var">prevDelay</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">60</span></span><span>
</span><span id="line-96"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679627572"><span class="hs-identifier hs-var">prevDelay</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">2</span></span><span>
</span><span id="line-97"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">60</span></span><span> </span><span class="hs-comment">-- After we reached 60+ secs delay, repeat an attempt every minute.</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="annot"><a href="Cardano.Tracer.Utils.html#showProblemIfAny"><span class="hs-identifier hs-type">showProblemIfAny</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Tracer.Configuration.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Tracer's verbosity.</span></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>           </span><span class="annot"><span class="hs-comment">-- ^ An IO-action that can throw an exception.</span></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span id="showProblemIfAny"><span class="annot"><span class="annottext">showProblemIfAny :: Maybe Verbosity -&gt; IO () -&gt; IO ()
</span><a href="Cardano.Tracer.Utils.html#showProblemIfAny"><span class="hs-identifier hs-var hs-var">showProblemIfAny</span></a></span></span><span> </span><span id="local-6989586621679627593"><span class="annot"><span class="annottext">Maybe Verbosity
</span><a href="#local-6989586621679627593"><span class="hs-identifier hs-var">verb</span></a></span></span><span> </span><span id="local-6989586621679627594"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679627594"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; IO (Either SomeException ())
forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Exception.Base.html#try"><span class="hs-identifier hs-var">try</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679627594"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either SomeException ())
-&gt; (Either SomeException () -&gt; IO ()) -&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679627595"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679627595"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Verbosity
</span><a href="#local-6989586621679627593"><span class="hs-identifier hs-var">verb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-107"></span><span>        </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="Cardano.Tracer.Configuration.html#Minimum"><span class="hs-identifier hs-var">Minimum</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><span class="annottext">Maybe Verbosity
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="Cardano.Tracer.Utils.html#logTrace"><span class="hs-identifier hs-var">logTrace</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cardano-tracer, the problem: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679627595"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="annot"><a href="Cardano.Tracer.Utils.html#logTrace"><span class="hs-identifier hs-type">logTrace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span id="logTrace"><span class="annot"><span class="annottext">logTrace :: String -&gt; IO ()
</span><a href="Cardano.Tracer.Utils.html#logTrace"><span class="hs-identifier hs-var hs-var">logTrace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer IO String -&gt; String -&gt; IO ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><a href="file:///nix/store/dkmky2ci646kg44ca5yvqjsbpllsmy3f-contra-tracer-lib-contra-tracer-0.1.0.2-haddock-doc/share/doc/contra-tracer/html/src/Control.Tracer.html#traceWith"><span class="hs-identifier hs-var">traceWith</span></a></span><span> </span><span class="annot"><span class="annottext">(Tracer IO String -&gt; String -&gt; IO ())
-&gt; Tracer IO String -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO String -&gt; Tracer IO String
forall a (m :: * -&gt; *). Show a =&gt; Tracer m String -&gt; Tracer m a
</span><a href="file:///nix/store/dkmky2ci646kg44ca5yvqjsbpllsmy3f-contra-tracer-lib-contra-tracer-0.1.0.2-haddock-doc/share/doc/contra-tracer/html/src/Control.Tracer.html#showTracing"><span class="hs-identifier hs-var">showTracing</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO String
forall (m :: * -&gt; *). MonadIO m =&gt; Tracer m String
</span><a href="file:///nix/store/dkmky2ci646kg44ca5yvqjsbpllsmy3f-contra-tracer-lib-contra-tracer-0.1.0.2-haddock-doc/share/doc/contra-tracer/html/src/Control.Tracer.html#stdoutTracer"><span class="hs-identifier hs-var">stdoutTracer</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span id="local-6989586621679627336"><span class="annot"><a href="Cardano.Tracer.Utils.html#connIdToNodeId"><span class="hs-identifier hs-type">connIdToNodeId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627336"><span class="hs-identifier hs-type">addr</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679627336"><span class="hs-identifier hs-type">addr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span></span><span>
</span><span id="line-115"></span><span id="connIdToNodeId"><span class="annot"><span class="annottext">connIdToNodeId :: forall addr. Show addr =&gt; ConnectionId addr -&gt; NodeId
</span><a href="Cardano.Tracer.Utils.html#connIdToNodeId"><span class="hs-identifier hs-var hs-var">connIdToNodeId</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span class="hs-special">{</span><span id="local-6989586621679627598"><span class="annot"><span class="annottext">addr
remoteAddress :: addr
remoteAddress :: forall addr. ConnectionId addr -&gt; addr
</span><a href="#local-6989586621679627598"><span class="hs-identifier hs-var hs-var">remoteAddress</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; NodeId
</span><a href="Cardano.Tracer.Types.html#NodeId"><span class="hs-identifier hs-var">NodeId</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679627601"><span class="hs-identifier hs-var">preparedAddress</span></a></span><span>
</span><span id="line-116"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-comment">-- We have to remove &quot;wrong&quot; symbols from 'NodeId',</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-comment">-- to make it appropriate for the name of the subdirectory.</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621679627601"><span class="annot"><span class="annottext">preparedAddress :: Text
</span><a href="#local-6989586621679627601"><span class="hs-identifier hs-var hs-var">preparedAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-120"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#pack"><span class="hs-identifier hs-var">T.pack</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; (String -&gt; String) -&gt; String -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.List.Extra.html#dropPrefix"><span class="hs-identifier hs-var">dropPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-&quot;</span></span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (String -&gt; String) -&gt; String -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.List.Extra.html#dropSuffix"><span class="hs-identifier hs-var">dropSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-&quot;</span></span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (String -&gt; String) -&gt; String -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; String
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.List.Extra.html#replace"><span class="hs-identifier hs-var">replace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;--&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (String -&gt; String) -&gt; String -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; String
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.List.Extra.html#replace"><span class="hs-identifier hs-var">replace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-&quot;</span></span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (String -&gt; String) -&gt; String -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; String
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.List.Extra.html#replace"><span class="hs-identifier hs-var">replace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-&quot;</span></span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (String -&gt; String) -&gt; String -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; String
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.List.Extra.html#replace"><span class="hs-identifier hs-var">replace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-&quot;</span></span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (String -&gt; String) -&gt; String -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; String
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.List.Extra.html#replace"><span class="hs-identifier hs-var">replace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\\&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-&quot;</span></span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (String -&gt; String) -&gt; String -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; String
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.List.Extra.html#replace"><span class="hs-identifier hs-var">replace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pipe&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-comment">-- For Windows.</span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (String -&gt; String) -&gt; String -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; String
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.List.Extra.html#replace"><span class="hs-identifier hs-var">replace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-comment">-- For Windows.</span><span>
</span><span id="line-130"></span><span>    </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (String -&gt; String) -&gt; String -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; String
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.List.Extra.html#replace"><span class="hs-identifier hs-var">replace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LocalAddress&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-comment">-- There are only local addresses by design.</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">addr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679627598"><span class="hs-identifier hs-var">remoteAddress</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="annot"><a href="Cardano.Tracer.Utils.html#initConnectedNodes"><span class="hs-identifier hs-type">initConnectedNodes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#ConnectedNodes"><span class="hs-identifier hs-type">ConnectedNodes</span></a></span><span>
</span><span id="line-134"></span><span id="initConnectedNodes"><span class="annot"><span class="annottext">initConnectedNodes :: IO ConnectedNodes
</span><a href="Cardano.Tracer.Utils.html#initConnectedNodes"><span class="hs-identifier hs-var hs-var">initConnectedNodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set NodeId -&gt; IO ConnectedNodes
forall a. a -&gt; IO (TVar a)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#newTVarIO"><span class="hs-identifier hs-var">newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">Set NodeId
forall a. Set a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="annot"><a href="Cardano.Tracer.Utils.html#initConnectedNodesNames"><span class="hs-identifier hs-type">initConnectedNodesNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#ConnectedNodesNames"><span class="hs-identifier hs-type">ConnectedNodesNames</span></a></span><span>
</span><span id="line-137"></span><span id="initConnectedNodesNames"><span class="annot"><span class="annottext">initConnectedNodesNames :: IO ConnectedNodesNames
</span><a href="Cardano.Tracer.Utils.html#initConnectedNodesNames"><span class="hs-identifier hs-var hs-var">initConnectedNodesNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bimap NodeId Text -&gt; IO ConnectedNodesNames
forall a. a -&gt; IO (TVar a)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#newTVarIO"><span class="hs-identifier hs-var">newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">Bimap NodeId Text
forall a b. Bimap a b
</span><span class="hs-identifier hs-var">BM.empty</span></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="annot"><a href="Cardano.Tracer.Utils.html#initAcceptedMetrics"><span class="hs-identifier hs-type">initAcceptedMetrics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#AcceptedMetrics"><span class="hs-identifier hs-type">AcceptedMetrics</span></a></span><span>
</span><span id="line-140"></span><span id="initAcceptedMetrics"><span class="annot"><span class="annottext">initAcceptedMetrics :: IO AcceptedMetrics
</span><a href="Cardano.Tracer.Utils.html#initAcceptedMetrics"><span class="hs-identifier hs-var hs-var">initAcceptedMetrics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map NodeId MetricsStores -&gt; IO AcceptedMetrics
forall a. a -&gt; IO (TVar a)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#newTVarIO"><span class="hs-identifier hs-var">newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeId MetricsStores
forall k a. Map k a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="annot"><a href="Cardano.Tracer.Utils.html#initDataPointRequestors"><span class="hs-identifier hs-type">initDataPointRequestors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#DataPointRequestors"><span class="hs-identifier hs-type">DataPointRequestors</span></a></span><span>
</span><span id="line-143"></span><span id="initDataPointRequestors"><span class="annot"><span class="annottext">initDataPointRequestors :: IO DataPointRequestors
</span><a href="Cardano.Tracer.Utils.html#initDataPointRequestors"><span class="hs-identifier hs-var hs-var">initDataPointRequestors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map NodeId DataPointRequestor -&gt; IO DataPointRequestors
forall a. a -&gt; IO (TVar a)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#newTVarIO"><span class="hs-identifier hs-var">newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeId DataPointRequestor
forall k a. Map k a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="annot"><a href="Cardano.Tracer.Utils.html#initProtocolsBrake"><span class="hs-identifier hs-type">initProtocolsBrake</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#ProtocolsBrake"><span class="hs-identifier hs-type">ProtocolsBrake</span></a></span><span>
</span><span id="line-146"></span><span id="initProtocolsBrake"><span class="annot"><span class="annottext">initProtocolsBrake :: IO ProtocolsBrake
</span><a href="Cardano.Tracer.Utils.html#initProtocolsBrake"><span class="hs-identifier hs-var hs-var">initProtocolsBrake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO ProtocolsBrake
forall a. a -&gt; IO (TVar a)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#newTVarIO"><span class="hs-identifier hs-var">newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="annot"><a href="Cardano.Tracer.Utils.html#askNodeName"><span class="hs-identifier hs-type">askNodeName</span></a></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Tracer.Environment.html#TracerEnv"><span class="hs-identifier hs-type">TracerEnv</span></a></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#NodeName"><span class="hs-identifier hs-type">NodeName</span></a></span><span>
</span><span id="line-152"></span><span id="askNodeName"><span class="annot"><span class="annottext">askNodeName :: TracerEnv -&gt; NodeId -&gt; IO Text
</span><a href="Cardano.Tracer.Utils.html#askNodeName"><span class="hs-identifier hs-var hs-var">askNodeName</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Tracer.Environment.html#TracerEnv"><span class="hs-identifier hs-type">TracerEnv</span></a></span><span class="hs-special">{</span><span id="local-6989586621679627640"><span class="annot"><span class="annottext">ConnectedNodesNames
teConnectedNodesNames :: ConnectedNodesNames
teConnectedNodesNames :: TracerEnv -&gt; ConnectedNodesNames
</span><a href="#local-6989586621679627640"><span class="hs-identifier hs-var hs-var">teConnectedNodesNames</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679627642"><span class="annot"><span class="annottext">DataPointRequestors
teDPRequestors :: DataPointRequestors
teDPRequestors :: TracerEnv -&gt; DataPointRequestors
</span><a href="#local-6989586621679627642"><span class="hs-identifier hs-var hs-var">teDPRequestors</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679627644"><span class="annot"><span class="annottext">Lock
teCurrentDPLock :: Lock
teCurrentDPLock :: TracerEnv -&gt; Lock
</span><a href="#local-6989586621679627644"><span class="hs-identifier hs-var hs-var">teCurrentDPLock</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-153"></span><span>  </span><span class="annot"><span class="annottext">ConnectedNodesNames
-&gt; DataPointRequestors -&gt; Lock -&gt; NodeId -&gt; IO Text
</span><a href="Cardano.Tracer.Utils.html#askNodeNameRaw"><span class="hs-identifier hs-var">askNodeNameRaw</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectedNodesNames
</span><a href="#local-6989586621679627640"><span class="hs-identifier hs-var">teConnectedNodesNames</span></a></span><span> </span><span class="annot"><span class="annottext">DataPointRequestors
</span><a href="#local-6989586621679627642"><span class="hs-identifier hs-var">teDPRequestors</span></a></span><span> </span><span class="annot"><span class="annottext">Lock
</span><a href="#local-6989586621679627644"><span class="hs-identifier hs-var">teCurrentDPLock</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><a href="Cardano.Tracer.Utils.html#askNodeNameRaw"><span class="hs-identifier hs-type">askNodeNameRaw</span></a></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#ConnectedNodesNames"><span class="hs-identifier hs-type">ConnectedNodesNames</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#DataPointRequestors"><span class="hs-identifier hs-type">DataPointRequestors</span></a></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Control.Concurrent.Extra.html#Lock"><span class="hs-identifier hs-type">Lock</span></a></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#NodeName"><span class="hs-identifier hs-type">NodeName</span></a></span><span>
</span><span id="line-161"></span><span id="askNodeNameRaw"><span class="annot"><span class="annottext">askNodeNameRaw :: ConnectedNodesNames
-&gt; DataPointRequestors -&gt; Lock -&gt; NodeId -&gt; IO Text
</span><a href="Cardano.Tracer.Utils.html#askNodeNameRaw"><span class="hs-identifier hs-var hs-var">askNodeNameRaw</span></a></span></span><span> </span><span id="local-6989586621679627646"><span class="annot"><span class="annottext">ConnectedNodesNames
</span><a href="#local-6989586621679627646"><span class="hs-identifier hs-var">connectedNodesNames</span></a></span></span><span> </span><span id="local-6989586621679627647"><span class="annot"><span class="annottext">DataPointRequestors
</span><a href="#local-6989586621679627647"><span class="hs-identifier hs-var">dpRequestors</span></a></span></span><span> </span><span id="local-6989586621679627648"><span class="annot"><span class="annottext">Lock
</span><a href="#local-6989586621679627648"><span class="hs-identifier hs-var">currentDPLock</span></a></span></span><span> </span><span id="local-6989586621679627649"><span class="annot"><span class="annottext">nodeId :: NodeId
</span><a href="#local-6989586621679627649"><span class="hs-identifier hs-var">nodeId</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Tracer.Types.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span> </span><span id="local-6989586621679627650"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679627650"><span class="hs-identifier hs-var">anId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-162"></span><span>  </span><span id="local-6989586621679627651"><span class="annot"><span class="annottext">Bimap NodeId Text
</span><a href="#local-6989586621679627651"><span class="hs-identifier hs-var">nodesNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConnectedNodesNames -&gt; IO (Bimap NodeId Text)
forall a. TVar a -&gt; IO a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#readTVarIO"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectedNodesNames
</span><a href="#local-6989586621679627646"><span class="hs-identifier hs-var">connectedNodesNames</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NodeId -&gt; Bimap NodeId Text -&gt; Maybe Text
forall a b (m :: * -&gt; *).
(Ord a, Ord b, MonadThrow m) =&gt;
a -&gt; Bimap a b -&gt; m b
</span><span class="hs-identifier hs-var">BM.lookup</span></span><span> </span><span class="annot"><span class="annottext">NodeId
</span><a href="#local-6989586621679627649"><span class="hs-identifier hs-var">nodeId</span></a></span><span> </span><span class="annot"><span class="annottext">Bimap NodeId Text
</span><a href="#local-6989586621679627651"><span class="hs-identifier hs-var">nodesNames</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679627653"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679627653"><span class="hs-identifier hs-var">nodeName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO Text
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679627653"><span class="hs-identifier hs-var">nodeName</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-166"></span><span>      </span><span class="hs-comment">-- There is no name yet, so we have to ask for 'NodeInfo' datapoint to get the name.</span><span>
</span><span id="line-167"></span><span>      </span><span id="local-6989586621679627654"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679627654"><span class="hs-identifier hs-var">nodeName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-168"></span><span>        </span><span class="annot"><span class="annottext">DataPointRequestors
-&gt; Lock -&gt; NodeId -&gt; Text -&gt; IO (Maybe NodeInfo)
forall a.
FromJSON a =&gt;
DataPointRequestors -&gt; Lock -&gt; NodeId -&gt; Text -&gt; IO (Maybe a)
</span><a href="Cardano.Tracer.Handlers.RTView.Update.Utils.html#askDataPoint"><span class="hs-identifier hs-var">askDataPoint</span></a></span><span> </span><span class="annot"><span class="annottext">DataPointRequestors
</span><a href="#local-6989586621679627647"><span class="hs-identifier hs-var">dpRequestors</span></a></span><span> </span><span class="annot"><span class="annottext">Lock
</span><a href="#local-6989586621679627648"><span class="hs-identifier hs-var">currentDPLock</span></a></span><span> </span><span class="annot"><span class="annottext">NodeId
</span><a href="#local-6989586621679627649"><span class="hs-identifier hs-var">nodeId</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;NodeInfo&quot;</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe NodeInfo) -&gt; (Maybe NodeInfo -&gt; IO Text) -&gt; IO Text
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-169"></span><span>          </span><span class="annot"><span class="annottext">Maybe NodeInfo
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO Text
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679627650"><span class="hs-identifier hs-var">anId</span></a></span><span>
</span><span id="line-170"></span><span>          </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-node/cardano-node/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cardano-node-8.8.0/doc/html/cardano-node/src/Cardano.Node.Startup.html#NodeInfo"><span class="hs-identifier hs-type">NodeInfo</span></a></span><span class="hs-special">{</span><span id="local-6989586621679627657"><span class="annot"><span class="annottext">Text
niName :: Text
niName :: NodeInfo -&gt; Text
</span><a href="#local-6989586621679627657"><span class="hs-identifier hs-var hs-var">niName</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO Text
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO Text) -&gt; Text -&gt; IO Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.html#null"><span class="hs-identifier hs-var">T.null</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679627657"><span class="hs-identifier hs-var">niName</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679627650"><span class="hs-identifier hs-var">anId</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679627657"><span class="hs-identifier hs-var">niName</span></a></span><span>
</span><span id="line-171"></span><span>      </span><span class="hs-comment">-- Store it in for the future using.</span><span>
</span><span id="line-172"></span><span>      </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#atomically"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ())
-&gt; ((Bimap NodeId Text -&gt; Bimap NodeId Text) -&gt; STM ())
-&gt; (Bimap NodeId Text -&gt; Bimap NodeId Text)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectedNodesNames
-&gt; (Bimap NodeId Text -&gt; Bimap NodeId Text) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TVar.html#modifyTVar%27"><span class="hs-identifier hs-var">modifyTVar'</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectedNodesNames
</span><a href="#local-6989586621679627646"><span class="hs-identifier hs-var">connectedNodesNames</span></a></span><span> </span><span class="annot"><span class="annottext">((Bimap NodeId Text -&gt; Bimap NodeId Text) -&gt; IO ())
-&gt; (Bimap NodeId Text -&gt; Bimap NodeId Text) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NodeId -&gt; Text -&gt; Bimap NodeId Text -&gt; Bimap NodeId Text
forall a b. (Ord a, Ord b) =&gt; a -&gt; b -&gt; Bimap a b -&gt; Bimap a b
</span><span class="hs-identifier hs-var">BM.insert</span></span><span> </span><span class="annot"><span class="annottext">NodeId
</span><a href="#local-6989586621679627649"><span class="hs-identifier hs-var">nodeId</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679627654"><span class="hs-identifier hs-var">nodeName</span></a></span><span>
</span><span id="line-173"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; IO Text
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679627654"><span class="hs-identifier hs-var">nodeName</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="annot"><a href="Cardano.Tracer.Utils.html#askNodeId"><span class="hs-identifier hs-type">askNodeId</span></a></span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Tracer.Environment.html#TracerEnv"><span class="hs-identifier hs-type">TracerEnv</span></a></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#NodeName"><span class="hs-identifier hs-type">NodeName</span></a></span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span id="askNodeId"><span class="annot"><span class="annottext">askNodeId :: TracerEnv -&gt; Text -&gt; IO (Maybe NodeId)
</span><a href="Cardano.Tracer.Utils.html#askNodeId"><span class="hs-identifier hs-var hs-var">askNodeId</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Tracer.Environment.html#TracerEnv"><span class="hs-identifier hs-type">TracerEnv</span></a></span><span class="hs-special">{</span><span id="local-6989586621679627661"><span class="annot"><span class="annottext">ConnectedNodesNames
teConnectedNodesNames :: TracerEnv -&gt; ConnectedNodesNames
teConnectedNodesNames :: ConnectedNodesNames
</span><a href="Cardano.Tracer.Environment.html#teConnectedNodesNames"><span class="hs-identifier hs-var hs-var">teConnectedNodesNames</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679627662"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679627662"><span class="hs-identifier hs-var">nodeName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-180"></span><span>  </span><span id="local-6989586621679627663"><span class="annot"><span class="annottext">Bimap NodeId Text
</span><a href="#local-6989586621679627663"><span class="hs-identifier hs-var">nodesNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConnectedNodesNames -&gt; IO (Bimap NodeId Text)
forall a. TVar a -&gt; IO a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#readTVarIO"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectedNodesNames
</span><a href="#local-6989586621679627661"><span class="hs-identifier hs-var">teConnectedNodesNames</span></a></span><span>
</span><span id="line-181"></span><span>  </span><span class="annot"><span class="annottext">Maybe NodeId -&gt; IO (Maybe NodeId)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe NodeId -&gt; IO (Maybe NodeId))
-&gt; Maybe NodeId -&gt; IO (Maybe NodeId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679627662"><span class="hs-identifier hs-var">nodeName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bimap NodeId Text -&gt; Bool
forall a b. (Ord a, Ord b) =&gt; b -&gt; Bimap a b -&gt; Bool
</span><span class="hs-operator hs-var">`BM.memberR`</span></span><span> </span><span class="annot"><span class="annottext">Bimap NodeId Text
</span><a href="#local-6989586621679627663"><span class="hs-identifier hs-var">nodesNames</span></a></span><span>
</span><span id="line-182"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">NodeId -&gt; Maybe NodeId
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(NodeId -&gt; Maybe NodeId) -&gt; NodeId -&gt; Maybe NodeId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bimap NodeId Text
</span><a href="#local-6989586621679627663"><span class="hs-identifier hs-var">nodesNames</span></a></span><span> </span><span class="annot"><span class="annottext">Bimap NodeId Text -&gt; Text -&gt; NodeId
forall a b. (Ord a, Ord b) =&gt; Bimap a b -&gt; b -&gt; a
</span><span class="hs-operator hs-var">!&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679627662"><span class="hs-identifier hs-var">nodeName</span></a></span><span>
</span><span id="line-183"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe NodeId
forall a. Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-comment">-- | Stop the protocols. As a result, 'MsgDone' will be sent and interaction</span><span>
</span><span id="line-186"></span><span class="hs-comment">--   between acceptor's part and forwarder's part will be finished.</span><span>
</span><span id="line-187"></span><span class="annot"><a href="Cardano.Tracer.Utils.html#applyBrake"><span class="hs-identifier hs-type">applyBrake</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#ProtocolsBrake"><span class="hs-identifier hs-type">ProtocolsBrake</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span id="applyBrake"><span class="annot"><span class="annottext">applyBrake :: ProtocolsBrake -&gt; IO ()
</span><a href="Cardano.Tracer.Utils.html#applyBrake"><span class="hs-identifier hs-var hs-var">applyBrake</span></a></span></span><span> </span><span id="local-6989586621679627666"><span class="annot"><span class="annottext">ProtocolsBrake
</span><a href="#local-6989586621679627666"><span class="hs-identifier hs-var">stopProtocols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#atomically"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolsBrake -&gt; (Bool -&gt; Bool) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TVar.html#modifyTVar%27"><span class="hs-identifier hs-var">modifyTVar'</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolsBrake
</span><a href="#local-6989586621679627666"><span class="hs-identifier hs-var">stopProtocols</span></a></span><span> </span><span class="annot"><span class="annottext">((Bool -&gt; Bool) -&gt; STM ())
-&gt; (Bool -&gt; Bool -&gt; Bool) -&gt; Bool -&gt; STM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; STM ()) -&gt; Bool -&gt; STM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="annot"><span class="hs-comment">-- | Like 'liftM2', but for monadic function.</span></span><span>
</span><span id="line-191"></span><span id="local-6989586621679627380"><span id="local-6989586621679627381"><span id="local-6989586621679627382"><span id="local-6989586621679627383"><span class="annot"><a href="Cardano.Tracer.Utils.html#lift2M"><span class="hs-identifier hs-type">lift2M</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627380"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679627381"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627382"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627380"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627383"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627380"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627381"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627380"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627382"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627380"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627383"><span class="hs-identifier hs-type">c</span></a></span></span></span></span></span><span>
</span><span id="line-192"></span><span id="lift2M"><span class="annot"><span class="annottext">lift2M :: forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; m c) -&gt; m a -&gt; m b -&gt; m c
</span><a href="Cardano.Tracer.Utils.html#lift2M"><span class="hs-identifier hs-var hs-var">lift2M</span></a></span></span><span> </span><span id="local-6989586621679627673"><span class="annot"><span class="annottext">a -&gt; b -&gt; m c
</span><a href="#local-6989586621679627673"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679627674"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679627674"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679627675"><span class="annot"><span class="annottext">m b
</span><a href="#local-6989586621679627675"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; b -&gt; (a, b)) -&gt; m a -&gt; m b -&gt; m (a, b)
forall a b c. (a -&gt; b -&gt; c) -&gt; m a -&gt; m b -&gt; m c
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#liftA2"><span class="hs-identifier hs-var">liftA2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679627674"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">m b
</span><a href="#local-6989586621679627675"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">m (a, b) -&gt; ((a, b) -&gt; m c) -&gt; m c
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b -&gt; m c) -&gt; (a, b) -&gt; m c
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; m c
</span><a href="#local-6989586621679627673"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="annot"><span class="hs-comment">-- | Like 'liftM3', but for monadic function.</span></span><span>
</span><span id="line-195"></span><span id="local-6989586621679627395"><span id="local-6989586621679627396"><span id="local-6989586621679627397"><span id="local-6989586621679627398"><span id="local-6989586621679627399"><span class="annot"><a href="Cardano.Tracer.Utils.html#lift3M"><span class="hs-identifier hs-type">lift3M</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627395"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679627396"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627397"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627398"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627395"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627399"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627395"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627396"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627395"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627397"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627395"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627398"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627395"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627399"><span class="hs-identifier hs-type">d</span></a></span></span></span></span></span></span><span>
</span><span id="line-196"></span><span id="lift3M"><span class="annot"><span class="annottext">lift3M :: forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; m d) -&gt; m a -&gt; m b -&gt; m c -&gt; m d
</span><a href="Cardano.Tracer.Utils.html#lift3M"><span class="hs-identifier hs-var hs-var">lift3M</span></a></span></span><span> </span><span id="local-6989586621679627682"><span class="annot"><span class="annottext">a -&gt; b -&gt; c -&gt; m d
</span><a href="#local-6989586621679627682"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679627683"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679627683"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679627684"><span class="annot"><span class="annottext">m b
</span><a href="#local-6989586621679627684"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679627685"><span class="annot"><span class="annottext">m c
</span><a href="#local-6989586621679627685"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; b -&gt; c -&gt; (a, b, c)) -&gt; m a -&gt; m b -&gt; m c -&gt; m (a, b, c)
forall (f :: * -&gt; *) a b c d.
Applicative f =&gt;
(a -&gt; b -&gt; c -&gt; d) -&gt; f a -&gt; f b -&gt; f c -&gt; f d
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#liftA3"><span class="hs-identifier hs-var">liftA3</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679627683"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">m b
</span><a href="#local-6989586621679627684"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">m c
</span><a href="#local-6989586621679627685"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">m (a, b, c) -&gt; ((a, b, c) -&gt; m d) -&gt; m d
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b -&gt; c -&gt; m d) -&gt; (a, b, c) -&gt; m d
forall a b c d. (a -&gt; b -&gt; c -&gt; d) -&gt; (a, b, c) -&gt; d
</span><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Data.Tuple.Extra.html#uncurry3"><span class="hs-identifier hs-var">uncurry3</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; c -&gt; m d
</span><a href="#local-6989586621679627682"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span id="local-6989586621679627415"><span id="local-6989586621679627416"><span id="local-6989586621679627417"><span id="local-6989586621679627418"><span class="annot"><a href="Cardano.Tracer.Utils.html#forMM"><span class="hs-identifier hs-type">forMM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Traversable.html#Traversable"><span class="hs-identifier hs-type">Traversable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627415"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627416"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627416"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679627415"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627417"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679627417"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627416"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627418"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627416"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679627415"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627418"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-199"></span><span id="forMM"><span class="annot"><span class="annottext">forMM :: forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
m (t a) -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="Cardano.Tracer.Utils.html#forMM"><span class="hs-identifier hs-var hs-var">forMM</span></a></span></span><span> </span><span id="local-6989586621679627691"><span class="annot"><span class="annottext">m (t a)
</span><a href="#local-6989586621679627691"><span class="hs-identifier hs-var">mVals</span></a></span></span><span> </span><span id="local-6989586621679627692"><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621679627692"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (t a)
</span><a href="#local-6989586621679627691"><span class="hs-identifier hs-var">mVals</span></a></span><span> </span><span class="annot"><span class="annottext">m (t a) -&gt; (t a -&gt; m (t b)) -&gt; m (t b)
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621679627692"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span id="local-6989586621679627427"><span id="local-6989586621679627428"><span id="local-6989586621679627429"><span class="annot"><a href="Cardano.Tracer.Utils.html#forMM_"><span class="hs-identifier hs-type">forMM_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#Foldable"><span class="hs-identifier hs-type">Foldable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627427"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627428"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627428"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679627427"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627429"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679627429"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627428"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679627428"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-202"></span><span id="forMM_"><span class="annot"><span class="annottext">forMM_ :: forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, Monad m) =&gt;
m (t a) -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Cardano.Tracer.Utils.html#forMM_"><span class="hs-identifier hs-var hs-var">forMM_</span></a></span></span><span> </span><span id="local-6989586621679627699"><span class="annot"><span class="annottext">m (t a)
</span><a href="#local-6989586621679627699"><span class="hs-identifier hs-var">mVals</span></a></span></span><span> </span><span id="local-6989586621679627700"><span class="annot"><span class="annottext">a -&gt; m ()
</span><a href="#local-6989586621679627700"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (t a)
</span><a href="#local-6989586621679627699"><span class="hs-identifier hs-var">mVals</span></a></span><span> </span><span class="annot"><span class="annottext">m (t a) -&gt; (t a -&gt; m ()) -&gt; m ()
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m ()) -&gt; t a -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; m ()
</span><a href="#local-6989586621679627700"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="annot"><a href="Cardano.Tracer.Utils.html#nl"><span class="hs-identifier hs-type">nl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">T.Text</span></a></span><span class="hs-cpp">
#ifdef UNIX
</span><span id="nl"><span class="annot"><span class="annottext">nl :: Text
</span><a href="Cardano.Tracer.Utils.html#nl"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-cpp">
#else
</span><span class="hs-identifier">nl</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\r\n&quot;</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- | If 'cardano-tracer' process is going to die (by receiving some system signal),</span><span>
</span><span id="line-212"></span><span class="hs-comment">--   we want to do something before it stops.</span><span>
</span><span id="line-213"></span><span class="annot"><a href="Cardano.Tracer.Utils.html#beforeProgramStops"><span class="hs-identifier hs-type">beforeProgramStops</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span id="beforeProgramStops"><span class="annot"><span class="annottext">beforeProgramStops :: IO () -&gt; IO ()
</span><a href="Cardano.Tracer.Utils.html#beforeProgramStops"><span class="hs-identifier hs-var hs-var">beforeProgramStops</span></a></span></span><span> </span><span id="local-6989586621679627702"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679627702"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-215"></span><span>  </span><span id="local-6989586621679627703"><span class="annot"><span class="annottext">Weak ThreadId
</span><a href="#local-6989586621679627703"><span class="hs-identifier hs-var">mainThreadIdWk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ThreadId -&gt; IO (Weak ThreadId)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#mkWeakThreadId"><span class="hs-identifier hs-var">mkWeakThreadId</span></a></span><span> </span><span class="annot"><span class="annottext">(ThreadId -&gt; IO (Weak ThreadId))
-&gt; IO ThreadId -&gt; IO (Weak ThreadId)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">IO ThreadId
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#myThreadId"><span class="hs-identifier hs-var">myThreadId</span></a></span><span>
</span><span id="line-216"></span><span>  </span><span class="annot"><span class="annottext">[Signal] -&gt; (Signal -&gt; IO ()) -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[Signal]
</span><a href="#local-6989586621679627705"><span class="hs-identifier hs-var">signals</span></a></span><span> </span><span class="annot"><span class="annottext">((Signal -&gt; IO ()) -&gt; IO ()) -&gt; (Signal -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679627706"><span class="annot"><span class="annottext">Signal
</span><a href="#local-6989586621679627706"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><span class="annottext">Signal -&gt; (Signal -&gt; IO ()) -&gt; IO ()
</span><a href="file:///nix/store/abkp85z71nz8ki0x114j4v8v90gng4mq-signal-lib-signal-0.1.0.4-haddock-doc/share/doc/signal/html/src/System.Signal.html#installHandler"><span class="hs-identifier hs-var">S.installHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Signal
</span><a href="#local-6989586621679627706"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">((Signal -&gt; IO ()) -&gt; IO ())
-&gt; (IO () -&gt; Signal -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Signal -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-218"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/System.IO.html#putStrLn"><span class="hs-identifier hs-var">putStrLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; Program is stopping, please wait...&quot;</span></span><span>
</span><span id="line-219"></span><span>      </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Handle.html#hFlush"><span class="hs-identifier hs-var">hFlush</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.StdHandles.html#stdout"><span class="hs-identifier hs-var">stdout</span></a></span><span>
</span><span id="line-220"></span><span>      </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679627702"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Exception.Base.html#finally"><span class="hs-operator hs-var">`finally`</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Maybe ThreadId) -&gt; (ThreadId -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (Maybe a) -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Control.Monad.Extra.html#whenJustM"><span class="hs-identifier hs-var">whenJustM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Weak ThreadId -&gt; IO (Maybe ThreadId)
forall v. Weak v -&gt; IO (Maybe v)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Weak.html#deRefWeak"><span class="hs-identifier hs-var">deRefWeak</span></a></span><span> </span><span class="annot"><span class="annottext">Weak ThreadId
</span><a href="#local-6989586621679627703"><span class="hs-identifier hs-var">mainThreadIdWk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThreadId -&gt; IO ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#killThread"><span class="hs-identifier hs-var">killThread</span></a></span><span>
</span><span id="line-222"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-223"></span><span>  </span><span id="local-6989586621679627705"><span class="annot"><span class="annottext">signals :: [Signal]
</span><a href="#local-6989586621679627705"><span class="hs-identifier hs-var hs-var">signals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Signal
</span><a href="file:///nix/store/abkp85z71nz8ki0x114j4v8v90gng4mq-signal-lib-signal-0.1.0.4-haddock-doc/share/doc/signal/html/src/System.Signal.html#sigABRT"><span class="hs-identifier hs-var">S.sigABRT</span></a></span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signal
</span><a href="file:///nix/store/abkp85z71nz8ki0x114j4v8v90gng4mq-signal-lib-signal-0.1.0.4-haddock-doc/share/doc/signal/html/src/System.Signal.html#sigINT"><span class="hs-identifier hs-var">S.sigINT</span></a></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signal
</span><a href="file:///nix/store/abkp85z71nz8ki0x114j4v8v90gng4mq-signal-lib-signal-0.1.0.4-haddock-doc/share/doc/signal/html/src/System.Signal.html#sigTERM"><span class="hs-identifier hs-var">S.sigTERM</span></a></span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-228"></span></pre></body></html>