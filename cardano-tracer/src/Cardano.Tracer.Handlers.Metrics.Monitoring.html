<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Tracer.Handlers.Metrics.Monitoring</span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Tracer.Handlers.Metrics.Monitoring.html#runMonitoringServer"><span class="hs-identifier">runMonitoringServer</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Concurrent.html"><span class="hs-identifier">Control.Concurrent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#ThreadId"><span class="hs-identifier">ThreadId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.html"><span class="hs-identifier">Control.Concurrent.STM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#atomically"><span class="hs-identifier">atomically</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TMVar.html"><span class="hs-identifier">Control.Concurrent.STM.TMVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TMVar.html#TMVar"><span class="hs-identifier">TMVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TMVar.html#newEmptyTMVarIO"><span class="hs-identifier">newEmptyTMVarIO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TMVar.html#putTMVar"><span class="hs-identifier">putTMVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TMVar.html#tryReadTMVar"><span class="hs-identifier">tryReadTMVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TVar.html"><span class="hs-identifier">Control.Concurrent.STM.TVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#readTVarIO"><span class="hs-identifier">readTVarIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Traversable.html#forM"><span class="hs-identifier">forM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#void"><span class="hs-identifier">void</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Control.Monad.Extra.html"><span class="hs-identifier">Control.Monad.Extra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Control.Monad.Extra.html#whenJust"><span class="hs-identifier">whenJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.html"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Encoding.html"><span class="hs-identifier">Data.Text.Encoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Encoding.html#encodeUtf8"><span class="hs-identifier">encodeUtf8</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.html"><span class="hs-identifier">Graphics.UI.Threepenny</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UI</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html"><span class="hs-identifier">Graphics.UI.Threepenny.Core</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Internal.html#Element"><span class="hs-identifier">Element</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Internal.html#UI"><span class="hs-identifier">UI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier">liftIO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#set"><span class="hs-identifier">set</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#%23"><span class="hs-operator">(#)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#%23%2B"><span class="hs-operator">(#+)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.Remote.Monitoring</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forkServerWith</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">serverThreadId</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/System.Time.Extra.html"><span class="hs-identifier">System.Time.Extra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/System.Time.Extra.html#sleep"><span class="hs-identifier">sleep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Tracer.Configuration.html"><span class="hs-identifier">Cardano.Tracer.Configuration</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Tracer.Environment.html"><span class="hs-identifier">Cardano.Tracer.Environment</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Tracer.Handlers.RTView.SSL.Certs.html"><span class="hs-identifier">Cardano.Tracer.Handlers.RTView.SSL.Certs</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Tracer.Types.html"><span class="hs-identifier">Cardano.Tracer.Types</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-comment">-- | 'ekg' package allows to run only one EKG server, to display only one web page</span><span>
</span><span id="line-31"></span><span class="hs-comment">--   for particular EKG.Store. Since 'cardano-tracer' can be connected to any number</span><span>
</span><span id="line-32"></span><span class="hs-comment">--   of nodes, we display their list on the first web page (the first 'Endpoint')</span><span>
</span><span id="line-33"></span><span class="hs-comment">--   as a list of hrefs. After clicking on the particular href, the user will be</span><span>
</span><span id="line-34"></span><span class="hs-comment">--   redirected to the monitoring web page (the second 'Endpoint') built by 'ekg' package.</span><span>
</span><span id="line-35"></span><span class="hs-comment">--   This page will display the metrics received from that node.</span><span>
</span><span id="line-36"></span><span class="hs-comment">--</span><span>
</span><span id="line-37"></span><span class="hs-comment">--   If the user returns to the first web page and clicks to another node's href,</span><span>
</span><span id="line-38"></span><span class="hs-comment">--   the EKG server will be restarted and the monitoring page will display the metrics</span><span>
</span><span id="line-39"></span><span class="hs-comment">--   received from that node.</span><span>
</span><span id="line-40"></span><span class="annot"><a href="Cardano.Tracer.Handlers.Metrics.Monitoring.html#runMonitoringServer"><span class="hs-identifier hs-type">runMonitoringServer</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Tracer.Environment.html#TracerEnv"><span class="hs-identifier hs-type">TracerEnv</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Tracer.Configuration.html#Endpoint"><span class="hs-identifier hs-type">Endpoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tracer.Configuration.html#Endpoint"><span class="hs-identifier hs-type">Endpoint</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ (web page with list of connected nodes, EKG web page).</span></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span id="runMonitoringServer"><span class="annot"><span class="annottext">runMonitoringServer :: TracerEnv -&gt; (Endpoint, Endpoint) -&gt; IO ()
</span><a href="Cardano.Tracer.Handlers.Metrics.Monitoring.html#runMonitoringServer"><span class="hs-identifier hs-var hs-var">runMonitoringServer</span></a></span></span><span> </span><span id="local-6989586621679627211"><span class="annot"><span class="annottext">TracerEnv
</span><a href="#local-6989586621679627211"><span class="hs-identifier hs-var">tracerEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Tracer.Configuration.html#Endpoint"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span id="local-6989586621679627212"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679627212"><span class="hs-identifier hs-var">listHost</span></a></span></span><span> </span><span id="local-6989586621679627213"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679627213"><span class="hs-identifier hs-var">listPort</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679627214"><span class="annot"><span class="annottext">Endpoint
</span><a href="#local-6989586621679627214"><span class="hs-identifier hs-var">monitorEP</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-comment">-- Pause to prevent collision between &quot;Listening&quot;-notifications from servers.</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><span class="annottext">Seconds -&gt; IO ()
</span><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/System.Time.Extra.html#sleep"><span class="hs-identifier hs-var">sleep</span></a></span><span> </span><span class="annot"><span class="annottext">Seconds
</span><span class="hs-number">0.2</span></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679627215"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679627215"><span class="hs-identifier hs-var">certFile</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679627216"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679627216"><span class="hs-identifier hs-var">keyFile</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TracerEnv -&gt; IO (String, String)
</span><a href="Cardano.Tracer.Handlers.RTView.SSL.Certs.html#placeDefaultSSLFiles"><span class="hs-identifier hs-var">placeDefaultSSLFiles</span></a></span><span> </span><span class="annot"><span class="annottext">TracerEnv
</span><a href="#local-6989586621679627211"><span class="hs-identifier hs-var">tracerEnv</span></a></span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><span class="annottext">Config -&gt; (Window -&gt; UI ()) -&gt; IO ()
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Internal.html#startGUI"><span class="hs-identifier hs-var">UI.startGUI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Config
</span><a href="#local-6989586621679627219"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679627215"><span class="hs-identifier hs-var">certFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679627216"><span class="hs-identifier hs-var">keyFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Window -&gt; UI ()) -&gt; IO ()) -&gt; (Window -&gt; UI ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679627220"><span class="annot"><span class="annottext">Window
</span><a href="#local-6989586621679627220"><span class="hs-identifier hs-var">window</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="annottext">UI Window -&gt; UI ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(UI Window -&gt; UI ()) -&gt; UI Window -&gt; UI ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Window -&gt; UI Window
forall a. a -&gt; UI a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Window
</span><a href="#local-6989586621679627220"><span class="hs-identifier hs-var">window</span></a></span><span> </span><span class="annot"><span class="annottext">UI Window -&gt; (UI Window -&gt; UI Window) -&gt; UI Window
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">ReadWriteAttr Window String () -&gt; String -&gt; UI Window -&gt; UI Window
forall x i o. ReadWriteAttr x i o -&gt; i -&gt; UI x -&gt; UI x
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">ReadWriteAttr Window String ()
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#title"><span class="hs-identifier hs-var">UI.title</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EKG Monitoring Nodes&quot;</span></span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><span class="annottext">UI Element -&gt; UI ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(UI Element -&gt; UI ()) -&gt; UI Element -&gt; UI ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Window -&gt; TracerEnv -&gt; Endpoint -&gt; UI Element
</span><a href="Cardano.Tracer.Handlers.Metrics.Monitoring.html#mkPageBody"><span class="hs-identifier hs-var">mkPageBody</span></a></span><span> </span><span class="annot"><span class="annottext">Window
</span><a href="#local-6989586621679627220"><span class="hs-identifier hs-var">window</span></a></span><span> </span><span class="annot"><span class="annottext">TracerEnv
</span><a href="#local-6989586621679627211"><span class="hs-identifier hs-var">tracerEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Endpoint
</span><a href="#local-6989586621679627214"><span class="hs-identifier hs-var">monitorEP</span></a></span><span>
</span><span id="line-51"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-52"></span><span>  </span><span id="local-6989586621679627219"><span class="annot"><span class="annottext">config :: String -&gt; String -&gt; Config
</span><a href="#local-6989586621679627219"><span class="hs-identifier hs-var hs-var">config</span></a></span></span><span> </span><span id="local-6989586621679627228"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679627228"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679627229"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679627229"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="annottext">Config
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Foreign.JavaScript.Types.html#defaultConfig"><span class="hs-identifier hs-var">UI.defaultConfig</span></a></span><span>
</span><span id="line-54"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Foreign.JavaScript.Types.html#jsLog"><span class="hs-identifier hs-var">UI.jsLog</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-type">const</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Foreign.JavaScript.Types.html#jsUseSSL"><span class="hs-identifier hs-var">UI.jsUseSSL</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-56"></span><span>          </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Foreign.JavaScript.Types.html#ConfigSSL"><span class="hs-identifier hs-type">UI.ConfigSSL</span></a></span><span>
</span><span id="line-57"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Foreign.JavaScript.Types.html#jsSSLBind"><span class="hs-identifier hs-var">UI.jsSSLBind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Encoding.html#encodeUtf8"><span class="hs-identifier hs-type">encodeUtf8</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#pack"><span class="hs-identifier hs-type">T.pack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627212"><span class="hs-identifier hs-type">listHost</span></a></span><span>
</span><span id="line-58"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Foreign.JavaScript.Types.html#jsSSLPort"><span class="hs-identifier hs-var">UI.jsSSLPort</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-type">fromIntegral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679627213"><span class="hs-identifier hs-type">listPort</span></a></span><span>
</span><span id="line-59"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Foreign.JavaScript.Types.html#jsSSLCert"><span class="hs-identifier hs-var">UI.jsSSLCert</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679627228"><span class="hs-identifier hs-type">cert</span></a></span><span>
</span><span id="line-60"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Foreign.JavaScript.Types.html#jsSSLKey"><span class="hs-identifier hs-var">UI.jsSSLKey</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679627229"><span class="hs-identifier hs-type">key</span></a></span><span>
</span><span id="line-61"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Foreign.JavaScript.Types.html#jsSSLChainCert"><span class="hs-identifier hs-var">UI.jsSSLChainCert</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-type">False</span></a></span><span>
</span><span id="line-62"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-63"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="annot"><span class="hs-comment">-- | We have to keep an id of the node as well as thread id of currently launched EKG server.</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">type</span><span> </span><span id="CurrentEKGServer"><span class="annot"><a href="Cardano.Tracer.Handlers.Metrics.Monitoring.html#CurrentEKGServer"><span class="hs-identifier hs-var">CurrentEKGServer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TMVar.html#TMVar"><span class="hs-identifier hs-type">TMVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Tracer.Types.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">-- | The first web page contains only the list of hrefs</span><span>
</span><span id="line-69"></span><span class="hs-comment">--   corresponding to currently connected nodes.</span><span>
</span><span id="line-70"></span><span class="annot"><a href="Cardano.Tracer.Handlers.Metrics.Monitoring.html#mkPageBody"><span class="hs-identifier hs-type">mkPageBody</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Internal.html#Window"><span class="hs-identifier hs-type">UI.Window</span></a></span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Tracer.Environment.html#TracerEnv"><span class="hs-identifier hs-type">TracerEnv</span></a></span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Tracer.Configuration.html#Endpoint"><span class="hs-identifier hs-type">Endpoint</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Internal.html#UI"><span class="hs-identifier hs-type">UI</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Internal.html#Element"><span class="hs-identifier hs-type">Element</span></a></span><span>
</span><span id="line-75"></span><span id="mkPageBody"><span class="annot"><span class="annottext">mkPageBody :: Window -&gt; TracerEnv -&gt; Endpoint -&gt; UI Element
</span><a href="Cardano.Tracer.Handlers.Metrics.Monitoring.html#mkPageBody"><span class="hs-identifier hs-var hs-var">mkPageBody</span></a></span></span><span> </span><span id="local-6989586621679627241"><span class="annot"><span class="annottext">Window
</span><a href="#local-6989586621679627241"><span class="hs-identifier hs-var">window</span></a></span></span><span> </span><span id="local-6989586621679627242"><span class="annot"><span class="annottext">TracerEnv
</span><a href="#local-6989586621679627242"><span class="hs-identifier hs-var">tracerEnv</span></a></span></span><span> </span><span id="local-6989586621679627243"><span class="annot"><span class="annottext">mEP :: Endpoint
</span><a href="#local-6989586621679627243"><span class="hs-identifier hs-var">mEP</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Tracer.Configuration.html#Endpoint"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span id="local-6989586621679627244"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679627244"><span class="hs-identifier hs-var">monitorHost</span></a></span></span><span> </span><span id="local-6989586621679627245"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679627245"><span class="hs-identifier hs-var">monitorPort</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-76"></span><span>  </span><span id="local-6989586621679627246"><span class="annot"><span class="annottext">[NodeId]
</span><a href="#local-6989586621679627246"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [NodeId] -&gt; UI [NodeId]
forall a. IO a -&gt; UI a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [NodeId] -&gt; UI [NodeId]) -&gt; IO [NodeId] -&gt; UI [NodeId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set NodeId -&gt; [NodeId]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Set NodeId -&gt; [NodeId]) -&gt; IO (Set NodeId) -&gt; IO [NodeId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Set NodeId) -&gt; IO (Set NodeId)
forall a. TVar a -&gt; IO a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#readTVarIO"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Set NodeId)
</span><a href="#local-6989586621679627249"><span class="hs-identifier hs-var">teConnectedNodes</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span id="local-6989586621679627250"><span class="annot"><span class="annottext">Element
</span><a href="#local-6989586621679627250"><span class="hs-identifier hs-var">nodesHrefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[NodeId] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeId]
</span><a href="#local-6989586621679627246"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-79"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; UI Element
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#string"><span class="hs-identifier hs-var">UI.string</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;There are no connected nodes yet&quot;</span></span><span>
</span><span id="line-80"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-81"></span><span>        </span><span id="local-6989586621679627253"><span class="annot"><span class="annottext">CurrentEKGServer
</span><a href="#local-6989586621679627253"><span class="hs-identifier hs-var">currentServer</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Tracer.Handlers.Metrics.Monitoring.html#CurrentEKGServer"><span class="hs-identifier hs-type">CurrentEKGServer</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO CurrentEKGServer -&gt; UI CurrentEKGServer
forall a. IO a -&gt; UI a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO CurrentEKGServer
forall a. IO (TMVar a)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TMVar.html#newEmptyTMVarIO"><span class="hs-identifier hs-var">newEmptyTMVarIO</span></a></span><span>
</span><span id="line-82"></span><span>        </span><span id="local-6989586621679627254"><span class="annot"><span class="annottext">[UI Element]
</span><a href="#local-6989586621679627254"><span class="hs-identifier hs-var">nodesLinks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-83"></span><span>          </span><span class="annot"><span class="annottext">[NodeId] -&gt; (NodeId -&gt; UI (UI Element)) -&gt; UI [UI Element]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeId]
</span><a href="#local-6989586621679627246"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">((NodeId -&gt; UI (UI Element)) -&gt; UI [UI Element])
-&gt; (NodeId -&gt; UI (UI Element)) -&gt; UI [UI Element]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679627255"><span class="annot"><span class="annottext">nodeId :: NodeId
</span><a href="#local-6989586621679627255"><span class="hs-identifier hs-var">nodeId</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Tracer.Types.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span> </span><span id="local-6989586621679627257"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679627257"><span class="hs-identifier hs-var">anId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-84"></span><span>            </span><span id="local-6989586621679627258"><span class="annot"><span class="annottext">Element
</span><a href="#local-6989586621679627258"><span class="hs-identifier hs-var">nodeLink</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-85"></span><span>              </span><span class="annot"><span class="annottext">UI Element
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Elements.html#li"><span class="hs-identifier hs-var">UI.li</span></a></span><span> </span><span class="annot"><span class="annottext">UI Element -&gt; [UI Element] -&gt; UI Element
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#%23%2B"><span class="hs-operator hs-var">#+</span></a></span><span>
</span><span id="line-86"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">UI Element
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Elements.html#anchor"><span class="hs-identifier hs-var">UI.anchor</span></a></span><span> </span><span class="annot"><span class="annottext">UI Element -&gt; (UI Element -&gt; UI Element) -&gt; UI Element
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">ReadWriteAttr Element String ()
-&gt; String -&gt; UI Element -&gt; UI Element
forall x i o. ReadWriteAttr x i o -&gt; i -&gt; UI x -&gt; UI x
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">ReadWriteAttr Element String ()
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Attributes.html#href"><span class="hs-identifier hs-var">UI.href</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;http://&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679627244"><span class="hs-identifier hs-var">monitorHost</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679627245"><span class="hs-identifier hs-var">monitorPort</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
                            # set UI.target &quot;_blank&quot;
</span><span class="hs-cpp">                            # set UI.title__ &quot;Open EKG monitor page for this node&quot;
</span><span class="hs-cpp">                            # set UI.text (T.unpack anId)
</span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-91"></span><span>            </span><span class="annot"><span class="annottext">UI () -&gt; UI ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(UI () -&gt; UI ()) -&gt; UI () -&gt; UI ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Element -&gt; Event ()) -&gt; Element -&gt; (() -&gt; UI ()) -&gt; UI ()
forall element a void.
(element -&gt; Event a) -&gt; element -&gt; (a -&gt; UI void) -&gt; UI ()
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#on"><span class="hs-identifier hs-var">UI.on</span></a></span><span> </span><span class="annot"><span class="annottext">Element -&gt; Event ()
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Events.html#click"><span class="hs-identifier hs-var">UI.click</span></a></span><span> </span><span class="annot"><span class="annottext">Element
</span><a href="#local-6989586621679627258"><span class="hs-identifier hs-var">nodeLink</span></a></span><span> </span><span class="annot"><span class="annottext">((() -&gt; UI ()) -&gt; UI ()) -&gt; (() -&gt; UI ()) -&gt; UI ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UI () -&gt; () -&gt; UI ()
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">(UI () -&gt; () -&gt; UI ()) -&gt; UI () -&gt; () -&gt; UI ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-92"></span><span>              </span><span class="annot"><span class="annottext">TracerEnv -&gt; NodeId -&gt; Endpoint -&gt; CurrentEKGServer -&gt; UI ()
</span><a href="Cardano.Tracer.Handlers.Metrics.Monitoring.html#restartEKGServer"><span class="hs-identifier hs-var">restartEKGServer</span></a></span><span> </span><span class="annot"><span class="annottext">TracerEnv
</span><a href="#local-6989586621679627242"><span class="hs-identifier hs-var">tracerEnv</span></a></span><span> </span><span class="annot"><span class="annottext">NodeId
</span><a href="#local-6989586621679627255"><span class="hs-identifier hs-var">nodeId</span></a></span><span> </span><span class="annot"><span class="annottext">Endpoint
</span><a href="#local-6989586621679627243"><span class="hs-identifier hs-var">mEP</span></a></span><span> </span><span class="annot"><span class="annottext">CurrentEKGServer
</span><a href="#local-6989586621679627253"><span class="hs-identifier hs-var">currentServer</span></a></span><span>
</span><span id="line-93"></span><span>            </span><span class="annot"><span class="annottext">UI Element -&gt; UI (UI Element)
forall a. a -&gt; UI a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(UI Element -&gt; UI (UI Element)) -&gt; UI Element -&gt; UI (UI Element)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Element -&gt; UI Element
forall (m :: * -&gt; *) w. (MonadIO m, Widget w) =&gt; w -&gt; m Element
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#element"><span class="hs-identifier hs-var">UI.element</span></a></span><span> </span><span class="annot"><span class="annottext">Element
</span><a href="#local-6989586621679627258"><span class="hs-identifier hs-var">nodeLink</span></a></span><span>
</span><span id="line-94"></span><span>        </span><span class="annot"><span class="annottext">UI Element
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Elements.html#ul"><span class="hs-identifier hs-var">UI.ul</span></a></span><span> </span><span class="annot"><span class="annottext">UI Element -&gt; [UI Element] -&gt; UI Element
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#%23%2B"><span class="hs-operator hs-var">#+</span></a></span><span> </span><span class="annot"><span class="annottext">[UI Element]
</span><a href="#local-6989586621679627254"><span class="hs-identifier hs-var">nodesLinks</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><span class="annottext">Window -&gt; UI Element
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#getBody"><span class="hs-identifier hs-var">UI.getBody</span></a></span><span> </span><span class="annot"><span class="annottext">Window
</span><a href="#local-6989586621679627241"><span class="hs-identifier hs-var">window</span></a></span><span> </span><span class="annot"><span class="annottext">UI Element -&gt; [UI Element] -&gt; UI Element
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#%23%2B"><span class="hs-operator hs-var">#+</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Element -&gt; UI Element
forall (m :: * -&gt; *) w. (MonadIO m, Widget w) =&gt; w -&gt; m Element
</span><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Core.html#element"><span class="hs-identifier hs-var">UI.element</span></a></span><span> </span><span class="annot"><span class="annottext">Element
</span><a href="#local-6989586621679627250"><span class="hs-identifier hs-var">nodesHrefs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-96"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="Cardano.Tracer.Environment.html#TracerEnv"><span class="hs-identifier hs-type">TracerEnv</span></a></span><span class="hs-special">{</span><span id="local-6989586621679627249"><span class="annot"><span class="annottext">TVar (Set NodeId)
teConnectedNodes :: TVar (Set NodeId)
teConnectedNodes :: TracerEnv -&gt; TVar (Set NodeId)
</span><a href="#local-6989586621679627249"><span class="hs-identifier hs-var hs-var">teConnectedNodes</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TracerEnv
</span><a href="#local-6989586621679627242"><span class="hs-identifier hs-var">tracerEnv</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | After clicking on the node's href, the user will be redirected to the monitoring page</span><span>
</span><span id="line-100"></span><span class="hs-comment">--   which is rendered by 'ekg' package. But before, we have to check if EKG server is</span><span>
</span><span id="line-101"></span><span class="hs-comment">--   already launched, and if so, restart the server if needed.</span><span>
</span><span id="line-102"></span><span class="annot"><a href="Cardano.Tracer.Handlers.Metrics.Monitoring.html#restartEKGServer"><span class="hs-identifier hs-type">restartEKGServer</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Tracer.Environment.html#TracerEnv"><span class="hs-identifier hs-type">TracerEnv</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Tracer.Types.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Tracer.Configuration.html#Endpoint"><span class="hs-identifier hs-type">Endpoint</span></a></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Tracer.Handlers.Metrics.Monitoring.html#CurrentEKGServer"><span class="hs-identifier hs-type">CurrentEKGServer</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/w941r35abisxky957xgd85kmdfw5bdrv-threepenny-gui-lib-threepenny-gui-0.9.4.0-haddock-doc/share/doc/threepenny-gui/html/src/Graphics.UI.Threepenny.Internal.html#UI"><span class="hs-identifier hs-type">UI</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span id="restartEKGServer"><span class="annot"><span class="annottext">restartEKGServer :: TracerEnv -&gt; NodeId -&gt; Endpoint -&gt; CurrentEKGServer -&gt; UI ()
</span><a href="Cardano.Tracer.Handlers.Metrics.Monitoring.html#restartEKGServer"><span class="hs-identifier hs-var hs-var">restartEKGServer</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Tracer.Environment.html#TracerEnv"><span class="hs-identifier hs-type">TracerEnv</span></a></span><span class="hs-special">{</span><span id="local-6989586621679627275"><span class="annot"><span class="annottext">AcceptedMetrics
teAcceptedMetrics :: AcceptedMetrics
teAcceptedMetrics :: TracerEnv -&gt; AcceptedMetrics
</span><a href="#local-6989586621679627275"><span class="hs-identifier hs-var hs-var">teAcceptedMetrics</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679627277"><span class="annot"><span class="annottext">NodeId
</span><a href="#local-6989586621679627277"><span class="hs-identifier hs-var">newNodeId</span></a></span></span><span>
</span><span id="line-109"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Tracer.Configuration.html#Endpoint"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span id="local-6989586621679627278"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679627278"><span class="hs-identifier hs-var">monitorHost</span></a></span></span><span> </span><span id="local-6989586621679627279"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679627279"><span class="hs-identifier hs-var">monitorPort</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679627280"><span class="annot"><span class="annottext">CurrentEKGServer
</span><a href="#local-6989586621679627280"><span class="hs-identifier hs-var">currentServer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; UI ()
forall a. IO a -&gt; UI a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; UI ()) -&gt; IO () -&gt; UI ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-110"></span><span>  </span><span id="local-6989586621679627281"><span class="annot"><span class="annottext">Map NodeId MetricsStores
</span><a href="#local-6989586621679627281"><span class="hs-identifier hs-var">metrics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AcceptedMetrics -&gt; IO (Map NodeId MetricsStores)
forall a. TVar a -&gt; IO a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#readTVarIO"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">AcceptedMetrics
</span><a href="#local-6989586621679627275"><span class="hs-identifier hs-var">teAcceptedMetrics</span></a></span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><span class="annottext">Maybe MetricsStores -&gt; (MetricsStores -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a.
Applicative m =&gt;
Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="file:///nix/store/1df7522106rl60xr1qprhwlmf1baz104-extra-lib-extra-1.7.14-haddock-doc/share/doc/extra/html/src/Control.Monad.Extra.html#whenJust"><span class="hs-identifier hs-var">whenJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map NodeId MetricsStores
</span><a href="#local-6989586621679627281"><span class="hs-identifier hs-var">metrics</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeId MetricsStores -&gt; NodeId -&gt; Maybe MetricsStores
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21%3F"><span class="hs-operator hs-var">M.!?</span></a></span><span> </span><span class="annot"><span class="annottext">NodeId
</span><a href="#local-6989586621679627277"><span class="hs-identifier hs-var">newNodeId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((MetricsStores -&gt; IO ()) -&gt; IO ())
-&gt; (MetricsStores -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679627283"><span class="annot"><span class="annottext">Store
</span><a href="#local-6989586621679627283"><span class="hs-identifier hs-var">storeForSelectedNode</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TVar MetricsLocalStore
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="annottext">STM (Maybe (NodeId, ThreadId)) -&gt; IO (Maybe (NodeId, ThreadId))
forall a. STM a -&gt; IO a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#atomically"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurrentEKGServer -&gt; STM (Maybe (NodeId, ThreadId))
forall a. TMVar a -&gt; STM (Maybe a)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TMVar.html#tryReadTMVar"><span class="hs-identifier hs-var">tryReadTMVar</span></a></span><span> </span><span class="annot"><span class="annottext">CurrentEKGServer
</span><a href="#local-6989586621679627280"><span class="hs-identifier hs-var">currentServer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (NodeId, ThreadId))
-&gt; (Maybe (NodeId, ThreadId) -&gt; IO ()) -&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679627284"><span class="annot"><span class="annottext">NodeId
</span><a href="#local-6989586621679627284"><span class="hs-identifier hs-var">_curNodeId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679627285"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621679627285"><span class="hs-identifier hs-var">_sThread</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-114"></span><span>        </span><span class="hs-comment">-- TODO: Currently we cannot restart EKG server,</span><span>
</span><span id="line-115"></span><span>        </span><span class="hs-comment">-- please see https://github.com/tibbe/ekg/issues/87</span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>        </span><span class="hs-comment">-- unless (newNodeId == curNodeId) $ do</span><span>
</span><span id="line-118"></span><span>        </span><span class="hs-comment">--   killThread sThread</span><span>
</span><span id="line-119"></span><span>        </span><span class="hs-comment">--   runEKGAndSave storeForSelectedNode</span><span>
</span><span id="line-120"></span><span>      </span><span class="annot"><span class="annottext">Maybe (NodeId, ThreadId)
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-121"></span><span>        </span><span class="hs-comment">-- Current server wasn't stored yet, it's a first click on the href.</span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><span class="annottext">Store -&gt; IO ()
</span><a href="#local-6989586621679627286"><span class="hs-identifier hs-var">runEKGAndSave</span></a></span><span> </span><span class="annot"><span class="annottext">Store
</span><a href="#local-6989586621679627283"><span class="hs-identifier hs-var">storeForSelectedNode</span></a></span><span>
</span><span id="line-123"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>  </span><span id="local-6989586621679627286"><span class="annot"><span class="annottext">runEKGAndSave :: Store -&gt; IO ()
</span><a href="#local-6989586621679627286"><span class="hs-identifier hs-var hs-var">runEKGAndSave</span></a></span></span><span> </span><span id="local-6989586621679627290"><span class="annot"><span class="annottext">Store
</span><a href="#local-6989586621679627290"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>    </span><span id="local-6989586621679627291"><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621679627291"><span class="hs-identifier hs-var">ekgServer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Store -&gt; ByteString -&gt; Int -&gt; IO Server
</span><span class="hs-identifier hs-var">forkServerWith</span></span><span> </span><span class="annot"><span class="annottext">Store
</span><a href="#local-6989586621679627290"><span class="hs-identifier hs-var">store</span></a></span><span>
</span><span id="line-126"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Encoding.html#encodeUtf8"><span class="hs-identifier hs-var">encodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ByteString) -&gt; (String -&gt; Text) -&gt; String -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#pack"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ByteString) -&gt; String -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679627278"><span class="hs-identifier hs-var">monitorHost</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679627279"><span class="hs-identifier hs-var">monitorPort</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Conc.Sync.html#atomically"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CurrentEKGServer -&gt; (NodeId, ThreadId) -&gt; STM ()
forall a. TMVar a -&gt; a -&gt; STM ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TMVar.html#putTMVar"><span class="hs-identifier hs-var">putTMVar</span></a></span><span> </span><span class="annot"><span class="annottext">CurrentEKGServer
</span><a href="#local-6989586621679627280"><span class="hs-identifier hs-var">currentServer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeId
</span><a href="#local-6989586621679627277"><span class="hs-identifier hs-var">newNodeId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Server -&gt; ThreadId
</span><span class="hs-identifier hs-var">serverThreadId</span></span><span> </span><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621679627291"><span class="hs-identifier hs-var">ekgServer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span></pre></body></html>