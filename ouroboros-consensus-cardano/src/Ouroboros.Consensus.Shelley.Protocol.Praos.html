<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveGeneric    #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns   #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies     #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- See https://gitlab.haskell.org/ghc/ghc/-/issues/14630. GHC currently warns</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- (erroneously) about name shadowing for record field selectors defined by</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- pattern synonyms.</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-name-shadowing #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.Shelley.Protocol.Praos</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Praos.html#PraosEnvelopeError"><span class="hs-identifier">PraosEnvelopeError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Crypto.KES</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">KES</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Cardano.Crypto.VRF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">certifiedOutput</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.BaseTypes</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ProtVer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ProtVer</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Version</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.BHeaderView</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Keys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hashKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Slot</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SlotNo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unSlotNo</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Cardano.Protocol.TPraos.OCert</span></span><span>
</span><span id="line-20"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">OCert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ocertKESPeriod</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ocertVkHot</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Protocol.TPraos.OCert</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SL</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html#unless"><span class="hs-identifier">unless</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Except.html"><span class="hs-identifier">Control.Monad.Except</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier">throwError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html"><span class="hs-identifier">Data.Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#isRight"><span class="hs-identifier">isRight</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Word.html"><span class="hs-identifier">Data.Word</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word16"><span class="hs-identifier">Word16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word32"><span class="hs-identifier">Word32</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">NoThunks.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NoThunks</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Protocol.Praos</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Protocol.Praos.Common</span></span><span>
</span><span id="line-30"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MaxMajorProtVer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MaxMajorProtVer</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Protocol.Praos.Header</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Header</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>                     </span><span class="annot"><span class="hs-identifier">HeaderBody</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">headerHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">headerSize</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Protocol.Praos.Views</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Protocol.Signed</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html"><span class="hs-identifier">Ouroboros.Consensus.Shelley.Protocol.Abstract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ProtoCrypto"><span class="hs-identifier">ProtoCrypto</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>                     </span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ProtocolHeaderSupportsEnvelope"><span class="hs-identifier">ProtocolHeaderSupportsEnvelope</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>                     </span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ProtocolHeaderSupportsKES"><span class="hs-identifier">ProtocolHeaderSupportsKES</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>                     </span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ProtocolHeaderSupportsLedger"><span class="hs-identifier">ProtocolHeaderSupportsLedger</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>                     </span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ProtocolHeaderSupportsProtocol"><span class="hs-identifier">ProtocolHeaderSupportsProtocol</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>                     </span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ShelleyHash"><span class="hs-identifier">ShelleyHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ShelleyHash"><span class="hs-identifier">ShelleyHash</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ShelleyProtocol"><span class="hs-identifier">ShelleyProtocol</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>                     </span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ShelleyProtocolHeader"><span class="hs-identifier">ShelleyProtocolHeader</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="ProtoCrypto"><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ProtoCrypto"><span class="hs-identifier hs-var">ProtoCrypto</span></a></span></span><span> </span><span id="local-6989586621680277257"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Praos</span></span><span> </span><span class="annot"><a href="#local-6989586621680277257"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680277257"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="ShelleyProtocolHeader"><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ShelleyProtocolHeader"><span class="hs-identifier hs-var">ShelleyProtocolHeader</span></a></span></span><span> </span><span id="local-6989586621680277258"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Praos</span></span><span> </span><span class="annot"><a href="#local-6989586621680277258"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Header</span></span><span> </span><span class="annot"><a href="#local-6989586621680277258"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">data</span><span> </span><span id="PraosEnvelopeError"><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Praos.html#PraosEnvelopeError"><span class="hs-identifier hs-var">PraosEnvelopeError</span></a></span></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ObsoleteNode"><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Praos.html#ObsoleteNode"><span class="hs-identifier hs-var">ObsoleteNode</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Version</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Version</span></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-comment">-- ^ This is a subtle case.</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-comment">-- This node is explicitly rejecting the header, but the header isn't</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-comment">-- necessarily _directly_ at fault.</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-comment">-- This rejection specifically happens when the ticked ledger state being</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-comment">-- used to validate this header contains a protocol major version (the</span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-comment">-- first 'Version') that exceeds the maximum major protocol version allowed</span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-comment">-- for this era this specific node's configuration (the second 'Version').</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-comment">-- The only thing the header did &quot;wrong&quot; was extend such a ledger state.</span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-comment">-- Note that the ChainSync client ensures that that ledger state is ticked</span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-comment">-- starting from one of the latest k+1 ledger states on the node's current</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-comment">-- chain (modulo STM scheduling).</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-comment">-- For Cardano and for now at least, this max major prot ver is typically</span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-comment">-- hardcoded in the source code (subject only to whether or not the</span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-comment">-- run-time config files enable &quot;experimental&quot; eras).</span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-comment">-- Hence, most likely, the appropriate rectifying action is for the node</span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-comment">-- operator to update their node software and/or config; hence the name</span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-comment">-- 'ObsoleteNode'. (Or if they're intentionally testing an experimental</span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-comment">-- era, they forgot to set the appropriate config flag.)</span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-comment">-- TODO Would it be more intuitive to instead enforce this when validating</span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-comment">-- the block that results in a ledger state with a major prot ver that</span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-comment">-- violates the config's limit? Would the errors the user sees be more or</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-comment">-- less helpful? Etc.</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-comment">-- TODO (cont'd) It's not even obviously that specific ledger</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-comment">-- state's/block's fault, since the protocol version is the consequence of</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-comment">-- on-chain governance. Is it the voters' fault? Is the fault of the first</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-comment">-- block that was after the voting deadline? So &quot;extending the ledger state</span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-comment">-- that resulting from ticking after applying the block after the epoch</span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-comment">-- that extended the ancestor block that was after the voting deadline that</span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-comment">-- ...&quot; is merely one step more removed. And this 'envelopeChecks' approach</span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-comment">-- does avoid the surprise (since the rejection doesn't even depend on the</span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-comment">-- block's non-header content either) where the header could be validated</span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-comment">-- but its underlying block could not. See</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-comment">-- &lt;https://github.com/IntersectMBO/ouroboros-consensus/issues/325&gt;.</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="HeaderSizeTooLarge"><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Praos.html#HeaderSizeTooLarge"><span class="hs-identifier hs-var">HeaderSizeTooLarge</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="BlockSizeTooLarge"><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Praos.html#BlockSizeTooLarge"><span class="hs-identifier hs-var">BlockSizeTooLarge</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word32"><span class="hs-identifier hs-type">Word32</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word32"><span class="hs-identifier hs-type">Word32</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680277264"><span id="local-6989586621680277276"><span class="annot"><span class="annottext">PraosEnvelopeError -&gt; PraosEnvelopeError -&gt; Bool
(PraosEnvelopeError -&gt; PraosEnvelopeError -&gt; Bool)
-&gt; (PraosEnvelopeError -&gt; PraosEnvelopeError -&gt; Bool)
-&gt; Eq PraosEnvelopeError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: PraosEnvelopeError -&gt; PraosEnvelopeError -&gt; Bool
== :: PraosEnvelopeError -&gt; PraosEnvelopeError -&gt; Bool
$c/= :: PraosEnvelopeError -&gt; PraosEnvelopeError -&gt; Bool
/= :: PraosEnvelopeError -&gt; PraosEnvelopeError -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680277281"><span id="local-6989586621680277283"><span class="annot"><span class="annottext">(forall x. PraosEnvelopeError -&gt; Rep PraosEnvelopeError x)
-&gt; (forall x. Rep PraosEnvelopeError x -&gt; PraosEnvelopeError)
-&gt; Generic PraosEnvelopeError
forall x. Rep PraosEnvelopeError x -&gt; PraosEnvelopeError
forall x. PraosEnvelopeError -&gt; Rep PraosEnvelopeError x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. PraosEnvelopeError -&gt; Rep PraosEnvelopeError x
from :: forall x. PraosEnvelopeError -&gt; Rep PraosEnvelopeError x
$cto :: forall x. Rep PraosEnvelopeError x -&gt; PraosEnvelopeError
to :: forall x. Rep PraosEnvelopeError x -&gt; PraosEnvelopeError
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680277287"><span id="local-6989586621680277303"><span id="local-6989586621680277307"><span class="annot"><span class="annottext">Int -&gt; PraosEnvelopeError -&gt; ShowS
[PraosEnvelopeError] -&gt; ShowS
PraosEnvelopeError -&gt; String
(Int -&gt; PraosEnvelopeError -&gt; ShowS)
-&gt; (PraosEnvelopeError -&gt; String)
-&gt; ([PraosEnvelopeError] -&gt; ShowS)
-&gt; Show PraosEnvelopeError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; PraosEnvelopeError -&gt; ShowS
showsPrec :: Int -&gt; PraosEnvelopeError -&gt; ShowS
$cshow :: PraosEnvelopeError -&gt; String
show :: PraosEnvelopeError -&gt; String
$cshowList :: [PraosEnvelopeError] -&gt; ShowS
showList :: [PraosEnvelopeError] -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680277311"><span id="local-6989586621680277315"><span id="local-6989586621680277321"><span class="annot"><span class="hs-identifier hs-type">NoThunks</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Praos.html#PraosEnvelopeError"><span class="hs-identifier hs-type">PraosEnvelopeError</span></a></span></span></span></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680277100"><span class="annot"><span class="hs-identifier hs-type">PraosCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621680277100"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ProtocolHeaderSupportsEnvelope"><span class="hs-identifier hs-type">ProtocolHeaderSupportsEnvelope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Praos</span></span><span> </span><span class="annot"><a href="#local-6989586621680277100"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-97"></span><span>  </span><span id="local-6989586621680277390"><span class="annot"><span class="annottext">pHeaderHash :: ShelleyProtocolHeader (Praos c)
-&gt; ShelleyHash (ProtoCrypto (Praos c))
</span><a href="#local-6989586621680277390"><span class="hs-identifier hs-var hs-var hs-var hs-var">pHeaderHash</span></a></span></span><span> </span><span id="local-6989586621680277392"><span class="annot"><span class="annottext">ShelleyProtocolHeader (Praos c)
</span><a href="#local-6989586621680277392"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash (ProtoCrypto (Praos c)) EraIndependentBlockHeader
-&gt; ShelleyHash (ProtoCrypto (Praos c))
forall crypto.
Hash crypto EraIndependentBlockHeader -&gt; ShelleyHash crypto
</span><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ShelleyHash"><span class="hs-identifier hs-var">ShelleyHash</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash (ProtoCrypto (Praos c)) EraIndependentBlockHeader
 -&gt; ShelleyHash (ProtoCrypto (Praos c)))
-&gt; Hash (ProtoCrypto (Praos c)) EraIndependentBlockHeader
-&gt; ShelleyHash (ProtoCrypto (Praos c))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Header c -&gt; Hash (HASH c) EraIndependentBlockHeader
forall crypto.
Crypto crypto =&gt;
Header crypto -&gt; Hash (HASH crypto) EraIndependentBlockHeader
</span><span class="hs-identifier hs-var">headerHash</span></span><span> </span><span class="annot"><span class="annottext">Header c
ShelleyProtocolHeader (Praos c)
</span><a href="#local-6989586621680277392"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span id="local-6989586621680277394"><span class="annot"><span class="annottext">pHeaderPrevHash :: ShelleyProtocolHeader (Praos c) -&gt; PrevHash (ProtoCrypto (Praos c))
</span><a href="#local-6989586621680277394"><span class="hs-identifier hs-var hs-var hs-var hs-var">pHeaderPrevHash</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Header</span></span><span> </span><span id="local-6989586621680277397"><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277397"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="annot"><span class="annottext">SignedKES c (HeaderBody c)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; PrevHash c
forall crypto. HeaderBody crypto -&gt; PrevHash crypto
</span><span class="hs-identifier hs-var">hbPrev</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277397"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span id="local-6989586621680277400"><span class="annot"><span class="annottext">pHeaderBodyHash :: ShelleyProtocolHeader (Praos c)
-&gt; Hash (ProtoCrypto (Praos c)) EraIndependentBlockBody
</span><a href="#local-6989586621680277400"><span class="hs-identifier hs-var hs-var hs-var hs-var">pHeaderBodyHash</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Header</span></span><span> </span><span id="local-6989586621680277402"><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277402"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="annot"><span class="annottext">SignedKES c (HeaderBody c)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; Hash c EraIndependentBlockBody
forall crypto.
HeaderBody crypto -&gt; Hash crypto EraIndependentBlockBody
</span><span class="hs-identifier hs-var">hbBodyHash</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277402"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span id="local-6989586621680277405"><span class="annot"><span class="annottext">pHeaderSlot :: ShelleyProtocolHeader (Praos c) -&gt; SlotNo
</span><a href="#local-6989586621680277405"><span class="hs-identifier hs-var hs-var hs-var hs-var">pHeaderSlot</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Header</span></span><span> </span><span id="local-6989586621680277407"><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277407"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="annot"><span class="annottext">SignedKES c (HeaderBody c)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; SlotNo
forall crypto. HeaderBody crypto -&gt; SlotNo
</span><span class="hs-identifier hs-var">hbSlotNo</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277407"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621680277410"><span class="annot"><span class="annottext">pHeaderBlock :: ShelleyProtocolHeader (Praos c) -&gt; BlockNo
</span><a href="#local-6989586621680277410"><span class="hs-identifier hs-var hs-var hs-var hs-var">pHeaderBlock</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Header</span></span><span> </span><span id="local-6989586621680277412"><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277412"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="annot"><span class="annottext">SignedKES c (HeaderBody c)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; BlockNo
forall crypto. HeaderBody crypto -&gt; BlockNo
</span><span class="hs-identifier hs-var">hbBlockNo</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277412"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-102"></span><span>  </span><span id="local-6989586621680277418"><span class="annot"><span class="annottext">pHeaderSize :: ShelleyProtocolHeader (Praos c) -&gt; Natural
</span><a href="#local-6989586621680277418"><span class="hs-identifier hs-var hs-var hs-var hs-var">pHeaderSize</span></a></span></span><span> </span><span id="local-6989586621680277420"><span class="annot"><span class="annottext">ShelleyProtocolHeader (Praos c)
</span><a href="#local-6989586621680277420"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Natural) -&gt; Int -&gt; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Header c -&gt; Int
forall crypto. Header crypto -&gt; Int
</span><span class="hs-identifier hs-var">headerSize</span></span><span> </span><span class="annot"><span class="annottext">Header c
ShelleyProtocolHeader (Praos c)
</span><a href="#local-6989586621680277420"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span id="local-6989586621680277425"><span class="annot"><span class="annottext">pHeaderBlockSize :: ShelleyProtocolHeader (Praos c) -&gt; Natural
</span><a href="#local-6989586621680277425"><span class="hs-identifier hs-var hs-var hs-var hs-var">pHeaderBlockSize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Header</span></span><span> </span><span id="local-6989586621680277427"><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277427"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="annot"><span class="annottext">SignedKES c (HeaderBody c)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Natural) -&gt; Word32 -&gt; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; Word32
forall crypto. HeaderBody crypto -&gt; Word32
</span><span class="hs-identifier hs-var">hbBodySize</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277427"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="EnvelopeCheckError"><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#EnvelopeCheckError"><span class="hs-identifier hs-var">EnvelopeCheckError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Praos.html#PraosEnvelopeError"><span class="hs-identifier hs-type">PraosEnvelopeError</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>  </span><span id="local-6989586621680277455"><span class="annot"><span class="annottext">envelopeChecks :: ConsensusConfig (Praos c)
-&gt; LedgerView (Praos c)
-&gt; ShelleyProtocolHeader (Praos c)
-&gt; Except (EnvelopeCheckError (Praos c)) ()
</span><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#envelopeChecks"><span class="hs-identifier hs-var hs-var hs-var hs-var">envelopeChecks</span></a></span></span><span> </span><span id="local-6989586621680277456"><span class="annot"><span class="annottext">ConsensusConfig (Praos c)
</span><a href="#local-6989586621680277456"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621680277457"><span class="annot"><span class="annottext">LedgerView (Praos c)
</span><a href="#local-6989586621680277457"><span class="hs-identifier hs-var">lv</span></a></span></span><span> </span><span id="local-6989586621680277458"><span class="annot"><span class="annottext">ShelleyProtocolHeader (Praos c)
</span><a href="#local-6989586621680277458"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; ExceptT PraosEnvelopeError Identity ()
-&gt; ExceptT PraosEnvelopeError Identity ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680277459"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Version -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680277461"><span class="hs-identifier hs-var">maxpv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT PraosEnvelopeError Identity ()
 -&gt; ExceptT PraosEnvelopeError Identity ())
-&gt; ExceptT PraosEnvelopeError Identity ()
-&gt; ExceptT PraosEnvelopeError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PraosEnvelopeError -&gt; ExceptT PraosEnvelopeError Identity ()
forall a.
PraosEnvelopeError -&gt; ExceptT PraosEnvelopeError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; Version -&gt; PraosEnvelopeError
</span><a href="Ouroboros.Consensus.Shelley.Protocol.Praos.html#ObsoleteNode"><span class="hs-identifier hs-var">ObsoleteNode</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680277459"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680277461"><span class="hs-identifier hs-var">maxpv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; ExceptT PraosEnvelopeError Identity ()
-&gt; ExceptT PraosEnvelopeError Identity ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BHeaderView c -&gt; Int
forall c. BHeaderView c -&gt; Int
</span><span class="hs-identifier hs-var">bhviewHSize</span></span><span> </span><span class="annot"><span class="annottext">BHeaderView c
BHeaderView (ProtoCrypto (Praos c))
</span><a href="#local-6989586621680277463"><span class="hs-identifier hs-var">bhv</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621680277464"><span class="hs-identifier hs-var">maxHeaderSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT PraosEnvelopeError Identity ()
 -&gt; ExceptT PraosEnvelopeError Identity ())
-&gt; ExceptT PraosEnvelopeError Identity ()
-&gt; ExceptT PraosEnvelopeError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-110"></span><span>      </span><span class="annot"><span class="annottext">PraosEnvelopeError -&gt; ExceptT PraosEnvelopeError Identity ()
forall a.
PraosEnvelopeError -&gt; ExceptT PraosEnvelopeError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(PraosEnvelopeError -&gt; ExceptT PraosEnvelopeError Identity ())
-&gt; PraosEnvelopeError -&gt; ExceptT PraosEnvelopeError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Word16 -&gt; PraosEnvelopeError
</span><a href="Ouroboros.Consensus.Shelley.Protocol.Praos.html#HeaderSizeTooLarge"><span class="hs-identifier hs-var">HeaderSizeTooLarge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BHeaderView c -&gt; Int
forall c. BHeaderView c -&gt; Int
</span><span class="hs-identifier hs-var">bhviewHSize</span></span><span> </span><span class="annot"><span class="annottext">BHeaderView c
BHeaderView (ProtoCrypto (Praos c))
</span><a href="#local-6989586621680277463"><span class="hs-identifier hs-var">bhv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621680277464"><span class="hs-identifier hs-var">maxHeaderSize</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; ExceptT PraosEnvelopeError Identity ()
-&gt; ExceptT PraosEnvelopeError Identity ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BHeaderView c -&gt; Word32
forall c. BHeaderView c -&gt; Word32
</span><span class="hs-identifier hs-var">bhviewBSize</span></span><span> </span><span class="annot"><span class="annottext">BHeaderView c
BHeaderView (ProtoCrypto (Praos c))
</span><a href="#local-6989586621680277463"><span class="hs-identifier hs-var">bhv</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621680277466"><span class="hs-identifier hs-var">maxBodySize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT PraosEnvelopeError Identity ()
 -&gt; ExceptT PraosEnvelopeError Identity ())
-&gt; ExceptT PraosEnvelopeError Identity ()
-&gt; ExceptT PraosEnvelopeError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><span class="annottext">PraosEnvelopeError -&gt; ExceptT PraosEnvelopeError Identity ()
forall a.
PraosEnvelopeError -&gt; ExceptT PraosEnvelopeError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(PraosEnvelopeError -&gt; ExceptT PraosEnvelopeError Identity ())
-&gt; PraosEnvelopeError -&gt; ExceptT PraosEnvelopeError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; PraosEnvelopeError
</span><a href="Ouroboros.Consensus.Shelley.Protocol.Praos.html#BlockSizeTooLarge"><span class="hs-identifier hs-var">BlockSizeTooLarge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BHeaderView c -&gt; Word32
forall c. BHeaderView c -&gt; Word32
</span><span class="hs-identifier hs-var">bhviewBSize</span></span><span> </span><span class="annot"><span class="annottext">BHeaderView c
BHeaderView (ProtoCrypto (Praos c))
</span><a href="#local-6989586621680277463"><span class="hs-identifier hs-var">bhv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621680277466"><span class="hs-identifier hs-var">maxBodySize</span></a></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-116"></span><span>      </span><span id="local-6989586621680277467"><span class="annot"><span class="annottext">pp :: PraosParams
</span><a href="#local-6989586621680277467"><span class="hs-identifier hs-var hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConsensusConfig (Praos c) -&gt; PraosParams
forall c. ConsensusConfig (Praos c) -&gt; PraosParams
</span><span class="hs-identifier hs-var">praosParams</span></span><span> </span><span class="annot"><span class="annottext">ConsensusConfig (Praos c)
</span><a href="#local-6989586621680277456"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-117"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MaxMajorProtVer</span></span><span> </span><span id="local-6989586621680277461"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680277461"><span class="hs-identifier hs-var">maxpv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PraosParams -&gt; MaxMajorProtVer
</span><span class="hs-identifier hs-var">praosMaxMajorPV</span></span><span> </span><span class="annot"><span class="annottext">PraosParams
</span><a href="#local-6989586621680277467"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-118"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ProtVer</span></span><span> </span><span id="local-6989586621680277459"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680277459"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerView c -&gt; ProtVer
forall crypto. LedgerView crypto -&gt; ProtVer
</span><span class="hs-identifier hs-var">lvProtocolVersion</span></span><span> </span><span class="annot"><span class="annottext">LedgerView (Praos c)
LedgerView c
</span><a href="#local-6989586621680277457"><span class="hs-identifier hs-var">lv</span></a></span><span>
</span><span id="line-119"></span><span>      </span><span id="local-6989586621680277464"><span class="annot"><span class="annottext">maxHeaderSize :: Word16
</span><a href="#local-6989586621680277464"><span class="hs-identifier hs-var hs-var">maxHeaderSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerView c -&gt; Word16
forall crypto. LedgerView crypto -&gt; Word16
</span><span class="hs-identifier hs-var">lvMaxHeaderSize</span></span><span> </span><span class="annot"><span class="annottext">LedgerView (Praos c)
LedgerView c
</span><a href="#local-6989586621680277457"><span class="hs-identifier hs-var">lv</span></a></span><span>
</span><span id="line-120"></span><span>      </span><span id="local-6989586621680277466"><span class="annot"><span class="annottext">maxBodySize :: Word32
</span><a href="#local-6989586621680277466"><span class="hs-identifier hs-var hs-var">maxBodySize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerView c -&gt; Word32
forall crypto. LedgerView crypto -&gt; Word32
</span><span class="hs-identifier hs-var">lvMaxBodySize</span></span><span> </span><span class="annot"><span class="annottext">LedgerView (Praos c)
LedgerView c
</span><a href="#local-6989586621680277457"><span class="hs-identifier hs-var">lv</span></a></span><span>
</span><span id="line-121"></span><span>      </span><span id="local-6989586621680277463"><span class="annot"><span class="annottext">bhv :: BHeaderView (ProtoCrypto (Praos c))
</span><a href="#local-6989586621680277463"><span class="hs-identifier hs-var hs-var">bhv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyProtocolHeader (Praos c)
-&gt; BHeaderView (ProtoCrypto (Praos c))
forall proto.
ProtocolHeaderSupportsLedger proto =&gt;
ShelleyProtocolHeader proto -&gt; BHeaderView (ProtoCrypto proto)
</span><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#mkHeaderView"><span class="hs-identifier hs-var">mkHeaderView</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyProtocolHeader (Praos c)
</span><a href="#local-6989586621680277458"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680277156"><span class="annot"><span class="hs-identifier hs-type">PraosCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621680277156"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ProtocolHeaderSupportsKES"><span class="hs-identifier hs-type">ProtocolHeaderSupportsKES</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Praos</span></span><span> </span><span class="annot"><a href="#local-6989586621680277156"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>  </span><span id="local-6989586621680277488"><span class="annot"><span class="annottext">configSlotsPerKESPeriod :: ConsensusConfig (Praos c) -&gt; Word64
</span><a href="#local-6989586621680277488"><span class="hs-identifier hs-var hs-var hs-var hs-var">configSlotsPerKESPeriod</span></a></span></span><span> </span><span id="local-6989586621680277490"><span class="annot"><span class="annottext">ConsensusConfig (Praos c)
</span><a href="#local-6989586621680277490"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PraosParams -&gt; Word64
</span><span class="hs-identifier hs-var">praosSlotsPerKESPeriod</span></span><span> </span><span class="annot"><span class="annottext">(PraosParams -&gt; Word64) -&gt; PraosParams -&gt; Word64
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConsensusConfig (Praos c) -&gt; PraosParams
forall c. ConsensusConfig (Praos c) -&gt; PraosParams
</span><span class="hs-identifier hs-var">praosParams</span></span><span> </span><span class="annot"><span class="annottext">ConsensusConfig (Praos c)
</span><a href="#local-6989586621680277490"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-125"></span><span>  </span><span id="local-6989586621680277504"><span class="annot"><span class="annottext">verifyHeaderIntegrity :: Word64 -&gt; ShelleyProtocolHeader (Praos c) -&gt; Bool
</span><a href="#local-6989586621680277504"><span class="hs-identifier hs-var hs-var hs-var hs-var">verifyHeaderIntegrity</span></a></span></span><span> </span><span id="local-6989586621680277506"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680277506"><span class="hs-identifier hs-var">slotsPerKESPeriod</span></a></span></span><span> </span><span id="local-6989586621680277507"><span class="annot"><span class="annottext">ShelleyProtocolHeader (Praos c)
</span><a href="#local-6989586621680277507"><span class="hs-identifier hs-var">header</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="annottext">Either String () -&gt; Bool
forall a b. Either a b -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#isRight"><span class="hs-identifier hs-var">isRight</span></a></span><span> </span><span class="annot"><span class="annottext">(Either String () -&gt; Bool) -&gt; Either String () -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKES (KES c)
-&gt; VerKeyKES (KES c)
-&gt; Word
-&gt; HeaderBody c
-&gt; SignedKES (KES c) (HeaderBody c)
-&gt; Either String ()
forall v a.
(KESAlgorithm v, Signable v a) =&gt;
ContextKES v
-&gt; VerKeyKES v -&gt; Word -&gt; a -&gt; SignedKES v a -&gt; Either String ()
</span><span class="hs-identifier hs-var">KES.verifySignedKES</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VerKeyKES (KES c)
</span><a href="#local-6989586621680277509"><span class="hs-identifier hs-var">ocertVkHot</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680277510"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277511"><span class="hs-identifier hs-var">headerBody</span></a></span><span> </span><span class="annot"><span class="annottext">SignedKES (KES c) (HeaderBody c)
</span><a href="#local-6989586621680277512"><span class="hs-identifier hs-var">headerSig</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-128"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Header</span></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680277511"><span class="annot"><span class="annottext">HeaderBody c
headerBody :: HeaderBody c
headerBody :: forall crypto. Crypto crypto =&gt; Header crypto -&gt; HeaderBody crypto
</span><a href="#local-6989586621680277511"><span class="hs-identifier hs-var hs-var">headerBody</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680277512"><span class="annot"><span class="annottext">SignedKES (KES c) (HeaderBody c)
headerSig :: SignedKES (KES c) (HeaderBody c)
headerSig :: forall crypto.
Crypto crypto =&gt;
Header crypto -&gt; SignedKES crypto (HeaderBody crypto)
</span><a href="#local-6989586621680277512"><span class="hs-identifier hs-var hs-var">headerSig</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyProtocolHeader (Praos c)
</span><a href="#local-6989586621680277507"><span class="hs-identifier hs-var">header</span></a></span><span>
</span><span id="line-129"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">SL.OCert</span></span><span>
</span><span id="line-130"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680277509"><span class="annot"><span class="annottext">VerKeyKES (KES c)
ocertVkHot :: forall c. OCert c -&gt; VerKeyKES c
ocertVkHot :: VerKeyKES (KES c)
</span><span class="hs-identifier hs-var hs-var">ocertVkHot</span></span></span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>          </span><span class="annot"><span class="annottext">ocertKESPeriod :: forall c. OCert c -&gt; KESPeriod
</span><span class="hs-identifier hs-var">ocertKESPeriod</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SL.KESPeriod</span></span><span> </span><span id="local-6989586621680277517"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680277517"><span class="hs-identifier hs-var">startOfKesPeriod</span></a></span></span><span>
</span><span id="line-132"></span><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; OCert c
forall crypto. HeaderBody crypto -&gt; OCert crypto
</span><span class="hs-identifier hs-var">hbOCert</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277511"><span class="hs-identifier hs-var">headerBody</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>      </span><span id="local-6989586621680277519"><span class="annot"><span class="annottext">currentKesPeriod :: Word
</span><a href="#local-6989586621680277519"><span class="hs-identifier hs-var hs-var">currentKesPeriod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>        </span><span class="annot"><span class="annottext">Word64 -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Word) -&gt; Word64 -&gt; Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-136"></span><span>          </span><span class="annot"><span class="annottext">SlotNo -&gt; Word64
</span><span class="hs-identifier hs-var">unSlotNo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderBody c -&gt; SlotNo
forall crypto. HeaderBody crypto -&gt; SlotNo
</span><span class="hs-identifier hs-var">hbSlotNo</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277511"><span class="hs-identifier hs-var">headerBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#div"><span class="hs-operator hs-var">`div`</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680277506"><span class="hs-identifier hs-var">slotsPerKESPeriod</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>      </span><span id="local-6989586621680277510"><span class="annot"><span class="annottext">t :: Word
</span><a href="#local-6989586621680277510"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680277519"><span class="hs-identifier hs-var">currentKesPeriod</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680277517"><span class="hs-identifier hs-var">startOfKesPeriod</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-140"></span><span>            </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680277519"><span class="hs-identifier hs-var">currentKesPeriod</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680277517"><span class="hs-identifier hs-var">startOfKesPeriod</span></a></span><span>
</span><span id="line-141"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-142"></span><span>            </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span>
</span><span id="line-143"></span><span>  </span><span id="local-6989586621680277538"><span class="annot"><span class="annottext">mkHeader :: forall crypto (m :: * -&gt; *).
(Crypto crypto, Monad m, crypto ~ ProtoCrypto (Praos c)) =&gt;
HotKey crypto m
-&gt; CanBeLeader (Praos c)
-&gt; IsLeader (Praos c)
-&gt; SlotNo
-&gt; BlockNo
-&gt; PrevHash crypto
-&gt; Hash crypto EraIndependentBlockBody
-&gt; Int
-&gt; ProtVer
-&gt; m (ShelleyProtocolHeader (Praos c))
</span><a href="#local-6989586621680277538"><span class="hs-identifier hs-var hs-var hs-var hs-var">mkHeader</span></a></span></span><span> </span><span id="local-6989586621680277540"><span class="annot"><span class="annottext">HotKey crypto m
</span><a href="#local-6989586621680277540"><span class="hs-identifier hs-var">hk</span></a></span></span><span> </span><span id="local-6989586621680277541"><span class="annot"><span class="annottext">CanBeLeader (Praos c)
</span><a href="#local-6989586621680277541"><span class="hs-identifier hs-var">cbl</span></a></span></span><span> </span><span id="local-6989586621680277542"><span class="annot"><span class="annottext">IsLeader (Praos c)
</span><a href="#local-6989586621680277542"><span class="hs-identifier hs-var">il</span></a></span></span><span> </span><span id="local-6989586621680277543"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680277543"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span> </span><span id="local-6989586621680277544"><span class="annot"><span class="annottext">BlockNo
</span><a href="#local-6989586621680277544"><span class="hs-identifier hs-var">blockNo</span></a></span></span><span> </span><span id="local-6989586621680277545"><span class="annot"><span class="annottext">PrevHash crypto
</span><a href="#local-6989586621680277545"><span class="hs-identifier hs-var">prevHash</span></a></span></span><span> </span><span id="local-6989586621680277546"><span class="annot"><span class="annottext">Hash crypto EraIndependentBlockBody
</span><a href="#local-6989586621680277546"><span class="hs-identifier hs-var">bbHash</span></a></span></span><span> </span><span id="local-6989586621680277547"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680277547"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621680277548"><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621680277548"><span class="hs-identifier hs-var">protVer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">PraosFields</span></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680277550"><span class="annot"><span class="annottext">SignedKES crypto (HeaderBody crypto)
praosSignature :: SignedKES crypto (HeaderBody crypto)
praosSignature :: forall c toSign. PraosFields c toSign -&gt; SignedKES c toSign
</span><a href="#local-6989586621680277550"><span class="hs-identifier hs-var hs-var">praosSignature</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680277552"><span class="annot"><span class="annottext">HeaderBody crypto
praosToSign :: HeaderBody crypto
praosToSign :: forall c toSign. PraosFields c toSign -&gt; toSign
</span><a href="#local-6989586621680277552"><span class="hs-identifier hs-var hs-var">praosToSign</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HotKey crypto m
-&gt; CanBeLeader (Praos crypto)
-&gt; IsLeader (Praos crypto)
-&gt; (PraosToSign crypto -&gt; HeaderBody crypto)
-&gt; m (PraosFields crypto (HeaderBody crypto))
forall c toSign (m :: * -&gt; *).
(PraosCrypto c, KESignable c toSign, Monad m) =&gt;
HotKey c m
-&gt; CanBeLeader (Praos c)
-&gt; IsLeader (Praos c)
-&gt; (PraosToSign c -&gt; toSign)
-&gt; m (PraosFields c toSign)
</span><span class="hs-identifier hs-var">forgePraosFields</span></span><span> </span><span class="annot"><span class="annottext">HotKey crypto m
</span><a href="#local-6989586621680277540"><span class="hs-identifier hs-var">hk</span></a></span><span> </span><span class="annot"><span class="annottext">CanBeLeader (Praos c)
CanBeLeader (Praos crypto)
</span><a href="#local-6989586621680277541"><span class="hs-identifier hs-var">cbl</span></a></span><span> </span><span class="annot"><span class="annottext">IsLeader (Praos c)
IsLeader (Praos crypto)
</span><a href="#local-6989586621680277542"><span class="hs-identifier hs-var">il</span></a></span><span> </span><span class="annot"><span class="annottext">PraosToSign crypto -&gt; HeaderBody crypto
</span><a href="#local-6989586621680277555"><span class="hs-identifier hs-var">mkBhBodyBytes</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="annottext">Header crypto -&gt; m (Header crypto)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Header crypto -&gt; m (Header crypto))
-&gt; Header crypto -&gt; m (Header crypto)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderBody crypto
-&gt; SignedKES crypto (HeaderBody crypto) -&gt; Header crypto
forall crypto.
Crypto crypto =&gt;
HeaderBody crypto
-&gt; SignedKES crypto (HeaderBody crypto) -&gt; Header crypto
</span><span class="hs-identifier hs-var">Header</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody crypto
</span><a href="#local-6989586621680277552"><span class="hs-identifier hs-var">praosToSign</span></a></span><span> </span><span class="annot"><span class="annottext">SignedKES crypto (HeaderBody crypto)
</span><a href="#local-6989586621680277550"><span class="hs-identifier hs-var">praosSignature</span></a></span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-147"></span><span>      </span><span id="local-6989586621680277555"><span class="annot"><span class="annottext">mkBhBodyBytes :: PraosToSign crypto -&gt; HeaderBody crypto
</span><a href="#local-6989586621680277555"><span class="hs-identifier hs-var hs-var">mkBhBodyBytes</span></a></span></span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">PraosToSign</span></span><span>
</span><span id="line-149"></span><span>          </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680277557"><span class="annot"><span class="annottext">VKey 'BlockIssuer crypto
praosToSignIssuerVK :: VKey 'BlockIssuer crypto
praosToSignIssuerVK :: forall c. PraosToSign c -&gt; VKey 'BlockIssuer c
</span><a href="#local-6989586621680277557"><span class="hs-identifier hs-var hs-var">praosToSignIssuerVK</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-150"></span><span>            </span><span id="local-6989586621680277559"><span class="annot"><span class="annottext">VerKeyVRF crypto
praosToSignVrfVK :: VerKeyVRF crypto
praosToSignVrfVK :: forall c. PraosToSign c -&gt; VerKeyVRF c
</span><a href="#local-6989586621680277559"><span class="hs-identifier hs-var hs-var">praosToSignVrfVK</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>            </span><span id="local-6989586621680277561"><span class="annot"><span class="annottext">CertifiedVRF crypto InputVRF
praosToSignVrfRes :: CertifiedVRF crypto InputVRF
praosToSignVrfRes :: forall c. PraosToSign c -&gt; CertifiedVRF c InputVRF
</span><a href="#local-6989586621680277561"><span class="hs-identifier hs-var hs-var">praosToSignVrfRes</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>            </span><span id="local-6989586621680277563"><span class="annot"><span class="annottext">OCert crypto
praosToSignOCert :: OCert crypto
praosToSignOCert :: forall c. PraosToSign c -&gt; OCert c
</span><a href="#local-6989586621680277563"><span class="hs-identifier hs-var hs-var">praosToSignOCert</span></a></span></span><span>
</span><span id="line-153"></span><span>          </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">HeaderBody</span></span><span>
</span><span id="line-155"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hbBlockNo :: BlockNo
</span><span class="hs-identifier hs-var">hbBlockNo</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockNo
</span><a href="#local-6989586621680277544"><span class="hs-identifier hs-var">blockNo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-156"></span><span>              </span><span class="annot"><span class="annottext">hbSlotNo :: SlotNo
</span><span class="hs-identifier hs-var">hbSlotNo</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680277543"><span class="hs-identifier hs-var">slotNo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-157"></span><span>              </span><span class="annot"><span class="annottext">hbPrev :: PrevHash crypto
</span><span class="hs-identifier hs-var">hbPrev</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrevHash crypto
</span><a href="#local-6989586621680277545"><span class="hs-identifier hs-var">prevHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-158"></span><span>              </span><span class="annot"><span class="annottext">hbVk :: VKey 'BlockIssuer crypto
</span><span class="hs-identifier hs-var">hbVk</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VKey 'BlockIssuer crypto
</span><a href="#local-6989586621680277557"><span class="hs-identifier hs-var">praosToSignIssuerVK</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-159"></span><span>              </span><span class="annot"><span class="annottext">hbVrfVk :: VerKeyVRF crypto
</span><span class="hs-identifier hs-var">hbVrfVk</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VerKeyVRF crypto
</span><a href="#local-6989586621680277559"><span class="hs-identifier hs-var">praosToSignVrfVK</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-160"></span><span>              </span><span class="annot"><span class="annottext">hbVrfRes :: CertifiedVRF crypto InputVRF
</span><span class="hs-identifier hs-var">hbVrfRes</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CertifiedVRF crypto InputVRF
</span><a href="#local-6989586621680277561"><span class="hs-identifier hs-var">praosToSignVrfRes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-161"></span><span>              </span><span class="annot"><span class="annottext">hbBodySize :: Word32
</span><span class="hs-identifier hs-var">hbBodySize</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680277547"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-162"></span><span>              </span><span class="annot"><span class="annottext">hbBodyHash :: Hash crypto EraIndependentBlockBody
</span><span class="hs-identifier hs-var">hbBodyHash</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash crypto EraIndependentBlockBody
</span><a href="#local-6989586621680277546"><span class="hs-identifier hs-var">bbHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-163"></span><span>              </span><span class="annot"><span class="annottext">hbOCert :: OCert crypto
</span><span class="hs-identifier hs-var">hbOCert</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OCert crypto
</span><a href="#local-6989586621680277563"><span class="hs-identifier hs-var">praosToSignOCert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-164"></span><span>              </span><span class="annot"><span class="annottext">hbProtVer :: ProtVer
</span><a href="#local-6989586621680277569"><span class="hs-identifier hs-var">hbProtVer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621680277548"><span class="hs-identifier hs-var">protVer</span></a></span><span>
</span><span id="line-165"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680277212"><span class="annot"><span class="hs-identifier hs-type">PraosCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621680277212"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ProtocolHeaderSupportsProtocol"><span class="hs-identifier hs-type">ProtocolHeaderSupportsProtocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Praos</span></span><span> </span><span class="annot"><a href="#local-6989586621680277212"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="CannotForgeError"><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#CannotForgeError"><span class="hs-identifier hs-var">CannotForgeError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Praos</span></span><span> </span><span class="annot"><a href="#local-6989586621680277212"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PraosCannotForge</span></span><span> </span><span class="annot"><a href="#local-6989586621680277212"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span id="local-6989586621680277581"><span class="annot"><span class="annottext">protocolHeaderView :: ShelleyProtocolHeader (Praos c) -&gt; ValidateView (Praos c)
</span><a href="#local-6989586621680277581"><span class="hs-identifier hs-var hs-var hs-var hs-var">protocolHeaderView</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Header</span></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680277583"><span class="annot"><span class="annottext">HeaderBody c
headerBody :: forall crypto. Crypto crypto =&gt; Header crypto -&gt; HeaderBody crypto
headerBody :: HeaderBody c
</span><span class="hs-identifier hs-var hs-var">headerBody</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680277584"><span class="annot"><span class="annottext">SignedKES c (HeaderBody c)
headerSig :: forall crypto.
Crypto crypto =&gt;
Header crypto -&gt; SignedKES crypto (HeaderBody crypto)
headerSig :: SignedKES c (HeaderBody c)
</span><span class="hs-identifier hs-var hs-var">headerSig</span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HeaderView</span></span><span>
</span><span id="line-171"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hvPrevHash :: PrevHash c
</span><a href="#local-6989586621680277586"><span class="hs-identifier hs-var">hvPrevHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; PrevHash c
forall crypto. HeaderBody crypto -&gt; PrevHash crypto
</span><span class="hs-identifier hs-var">hbPrev</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277583"><span class="hs-identifier hs-var">headerBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-172"></span><span>        </span><span class="annot"><span class="annottext">hvVK :: VKey 'BlockIssuer c
</span><a href="#local-6989586621680277587"><span class="hs-identifier hs-var">hvVK</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; VKey 'BlockIssuer c
forall crypto. HeaderBody crypto -&gt; VKey 'BlockIssuer crypto
</span><span class="hs-identifier hs-var">hbVk</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277583"><span class="hs-identifier hs-var">headerBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-173"></span><span>        </span><span class="annot"><span class="annottext">hvVrfVK :: VerKeyVRF (VRF c)
</span><a href="#local-6989586621680277588"><span class="hs-identifier hs-var">hvVrfVK</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; VerKeyVRF (VRF c)
forall crypto. HeaderBody crypto -&gt; VerKeyVRF crypto
</span><span class="hs-identifier hs-var">hbVrfVk</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277583"><span class="hs-identifier hs-var">headerBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><span class="annottext">hvVrfRes :: CertifiedVRF (VRF c) InputVRF
</span><a href="#local-6989586621680277589"><span class="hs-identifier hs-var">hvVrfRes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; CertifiedVRF (VRF c) InputVRF
forall crypto. HeaderBody crypto -&gt; CertifiedVRF crypto InputVRF
</span><span class="hs-identifier hs-var">hbVrfRes</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277583"><span class="hs-identifier hs-var">headerBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-175"></span><span>        </span><span class="annot"><span class="annottext">hvOCert :: OCert c
</span><a href="#local-6989586621680277590"><span class="hs-identifier hs-var">hvOCert</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; OCert c
forall crypto. HeaderBody crypto -&gt; OCert crypto
</span><span class="hs-identifier hs-var">hbOCert</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277583"><span class="hs-identifier hs-var">headerBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-176"></span><span>        </span><span class="annot"><span class="annottext">hvSlotNo :: SlotNo
</span><a href="#local-6989586621680277591"><span class="hs-identifier hs-var">hvSlotNo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; SlotNo
forall crypto. HeaderBody crypto -&gt; SlotNo
</span><span class="hs-identifier hs-var">hbSlotNo</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277583"><span class="hs-identifier hs-var">headerBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><span class="annottext">hvSigned :: HeaderBody c
</span><a href="#local-6989586621680277592"><span class="hs-identifier hs-var">hvSigned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277583"><span class="hs-identifier hs-var">headerBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-178"></span><span>        </span><span class="annot"><span class="annottext">hvSignature :: SignedKES c (HeaderBody c)
</span><a href="#local-6989586621680277593"><span class="hs-identifier hs-var">hvSignature</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SignedKES c (HeaderBody c)
</span><a href="#local-6989586621680277584"><span class="hs-identifier hs-var">headerSig</span></a></span><span>
</span><span id="line-179"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-180"></span><span>  </span><span id="local-6989586621680277595"><span class="annot"><span class="annottext">pHeaderIssuer :: ShelleyProtocolHeader (Praos c)
-&gt; VKey 'BlockIssuer (ProtoCrypto (Praos c))
</span><a href="#local-6989586621680277595"><span class="hs-identifier hs-var hs-var hs-var hs-var">pHeaderIssuer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; VKey 'BlockIssuer c
forall crypto. HeaderBody crypto -&gt; VKey 'BlockIssuer crypto
</span><span class="hs-identifier hs-var">hbVk</span></span><span> </span><span class="annot"><span class="annottext">(HeaderBody c -&gt; VKey 'BlockIssuer c)
-&gt; (Header c -&gt; HeaderBody c) -&gt; Header c -&gt; VKey 'BlockIssuer c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Header c -&gt; HeaderBody c
forall crypto. Crypto crypto =&gt; Header crypto -&gt; HeaderBody crypto
</span><span class="hs-identifier hs-var">headerBody</span></span><span>
</span><span id="line-181"></span><span>  </span><span id="local-6989586621680277599"><span class="annot"><span class="annottext">pHeaderIssueNo :: ShelleyProtocolHeader (Praos c) -&gt; Word64
</span><a href="#local-6989586621680277599"><span class="hs-identifier hs-var hs-var hs-var hs-var">pHeaderIssueNo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OCert c -&gt; Word64
forall c. OCert c -&gt; Word64
</span><span class="hs-identifier hs-var">SL.ocertN</span></span><span> </span><span class="annot"><span class="annottext">(OCert c -&gt; Word64) -&gt; (Header c -&gt; OCert c) -&gt; Header c -&gt; Word64
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; OCert c
forall crypto. HeaderBody crypto -&gt; OCert crypto
</span><span class="hs-identifier hs-var">hbOCert</span></span><span> </span><span class="annot"><span class="annottext">(HeaderBody c -&gt; OCert c)
-&gt; (Header c -&gt; HeaderBody c) -&gt; Header c -&gt; OCert c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Header c -&gt; HeaderBody c
forall crypto. Crypto crypto =&gt; Header crypto -&gt; HeaderBody crypto
</span><span class="hs-identifier hs-var">headerBody</span></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-comment">-- This is the &quot;unified&quot; VRF value, prior to range extension which yields e.g.</span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-comment">-- the leader VRF value used for slot election.</span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-comment">-- In the future, we might want to use a dedicated range-extended VRF value</span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-comment">-- here instead.</span><span>
</span><span id="line-188"></span><span>  </span><span id="local-6989586621680277603"><span class="annot"><span class="annottext">pTieBreakVRFValue :: ShelleyProtocolHeader (Praos c)
-&gt; OutputVRF (VRF (ProtoCrypto (Praos c)))
</span><a href="#local-6989586621680277603"><span class="hs-identifier hs-var hs-var hs-var hs-var">pTieBreakVRFValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CertifiedVRF (VRF c) InputVRF -&gt; OutputVRF (VRF c)
forall v a. CertifiedVRF v a -&gt; OutputVRF v
</span><span class="hs-identifier hs-var">certifiedOutput</span></span><span> </span><span class="annot"><span class="annottext">(CertifiedVRF (VRF c) InputVRF -&gt; OutputVRF (VRF c))
-&gt; (Header c -&gt; CertifiedVRF (VRF c) InputVRF)
-&gt; Header c
-&gt; OutputVRF (VRF c)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; CertifiedVRF (VRF c) InputVRF
forall crypto. HeaderBody crypto -&gt; CertifiedVRF crypto InputVRF
</span><span class="hs-identifier hs-var">hbVrfRes</span></span><span> </span><span class="annot"><span class="annottext">(HeaderBody c -&gt; CertifiedVRF (VRF c) InputVRF)
-&gt; (Header c -&gt; HeaderBody c)
-&gt; Header c
-&gt; CertifiedVRF (VRF c) InputVRF
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Header c -&gt; HeaderBody c
forall crypto. Crypto crypto =&gt; Header crypto -&gt; HeaderBody crypto
</span><span class="hs-identifier hs-var">headerBody</span></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680277130"><span class="annot"><span class="hs-identifier hs-type">PraosCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621680277130"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ProtocolHeaderSupportsLedger"><span class="hs-identifier hs-type">ProtocolHeaderSupportsLedger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Praos</span></span><span> </span><span class="annot"><a href="#local-6989586621680277130"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-191"></span><span>  </span><span id="local-6989586621680277611"><span class="annot"><span class="annottext">mkHeaderView :: ShelleyProtocolHeader (Praos c)
-&gt; BHeaderView (ProtoCrypto (Praos c))
</span><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#mkHeaderView"><span class="hs-identifier hs-var hs-var hs-var hs-var">mkHeaderView</span></a></span></span><span> </span><span id="local-6989586621680277612"><span class="annot"><span class="annottext">hdr :: ShelleyProtocolHeader (Praos c)
</span><a href="#local-6989586621680277612"><span class="hs-identifier hs-var">hdr</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Header</span></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680277613"><span class="annot"><span class="annottext">HeaderBody c
headerBody :: forall crypto. Crypto crypto =&gt; Header crypto -&gt; HeaderBody crypto
headerBody :: HeaderBody c
</span><span class="hs-identifier hs-var hs-var">headerBody</span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">BHeaderView</span></span><span>
</span><span id="line-193"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bhviewID :: KeyHash 'BlockIssuer c
</span><a href="#local-6989586621680277615"><span class="hs-identifier hs-var">bhviewID</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VKey 'BlockIssuer c -&gt; KeyHash 'BlockIssuer c
forall c (kd :: KeyRole). Crypto c =&gt; VKey kd c -&gt; KeyHash kd c
</span><span class="hs-identifier hs-var">hashKey</span></span><span> </span><span class="annot"><span class="annottext">(VKey 'BlockIssuer c -&gt; KeyHash 'BlockIssuer c)
-&gt; VKey 'BlockIssuer c -&gt; KeyHash 'BlockIssuer c
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; VKey 'BlockIssuer c
forall crypto. HeaderBody crypto -&gt; VKey 'BlockIssuer crypto
</span><span class="hs-identifier hs-var">hbVk</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277613"><span class="hs-identifier hs-var">headerBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><span class="annottext">bhviewBSize :: Word32
</span><span class="hs-identifier hs-var">bhviewBSize</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; Word32
forall crypto. HeaderBody crypto -&gt; Word32
</span><span class="hs-identifier hs-var">hbBodySize</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277613"><span class="hs-identifier hs-var">headerBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><span class="annottext">bhviewHSize :: Int
</span><span class="hs-identifier hs-var">bhviewHSize</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Header c -&gt; Int
forall crypto. Header crypto -&gt; Int
</span><span class="hs-identifier hs-var">headerSize</span></span><span> </span><span class="annot"><span class="annottext">Header c
ShelleyProtocolHeader (Praos c)
</span><a href="#local-6989586621680277612"><span class="hs-identifier hs-var">hdr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-196"></span><span>        </span><span class="annot"><span class="annottext">bhviewBHash :: Hash c EraIndependentBlockBody
</span><span class="hs-identifier hs-var">bhviewBHash</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; Hash c EraIndependentBlockBody
forall crypto.
HeaderBody crypto -&gt; Hash crypto EraIndependentBlockBody
</span><span class="hs-identifier hs-var">hbBodyHash</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277613"><span class="hs-identifier hs-var">headerBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-197"></span><span>        </span><span class="annot"><span class="annottext">bhviewSlot :: SlotNo
</span><span class="hs-identifier hs-var">bhviewSlot</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderBody c -&gt; SlotNo
forall crypto. HeaderBody crypto -&gt; SlotNo
</span><span class="hs-identifier hs-var">hbSlotNo</span></span><span> </span><span class="annot"><span class="annottext">HeaderBody c
</span><a href="#local-6989586621680277613"><span class="hs-identifier hs-var">headerBody</span></a></span><span>
</span><span id="line-198"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="Signed"><span class="annot"><span class="hs-identifier hs-var">Signed</span></span></span><span> </span><span id="local-6989586621680277618"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Header</span></span><span> </span><span class="annot"><a href="#local-6989586621680277618"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeaderBody</span></span><span> </span><span class="annot"><a href="#local-6989586621680277618"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-201"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680277234"><span class="annot"><span class="hs-identifier hs-type">PraosCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621680277234"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SignedHeader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Header</span></span><span> </span><span class="annot"><a href="#local-6989586621680277234"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-202"></span><span>  </span><span id="local-6989586621680277625"><span class="annot"><span class="annottext">headerSigned :: Header c -&gt; Signed (Header c)
</span><a href="#local-6989586621680277625"><span class="hs-identifier hs-var hs-var hs-var hs-var">headerSigned</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Header c -&gt; Signed (Header c)
Header c -&gt; HeaderBody c
forall crypto. Crypto crypto =&gt; Header crypto -&gt; HeaderBody crypto
</span><span class="hs-identifier hs-var">headerBody</span></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680277243"><span class="annot"><span class="hs-identifier hs-type">PraosCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621680277243"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Shelley.Protocol.Abstract.html#ShelleyProtocol"><span class="hs-identifier hs-type">ShelleyProtocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Praos</span></span><span> </span><span class="annot"><a href="#local-6989586621680277243"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-205"></span></pre></body></html>