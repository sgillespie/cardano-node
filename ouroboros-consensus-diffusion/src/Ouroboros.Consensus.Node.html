<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds     #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE GADTs               #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures      #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase          #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE MonadComprehensions #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns      #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE Rank2Types          #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards     #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving  #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications    #-}</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- | Run the whole Node</span><span>
</span><span id="line-14"></span><span class="hs-comment">--</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- Intended for qualified import.</span><span>
</span><span id="line-16"></span><span class="hs-comment">--</span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.Node</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#run"><span class="hs-identifier">run</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#runWith"><span class="hs-identifier">runWith</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Standard arguments</span></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#StdRunNodeArgs"><span class="hs-identifier">StdRunNodeArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdBfcSaltIO"><span class="hs-identifier">stdBfcSaltIO</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdChainSyncTimeout"><span class="hs-identifier">stdChainSyncTimeout</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdKeepAliveRngIO"><span class="hs-identifier">stdKeepAliveRngIO</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdLowLevelRunNodeArgsIO"><span class="hs-identifier">stdLowLevelRunNodeArgsIO</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdMkChainDbHasFS"><span class="hs-identifier">stdMkChainDbHasFS</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdRunDataDiffusion"><span class="hs-identifier">stdRunDataDiffusion</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdVersionDataNTC"><span class="hs-identifier">stdVersionDataNTC</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdVersionDataNTN"><span class="hs-identifier">stdVersionDataNTN</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdWithCheckedDB"><span class="hs-identifier">stdWithCheckedDB</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** P2P Switch</span></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#NetworkP2PMode"><span class="hs-identifier">NetworkP2PMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Exposed by 'run' et al</span></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ChainDB.RelativeMountPoint</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ChainDB.TraceEvent</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ChainDbArgs</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">HardForkBlockchainTimeArgs</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Recovery.html#LastShutDownWasClean"><span class="hs-identifier">LastShutDownWasClean</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#LowLevelRunNodeArgs"><span class="hs-identifier">LowLevelRunNodeArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MempoolCapacityBytesOverride</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernel"><span class="hs-identifier">NodeKernel</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier">NodeKernelArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ProtocolInfo</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">RunNode</span></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#RunNodeArgs"><span class="hs-identifier">RunNodeArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Tracers.html#Tracers"><span class="hs-identifier">Tracers</span></a></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Tracers.html#Tracers%27"><span class="hs-identifier">Tracers'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Internal helpers</span></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#mkChainDbArgs"><span class="hs-identifier">mkChainDbArgs</span></a></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#mkNodeKernelArgs"><span class="hs-identifier">mkNodeKernelArgs</span></a></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#nodeKernelArgsEnforceInvariants"><span class="hs-identifier">nodeKernelArgsEnforceInvariants</span></a></span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#openChainDB"><span class="hs-identifier">openChainDB</span></a></span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Decoding</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CBOR</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Encoding</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CBOR</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Codec.Serialise</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DeserialiseFailure</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/deepseq-1.4.8.1/src/Control.DeepSeq.html"><span class="hs-identifier">Control.DeepSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/deepseq-1.4.8.1/src/Control.DeepSeq.html#NFData"><span class="hs-identifier">NFData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadTime.SI</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadTimer.SI</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadTimer</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Tracer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Tracer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Contravariant.html#contramap"><span class="hs-identifier">contramap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">traceWith</span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.html"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Contravariant.html"><span class="hs-identifier">Data.Functor.Contravariant</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Contravariant.html#Predicate"><span class="hs-identifier">Predicate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Hashable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Hashable</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier">fromMaybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#isNothing"><span class="hs-identifier">isNothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.html"><span class="hs-identifier">Data.Typeable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier">Typeable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Block</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.BlockchainTime</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getSystemStart</span></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Config</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Config.SupportsNode</span></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Fragment.InFuture</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CheckInFuture</span></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>                     </span><span class="annot"><span class="hs-identifier">ClockSkew</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Fragment.InFuture</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">InFuture</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Ledger.Extended</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ExtLedgerState</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.MiniProtocol.ChainSync.Client.InFutureCheck</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">InFutureCheck</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToClient.html"><span class="hs-identifier">Ouroboros.Consensus.Network.NodeToClient</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NTC</span></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html"><span class="hs-identifier">Ouroboros.Consensus.Network.NodeToNode</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NTN</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.DbLock.html"><span class="hs-identifier">Ouroboros.Consensus.Node.DbLock</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.DbMarker.html"><span class="hs-identifier">Ouroboros.Consensus.Node.DbMarker</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.ErrorPolicy.html"><span class="hs-identifier">Ouroboros.Consensus.Node.ErrorPolicy</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.ExitPolicy.html"><span class="hs-identifier">Ouroboros.Consensus.Node.ExitPolicy</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Node.InitStorage</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Node.NetworkProtocolVersion</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Node.ProtocolInfo</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.Recovery.html"><span class="hs-identifier">Ouroboros.Consensus.Node.Recovery</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.RethrowPolicy.html"><span class="hs-identifier">Ouroboros.Consensus.Node.RethrowPolicy</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Node.Run</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.Tracers.html"><span class="hs-identifier">Ouroboros.Consensus.Node.Tracers</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html"><span class="hs-identifier">Ouroboros.Consensus.NodeKernel</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ChainDB</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ChainDbArgs</span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ChainDB</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Storage.ImmutableDB</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ChunkInfo</span></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>                     </span><span class="annot"><span class="hs-identifier">ValidationPolicy</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Storage.LedgerDB</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SnapshotInterval</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>                     </span><span class="annot"><span class="hs-identifier">defaultDiskPolicy</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Storage.VolatileDB</span></span><span>
</span><span id="line-99"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">BlockValidationPolicy</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Util.Args</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Util.IOLike</span></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Util.Orphans</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Util.ResourceRegistry</span></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Util.Time</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">secondsToNominalDiffTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.BlockFetch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">BlockFetchConfiguration</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Diffusion</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Diffusion</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Diffusion.NonP2P</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NonP2P</span></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Diffusion.P2P</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P2P</span></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Diffusion.Policies</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Diffusion</span></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Magic</span></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.NodeToClient</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ConnectionId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">LocalAddress</span></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>                     </span><span class="annot"><span class="hs-identifier">LocalSocket</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">NodeToClientVersionData</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">combineVersions</span></span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>                     </span><span class="annot"><span class="hs-identifier">simpleSingletonVersions</span></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.NodeToNode</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DiffusionMode</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>                     </span><span class="annot"><span class="hs-identifier">ExceptionInHandler</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MiniProtocolParameters</span></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>                     </span><span class="annot"><span class="hs-identifier">NodeToNodeVersionData</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">RemoteAddress</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Socket</span></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>                     </span><span class="annot"><span class="hs-identifier">blockFetchPipeliningMax</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">defaultMiniProtocolParameters</span></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.PeerSelection.LedgerPeers</span></span><span>
</span><span id="line-119"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LedgerPeersConsensusInterface</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.PeerSelection.PeerMetric</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PeerMetrics</span></span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>                     </span><span class="annot"><span class="hs-identifier">newPeerMetric</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">reportMetric</span></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.PeerSelection.PeerSharing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PeerSharing</span></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.PeerSelection.PeerSharing.Codec</span></span><span>
</span><span id="line-124"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">decodeRemoteAddress</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">encodeRemoteAddress</span></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Protocol.Limits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">shortWait</span></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Protocol.PeerSharing.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PeerSharingAmount</span></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.RethrowPolicy</span></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/System.Exit.html"><span class="hs-identifier">System.Exit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Exception.html#ExitCode"><span class="hs-identifier">ExitCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/template-haskell-2.20.0.0/src/System.FilePath.html"><span class="hs-identifier">System.FilePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/filepath-1.4.100.4/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator">(&lt;/&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.FS.API</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SomeHasFS</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.FS.API.Types</span></span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.FS.IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ioHasFS</span></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.Random</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">StdGen</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newStdGen</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">randomIO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">randomRIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  The arguments to the Consensus Layer node functionality
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-comment">-- How to add a new argument</span><span>
</span><span id="line-140"></span><span class="hs-comment">--</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- 1) As a Consensus Layer maintainer, use your judgement to determine whether</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- the new argument belongs in 'RunNodeArgs' or 'LowLevelArgs'. Give it the type</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- that seems most &quot; natural &quot;, future-proof, and useful for the whole range of</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- invocations: our tests, our own benchmarks, deployment on @mainnet@, etc. The</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- major litmus test is: it only belongs in 'RunNodeArgs' if /every/ invocation</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- of our node code must specify it.</span><span>
</span><span id="line-147"></span><span class="hs-comment">--</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- 2) If you add it to 'LowLevelArgs', you'll have type errors in</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- 'stdLowLevelRunNodeArgsIO'. To fix them, you'll need to either hard-code a</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- default value or else extend 'StdRunNodeArgs' with a new sufficient field.</span><span>
</span><span id="line-151"></span><span class="hs-comment">--</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- 3) When extending either 'RunNodeArgs' or 'StdRunNodeArgs', the</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- @cardano-node@ will have to be updated, so consider the Node Team's</span><span>
</span><span id="line-154"></span><span class="hs-comment">-- preferences when choosing the new field's type. As an oversimplification,</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- Consensus /owns/ 'RunNodeArgs' while Node /owns/ 'StdRunNodeArgs', but it's</span><span>
</span><span id="line-156"></span><span class="hs-comment">-- always worth spending some effort to try to find a type that satisfies both</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- teams.</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- | Arguments expected from any invocation of 'runWith', whether by deployed</span><span>
</span><span id="line-160"></span><span class="hs-comment">-- code, tests, etc.</span><span>
</span><span id="line-161"></span><span class="hs-keyword">data</span><span> </span><span id="RunNodeArgs"><span class="annot"><a href="Ouroboros.Consensus.Node.html#RunNodeArgs"><span class="hs-identifier hs-var">RunNodeArgs</span></a></span></span><span> </span><span id="local-6989586621679184644"><span class="annot"><a href="#local-6989586621679184644"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679184645"><span class="annot"><a href="#local-6989586621679184645"><span class="hs-identifier hs-type">addrNTN</span></a></span></span><span> </span><span id="local-6989586621679184646"><span class="annot"><a href="#local-6989586621679184646"><span class="hs-identifier hs-type">addrNTC</span></a></span></span><span> </span><span id="local-6989586621679184647"><span class="annot"><a href="#local-6989586621679184647"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679184648"><span class="annot"><a href="#local-6989586621679184648"><span class="hs-identifier hs-type">p2p</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.P2P</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RunNodeArgs"><span class="annot"><a href="Ouroboros.Consensus.Node.html#RunNodeArgs"><span class="hs-identifier hs-var">RunNodeArgs</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Consensus tracers</span></span><span>
</span><span id="line-163"></span><span>      </span><span id="rnTraceConsensus"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p
-&gt; Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
</span><a href="Ouroboros.Consensus.Node.html#rnTraceConsensus"><span class="hs-identifier hs-var hs-var">rnTraceConsensus</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Tracers.html#Tracers"><span class="hs-identifier hs-type">Tracers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184644"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679184645"><span class="hs-identifier hs-type">addrNTN</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679184646"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679184647"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Protocol tracers for node-to-node communication</span></span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnTraceNTN"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p
-&gt; Tracers m (ConnectionId addrNTN) blk DeserialiseFailure
</span><a href="Ouroboros.Consensus.Node.html#rnTraceNTN"><span class="hs-identifier hs-var hs-var">rnTraceNTN</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers"><span class="hs-identifier hs-type">NTN.Tracers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184644"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679184645"><span class="hs-identifier hs-type">addrNTN</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679184647"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeserialiseFailure</span></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Protocol tracers for node-to-client communication</span></span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnTraceNTC"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p
-&gt; Tracers m (ConnectionId addrNTC) blk DeserialiseFailure
</span><a href="Ouroboros.Consensus.Node.html#rnTraceNTC"><span class="hs-identifier hs-var hs-var">rnTraceNTC</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToClient.html#Tracers"><span class="hs-identifier hs-type">NTC.Tracers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184644"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679184646"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679184647"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeserialiseFailure</span></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Protocol info</span></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnProtocolInfo"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p -&gt; ProtocolInfo blk
</span><a href="Ouroboros.Consensus.Node.html#rnProtocolInfo"><span class="hs-identifier hs-var hs-var">rnProtocolInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProtocolInfo</span></span><span> </span><span class="annot"><a href="#local-6989586621679184647"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>      </span><span class="hs-comment">-- | Hook called after the initialisation of the 'NodeKernel'</span><span>
</span><span id="line-175"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-176"></span><span>      </span><span class="hs-comment">-- Called on the 'NodeKernel' after creating it, but before the network</span><span>
</span><span id="line-177"></span><span>      </span><span class="hs-comment">-- layer is initialised.</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnNodeKernelHook"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p
-&gt; ResourceRegistry m
-&gt; NodeKernel m addrNTN (ConnectionId addrNTC) blk
-&gt; m ()
</span><a href="Ouroboros.Consensus.Node.html#rnNodeKernelHook"><span class="hs-identifier hs-var hs-var">rnNodeKernelHook</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ResourceRegistry</span></span><span> </span><span class="annot"><a href="#local-6989586621679184644"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-179"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernel"><span class="hs-identifier hs-type">NodeKernel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184644"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184645"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679184646"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679184647"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-180"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679184644"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Network P2P Mode switch</span></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnEnableP2P"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p -&gt; NetworkP2PMode p2p
</span><a href="Ouroboros.Consensus.Node.html#rnEnableP2P"><span class="hs-identifier hs-var hs-var">rnEnableP2P</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#NetworkP2PMode"><span class="hs-identifier hs-type">NetworkP2PMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184648"><span class="hs-identifier hs-type">p2p</span></a></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Network PeerSharing miniprotocol willingness flag</span></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnPeerSharing"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p -&gt; PeerSharing
</span><a href="Ouroboros.Consensus.Node.html#rnPeerSharing"><span class="hs-identifier hs-var hs-var">rnPeerSharing</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerSharing</span></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">-- | Arguments that usually only tests /directly/ specify.</span><span>
</span><span id="line-190"></span><span class="hs-comment">--</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- A non-testing invocation probably wouldn't explicitly provide these values to</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- 'runWith'. The @cardano-node@, for example, instead calls the 'run'</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- abbreviation, which uses 'stdLowLevelRunNodeArgsIO' to indirectly specify</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- these low-level values from the higher-level 'StdRunNodeArgs'.</span><span>
</span><span id="line-195"></span><span class="hs-keyword">data</span><span> </span><span id="LowLevelRunNodeArgs"><span class="annot"><a href="Ouroboros.Consensus.Node.html#LowLevelRunNodeArgs"><span class="hs-identifier hs-var">LowLevelRunNodeArgs</span></a></span></span><span> </span><span id="local-6989586621679184695"><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679184696"><span class="annot"><a href="#local-6989586621679184696"><span class="hs-identifier hs-type">addrNTN</span></a></span></span><span> </span><span id="local-6989586621679184697"><span class="annot"><a href="#local-6989586621679184697"><span class="hs-identifier hs-type">addrNTC</span></a></span></span><span> </span><span id="local-6989586621679184698"><span class="annot"><a href="#local-6989586621679184698"><span class="hs-identifier hs-type">versionDataNTN</span></a></span></span><span> </span><span id="local-6989586621679184699"><span class="annot"><a href="#local-6989586621679184699"><span class="hs-identifier hs-type">versionDataNTC</span></a></span></span><span> </span><span id="local-6989586621679184700"><span class="annot"><a href="#local-6989586621679184700"><span class="hs-identifier hs-type">blk</span></a></span></span><span>
</span><span id="line-196"></span><span>                         </span><span class="hs-special">(</span><span id="local-6989586621679184701"><span class="annot"><a href="#local-6989586621679184701"><span class="hs-identifier hs-type">p2p</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.P2P</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-197"></span><span>   </span><span id="LowLevelRunNodeArgs"><span class="annot"><a href="Ouroboros.Consensus.Node.html#LowLevelRunNodeArgs"><span class="hs-identifier hs-var">LowLevelRunNodeArgs</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>      </span><span class="hs-comment">-- | An action that will receive a marker indicating whether the previous</span><span>
</span><span id="line-200"></span><span>      </span><span class="hs-comment">-- shutdown was considered clean and a wrapper for installing a handler to</span><span>
</span><span id="line-201"></span><span>      </span><span class="hs-comment">-- create a clean file on exit if needed. See</span><span>
</span><span id="line-202"></span><span>      </span><span class="hs-comment">-- 'Ouroboros.Consensus.Node.Recovery.runWithCheckedDB'.</span><span>
</span><span id="line-203"></span><span>      </span><span id="llrnWithCheckedDB"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; forall a.
   (LastShutDownWasClean -&gt; (ChainDB m blk -&gt; m a -&gt; m a) -&gt; m a)
   -&gt; m a
</span><a href="Ouroboros.Consensus.Node.html#llrnWithCheckedDB"><span class="hs-identifier hs-var hs-var">llrnWithCheckedDB</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679184705"><span class="annot"><a href="#local-6989586621679184705"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span>  </span><span class="annot"><a href="Ouroboros.Consensus.Node.Recovery.html#LastShutDownWasClean"><span class="hs-identifier hs-type">LastShutDownWasClean</span></a></span><span>
</span><span id="line-204"></span><span>                                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ChainDB</span></span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184700"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184705"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184705"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>                                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184705"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184705"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span>      </span><span class="annot"><span class="hs-comment">-- | The &quot; static &quot; ChainDB arguments</span></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="llrnChainDbArgsDefaults"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; ChainDbArgs Defaults m blk
</span><a href="Ouroboros.Consensus.Node.html#llrnChainDbArgsDefaults"><span class="hs-identifier hs-var hs-var">llrnChainDbArgsDefaults</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ChainDbArgs</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defaults</span></span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184700"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Customise the 'ChainDbArgs'</span></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="llrnCustomiseChainDbArgs"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; ChainDbArgs Identity m blk -&gt; ChainDbArgs Identity m blk
</span><a href="Ouroboros.Consensus.Node.html#llrnCustomiseChainDbArgs"><span class="hs-identifier hs-var hs-var">llrnCustomiseChainDbArgs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-213"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">ChainDbArgs</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Identity.html#Identity"><span class="hs-identifier hs-type">Identity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184700"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ChainDbArgs</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Identity.html#Identity"><span class="hs-identifier hs-type">Identity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184700"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Customise the 'NodeArgs'</span></span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="llrnCustomiseNodeKernelArgs"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="Ouroboros.Consensus.Node.html#llrnCustomiseNodeKernelArgs"><span class="hs-identifier hs-var hs-var">llrnCustomiseNodeKernelArgs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-218"></span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184696"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679184697"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679184700"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184696"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679184697"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679184700"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Ie 'bfcSalt'</span></span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="llrnBfcSalt"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; Int
</span><a href="Ouroboros.Consensus.Node.html#llrnBfcSalt"><span class="hs-identifier hs-var hs-var">llrnBfcSalt</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Ie 'keepAliveRng'</span></span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="llrnKeepAliveRng"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; StdGen
</span><a href="Ouroboros.Consensus.Node.html#llrnKeepAliveRng"><span class="hs-identifier hs-var hs-var">llrnKeepAliveRng</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Customise the 'HardForkBlockchainTimeArgs'</span></span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="llrnCustomiseHardForkBlockchainTimeArgs"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; HardForkBlockchainTimeArgs m blk
-&gt; HardForkBlockchainTimeArgs m blk
</span><a href="Ouroboros.Consensus.Node.html#llrnCustomiseHardForkBlockchainTimeArgs"><span class="hs-identifier hs-var hs-var">llrnCustomiseHardForkBlockchainTimeArgs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-229"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">HardForkBlockchainTimeArgs</span></span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184700"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-230"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HardForkBlockchainTimeArgs</span></span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184700"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>      </span><span class="annot"><span class="hs-comment">-- | See 'NTN.ChainSyncTimeout'</span></span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="llrnChainSyncTimeout"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; m ChainSyncTimeout
</span><a href="Ouroboros.Consensus.Node.html#llrnChainSyncTimeout"><span class="hs-identifier hs-var hs-var">llrnChainSyncTimeout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NTN.ChainSyncTimeout</span></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-comment">-- | How to run the data diffusion applications</span><span>
</span><span id="line-236"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-comment">-- 'run' will not return before this does.</span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="llrnRunDataDiffusion"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; ResourceRegistry m
-&gt; Applications
     addrNTN
     NodeToNodeVersion
     versionDataNTN
     addrNTC
     NodeToClientVersion
     versionDataNTC
     m
     NodeToNodeInitiatorResult
-&gt; ExtraApplications p2p addrNTN m NodeToNodeInitiatorResult
-&gt; m ()
</span><a href="Ouroboros.Consensus.Node.html#llrnRunDataDiffusion"><span class="hs-identifier hs-var hs-var">llrnRunDataDiffusion</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-239"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">ResourceRegistry</span></span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-240"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.Applications</span></span><span>
</span><span id="line-241"></span><span>             </span><span class="annot"><a href="#local-6989586621679184696"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeToNodeVersion</span></span><span>   </span><span class="annot"><a href="#local-6989586621679184698"><span class="hs-identifier hs-type">versionDataNTN</span></a></span><span>
</span><span id="line-242"></span><span>             </span><span class="annot"><a href="#local-6989586621679184697"><span class="hs-identifier hs-type">addrNTC</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeToClientVersion</span></span><span> </span><span class="annot"><a href="#local-6989586621679184699"><span class="hs-identifier hs-type">versionDataNTC</span></a></span><span>
</span><span id="line-243"></span><span>             </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.ExitPolicy.html#NodeToNodeInitiatorResult"><span class="hs-identifier hs-type">NodeToNodeInitiatorResult</span></a></span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.ExtraApplications</span></span><span> </span><span class="annot"><a href="#local-6989586621679184701"><span class="hs-identifier hs-type">p2p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184696"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.ExitPolicy.html#NodeToNodeInitiatorResult"><span class="hs-identifier hs-type">NodeToNodeInitiatorResult</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679184695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="llrnVersionDataNTC"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; versionDataNTC
</span><a href="Ouroboros.Consensus.Node.html#llrnVersionDataNTC"><span class="hs-identifier hs-var hs-var">llrnVersionDataNTC</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679184699"><span class="hs-identifier hs-type">versionDataNTC</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="llrnVersionDataNTN"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; versionDataNTN
</span><a href="Ouroboros.Consensus.Node.html#llrnVersionDataNTN"><span class="hs-identifier hs-var hs-var">llrnVersionDataNTN</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679184698"><span class="hs-identifier hs-type">versionDataNTN</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>      </span><span class="annot"><span class="hs-comment">-- | node-to-node protocol versions to run.</span></span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="llrnNodeToNodeVersions"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
</span><a href="Ouroboros.Consensus.Node.html#llrnNodeToNodeVersions"><span class="hs-identifier hs-var hs-var">llrnNodeToNodeVersions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeToNodeVersion</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></span><span> </span><span class="annot"><a href="#local-6989586621679184700"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>      </span><span class="annot"><span class="hs-comment">-- | node-to-client protocol versions to run.</span></span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="llrnNodeToClientVersions"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; Map NodeToClientVersion (BlockNodeToClientVersion blk)
</span><a href="Ouroboros.Consensus.Node.html#llrnNodeToClientVersions"><span class="hs-identifier hs-var hs-var">llrnNodeToClientVersions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeToClientVersion</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></span><span> </span><span class="annot"><a href="#local-6989586621679184700"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span>      </span><span class="annot"><span class="hs-comment">-- | Maximum clock skew</span></span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="llrnMaxClockSkew"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; ClockSkew
</span><a href="Ouroboros.Consensus.Node.html#llrnMaxClockSkew"><span class="hs-identifier hs-var hs-var">llrnMaxClockSkew</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClockSkew</span></span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Entrypoints to the Consensus Layer node functionality
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="hs-comment">-- | P2P Switch</span><span>
</span><span id="line-266"></span><span class="hs-comment">--</span><span>
</span><span id="line-267"></span><span class="hs-keyword">data</span><span> </span><span id="NetworkP2PMode"><span class="annot"><a href="Ouroboros.Consensus.Node.html#NetworkP2PMode"><span class="hs-identifier hs-var">NetworkP2PMode</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679185462"><span class="annot"><a href="#local-6989586621679185462"><span class="hs-identifier hs-type">p2p</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.P2P</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-268"></span><span>    </span><span id="EnabledP2PMode"><span class="annot"><a href="Ouroboros.Consensus.Node.html#EnabledP2PMode"><span class="hs-identifier hs-var">EnabledP2PMode</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#NetworkP2PMode"><span class="hs-identifier hs-type">NetworkP2PMode</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Diffusion.P2P</span></span><span>
</span><span id="line-269"></span><span>    </span><span id="DisabledP2PMode"><span class="annot"><a href="Ouroboros.Consensus.Node.html#DisabledP2PMode"><span class="hs-identifier hs-var">DisabledP2PMode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#NetworkP2PMode"><span class="hs-identifier hs-type">NetworkP2PMode</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Diffusion.NonP2P</span></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span id="local-6989586621679184823"><span id="local-6989586621679185466"><span id="local-6989586621679185468"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-type">Eq</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Node.html#NetworkP2PMode"><span class="hs-identifier hs-type">NetworkP2PMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184823"><span class="hs-identifier hs-type">p2p</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-272"></span><span id="local-6989586621679184826"><span id="local-6989586621679185473"><span id="local-6989586621679185475"><span id="local-6989586621679185479"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Node.html#NetworkP2PMode"><span class="hs-identifier hs-type">NetworkP2PMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184826"><span class="hs-identifier hs-type">p2p</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="annot"><span class="hs-comment">-- | Combination of 'runWith' and 'stdLowLevelRunArgsIO'</span></span><span>
</span><span id="line-276"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#run"><span class="hs-identifier hs-type">run</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679184827"><span class="annot"><a href="#local-6989586621679184827"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span id="local-6989586621679184831"><span class="annot"><a href="#local-6989586621679184831"><span class="hs-identifier hs-type">p2p</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-277"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">RunNode</span></span><span> </span><span class="annot"><a href="#local-6989586621679184827"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#RunNodeArgs"><span class="hs-identifier hs-type">RunNodeArgs</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RemoteAddress</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LocalAddress</span></span><span> </span><span class="annot"><a href="#local-6989586621679184827"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184831"><span class="hs-identifier hs-type">p2p</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#StdRunNodeArgs"><span class="hs-identifier hs-type">StdRunNodeArgs</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184827"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184831"><span class="hs-identifier hs-type">p2p</span></a></span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span id="run"><span class="annot"><span class="annottext">run :: forall blk (p2p :: P2P).
RunNode blk =&gt;
RunNodeArgs IO RemoteAddress LocalAddress blk p2p
-&gt; StdRunNodeArgs IO blk p2p -&gt; IO ()
</span><a href="Ouroboros.Consensus.Node.html#run"><span class="hs-identifier hs-var hs-var">run</span></a></span></span><span> </span><span id="local-6989586621679185505"><span class="annot"><span class="annottext">RunNodeArgs IO RemoteAddress LocalAddress blk p2p
</span><a href="#local-6989586621679185505"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621679185506"><span class="annot"><span class="annottext">StdRunNodeArgs IO blk p2p
</span><a href="#local-6989586621679185506"><span class="hs-identifier hs-var">stdArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RunNodeArgs IO RemoteAddress LocalAddress blk p2p
-&gt; StdRunNodeArgs IO blk p2p
-&gt; IO
     (LowLevelRunNodeArgs
        IO
        RemoteAddress
        LocalAddress
        NodeToNodeVersionData
        NodeToClientVersionData
        blk
        p2p)
forall blk (p2p :: P2P).
RunNode blk =&gt;
RunNodeArgs IO RemoteAddress LocalAddress blk p2p
-&gt; StdRunNodeArgs IO blk p2p
-&gt; IO
     (LowLevelRunNodeArgs
        IO
        RemoteAddress
        LocalAddress
        NodeToNodeVersionData
        NodeToClientVersionData
        blk
        p2p)
</span><a href="Ouroboros.Consensus.Node.html#stdLowLevelRunNodeArgsIO"><span class="hs-identifier hs-var">stdLowLevelRunNodeArgsIO</span></a></span><span> </span><span class="annot"><span class="annottext">RunNodeArgs IO RemoteAddress LocalAddress blk p2p
</span><a href="#local-6989586621679185505"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">StdRunNodeArgs IO blk p2p
</span><a href="#local-6989586621679185506"><span class="hs-identifier hs-var">stdArgs</span></a></span><span> </span><span class="annot"><span class="annottext">IO
  (LowLevelRunNodeArgs
     IO
     RemoteAddress
     LocalAddress
     NodeToNodeVersionData
     NodeToClientVersionData
     blk
     p2p)
-&gt; (LowLevelRunNodeArgs
      IO
      RemoteAddress
      LocalAddress
      NodeToNodeVersionData
      NodeToClientVersionData
      blk
      p2p
    -&gt; IO ())
-&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">RunNodeArgs IO RemoteAddress LocalAddress blk p2p
-&gt; (NodeToNodeVersion -&gt; RemoteAddress -&gt; Encoding)
-&gt; (NodeToNodeVersion -&gt; forall s. Decoder s RemoteAddress)
-&gt; LowLevelRunNodeArgs
     IO
     RemoteAddress
     LocalAddress
     NodeToNodeVersionData
     NodeToClientVersionData
     blk
     p2p
-&gt; IO ()
forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
(RunNode blk, IOLike m, Hashable addrNTN, NetworkIO m,
 NetworkAddr addrNTN) =&gt;
RunNodeArgs m addrNTN addrNTC blk p2p
-&gt; (NodeToNodeVersion -&gt; addrNTN -&gt; Encoding)
-&gt; (NodeToNodeVersion -&gt; forall s. Decoder s addrNTN)
-&gt; LowLevelRunNodeArgs
     m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; m ()
</span><a href="Ouroboros.Consensus.Node.html#runWith"><span class="hs-identifier hs-var">runWith</span></a></span><span> </span><span class="annot"><span class="annottext">RunNodeArgs IO RemoteAddress LocalAddress blk p2p
</span><a href="#local-6989586621679185505"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; RemoteAddress -&gt; Encoding
</span><span class="hs-identifier hs-var">encodeRemoteAddress</span></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; Decoder s RemoteAddress
NodeToNodeVersion -&gt; forall s. Decoder s RemoteAddress
forall s. NodeToNodeVersion -&gt; Decoder s RemoteAddress
</span><span class="hs-identifier hs-var">decodeRemoteAddress</span></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="hs-comment">-- | Extra constraints used by `ouroboros-network`.</span><span>
</span><span id="line-285"></span><span class="hs-comment">--</span><span>
</span><span id="line-286"></span><span class="hs-keyword">type</span><span> </span><span id="NetworkIO"><span class="annot"><a href="Ouroboros.Consensus.Node.html#NetworkIO"><span class="hs-identifier hs-var">NetworkIO</span></a></span></span><span> </span><span id="local-6989586621679185507"><span class="annot"><a href="#local-6989586621679185507"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-287"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadTime</span></span><span> </span><span class="annot"><a href="#local-6989586621679185507"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-288"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679185507"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-289"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadLabelledSTM</span></span><span> </span><span class="annot"><a href="#local-6989586621679185507"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-290"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="annot"><span class="hs-comment">-- | Extra constraints used by `ouroboros-network`.</span></span><span>
</span><span id="line-293"></span><span class="hs-keyword">type</span><span> </span><span id="NetworkAddr"><span class="annot"><a href="Ouroboros.Consensus.Node.html#NetworkAddr"><span class="hs-identifier hs-var">NetworkAddr</span></a></span></span><span> </span><span id="local-6989586621679185508"><span class="annot"><a href="#local-6989586621679185508"><span class="hs-identifier hs-type">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-294"></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185508"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-295"></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185508"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-296"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">NoThunks</span></span><span> </span><span class="annot"><a href="#local-6989586621679185508"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-297"></span><span>      </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/deepseq-1.4.8.1/src/Control.DeepSeq.html#NFData"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185508"><span class="hs-identifier hs-type">addr</span></a></span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="hs-comment">-- | Start a node.</span><span>
</span><span id="line-301"></span><span class="hs-comment">--</span><span>
</span><span id="line-302"></span><span class="hs-comment">-- This opens the 'ChainDB', sets up the 'NodeKernel' and initialises the</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- network layer.</span><span>
</span><span id="line-304"></span><span class="hs-comment">--</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- This function runs forever unless an exception is thrown.</span><span>
</span><span id="line-306"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#runWith"><span class="hs-identifier hs-type">runWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679184857"><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679184858"><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span></span><span> </span><span id="local-6989586621679184861"><span class="annot"><a href="#local-6989586621679184861"><span class="hs-identifier hs-type">addrNTC</span></a></span></span><span> </span><span id="local-6989586621679184863"><span class="annot"><a href="#local-6989586621679184863"><span class="hs-identifier hs-type">versionDataNTN</span></a></span></span><span> </span><span id="local-6989586621679184864"><span class="annot"><a href="#local-6989586621679184864"><span class="hs-identifier hs-type">versionDataNTC</span></a></span></span><span> </span><span id="local-6989586621679184856"><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span id="local-6989586621679184862"><span class="annot"><a href="#local-6989586621679184862"><span class="hs-identifier hs-type">p2p</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-307"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RunNode</span></span><span> </span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-308"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IOLike</span></span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-309"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-comment">-- the constraint comes from `initNodeKernel`</span><span>
</span><span id="line-310"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#NetworkIO"><span class="hs-identifier hs-type">NetworkIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-311"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#NetworkAddr"><span class="hs-identifier hs-type">NetworkAddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span>
</span><span id="line-312"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#RunNodeArgs"><span class="hs-identifier hs-type">RunNodeArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184861"><span class="hs-identifier hs-type">addrNTC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184862"><span class="hs-identifier hs-type">p2p</span></a></span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NodeToNodeVersion</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Encoding</span></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NodeToNodeVersion</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679184854"><span class="annot"><a href="#local-6989586621679184854"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679184854"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#LowLevelRunNodeArgs"><span class="hs-identifier hs-type">LowLevelRunNodeArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184861"><span class="hs-identifier hs-type">addrNTC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184863"><span class="hs-identifier hs-type">versionDataNTN</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184864"><span class="hs-identifier hs-type">versionDataNTC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184862"><span class="hs-identifier hs-type">p2p</span></a></span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span id="runWith"><span class="annot"><span class="annottext">runWith :: forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
(RunNode blk, IOLike m, Hashable addrNTN, NetworkIO m,
 NetworkAddr addrNTN) =&gt;
RunNodeArgs m addrNTN addrNTC blk p2p
-&gt; (NodeToNodeVersion -&gt; addrNTN -&gt; Encoding)
-&gt; (NodeToNodeVersion -&gt; forall s. Decoder s addrNTN)
-&gt; LowLevelRunNodeArgs
     m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; m ()
</span><a href="Ouroboros.Consensus.Node.html#runWith"><span class="hs-identifier hs-var hs-var">runWith</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#RunNodeArgs"><span class="hs-identifier hs-type">RunNodeArgs</span></a></span><span class="hs-special">{</span><span id="local-6989586621679185734"><span id="local-6989586621679185735"><span id="local-6989586621679185736"><span id="local-6989586621679185737"><span id="local-6989586621679185738"><span id="local-6989586621679185739"><span id="local-6989586621679185740"><span class="annot"><span class="annottext">PeerSharing
Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
Tracers m (ConnectionId addrNTN) blk DeserialiseFailure
Tracers m (ConnectionId addrNTC) blk DeserialiseFailure
ProtocolInfo blk
NetworkP2PMode p2p
ResourceRegistry m
-&gt; NodeKernel m addrNTN (ConnectionId addrNTC) blk -&gt; m ()
rnTraceConsensus :: forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p
-&gt; Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
rnTraceNTN :: forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p
-&gt; Tracers m (ConnectionId addrNTN) blk DeserialiseFailure
rnTraceNTC :: forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p
-&gt; Tracers m (ConnectionId addrNTC) blk DeserialiseFailure
rnProtocolInfo :: forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p -&gt; ProtocolInfo blk
rnNodeKernelHook :: forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p
-&gt; ResourceRegistry m
-&gt; NodeKernel m addrNTN (ConnectionId addrNTC) blk
-&gt; m ()
rnEnableP2P :: forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p -&gt; NetworkP2PMode p2p
rnPeerSharing :: forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p -&gt; PeerSharing
rnTraceConsensus :: Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
rnTraceNTN :: Tracers m (ConnectionId addrNTN) blk DeserialiseFailure
rnTraceNTC :: Tracers m (ConnectionId addrNTC) blk DeserialiseFailure
rnProtocolInfo :: ProtocolInfo blk
rnNodeKernelHook :: ResourceRegistry m
-&gt; NodeKernel m addrNTN (ConnectionId addrNTC) blk -&gt; m ()
rnEnableP2P :: NetworkP2PMode p2p
rnPeerSharing :: PeerSharing
</span><a href="Ouroboros.Consensus.Node.html#rnTraceConsensus"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679185741"><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; addrNTN -&gt; Encoding
</span><a href="#local-6989586621679185741"><span class="hs-identifier hs-var">encAddrNtN</span></a></span></span><span> </span><span id="local-6989586621679185742"><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; forall s. Decoder s addrNTN
</span><a href="#local-6989586621679185742"><span class="hs-identifier hs-var">decAddrNtN</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#LowLevelRunNodeArgs"><span class="hs-identifier hs-type">LowLevelRunNodeArgs</span></a></span><span class="hs-special">{</span><span id="local-6989586621679185743"><span id="local-6989586621679185744"><span id="local-6989586621679185745"><span id="local-6989586621679185746"><span id="local-6989586621679185747"><span id="local-6989586621679185748"><span id="local-6989586621679185749"><span id="local-6989586621679185750"><span id="local-6989586621679185751"><span id="local-6989586621679185752"><span id="local-6989586621679185753"><span id="local-6989586621679185754"><span id="local-6989586621679185755"><span id="local-6989586621679185756"><span class="annot"><span class="annottext">versionDataNTN
versionDataNTC
m ChainSyncTimeout
Int
Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
Map NodeToClientVersion (BlockNodeToClientVersion blk)
StdGen
ChainDbArgs Defaults m blk
ClockSkew
HardForkBlockchainTimeArgs m blk
-&gt; HardForkBlockchainTimeArgs m blk
ResourceRegistry m
-&gt; Applications
     addrNTN
     NodeToNodeVersion
     versionDataNTN
     addrNTC
     NodeToClientVersion
     versionDataNTC
     m
     NodeToNodeInitiatorResult
-&gt; ExtraApplications p2p addrNTN m NodeToNodeInitiatorResult
-&gt; m ()
ChainDbArgs Identity m blk -&gt; ChainDbArgs Identity m blk
NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
forall a.
(LastShutDownWasClean -&gt; (ChainDB m blk -&gt; m a -&gt; m a) -&gt; m a)
-&gt; m a
llrnWithCheckedDB :: forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; forall a.
   (LastShutDownWasClean -&gt; (ChainDB m blk -&gt; m a -&gt; m a) -&gt; m a)
   -&gt; m a
llrnChainDbArgsDefaults :: forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; ChainDbArgs Defaults m blk
llrnCustomiseChainDbArgs :: forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; ChainDbArgs Identity m blk -&gt; ChainDbArgs Identity m blk
llrnCustomiseNodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
llrnBfcSalt :: forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; Int
llrnKeepAliveRng :: forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; StdGen
llrnCustomiseHardForkBlockchainTimeArgs :: forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; HardForkBlockchainTimeArgs m blk
-&gt; HardForkBlockchainTimeArgs m blk
llrnChainSyncTimeout :: forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; m ChainSyncTimeout
llrnRunDataDiffusion :: forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; ResourceRegistry m
-&gt; Applications
     addrNTN
     NodeToNodeVersion
     versionDataNTN
     addrNTC
     NodeToClientVersion
     versionDataNTC
     m
     NodeToNodeInitiatorResult
-&gt; ExtraApplications p2p addrNTN m NodeToNodeInitiatorResult
-&gt; m ()
llrnVersionDataNTC :: forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; versionDataNTC
llrnVersionDataNTN :: forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; versionDataNTN
llrnNodeToNodeVersions :: forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
llrnNodeToClientVersions :: forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; Map NodeToClientVersion (BlockNodeToClientVersion blk)
llrnMaxClockSkew :: forall (m :: * -&gt; *) addrNTN addrNTC versionDataNTN versionDataNTC
       blk (p2p :: P2P).
LowLevelRunNodeArgs
  m addrNTN addrNTC versionDataNTN versionDataNTC blk p2p
-&gt; ClockSkew
llrnWithCheckedDB :: forall a.
(LastShutDownWasClean -&gt; (ChainDB m blk -&gt; m a -&gt; m a) -&gt; m a)
-&gt; m a
llrnChainDbArgsDefaults :: ChainDbArgs Defaults m blk
llrnCustomiseChainDbArgs :: ChainDbArgs Identity m blk -&gt; ChainDbArgs Identity m blk
llrnCustomiseNodeKernelArgs :: NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
llrnBfcSalt :: Int
llrnKeepAliveRng :: StdGen
llrnCustomiseHardForkBlockchainTimeArgs :: HardForkBlockchainTimeArgs m blk
-&gt; HardForkBlockchainTimeArgs m blk
llrnChainSyncTimeout :: m ChainSyncTimeout
llrnRunDataDiffusion :: ResourceRegistry m
-&gt; Applications
     addrNTN
     NodeToNodeVersion
     versionDataNTN
     addrNTC
     NodeToClientVersion
     versionDataNTC
     m
     NodeToNodeInitiatorResult
-&gt; ExtraApplications p2p addrNTN m NodeToNodeInitiatorResult
-&gt; m ()
llrnVersionDataNTC :: versionDataNTC
llrnVersionDataNTN :: versionDataNTN
llrnNodeToNodeVersions :: Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
llrnNodeToClientVersions :: Map NodeToClientVersion (BlockNodeToClientVersion blk)
llrnMaxClockSkew :: ClockSkew
</span><a href="Ouroboros.Consensus.Node.html#llrnWithCheckedDB"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><span class="annottext">(LastShutDownWasClean -&gt; (ChainDB m blk -&gt; m () -&gt; m ()) -&gt; m ())
-&gt; m ()
forall a.
(LastShutDownWasClean -&gt; (ChainDB m blk -&gt; m a -&gt; m a) -&gt; m a)
-&gt; m a
</span><a href="#local-6989586621679185743"><span class="hs-identifier hs-var">llrnWithCheckedDB</span></a></span><span> </span><span class="annot"><span class="annottext">((LastShutDownWasClean -&gt; (ChainDB m blk -&gt; m () -&gt; m ()) -&gt; m ())
 -&gt; m ())
-&gt; (LastShutDownWasClean
    -&gt; (ChainDB m blk -&gt; m () -&gt; m ()) -&gt; m ())
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Node.Recovery.html#LastShutDownWasClean"><span class="hs-identifier hs-type">LastShutDownWasClean</span></a></span><span> </span><span id="local-6989586621679185758"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679185758"><span class="hs-identifier hs-var">lastShutDownWasClean</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679185759"><span class="annot"><span class="annottext">ChainDB m blk -&gt; m () -&gt; m ()
</span><a href="#local-6989586621679185759"><span class="hs-identifier hs-var">continueWithCleanChainDB</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-321"></span><span>    </span><span class="annot"><span class="annottext">(ResourceRegistry m -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) a.
(IOLike m, HasCallStack) =&gt;
(ResourceRegistry m -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">withRegistry</span></span><span> </span><span class="annot"><span class="annottext">((ResourceRegistry m -&gt; m ()) -&gt; m ())
-&gt; (ResourceRegistry m -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679185761"><span class="annot"><span class="annottext">ResourceRegistry m
</span><a href="#local-6989586621679185761"><span class="hs-identifier hs-var">registry</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-322"></span><span>      </span><span class="annot"><span class="annottext">(SomeException -&gt; Maybe SomeException)
-&gt; (SomeException -&gt; m ()) -&gt; m () -&gt; m ()
forall e b a.
Exception e =&gt;
(e -&gt; Maybe b) -&gt; (b -&gt; m a) -&gt; m a -&gt; m a
forall (m :: * -&gt; *) e b a.
(MonadCatch m, Exception e) =&gt;
(e -&gt; Maybe b) -&gt; (b -&gt; m a) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">handleJust</span></span><span>
</span><span id="line-323"></span><span>             </span><span class="hs-comment">-- Ignore exception thrown in connection handlers and diffusion.</span><span>
</span><span id="line-324"></span><span>             </span><span class="hs-comment">-- Also ignore 'ExitSuccess'.</span><span>
</span><span id="line-325"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Predicate SomeException -&gt; SomeException -&gt; Maybe SomeException
forall a. Predicate a -&gt; a -&gt; Maybe a
</span><a href="#local-6989586621679185763"><span class="hs-identifier hs-var">runPredicate</span></a></span><span> </span><span class="annot"><span class="annottext">(Predicate SomeException -&gt; SomeException -&gt; Maybe SomeException)
-&gt; Predicate SomeException -&gt; SomeException -&gt; Maybe SomeException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-326"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SomeException -&gt; Bool) -&gt; Predicate SomeException
forall a. (a -&gt; Bool) -&gt; Predicate a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Contravariant.html#Predicate"><span class="hs-identifier hs-var">Predicate</span></a></span><span> </span><span class="annot"><span class="annottext">((SomeException -&gt; Bool) -&gt; Predicate SomeException)
-&gt; (SomeException -&gt; Bool) -&gt; Predicate SomeException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679185765"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679185765"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-327"></span><span>                     </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var">fromException</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">ExceptionInLinkedThread</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679185765"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-328"></span><span>                       </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ExceptionInLinkedThread</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679185768"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679185768"><span class="hs-identifier hs-var">err'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (ExitCode -&gt; Bool) -&gt; Maybe ExitCode -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExitCode -&gt; ExitCode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Exception.html#ExitSuccess"><span class="hs-identifier hs-var">ExitSuccess</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe ExitCode -&gt; Bool) -&gt; Maybe ExitCode -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe ExitCode
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var">fromException</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679185768"><span class="hs-identifier hs-var">err'</span></a></span><span>
</span><span id="line-330"></span><span>                       </span><span class="annot"><span class="annottext">Maybe ExceptionInLinkedThread
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>                </span><span class="annot"><span class="annottext">Predicate SomeException
-&gt; Predicate SomeException -&gt; Predicate SomeException
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SomeException -&gt; Bool) -&gt; Predicate SomeException
forall a. (a -&gt; Bool) -&gt; Predicate a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Contravariant.html#Predicate"><span class="hs-identifier hs-var">Predicate</span></a></span><span> </span><span class="annot"><span class="annottext">((SomeException -&gt; Bool) -&gt; Predicate SomeException)
-&gt; (SomeException -&gt; Bool) -&gt; Predicate SomeException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679185772"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679185772"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-332"></span><span>                     </span><span class="annot"><span class="annottext">Maybe ExceptionInHandler -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var">fromException</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">ExceptionInHandler</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679185772"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>                </span><span class="annot"><span class="annottext">Predicate SomeException
-&gt; Predicate SomeException -&gt; Predicate SomeException
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SomeException -&gt; Bool) -&gt; Predicate SomeException
forall a. (a -&gt; Bool) -&gt; Predicate a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Contravariant.html#Predicate"><span class="hs-identifier hs-var">Predicate</span></a></span><span> </span><span class="annot"><span class="annottext">((SomeException -&gt; Bool) -&gt; Predicate SomeException)
-&gt; (SomeException -&gt; Bool) -&gt; Predicate SomeException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679185773"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679185773"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-334"></span><span>                     </span><span class="annot"><span class="annottext">Maybe Failure -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var">fromException</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Diffusion.Failure</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679185773"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>              </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679185774"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679185774"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tracer m SomeException -&gt; SomeException -&gt; m ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">traceWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
-&gt; Tracer m SomeException
forall remotePeer localPeer blk (f :: * -&gt; *).
Tracers' remotePeer localPeer blk f -&gt; f SomeException
</span><a href="Ouroboros.Consensus.Node.Tracers.html#consensusErrorTracer"><span class="hs-identifier hs-var">consensusErrorTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185734"><span class="hs-identifier hs-var">rnTraceConsensus</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679185774"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-337"></span><span>                    </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall a b. m a -&gt; m b -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; m ()
forall e a. Exception e =&gt; e -&gt; m a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679185774"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-338"></span><span>              </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-339"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679185777"><span class="hs-identifier hs-type">systemStart</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SystemStart</span></span><span>
</span><span id="line-340"></span><span>            </span><span id="local-6989586621679185777"><span class="annot"><span class="annottext">systemStart :: SystemStart
</span><a href="#local-6989586621679185777"><span class="hs-identifier hs-var hs-var">systemStart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockConfig blk -&gt; SystemStart
forall blk.
ConfigSupportsNode blk =&gt;
BlockConfig blk -&gt; SystemStart
</span><span class="hs-identifier hs-var">getSystemStart</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; BlockConfig blk
forall blk. TopLevelConfig blk -&gt; BlockConfig blk
</span><span class="hs-identifier hs-var">configBlock</span></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679185780"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span>            </span><span class="annot"><a href="#local-6989586621679185781"><span class="hs-identifier hs-type">systemTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SystemTime</span></span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-343"></span><span>            </span><span id="local-6989586621679185781"><span class="annot"><span class="annottext">systemTime :: SystemTime m
</span><a href="#local-6989586621679185781"><span class="hs-identifier hs-var hs-var">systemTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SystemStart
-&gt; Tracer m (TraceBlockchainTimeEvent UTCTime) -&gt; SystemTime m
forall (m :: * -&gt; *).
(MonadTime m, MonadDelay m) =&gt;
SystemStart
-&gt; Tracer m (TraceBlockchainTimeEvent UTCTime) -&gt; SystemTime m
</span><span class="hs-identifier hs-var">defaultSystemTime</span></span><span>
</span><span id="line-344"></span><span>                           </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621679185777"><span class="hs-identifier hs-var">systemStart</span></a></span><span>
</span><span id="line-345"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
-&gt; Tracer m (TraceBlockchainTimeEvent UTCTime)
forall remotePeer localPeer blk (f :: * -&gt; *).
Tracers' remotePeer localPeer blk f
-&gt; f (TraceBlockchainTimeEvent UTCTime)
</span><a href="Ouroboros.Consensus.Node.Tracers.html#blockchainTimeTracer"><span class="hs-identifier hs-var">blockchainTimeTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185734"><span class="hs-identifier hs-var">rnTraceConsensus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>            </span><span class="annot"><a href="#local-6989586621679185784"><span class="hs-identifier hs-type">inFuture</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CheckInFuture</span></span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-348"></span><span>            </span><span id="local-6989586621679185784"><span class="annot"><span class="annottext">inFuture :: CheckInFuture m blk
</span><a href="#local-6989586621679185784"><span class="hs-identifier hs-var hs-var">inFuture</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerConfig blk
-&gt; ClockSkew -&gt; SystemTime m -&gt; CheckInFuture m blk
forall (m :: * -&gt; *) blk.
(Monad m, UpdateLedger blk, HasHardForkHistory blk) =&gt;
LedgerConfig blk
-&gt; ClockSkew -&gt; SystemTime m -&gt; CheckInFuture m blk
</span><span class="hs-identifier hs-var">InFuture.reference</span></span><span>
</span><span id="line-349"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; LedgerConfig blk
forall blk. TopLevelConfig blk -&gt; LedgerConfig blk
</span><span class="hs-identifier hs-var">configLedger</span></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679185780"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>                         </span><span class="annot"><span class="annottext">ClockSkew
</span><a href="#local-6989586621679185756"><span class="hs-identifier hs-var">llrnMaxClockSkew</span></a></span><span>
</span><span id="line-351"></span><span>                         </span><span class="annot"><span class="annottext">SystemTime m
</span><a href="#local-6989586621679185781"><span class="hs-identifier hs-var">systemTime</span></a></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679185787"><span class="annot"><span class="annottext">customiseChainDbArgs' :: ChainDbArgs Identity m blk -&gt; ChainDbArgs Identity m blk
</span><a href="#local-6989586621679185787"><span class="hs-identifier hs-var hs-var">customiseChainDbArgs'</span></a></span></span><span> </span><span id="local-6989586621679185788"><span class="annot"><span class="annottext">ChainDbArgs Identity m blk
</span><a href="#local-6989586621679185788"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-354"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679185758"><span class="hs-identifier hs-var">lastShutDownWasClean</span></a></span><span>
</span><span id="line-355"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity m blk -&gt; ChainDbArgs Identity m blk
</span><a href="#local-6989586621679185745"><span class="hs-identifier hs-var">llrnCustomiseChainDbArgs</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity m blk
</span><a href="#local-6989586621679185788"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-356"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-357"></span><span>                </span><span class="hs-comment">-- When the last shutdown was not clean, validate the complete</span><span>
</span><span id="line-358"></span><span>                </span><span class="hs-comment">-- ChainDB to detect and recover from any corruptions. This will</span><span>
</span><span id="line-359"></span><span>                </span><span class="hs-comment">-- override the default value /and/ the user-customised value of</span><span>
</span><span id="line-360"></span><span>                </span><span class="hs-comment">-- the 'ChainDB.cdbImmValidation' and the</span><span>
</span><span id="line-361"></span><span>                </span><span class="hs-comment">-- 'ChainDB.cdbVolValidation' fields.</span><span>
</span><span id="line-362"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainDbArgs Identity m blk -&gt; ChainDbArgs Identity m blk
</span><a href="#local-6989586621679185745"><span class="hs-identifier hs-var">llrnCustomiseChainDbArgs</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity m blk
</span><a href="#local-6989586621679185788"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-363"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-var">ChainDB.cdbImmutableDbValidation</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ValidateAllChunks</span></span><span>
</span><span id="line-364"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">ChainDB.cdbVolatileDbValidation</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ValidateAll</span></span><span>
</span><span id="line-365"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>        </span><span id="local-6989586621679185793"><span class="annot"><span class="annottext">ChainDB m blk
</span><a href="#local-6989586621679185793"><span class="hs-identifier hs-var">chainDB</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ResourceRegistry m
-&gt; CheckInFuture m blk
-&gt; TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; ChainDbArgs Defaults m blk
-&gt; (ChainDbArgs Identity m blk -&gt; ChainDbArgs Identity m blk)
-&gt; m (ChainDB m blk)
forall (m :: * -&gt; *) blk.
(RunNode blk, IOLike m) =&gt;
ResourceRegistry m
-&gt; CheckInFuture m blk
-&gt; TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; ChainDbArgs Defaults m blk
-&gt; (ChainDbArgs Identity m blk -&gt; ChainDbArgs Identity m blk)
-&gt; m (ChainDB m blk)
</span><a href="Ouroboros.Consensus.Node.html#openChainDB"><span class="hs-identifier hs-var">openChainDB</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRegistry m
</span><a href="#local-6989586621679185761"><span class="hs-identifier hs-var">registry</span></a></span><span> </span><span class="annot"><span class="annottext">CheckInFuture m blk
</span><a href="#local-6989586621679185784"><span class="hs-identifier hs-var">inFuture</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679185780"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621679185794"><span class="hs-identifier hs-var">initLedger</span></a></span><span>
</span><span id="line-368"></span><span>                  </span><span class="annot"><span class="annottext">ChainDbArgs Defaults m blk
</span><a href="#local-6989586621679185744"><span class="hs-identifier hs-var">llrnChainDbArgsDefaults</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity m blk -&gt; ChainDbArgs Identity m blk
</span><a href="#local-6989586621679185787"><span class="hs-identifier hs-var">customiseChainDbArgs'</span></a></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>        </span><span class="annot"><span class="annottext">ChainDB m blk -&gt; m () -&gt; m ()
</span><a href="#local-6989586621679185759"><span class="hs-identifier hs-var">continueWithCleanChainDB</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDB m blk
</span><a href="#local-6989586621679185793"><span class="hs-identifier hs-var">chainDB</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-371"></span><span>          </span><span id="local-6989586621679185795"><span class="annot"><span class="annottext">BlockchainTime m
</span><a href="#local-6989586621679185795"><span class="hs-identifier hs-var">btime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-372"></span><span>            </span><span class="annot"><span class="annottext">HardForkBlockchainTimeArgs m blk -&gt; m (BlockchainTime m)
forall (m :: * -&gt; *) blk.
(IOLike m, HasHardForkHistory blk, HasCallStack) =&gt;
HardForkBlockchainTimeArgs m blk -&gt; m (BlockchainTime m)
</span><span class="hs-identifier hs-var">hardForkBlockchainTime</span></span><span> </span><span class="annot"><span class="annottext">(HardForkBlockchainTimeArgs m blk -&gt; m (BlockchainTime m))
-&gt; HardForkBlockchainTimeArgs m blk -&gt; m (BlockchainTime m)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-373"></span><span>            </span><span class="annot"><span class="annottext">HardForkBlockchainTimeArgs m blk
-&gt; HardForkBlockchainTimeArgs m blk
</span><a href="#local-6989586621679185749"><span class="hs-identifier hs-var">llrnCustomiseHardForkBlockchainTimeArgs</span></a></span><span> </span><span class="annot"><span class="annottext">(HardForkBlockchainTimeArgs m blk
 -&gt; HardForkBlockchainTimeArgs m blk)
-&gt; HardForkBlockchainTimeArgs m blk
-&gt; HardForkBlockchainTimeArgs m blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-374"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">HardForkBlockchainTimeArgs</span></span><span>
</span><span id="line-375"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hfbtBackoffDelay :: m BackoffDelay
</span><span class="hs-identifier hs-var">hfbtBackoffDelay</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackoffDelay -&gt; m BackoffDelay
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(BackoffDelay -&gt; m BackoffDelay) -&gt; BackoffDelay -&gt; m BackoffDelay
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; BackoffDelay
</span><span class="hs-identifier hs-var">BackoffDelay</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">60</span></span><span>
</span><span id="line-376"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hfbtGetLedgerState :: STM m (LedgerState blk)
</span><span class="hs-identifier hs-var">hfbtGetLedgerState</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-377"></span><span>                  </span><span class="annot"><span class="annottext">ExtLedgerState blk -&gt; LedgerState blk
forall blk. ExtLedgerState blk -&gt; LedgerState blk
</span><span class="hs-identifier hs-var">ledgerState</span></span><span> </span><span class="annot"><span class="annottext">(ExtLedgerState blk -&gt; LedgerState blk)
-&gt; STM m (ExtLedgerState blk) -&gt; STM m (LedgerState blk)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDB m blk -&gt; STM m (ExtLedgerState blk)
forall (m :: * -&gt; *) blk.
(Monad (STM m), IsLedger (LedgerState blk)) =&gt;
ChainDB m blk -&gt; STM m (ExtLedgerState blk)
</span><span class="hs-identifier hs-var">ChainDB.getCurrentLedger</span></span><span> </span><span class="annot"><span class="annottext">ChainDB m blk
</span><a href="#local-6989586621679185793"><span class="hs-identifier hs-var">chainDB</span></a></span><span>
</span><span id="line-378"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hfbtLedgerConfig :: LedgerConfig blk
</span><span class="hs-identifier hs-var">hfbtLedgerConfig</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; LedgerConfig blk
forall blk. TopLevelConfig blk -&gt; LedgerConfig blk
</span><span class="hs-identifier hs-var">configLedger</span></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679185780"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-379"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hfbtRegistry :: ResourceRegistry m
</span><span class="hs-identifier hs-var">hfbtRegistry</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResourceRegistry m
</span><a href="#local-6989586621679185761"><span class="hs-identifier hs-var">registry</span></a></span><span>
</span><span id="line-380"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hfbtSystemTime :: SystemTime m
</span><span class="hs-identifier hs-var">hfbtSystemTime</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SystemTime m
</span><a href="#local-6989586621679185781"><span class="hs-identifier hs-var">systemTime</span></a></span><span>
</span><span id="line-381"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hfbtTracer :: Tracer m (TraceBlockchainTimeEvent RelativeTime)
</span><span class="hs-identifier hs-var">hfbtTracer</span></span><span>         </span><span class="hs-glyph">=</span><span>
</span><span id="line-382"></span><span>                  </span><span class="annot"><span class="annottext">(TraceBlockchainTimeEvent RelativeTime
 -&gt; TraceBlockchainTimeEvent UTCTime)
-&gt; Tracer m (TraceBlockchainTimeEvent UTCTime)
-&gt; Tracer m (TraceBlockchainTimeEvent RelativeTime)
forall a' a. (a' -&gt; a) -&gt; Tracer m a -&gt; Tracer m a'
forall (f :: * -&gt; *) a' a.
Contravariant f =&gt;
(a' -&gt; a) -&gt; f a -&gt; f a'
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Contravariant.html#contramap"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RelativeTime -&gt; UTCTime)
-&gt; TraceBlockchainTimeEvent RelativeTime
-&gt; TraceBlockchainTimeEvent UTCTime
forall a b.
(a -&gt; b)
-&gt; TraceBlockchainTimeEvent a -&gt; TraceBlockchainTimeEvent b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SystemStart -&gt; RelativeTime -&gt; UTCTime
</span><span class="hs-identifier hs-var">fromRelativeTime</span></span><span> </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621679185777"><span class="hs-identifier hs-var">systemStart</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
-&gt; Tracer m (TraceBlockchainTimeEvent UTCTime)
forall remotePeer localPeer blk (f :: * -&gt; *).
Tracers' remotePeer localPeer blk f
-&gt; f (TraceBlockchainTimeEvent UTCTime)
</span><a href="Ouroboros.Consensus.Node.Tracers.html#blockchainTimeTracer"><span class="hs-identifier hs-var">blockchainTimeTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185734"><span class="hs-identifier hs-var">rnTraceConsensus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hfbtMaxClockRewind :: NominalDiffTime
</span><span class="hs-identifier hs-var">hfbtMaxClockRewind</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; NominalDiffTime
</span><span class="hs-identifier hs-var">secondsToNominalDiffTime</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">20</span></span><span>
</span><span id="line-385"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span>          </span><span id="local-6989586621679185809"><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185809"><span class="hs-identifier hs-var">nodeKernelArgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-388"></span><span>              </span><span class="annot"><span class="annottext">(NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
 -&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
-&gt; m (NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
-&gt; m (NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="Ouroboros.Consensus.Node.html#nodeKernelArgsEnforceInvariants"><span class="hs-identifier hs-var">nodeKernelArgsEnforceInvariants</span></a></span><span> </span><span class="annot"><span class="annottext">(NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
 -&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
-&gt; (NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
    -&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185746"><span class="hs-identifier hs-var">llrnCustomiseNodeKernelArgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
 -&gt; m (NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk))
-&gt; m (NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
-&gt; m (NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-389"></span><span>              </span><span class="annot"><span class="annottext">ResourceRegistry m
-&gt; Int
-&gt; StdGen
-&gt; TopLevelConfig blk
-&gt; Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
-&gt; BlockchainTime m
-&gt; SomeHeaderInFutureCheck m blk
-&gt; ChainDB m blk
-&gt; m (NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
forall (m :: * -&gt; *) addrNTN addrNTC blk.
(RunNode blk, IOLike m) =&gt;
ResourceRegistry m
-&gt; Int
-&gt; StdGen
-&gt; TopLevelConfig blk
-&gt; Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
-&gt; BlockchainTime m
-&gt; SomeHeaderInFutureCheck m blk
-&gt; ChainDB m blk
-&gt; m (NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
</span><a href="Ouroboros.Consensus.Node.html#mkNodeKernelArgs"><span class="hs-identifier hs-var">mkNodeKernelArgs</span></a></span><span>
</span><span id="line-390"></span><span>                </span><span class="annot"><span class="annottext">ResourceRegistry m
</span><a href="#local-6989586621679185761"><span class="hs-identifier hs-var">registry</span></a></span><span>
</span><span id="line-391"></span><span>                </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679185747"><span class="hs-identifier hs-var">llrnBfcSalt</span></a></span><span>
</span><span id="line-392"></span><span>                </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679185748"><span class="hs-identifier hs-var">llrnKeepAliveRng</span></a></span><span>
</span><span id="line-393"></span><span>                </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679185780"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-394"></span><span>                </span><span class="annot"><span class="annottext">Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185734"><span class="hs-identifier hs-var">rnTraceConsensus</span></a></span><span>
</span><span id="line-395"></span><span>                </span><span class="annot"><span class="annottext">BlockchainTime m
</span><a href="#local-6989586621679185795"><span class="hs-identifier hs-var">btime</span></a></span><span>
</span><span id="line-396"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClockSkew -&gt; SystemTime m -&gt; SomeHeaderInFutureCheck m blk
forall blk (m :: * -&gt; *).
(HasHeader blk, HasHeader (Header blk), HasHardForkHistory blk,
 MonadDelay m) =&gt;
ClockSkew -&gt; SystemTime m -&gt; SomeHeaderInFutureCheck m blk
</span><span class="hs-identifier hs-var">InFutureCheck.realHeaderInFutureCheck</span></span><span> </span><span class="annot"><span class="annottext">ClockSkew
</span><a href="#local-6989586621679185756"><span class="hs-identifier hs-var">llrnMaxClockSkew</span></a></span><span> </span><span class="annot"><span class="annottext">SystemTime m
</span><a href="#local-6989586621679185781"><span class="hs-identifier hs-var">systemTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>                </span><span class="annot"><span class="annottext">ChainDB m blk
</span><a href="#local-6989586621679185793"><span class="hs-identifier hs-var">chainDB</span></a></span><span>
</span><span id="line-398"></span><span>          </span><span id="local-6989586621679185812"><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185812"><span class="hs-identifier hs-var">nodeKernel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; m (NodeKernel m addrNTN (ConnectionId addrNTC) blk)
forall (m :: * -&gt; *) addrNTN addrNTC blk.
(IOLike m, RunNode blk, Ord addrNTN, Hashable addrNTN,
 Typeable addrNTN) =&gt;
NodeKernelArgs m addrNTN addrNTC blk
-&gt; m (NodeKernel m addrNTN addrNTC blk)
</span><a href="Ouroboros.Consensus.NodeKernel.html#initNodeKernel"><span class="hs-identifier hs-var">initNodeKernel</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185809"><span class="hs-identifier hs-var">nodeKernelArgs</span></a></span><span>
</span><span id="line-399"></span><span>          </span><span class="annot"><span class="annottext">ResourceRegistry m
-&gt; NodeKernel m addrNTN (ConnectionId addrNTC) blk -&gt; m ()
</span><a href="#local-6989586621679185738"><span class="hs-identifier hs-var">rnNodeKernelHook</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRegistry m
</span><a href="#local-6989586621679185761"><span class="hs-identifier hs-var">registry</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185812"><span class="hs-identifier hs-var">nodeKernel</span></a></span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span>          </span><span id="local-6989586621679185814"><span class="annot"><span class="annottext">PeerMetrics m addrNTN
</span><a href="#local-6989586621679185814"><span class="hs-identifier hs-var">peerMetrics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PeerMetricsConfiguration -&gt; m (PeerMetrics m addrNTN)
forall (m :: * -&gt; *) p.
(MonadLabelledSTM m, NoThunks p, NFData p) =&gt;
PeerMetricsConfiguration -&gt; m (PeerMetrics m p)
</span><span class="hs-identifier hs-var">newPeerMetric</span></span><span> </span><span class="annot"><span class="annottext">PeerMetricsConfiguration
</span><span class="hs-identifier hs-var">Diffusion.peerMetricsConfiguration</span></span><span>
</span><span id="line-402"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679185816"><span class="annot"><span class="annottext">ntnApps :: BlockNodeToNodeVersion blk
-&gt; (PeerSharingAmount -&gt; m [addrNTN])
-&gt; Apps
     m
     addrNTN
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     NodeToNodeInitiatorResult
     ()
</span><a href="#local-6989586621679185816"><span class="hs-identifier hs-var hs-var">ntnApps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernel m addrNTN (ConnectionId addrNTC) blk
-&gt; PeerMetrics m addrNTN
-&gt; (NodeToNodeVersion -&gt; addrNTN -&gt; Encoding)
-&gt; (NodeToNodeVersion -&gt; forall s. Decoder s addrNTN)
-&gt; BlockNodeToNodeVersion blk
-&gt; (PeerSharingAmount -&gt; m [addrNTN])
-&gt; Apps
     m
     addrNTN
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     NodeToNodeInitiatorResult
     ()
</span><a href="#local-6989586621679185817"><span class="hs-identifier hs-var">mkNodeToNodeApps</span></a></span><span>   </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185809"><span class="hs-identifier hs-var">nodeKernelArgs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185812"><span class="hs-identifier hs-var">nodeKernel</span></a></span><span> </span><span class="annot"><span class="annottext">PeerMetrics m addrNTN
</span><a href="#local-6989586621679185814"><span class="hs-identifier hs-var">peerMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; addrNTN -&gt; Encoding
</span><a href="#local-6989586621679185741"><span class="hs-identifier hs-var">encAddrNtN</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; Decoder s addrNTN
NodeToNodeVersion -&gt; forall s. Decoder s addrNTN
</span><a href="#local-6989586621679185742"><span class="hs-identifier hs-var">decAddrNtN</span></a></span><span>
</span><span id="line-403"></span><span>              </span><span id="local-6989586621679185818"><span class="annot"><span class="annottext">ntcApps :: BlockNodeToClientVersion blk
-&gt; NodeToClientVersion
-&gt; Apps
     m
     (ConnectionId addrNTC)
     ByteString
     ByteString
     ByteString
     ByteString
     ()
</span><a href="#local-6989586621679185818"><span class="hs-identifier hs-var hs-var">ntcApps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernel m addrNTN (ConnectionId addrNTC) blk
-&gt; BlockNodeToClientVersion blk
-&gt; NodeToClientVersion
-&gt; Apps
     m
     (ConnectionId addrNTC)
     ByteString
     ByteString
     ByteString
     ByteString
     ()
</span><a href="#local-6989586621679185819"><span class="hs-identifier hs-var">mkNodeToClientApps</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185809"><span class="hs-identifier hs-var">nodeKernelArgs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185812"><span class="hs-identifier hs-var">nodeKernel</span></a></span><span>
</span><span id="line-404"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679185820"><span class="annot"><span class="annottext">Applications
  addrNTN
  NodeToNodeVersion
  versionDataNTN
  addrNTC
  NodeToClientVersion
  versionDataNTC
  m
  NodeToNodeInitiatorResult
</span><a href="#local-6989586621679185820"><span class="hs-identifier hs-var">apps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679185821"><span class="annot"><span class="annottext">ExtraApplications p2p addrNTN m NodeToNodeInitiatorResult
</span><a href="#local-6989586621679185821"><span class="hs-identifier hs-var">appsExtra</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkP2PMode p2p
-&gt; MiniProtocolParameters
-&gt; (BlockNodeToNodeVersion blk
    -&gt; (PeerSharingAmount -&gt; m [addrNTN])
    -&gt; Apps
         m
         addrNTN
         ByteString
         ByteString
         ByteString
         ByteString
         ByteString
         NodeToNodeInitiatorResult
         ())
-&gt; (BlockNodeToClientVersion blk
    -&gt; NodeToClientVersion
    -&gt; Apps
         m
         (ConnectionId addrNTC)
         ByteString
         ByteString
         ByteString
         ByteString
         ())
-&gt; NodeKernel m addrNTN (ConnectionId addrNTC) blk
-&gt; PeerMetrics m addrNTN
-&gt; (Applications
      addrNTN
      NodeToNodeVersion
      versionDataNTN
      addrNTC
      NodeToClientVersion
      versionDataNTC
      m
      NodeToNodeInitiatorResult,
    ExtraApplications p2p addrNTN m NodeToNodeInitiatorResult)
</span><a href="#local-6989586621679185822"><span class="hs-identifier hs-var">mkDiffusionApplications</span></a></span><span>
</span><span id="line-405"></span><span>                                        </span><span class="annot"><span class="annottext">NetworkP2PMode p2p
</span><a href="#local-6989586621679185739"><span class="hs-identifier hs-var">rnEnableP2P</span></a></span><span>
</span><span id="line-406"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; MiniProtocolParameters
forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN addrNTC blk -&gt; MiniProtocolParameters
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AminiProtocolParameters%3ANodeKernelArgs"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185809"><span class="hs-identifier hs-var">nodeKernelArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>                                        </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
-&gt; (PeerSharingAmount -&gt; m [addrNTN])
-&gt; Apps
     m
     addrNTN
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     NodeToNodeInitiatorResult
     ()
</span><a href="#local-6989586621679185816"><span class="hs-identifier hs-var">ntnApps</span></a></span><span>
</span><span id="line-408"></span><span>                                        </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
-&gt; NodeToClientVersion
-&gt; Apps
     m
     (ConnectionId addrNTC)
     ByteString
     ByteString
     ByteString
     ByteString
     ()
</span><a href="#local-6989586621679185818"><span class="hs-identifier hs-var">ntcApps</span></a></span><span>
</span><span id="line-409"></span><span>                                        </span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185812"><span class="hs-identifier hs-var">nodeKernel</span></a></span><span>
</span><span id="line-410"></span><span>                                        </span><span class="annot"><span class="annottext">PeerMetrics m addrNTN
</span><a href="#local-6989586621679185814"><span class="hs-identifier hs-var">peerMetrics</span></a></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span>          </span><span class="annot"><span class="annottext">ResourceRegistry m
-&gt; Applications
     addrNTN
     NodeToNodeVersion
     versionDataNTN
     addrNTC
     NodeToClientVersion
     versionDataNTC
     m
     NodeToNodeInitiatorResult
-&gt; ExtraApplications p2p addrNTN m NodeToNodeInitiatorResult
-&gt; m ()
</span><a href="#local-6989586621679185751"><span class="hs-identifier hs-var">llrnRunDataDiffusion</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRegistry m
</span><a href="#local-6989586621679185761"><span class="hs-identifier hs-var">registry</span></a></span><span> </span><span class="annot"><span class="annottext">Applications
  addrNTN
  NodeToNodeVersion
  versionDataNTN
  addrNTC
  NodeToClientVersion
  versionDataNTC
  m
  NodeToNodeInitiatorResult
</span><a href="#local-6989586621679185820"><span class="hs-identifier hs-var">apps</span></a></span><span> </span><span class="annot"><span class="annottext">ExtraApplications p2p addrNTN m NodeToNodeInitiatorResult
</span><a href="#local-6989586621679185821"><span class="hs-identifier hs-var">appsExtra</span></a></span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-414"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">ProtocolInfo</span></span><span>
</span><span id="line-415"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pInfoConfig :: forall b. ProtocolInfo b -&gt; TopLevelConfig b
</span><span class="hs-identifier hs-var">pInfoConfig</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679185780"><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679185780"><span class="hs-identifier hs-var">cfg</span></a></span></span><span>
</span><span id="line-416"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pInfoInitLedger :: forall b. ProtocolInfo b -&gt; ExtLedgerState b
</span><span class="hs-identifier hs-var">pInfoInitLedger</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679185794"><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621679185794"><span class="hs-identifier hs-var">initLedger</span></a></span></span><span>
</span><span id="line-417"></span><span>      </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolInfo blk
</span><a href="#local-6989586621679185737"><span class="hs-identifier hs-var">rnProtocolInfo</span></a></span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span>    </span><span class="annot"><a href="#local-6989586621679185827"><span class="hs-identifier hs-type">codecConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CodecConfig</span></span><span> </span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-420"></span><span>    </span><span id="local-6989586621679185827"><span class="annot"><span class="annottext">codecConfig :: CodecConfig blk
</span><a href="#local-6989586621679185827"><span class="hs-identifier hs-var hs-var">codecConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; CodecConfig blk
forall blk. TopLevelConfig blk -&gt; CodecConfig blk
</span><span class="hs-identifier hs-var">configCodec</span></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679185780"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span>    </span><span class="annot"><a href="#local-6989586621679185817"><span class="hs-identifier hs-type">mkNodeToNodeApps</span></a></span><span>
</span><span id="line-423"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679184861"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-424"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernel"><span class="hs-identifier hs-type">NodeKernel</span></a></span><span>     </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679184861"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-425"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerMetrics</span></span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span>
</span><span id="line-426"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NodeToNodeVersion</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Encoding</span></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NodeToNodeVersion</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679185829"><span class="annot"><a href="#local-6989586621679185829"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679185829"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></span><span> </span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-429"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PeerSharingAmount</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>      </span><span class="hs-comment">-- ^ Peer Sharing result computation callback</span><span>
</span><span id="line-431"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Apps"><span class="hs-identifier hs-type">NTN.Apps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-432"></span><span>          </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span>
</span><span id="line-433"></span><span>          </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-434"></span><span>          </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-435"></span><span>          </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-436"></span><span>          </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-437"></span><span>          </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-438"></span><span>          </span><span class="annot"><a href="Ouroboros.Consensus.Node.ExitPolicy.html#NodeToNodeInitiatorResult"><span class="hs-identifier hs-type">NodeToNodeInitiatorResult</span></a></span><span>
</span><span id="line-439"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>    </span><span id="local-6989586621679185817"><span class="annot"><span class="annottext">mkNodeToNodeApps :: NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernel m addrNTN (ConnectionId addrNTC) blk
-&gt; PeerMetrics m addrNTN
-&gt; (NodeToNodeVersion -&gt; addrNTN -&gt; Encoding)
-&gt; (NodeToNodeVersion -&gt; forall s. Decoder s addrNTN)
-&gt; BlockNodeToNodeVersion blk
-&gt; (PeerSharingAmount -&gt; m [addrNTN])
-&gt; Apps
     m
     addrNTN
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     NodeToNodeInitiatorResult
     ()
</span><a href="#local-6989586621679185817"><span class="hs-identifier hs-var hs-var">mkNodeToNodeApps</span></a></span></span><span> </span><span id="local-6989586621679185830"><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185830"><span class="hs-identifier hs-var">nodeKernelArgs</span></a></span></span><span> </span><span id="local-6989586621679185831"><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185831"><span class="hs-identifier hs-var">nodeKernel</span></a></span></span><span> </span><span id="local-6989586621679185832"><span class="annot"><span class="annottext">PeerMetrics m addrNTN
</span><a href="#local-6989586621679185832"><span class="hs-identifier hs-var">peerMetrics</span></a></span></span><span> </span><span id="local-6989586621679185833"><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; addrNTN -&gt; Encoding
</span><a href="#local-6989586621679185833"><span class="hs-identifier hs-var">encAddrNTN</span></a></span></span><span> </span><span id="local-6989586621679185834"><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; forall s. Decoder s addrNTN
</span><a href="#local-6989586621679185834"><span class="hs-identifier hs-var">decAddrNTN</span></a></span></span><span> </span><span id="local-6989586621679185835"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679185835"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621679185836"><span class="annot"><span class="annottext">PeerSharingAmount -&gt; m [addrNTN]
</span><a href="#local-6989586621679185836"><span class="hs-identifier hs-var">computePeers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-441"></span><span>        </span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
-&gt; Tracers m (ConnectionId addrNTN) blk DeserialiseFailure
-&gt; (NodeToNodeVersion
    -&gt; Codecs
         blk
         addrNTN
         DeserialiseFailure
         m
         ByteString
         ByteString
         ByteString
         ByteString
         ByteString
         ByteString
         ByteString)
-&gt; ByteLimits ByteString ByteString ByteString ByteString
-&gt; m ChainSyncTimeout
-&gt; ReportPeerMetrics m (ConnectionId addrNTN)
-&gt; Handlers m addrNTN blk
-&gt; Apps
     m
     addrNTN
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     NodeToNodeInitiatorResult
     ()
forall (m :: * -&gt; *) addrNTN addrNTC blk e bCS bBF bTX bKA bPS.
(IOLike m, MonadTimer m, Ord addrNTN, Exception e,
 LedgerSupportsProtocol blk, ShowProxy blk, ShowProxy (Header blk),
 ShowProxy (TxId (GenTx blk)), ShowProxy (GenTx blk)) =&gt;
NodeKernel m addrNTN addrNTC blk
-&gt; Tracers m (ConnectionId addrNTN) blk e
-&gt; (NodeToNodeVersion
    -&gt; Codecs blk addrNTN e m bCS bCS bBF bBF bTX bKA bPS)
-&gt; ByteLimits bCS bBF bTX bKA
-&gt; m ChainSyncTimeout
-&gt; ReportPeerMetrics m (ConnectionId addrNTN)
-&gt; Handlers m addrNTN blk
-&gt; Apps m addrNTN bCS bBF bTX bKA bPS NodeToNodeInitiatorResult ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#mkApps"><span class="hs-identifier hs-var">NTN.mkApps</span></a></span><span>
</span><span id="line-442"></span><span>          </span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185831"><span class="hs-identifier hs-var">nodeKernel</span></a></span><span>
</span><span id="line-443"></span><span>          </span><span class="annot"><span class="annottext">Tracers m (ConnectionId addrNTN) blk DeserialiseFailure
</span><a href="#local-6989586621679185735"><span class="hs-identifier hs-var">rnTraceNTN</span></a></span><span>
</span><span id="line-444"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; BlockNodeToNodeVersion blk
-&gt; (NodeToNodeVersion -&gt; addrNTN -&gt; Encoding)
-&gt; (NodeToNodeVersion -&gt; forall s. Decoder s addrNTN)
-&gt; NodeToNodeVersion
-&gt; Codecs
     blk
     addrNTN
     DeserialiseFailure
     m
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
forall (m :: * -&gt; *) blk addr.
(IOLike m, SerialiseNodeToNodeConstraints blk) =&gt;
CodecConfig blk
-&gt; BlockNodeToNodeVersion blk
-&gt; (NodeToNodeVersion -&gt; addr -&gt; Encoding)
-&gt; (NodeToNodeVersion -&gt; forall s. Decoder s addr)
-&gt; NodeToNodeVersion
-&gt; Codecs
     blk
     addr
     DeserialiseFailure
     m
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#defaultCodecs"><span class="hs-identifier hs-var">NTN.defaultCodecs</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679185827"><span class="hs-identifier hs-var">codecConfig</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679185835"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; addrNTN -&gt; Encoding
</span><a href="#local-6989586621679185833"><span class="hs-identifier hs-var">encAddrNTN</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion -&gt; Decoder s addrNTN
NodeToNodeVersion -&gt; forall s. Decoder s addrNTN
</span><a href="#local-6989586621679185834"><span class="hs-identifier hs-var">decAddrNTN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>          </span><span class="annot"><span class="annottext">ByteLimits ByteString ByteString ByteString ByteString
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#byteLimits"><span class="hs-identifier hs-var">NTN.byteLimits</span></a></span><span>
</span><span id="line-446"></span><span>          </span><span class="annot"><span class="annottext">m ChainSyncTimeout
</span><a href="#local-6989586621679185750"><span class="hs-identifier hs-var">llrnChainSyncTimeout</span></a></span><span>
</span><span id="line-447"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerMetricsConfiguration
-&gt; PeerMetrics m addrNTN
-&gt; ReportPeerMetrics m (ConnectionId addrNTN)
forall (m :: * -&gt; *) p.
(MonadSTM m, Ord p) =&gt;
PeerMetricsConfiguration
-&gt; PeerMetrics m p -&gt; ReportPeerMetrics m (ConnectionId p)
</span><span class="hs-identifier hs-var">reportMetric</span></span><span> </span><span class="annot"><span class="annottext">PeerMetricsConfiguration
</span><span class="hs-identifier hs-var">Diffusion.peerMetricsConfiguration</span></span><span> </span><span class="annot"><span class="annottext">PeerMetrics m addrNTN
</span><a href="#local-6989586621679185832"><span class="hs-identifier hs-var">peerMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernel m addrNTN (ConnectionId addrNTC) blk
-&gt; (PeerSharingAmount -&gt; m [addrNTN])
-&gt; Handlers m addrNTN blk
forall (m :: * -&gt; *) blk addrNTN addrNTC.
(IOLike m, MonadTime m, MonadTimer m, LedgerSupportsMempool blk,
 HasTxId (GenTx blk), LedgerSupportsProtocol blk, Ord addrNTN) =&gt;
NodeKernelArgs m addrNTN addrNTC blk
-&gt; NodeKernel m addrNTN addrNTC blk
-&gt; (PeerSharingAmount -&gt; m [addrNTN])
-&gt; Handlers m addrNTN blk
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#mkHandlers"><span class="hs-identifier hs-var">NTN.mkHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185830"><span class="hs-identifier hs-var">nodeKernelArgs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185831"><span class="hs-identifier hs-var">nodeKernel</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSharingAmount -&gt; m [addrNTN]
</span><a href="#local-6989586621679185836"><span class="hs-identifier hs-var">computePeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span>    </span><span class="annot"><a href="#local-6989586621679185819"><span class="hs-identifier hs-type">mkNodeToClientApps</span></a></span><span>
</span><span id="line-451"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679184861"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-452"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernel"><span class="hs-identifier hs-type">NodeKernel</span></a></span><span>     </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679184861"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-453"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></span><span> </span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-454"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeToClientVersion</span></span><span>
</span><span id="line-455"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToClient.html#Apps"><span class="hs-identifier hs-type">NTC.Apps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679184861"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>    </span><span id="local-6989586621679185819"><span class="annot"><span class="annottext">mkNodeToClientApps :: NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernel m addrNTN (ConnectionId addrNTC) blk
-&gt; BlockNodeToClientVersion blk
-&gt; NodeToClientVersion
-&gt; Apps
     m
     (ConnectionId addrNTC)
     ByteString
     ByteString
     ByteString
     ByteString
     ()
</span><a href="#local-6989586621679185819"><span class="hs-identifier hs-var hs-var">mkNodeToClientApps</span></a></span></span><span> </span><span id="local-6989586621679185841"><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185841"><span class="hs-identifier hs-var">nodeKernelArgs</span></a></span></span><span> </span><span id="local-6989586621679185842"><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185842"><span class="hs-identifier hs-var">nodeKernel</span></a></span></span><span> </span><span id="local-6989586621679185843"><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679185843"><span class="hs-identifier hs-var">blockVersion</span></a></span></span><span> </span><span id="local-6989586621679185844"><span class="annot"><span class="annottext">NodeToClientVersion
</span><a href="#local-6989586621679185844"><span class="hs-identifier hs-var">networkVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-457"></span><span>        </span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
-&gt; Tracers m (ConnectionId addrNTC) blk DeserialiseFailure
-&gt; Codecs
     blk
     DeserialiseFailure
     m
     ByteString
     ByteString
     ByteString
     ByteString
-&gt; Handlers m (ConnectionId addrNTC) blk
-&gt; Apps
     m
     (ConnectionId addrNTC)
     ByteString
     ByteString
     ByteString
     ByteString
     ()
forall (m :: * -&gt; *) addrNTN addrNTC blk e bCS bTX bSQ bTM.
(IOLike m, Exception e, ShowProxy blk, ShowProxy (ApplyTxErr blk),
 ShowProxy (BlockQuery blk), ShowProxy (GenTx blk),
 ShowProxy (GenTxId blk), ShowQuery (BlockQuery blk)) =&gt;
NodeKernel m addrNTN addrNTC blk
-&gt; Tracers m addrNTC blk e
-&gt; Codecs blk e m bCS bTX bSQ bTM
-&gt; Handlers m addrNTC blk
-&gt; Apps m addrNTC bCS bTX bSQ bTM ()
</span><a href="Ouroboros.Consensus.Network.NodeToClient.html#mkApps"><span class="hs-identifier hs-var">NTC.mkApps</span></a></span><span>
</span><span id="line-458"></span><span>          </span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185842"><span class="hs-identifier hs-var">nodeKernel</span></a></span><span>
</span><span id="line-459"></span><span>          </span><span class="annot"><span class="annottext">Tracers m (ConnectionId addrNTC) blk DeserialiseFailure
</span><a href="#local-6989586621679185736"><span class="hs-identifier hs-var">rnTraceNTC</span></a></span><span>
</span><span id="line-460"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; BlockNodeToClientVersion blk
-&gt; NodeToClientVersion
-&gt; Codecs
     blk
     DeserialiseFailure
     m
     ByteString
     ByteString
     ByteString
     ByteString
forall (m :: * -&gt; *) blk.
(MonadST m, SerialiseNodeToClientConstraints blk,
 ShowQuery (BlockQuery blk), StandardHash blk,
 Serialise (HeaderHash blk)) =&gt;
CodecConfig blk
-&gt; BlockNodeToClientVersion blk
-&gt; NodeToClientVersion
-&gt; DefaultCodecs blk m
</span><a href="Ouroboros.Consensus.Network.NodeToClient.html#defaultCodecs"><span class="hs-identifier hs-var">NTC.defaultCodecs</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679185827"><span class="hs-identifier hs-var">codecConfig</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679185843"><span class="hs-identifier hs-var">blockVersion</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToClientVersion
</span><a href="#local-6989586621679185844"><span class="hs-identifier hs-var">networkVersion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernel m addrNTN (ConnectionId addrNTC) blk
-&gt; Handlers m (ConnectionId addrNTC) blk
forall (m :: * -&gt; *) blk addrNTN addrNTC.
(IOLike m, LedgerSupportsMempool blk, LedgerSupportsProtocol blk,
 QueryLedger blk, ConfigSupportsNode blk) =&gt;
NodeKernelArgs m addrNTN addrNTC blk
-&gt; NodeKernel m addrNTN addrNTC blk -&gt; Handlers m addrNTC blk
</span><a href="Ouroboros.Consensus.Network.NodeToClient.html#mkHandlers"><span class="hs-identifier hs-var">NTC.mkHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185841"><span class="hs-identifier hs-var">nodeKernelArgs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185842"><span class="hs-identifier hs-var">nodeKernel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span>    </span><span class="annot"><a href="#local-6989586621679185822"><span class="hs-identifier hs-type">mkDiffusionApplications</span></a></span><span>
</span><span id="line-464"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#NetworkP2PMode"><span class="hs-identifier hs-type">NetworkP2PMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184862"><span class="hs-identifier hs-type">p2p</span></a></span><span>
</span><span id="line-465"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MiniProtocolParameters</span></span><span>
</span><span id="line-466"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span>   </span><span class="annot"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></span><span> </span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-467"></span><span>          </span><span class="hs-comment">-- Peer Sharing result computation callback</span><span>
</span><span id="line-468"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PeerSharingAmount</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Apps"><span class="hs-identifier hs-type">NTN.Apps</span></a></span><span>
</span><span id="line-470"></span><span>               </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-471"></span><span>               </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span>
</span><span id="line-472"></span><span>               </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-473"></span><span>               </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-474"></span><span>               </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-475"></span><span>               </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-476"></span><span>               </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-477"></span><span>               </span><span class="annot"><a href="Ouroboros.Consensus.Node.ExitPolicy.html#NodeToNodeInitiatorResult"><span class="hs-identifier hs-type">NodeToNodeInitiatorResult</span></a></span><span>
</span><span id="line-478"></span><span>               </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span>   </span><span class="annot"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></span><span> </span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-481"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeToClientVersion</span></span><span>
</span><span id="line-482"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToClient.html#Apps"><span class="hs-identifier hs-type">NTC.Apps</span></a></span><span>
</span><span id="line-483"></span><span>               </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679184861"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/bytestring-0.11.5.2/src/Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernel"><span class="hs-identifier hs-type">NodeKernel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679184861"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-486"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerMetrics</span></span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span>
</span><span id="line-487"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.Applications</span></span><span>
</span><span id="line-488"></span><span>             </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeToNodeVersion</span></span><span>   </span><span class="annot"><a href="#local-6989586621679184863"><span class="hs-identifier hs-type">versionDataNTN</span></a></span><span>
</span><span id="line-489"></span><span>             </span><span class="annot"><a href="#local-6989586621679184861"><span class="hs-identifier hs-type">addrNTC</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeToClientVersion</span></span><span> </span><span class="annot"><a href="#local-6989586621679184864"><span class="hs-identifier hs-type">versionDataNTC</span></a></span><span>
</span><span id="line-490"></span><span>             </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.ExitPolicy.html#NodeToNodeInitiatorResult"><span class="hs-identifier hs-type">NodeToNodeInitiatorResult</span></a></span><span>
</span><span id="line-491"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.ExtraApplications</span></span><span> </span><span class="annot"><a href="#local-6989586621679184862"><span class="hs-identifier hs-type">p2p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184858"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.ExitPolicy.html#NodeToNodeInitiatorResult"><span class="hs-identifier hs-type">NodeToNodeInitiatorResult</span></a></span><span>
</span><span id="line-492"></span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>    </span><span id="local-6989586621679185822"><span class="annot"><span class="annottext">mkDiffusionApplications :: NetworkP2PMode p2p
-&gt; MiniProtocolParameters
-&gt; (BlockNodeToNodeVersion blk
    -&gt; (PeerSharingAmount -&gt; m [addrNTN])
    -&gt; Apps
         m
         addrNTN
         ByteString
         ByteString
         ByteString
         ByteString
         ByteString
         NodeToNodeInitiatorResult
         ())
-&gt; (BlockNodeToClientVersion blk
    -&gt; NodeToClientVersion
    -&gt; Apps
         m
         (ConnectionId addrNTC)
         ByteString
         ByteString
         ByteString
         ByteString
         ())
-&gt; NodeKernel m addrNTN (ConnectionId addrNTC) blk
-&gt; PeerMetrics m addrNTN
-&gt; (Applications
      addrNTN
      NodeToNodeVersion
      versionDataNTN
      addrNTC
      NodeToClientVersion
      versionDataNTC
      m
      NodeToNodeInitiatorResult,
    ExtraApplications p2p addrNTN m NodeToNodeInitiatorResult)
</span><a href="#local-6989586621679185822"><span class="hs-identifier hs-var hs-var">mkDiffusionApplications</span></a></span></span><span>
</span><span id="line-494"></span><span>      </span><span id="local-6989586621679185848"><span class="annot"><span class="annottext">NetworkP2PMode p2p
</span><a href="#local-6989586621679185848"><span class="hs-identifier hs-var">enP2P</span></a></span></span><span>
</span><span id="line-495"></span><span>      </span><span id="local-6989586621679185849"><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621679185849"><span class="hs-identifier hs-var">miniProtocolParams</span></a></span></span><span>
</span><span id="line-496"></span><span>      </span><span id="local-6989586621679185850"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
-&gt; (PeerSharingAmount -&gt; m [addrNTN])
-&gt; Apps
     m
     addrNTN
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     NodeToNodeInitiatorResult
     ()
</span><a href="#local-6989586621679185850"><span class="hs-identifier hs-var">ntnApps</span></a></span></span><span>
</span><span id="line-497"></span><span>      </span><span id="local-6989586621679185851"><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
-&gt; NodeToClientVersion
-&gt; Apps
     m
     (ConnectionId addrNTC)
     ByteString
     ByteString
     ByteString
     ByteString
     ()
</span><a href="#local-6989586621679185851"><span class="hs-identifier hs-var">ntcApps</span></a></span></span><span>
</span><span id="line-498"></span><span>      </span><span id="local-6989586621679185852"><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185852"><span class="hs-identifier hs-var">kernel</span></a></span></span><span>
</span><span id="line-499"></span><span>      </span><span id="local-6989586621679185853"><span class="annot"><span class="annottext">PeerMetrics m addrNTN
</span><a href="#local-6989586621679185853"><span class="hs-identifier hs-var">peerMetrics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-500"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NetworkP2PMode p2p
</span><a href="#local-6989586621679185848"><span class="hs-identifier hs-var">enP2P</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-501"></span><span>        </span><span class="annot"><span class="annottext">NetworkP2PMode p2p
</span><a href="Ouroboros.Consensus.Node.html#EnabledP2PMode"><span class="hs-identifier hs-var">EnabledP2PMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-502"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Applications
  addrNTN
  NodeToNodeVersion
  versionDataNTN
  addrNTC
  NodeToClientVersion
  versionDataNTC
  m
  NodeToNodeInitiatorResult
</span><a href="#local-6989586621679185857"><span class="hs-identifier hs-var">apps</span></a></span><span>
</span><span id="line-503"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApplicationsExtra addrNTN m NodeToNodeInitiatorResult
-&gt; ExtraApplications 'P2P addrNTN m NodeToNodeInitiatorResult
forall ntnAddr (m :: * -&gt; *) a.
ApplicationsExtra ntnAddr m a -&gt; ExtraApplications 'P2P ntnAddr m a
</span><span class="hs-identifier hs-var">Diffusion.P2PApplications</span></span><span>
</span><span id="line-504"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">P2P.ApplicationsExtra</span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-505"></span><span>                </span><span class="annot"><span class="annottext">daRethrowPolicy :: RethrowPolicy
</span><span class="hs-identifier hs-var">P2P.daRethrowPolicy</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy blk -&gt; RethrowPolicy
forall blk.
(Typeable blk, StandardHash blk) =&gt;
Proxy blk -&gt; RethrowPolicy
</span><a href="Ouroboros.Consensus.Node.RethrowPolicy.html#consensusRethrowPolicy"><span class="hs-identifier hs-var">consensusRethrowPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall t. Proxy t
forall {k} (t :: k). Proxy t
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Proxy.html#Proxy"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-506"></span><span>                </span><span class="annot"><span class="annottext">daReturnPolicy :: ReturnPolicy NodeToNodeInitiatorResult
</span><span class="hs-identifier hs-var">P2P.daReturnPolicy</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReturnPolicy NodeToNodeInitiatorResult
</span><a href="Ouroboros.Consensus.Node.ExitPolicy.html#returnPolicy"><span class="hs-identifier hs-var">returnPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-507"></span><span>                </span><span class="annot"><span class="annottext">daLocalRethrowPolicy :: RethrowPolicy
</span><span class="hs-identifier hs-var">P2P.daLocalRethrowPolicy</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RethrowPolicy
</span><a href="#local-6989586621679185866"><span class="hs-identifier hs-var">localRethrowPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-508"></span><span>                </span><span class="annot"><span class="annottext">daPeerMetrics :: PeerMetrics m addrNTN
</span><span class="hs-identifier hs-var">P2P.daPeerMetrics</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerMetrics m addrNTN
</span><a href="#local-6989586621679185853"><span class="hs-identifier hs-var">peerMetrics</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-509"></span><span>                </span><span class="annot"><span class="annottext">daBlockFetchMode :: STM m FetchMode
</span><span class="hs-identifier hs-var">P2P.daBlockFetchMode</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk -&gt; STM m FetchMode
forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernel m addrNTN addrNTC blk -&gt; STM m FetchMode
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AgetFetchMode%3ANodeKernel"><span class="hs-identifier hs-var">getFetchMode</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185852"><span class="hs-identifier hs-var">kernel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-510"></span><span>                </span><span class="annot"><span class="annottext">daPeerSharingRegistry :: PeerSharingRegistry addrNTN m
</span><span class="hs-identifier hs-var">P2P.daPeerSharingRegistry</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
-&gt; PeerSharingRegistry addrNTN m
forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernel m addrNTN addrNTC blk -&gt; PeerSharingRegistry addrNTN m
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AgetPeerSharingRegistry%3ANodeKernel"><span class="hs-identifier hs-var">getPeerSharingRegistry</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185852"><span class="hs-identifier hs-var">kernel</span></a></span><span>
</span><span id="line-511"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-512"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>        </span><span class="annot"><span class="annottext">NetworkP2PMode p2p
</span><a href="Ouroboros.Consensus.Node.html#DisabledP2PMode"><span class="hs-identifier hs-var">DisabledP2PMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-514"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Applications
  addrNTN
  NodeToNodeVersion
  versionDataNTN
  addrNTC
  NodeToClientVersion
  versionDataNTC
  m
  NodeToNodeInitiatorResult
</span><a href="#local-6989586621679185857"><span class="hs-identifier hs-var">apps</span></a></span><span>
</span><span id="line-515"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApplicationsExtra
-&gt; ExtraApplications 'NonP2P addrNTN m NodeToNodeInitiatorResult
forall ntnAddr (m :: * -&gt; *) a.
ApplicationsExtra -&gt; ExtraApplications 'NonP2P ntnAddr m a
</span><span class="hs-identifier hs-var">Diffusion.NonP2PApplications</span></span><span>
</span><span id="line-516"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">NonP2P.ApplicationsExtra</span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-517"></span><span>                </span><span class="annot"><span class="annottext">daErrorPolicies :: ErrorPolicies
</span><span class="hs-identifier hs-var">NonP2P.daErrorPolicies</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy blk -&gt; ErrorPolicies
forall blk.
(Typeable blk, StandardHash blk) =&gt;
Proxy blk -&gt; ErrorPolicies
</span><a href="Ouroboros.Consensus.Node.ErrorPolicy.html#consensusErrorPolicy"><span class="hs-identifier hs-var">consensusErrorPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall t. Proxy t
forall {k} (t :: k). Proxy t
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Proxy.html#Proxy"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679184856"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-519"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-521"></span><span>        </span><span id="local-6989586621679185857"><span class="annot"><span class="annottext">apps :: Applications
  addrNTN
  NodeToNodeVersion
  versionDataNTN
  addrNTC
  NodeToClientVersion
  versionDataNTC
  m
  NodeToNodeInitiatorResult
</span><a href="#local-6989586621679185857"><span class="hs-identifier hs-var hs-var">apps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.Applications</span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-522"></span><span>            </span><span class="annot"><span class="annottext">daApplicationInitiatorMode :: Versions
  NodeToNodeVersion
  versionDataNTN
  (OuroborosBundleWithExpandedCtx
     'InitiatorMode addrNTN ByteString m NodeToNodeInitiatorResult Void)
</span><span class="hs-identifier hs-var">Diffusion.daApplicationInitiatorMode</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-523"></span><span>              </span><span class="annot"><span class="annottext">[Versions
   NodeToNodeVersion
   versionDataNTN
   (OuroborosBundleWithExpandedCtx
      'InitiatorMode
      addrNTN
      ByteString
      m
      NodeToNodeInitiatorResult
      Void)]
-&gt; Versions
     NodeToNodeVersion
     versionDataNTN
     (OuroborosBundleWithExpandedCtx
        'InitiatorMode addrNTN ByteString m NodeToNodeInitiatorResult Void)
forall vNum (f :: * -&gt; *) extra r.
(Ord vNum, Foldable f, HasCallStack) =&gt;
f (Versions vNum extra r) -&gt; Versions vNum extra r
</span><span class="hs-identifier hs-var">combineVersions</span></span><span>
</span><span id="line-524"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
-&gt; versionDataNTN
-&gt; OuroborosBundleWithExpandedCtx
     'InitiatorMode addrNTN ByteString m NodeToNodeInitiatorResult Void
-&gt; Versions
     NodeToNodeVersion
     versionDataNTN
     (OuroborosBundleWithExpandedCtx
        'InitiatorMode addrNTN ByteString m NodeToNodeInitiatorResult Void)
forall vNum vData r. vNum -&gt; vData -&gt; r -&gt; Versions vNum vData r
</span><span class="hs-identifier hs-var">simpleSingletonVersions</span></span><span>
</span><span id="line-525"></span><span>                    </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621679185881"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-526"></span><span>                    </span><span class="annot"><span class="annottext">versionDataNTN
</span><a href="#local-6989586621679185753"><span class="hs-identifier hs-var">llrnVersionDataNTN</span></a></span><span>
</span><span id="line-527"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MiniProtocolParameters
-&gt; NodeToNodeVersion
-&gt; PeerSharing
-&gt; Apps
     m
     addrNTN
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     NodeToNodeInitiatorResult
     ()
-&gt; OuroborosBundleWithExpandedCtx
     'InitiatorMode addrNTN ByteString m NodeToNodeInitiatorResult Void
forall (m :: * -&gt; *) addr b a c.
MiniProtocolParameters
-&gt; NodeToNodeVersion
-&gt; PeerSharing
-&gt; Apps m addr b b b b b a c
-&gt; OuroborosBundleWithExpandedCtx 'InitiatorMode addr b m a Void
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#initiator"><span class="hs-identifier hs-var">NTN.initiator</span></a></span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621679185849"><span class="hs-identifier hs-var">miniProtocolParams</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621679185881"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSharing
</span><a href="#local-6989586621679185740"><span class="hs-identifier hs-var">rnPeerSharing</span></a></span><span>
</span><span id="line-528"></span><span>                      </span><span class="hs-comment">-- Initiator side won't start responder side of Peer</span><span>
</span><span id="line-529"></span><span>                      </span><span class="hs-comment">-- Sharing protocol so we give a dummy implementation</span><span>
</span><span id="line-530"></span><span>                      </span><span class="hs-comment">-- here.</span><span>
</span><span id="line-531"></span><span>                      </span><span class="annot"><span class="annottext">(Apps
   m
   addrNTN
   ByteString
   ByteString
   ByteString
   ByteString
   ByteString
   NodeToNodeInitiatorResult
   ()
 -&gt; OuroborosBundleWithExpandedCtx
      'InitiatorMode addrNTN ByteString m NodeToNodeInitiatorResult Void)
-&gt; Apps
     m
     addrNTN
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     NodeToNodeInitiatorResult
     ()
-&gt; OuroborosBundleWithExpandedCtx
     'InitiatorMode addrNTN ByteString m NodeToNodeInitiatorResult Void
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
-&gt; (PeerSharingAmount -&gt; m [addrNTN])
-&gt; Apps
     m
     addrNTN
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     NodeToNodeInitiatorResult
     ()
</span><a href="#local-6989586621679185850"><span class="hs-identifier hs-var">ntnApps</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679185883"><span class="hs-identifier hs-var">blockVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; PeerSharingAmount -&gt; m [addrNTN]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;impossible happened!&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679185881"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621679185881"><span class="hs-identifier hs-var">version</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679185883"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679185883"><span class="hs-identifier hs-var">blockVersion</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
-&gt; [(NodeToNodeVersion, BlockNodeToNodeVersion blk)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
</span><a href="#local-6989586621679185754"><span class="hs-identifier hs-var">llrnNodeToNodeVersions</span></a></span><span>
</span><span id="line-533"></span><span>                </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-534"></span><span>            </span><span class="annot"><span class="annottext">daApplicationInitiatorResponderMode :: (PeerSharingAmount -&gt; m [addrNTN])
-&gt; Versions
     NodeToNodeVersion
     versionDataNTN
     (OuroborosBundleWithExpandedCtx
        'InitiatorResponderMode
        addrNTN
        ByteString
        m
        NodeToNodeInitiatorResult
        ())
</span><span class="hs-identifier hs-var">Diffusion.daApplicationInitiatorResponderMode</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679185887"><span class="annot"><span class="annottext">PeerSharingAmount -&gt; m [addrNTN]
</span><a href="#local-6989586621679185887"><span class="hs-identifier hs-var">computePeers</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-535"></span><span>              </span><span class="annot"><span class="annottext">[Versions
   NodeToNodeVersion
   versionDataNTN
   (OuroborosBundleWithExpandedCtx
      'InitiatorResponderMode
      addrNTN
      ByteString
      m
      NodeToNodeInitiatorResult
      ())]
-&gt; Versions
     NodeToNodeVersion
     versionDataNTN
     (OuroborosBundleWithExpandedCtx
        'InitiatorResponderMode
        addrNTN
        ByteString
        m
        NodeToNodeInitiatorResult
        ())
forall vNum (f :: * -&gt; *) extra r.
(Ord vNum, Foldable f, HasCallStack) =&gt;
f (Versions vNum extra r) -&gt; Versions vNum extra r
</span><span class="hs-identifier hs-var">combineVersions</span></span><span>
</span><span id="line-536"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
-&gt; versionDataNTN
-&gt; OuroborosBundleWithExpandedCtx
     'InitiatorResponderMode
     addrNTN
     ByteString
     m
     NodeToNodeInitiatorResult
     ()
-&gt; Versions
     NodeToNodeVersion
     versionDataNTN
     (OuroborosBundleWithExpandedCtx
        'InitiatorResponderMode
        addrNTN
        ByteString
        m
        NodeToNodeInitiatorResult
        ())
forall vNum vData r. vNum -&gt; vData -&gt; r -&gt; Versions vNum vData r
</span><span class="hs-identifier hs-var">simpleSingletonVersions</span></span><span>
</span><span id="line-537"></span><span>                    </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621679185888"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-538"></span><span>                    </span><span class="annot"><span class="annottext">versionDataNTN
</span><a href="#local-6989586621679185753"><span class="hs-identifier hs-var">llrnVersionDataNTN</span></a></span><span>
</span><span id="line-539"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MiniProtocolParameters
-&gt; NodeToNodeVersion
-&gt; PeerSharing
-&gt; Apps
     m
     addrNTN
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     NodeToNodeInitiatorResult
     ()
-&gt; OuroborosBundleWithExpandedCtx
     'InitiatorResponderMode
     addrNTN
     ByteString
     m
     NodeToNodeInitiatorResult
     ()
forall (m :: * -&gt; *) addr b a c.
MiniProtocolParameters
-&gt; NodeToNodeVersion
-&gt; PeerSharing
-&gt; Apps m addr b b b b b a c
-&gt; OuroborosBundleWithExpandedCtx
     'InitiatorResponderMode addr b m a c
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#initiatorAndResponder"><span class="hs-identifier hs-var">NTN.initiatorAndResponder</span></a></span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621679185849"><span class="hs-identifier hs-var">miniProtocolParams</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621679185888"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSharing
</span><a href="#local-6989586621679185740"><span class="hs-identifier hs-var">rnPeerSharing</span></a></span><span>
</span><span id="line-540"></span><span>                      </span><span class="annot"><span class="annottext">(Apps
   m
   addrNTN
   ByteString
   ByteString
   ByteString
   ByteString
   ByteString
   NodeToNodeInitiatorResult
   ()
 -&gt; OuroborosBundleWithExpandedCtx
      'InitiatorResponderMode
      addrNTN
      ByteString
      m
      NodeToNodeInitiatorResult
      ())
-&gt; Apps
     m
     addrNTN
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     NodeToNodeInitiatorResult
     ()
-&gt; OuroborosBundleWithExpandedCtx
     'InitiatorResponderMode
     addrNTN
     ByteString
     m
     NodeToNodeInitiatorResult
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
-&gt; (PeerSharingAmount -&gt; m [addrNTN])
-&gt; Apps
     m
     addrNTN
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     NodeToNodeInitiatorResult
     ()
</span><a href="#local-6989586621679185850"><span class="hs-identifier hs-var">ntnApps</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679185890"><span class="hs-identifier hs-var">blockVersion</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSharingAmount -&gt; m [addrNTN]
</span><a href="#local-6989586621679185887"><span class="hs-identifier hs-var">computePeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679185888"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621679185888"><span class="hs-identifier hs-var">version</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679185890"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621679185890"><span class="hs-identifier hs-var">blockVersion</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
-&gt; [(NodeToNodeVersion, BlockNodeToNodeVersion blk)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
</span><a href="#local-6989586621679185754"><span class="hs-identifier hs-var">llrnNodeToNodeVersions</span></a></span><span>
</span><span id="line-542"></span><span>                </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-543"></span><span>            </span><span class="annot"><span class="annottext">daLocalResponderApplication :: Versions
  NodeToClientVersion
  versionDataNTC
  (OuroborosApplicationWithMinimalCtx
     'ResponderMode addrNTC ByteString m Void ())
</span><span class="hs-identifier hs-var">Diffusion.daLocalResponderApplication</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-544"></span><span>              </span><span class="annot"><span class="annottext">[Versions
   NodeToClientVersion
   versionDataNTC
   (OuroborosApplicationWithMinimalCtx
      'ResponderMode addrNTC ByteString m Void ())]
-&gt; Versions
     NodeToClientVersion
     versionDataNTC
     (OuroborosApplicationWithMinimalCtx
        'ResponderMode addrNTC ByteString m Void ())
forall vNum (f :: * -&gt; *) extra r.
(Ord vNum, Foldable f, HasCallStack) =&gt;
f (Versions vNum extra r) -&gt; Versions vNum extra r
</span><span class="hs-identifier hs-var">combineVersions</span></span><span>
</span><span id="line-545"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">NodeToClientVersion
-&gt; versionDataNTC
-&gt; OuroborosApplicationWithMinimalCtx
     'ResponderMode addrNTC ByteString m Void ()
-&gt; Versions
     NodeToClientVersion
     versionDataNTC
     (OuroborosApplicationWithMinimalCtx
        'ResponderMode addrNTC ByteString m Void ())
forall vNum vData r. vNum -&gt; vData -&gt; r -&gt; Versions vNum vData r
</span><span class="hs-identifier hs-var">simpleSingletonVersions</span></span><span>
</span><span id="line-546"></span><span>                    </span><span class="annot"><span class="annottext">NodeToClientVersion
</span><a href="#local-6989586621679185892"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-547"></span><span>                    </span><span class="annot"><span class="annottext">versionDataNTC
</span><a href="#local-6989586621679185752"><span class="hs-identifier hs-var">llrnVersionDataNTC</span></a></span><span>
</span><span id="line-548"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToClientVersion
-&gt; Apps
     m
     (ConnectionId addrNTC)
     ByteString
     ByteString
     ByteString
     ByteString
     ()
-&gt; OuroborosApplicationWithMinimalCtx
     'ResponderMode addrNTC ByteString m Void ()
forall (m :: * -&gt; *) peer b a.
NodeToClientVersion
-&gt; Apps m (ConnectionId peer) b b b b a
-&gt; OuroborosApplicationWithMinimalCtx
     'ResponderMode peer b m Void a
</span><a href="Ouroboros.Consensus.Network.NodeToClient.html#responder"><span class="hs-identifier hs-var">NTC.responder</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToClientVersion
</span><a href="#local-6989586621679185892"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">(Apps
   m
   (ConnectionId addrNTC)
   ByteString
   ByteString
   ByteString
   ByteString
   ()
 -&gt; OuroborosApplicationWithMinimalCtx
      'ResponderMode addrNTC ByteString m Void ())
-&gt; Apps
     m
     (ConnectionId addrNTC)
     ByteString
     ByteString
     ByteString
     ByteString
     ()
-&gt; OuroborosApplicationWithMinimalCtx
     'ResponderMode addrNTC ByteString m Void ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
-&gt; NodeToClientVersion
-&gt; Apps
     m
     (ConnectionId addrNTC)
     ByteString
     ByteString
     ByteString
     ByteString
     ()
</span><a href="#local-6989586621679185851"><span class="hs-identifier hs-var">ntcApps</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679185894"><span class="hs-identifier hs-var">blockVersion</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToClientVersion
</span><a href="#local-6989586621679185892"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679185892"><span class="annot"><span class="annottext">NodeToClientVersion
</span><a href="#local-6989586621679185892"><span class="hs-identifier hs-var">version</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679185894"><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621679185894"><span class="hs-identifier hs-var">blockVersion</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map NodeToClientVersion (BlockNodeToClientVersion blk)
-&gt; [(NodeToClientVersion, BlockNodeToClientVersion blk)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeToClientVersion (BlockNodeToClientVersion blk)
</span><a href="#local-6989586621679185755"><span class="hs-identifier hs-var">llrnNodeToClientVersions</span></a></span><span>
</span><span id="line-550"></span><span>                </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-551"></span><span>            </span><span class="annot"><span class="annottext">daLedgerPeersCtx :: LedgerPeersConsensusInterface m
</span><span class="hs-identifier hs-var">Diffusion.daLedgerPeersCtx</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-552"></span><span>              </span><span class="annot"><span class="annottext">(SlotNo -&gt; STM m (Maybe [(PoolStake, NonEmpty RelayAccessPoint)]))
-&gt; LedgerPeersConsensusInterface m
forall (m :: * -&gt; *).
(SlotNo -&gt; STM m (Maybe [(PoolStake, NonEmpty RelayAccessPoint)]))
-&gt; LedgerPeersConsensusInterface m
</span><span class="hs-identifier hs-var">LedgerPeersConsensusInterface</span></span><span>
</span><span id="line-553"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
-&gt; SlotNo -&gt; STM m (Maybe [(PoolStake, NonEmpty RelayAccessPoint)])
forall (m :: * -&gt; *) blk addrNTN addrNTC.
(IOLike m, LedgerSupportsPeerSelection blk, UpdateLedger blk) =&gt;
NodeKernel m addrNTN addrNTC blk
-&gt; SlotNo -&gt; STM m (Maybe [(PoolStake, NonEmpty RelayAccessPoint)])
</span><a href="Ouroboros.Consensus.NodeKernel.html#getPeersFromCurrentLedgerAfterSlot"><span class="hs-identifier hs-var">getPeersFromCurrentLedgerAfterSlot</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185852"><span class="hs-identifier hs-var">kernel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span>        </span><span class="annot"><a href="#local-6989586621679185866"><span class="hs-identifier hs-type">localRethrowPolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RethrowPolicy</span></span><span>
</span><span id="line-557"></span><span>        </span><span id="local-6989586621679185866"><span class="annot"><span class="annottext">localRethrowPolicy :: RethrowPolicy
</span><a href="#local-6989586621679185866"><span class="hs-identifier hs-var hs-var">localRethrowPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RethrowPolicy
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span>    </span><span id="local-6989586621679184955"><span class="annot"><a href="#local-6989586621679185763"><span class="hs-identifier hs-type">runPredicate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Contravariant.html#Predicate"><span class="hs-identifier hs-type">Predicate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184955"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679184955"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184955"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-560"></span><span>    </span><span id="local-6989586621679185763"><span class="annot"><span class="annottext">runPredicate :: forall a. Predicate a -&gt; a -&gt; Maybe a
</span><a href="#local-6989586621679185763"><span class="hs-identifier hs-var hs-var">runPredicate</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Contravariant.html#Predicate"><span class="hs-identifier hs-type">Predicate</span></a></span><span> </span><span id="local-6989586621679185898"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679185898"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679185899"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679185899"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679185898"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679185899"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679185899"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span class="hs-comment">-- | Check the DB marker, lock the DB and look for the clean shutdown marker.</span><span>
</span><span id="line-564"></span><span class="hs-comment">--</span><span>
</span><span id="line-565"></span><span class="hs-comment">-- Run the body action with the DB locked.</span><span>
</span><span id="line-566"></span><span class="hs-comment">--</span><span>
</span><span id="line-567"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdWithCheckedDB"><span class="hs-identifier hs-type">stdWithCheckedDB</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-568"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679185158"><span class="annot"><a href="#local-6989586621679185158"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span id="local-6989586621679185160"><span class="annot"><a href="#local-6989586621679185160"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StandardHash</span></span><span> </span><span class="annot"><a href="#local-6989586621679185158"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185158"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Proxy.html#Proxy"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185158"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-570"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-571"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NetworkMagic</span></span><span>
</span><span id="line-572"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Node.Recovery.html#LastShutDownWasClean"><span class="hs-identifier hs-type">LastShutDownWasClean</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ChainDB</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185158"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185160"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185160"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185160"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Body action with last shutdown was clean.</span></span><span>
</span><span id="line-573"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185160"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-574"></span><span id="stdWithCheckedDB"><span class="annot"><span class="annottext">stdWithCheckedDB :: forall blk a.
(StandardHash blk, Typeable blk) =&gt;
Proxy blk
-&gt; String
-&gt; NetworkMagic
-&gt; (LastShutDownWasClean
    -&gt; (ChainDB IO blk -&gt; IO a -&gt; IO a) -&gt; IO a)
-&gt; IO a
</span><a href="Ouroboros.Consensus.Node.html#stdWithCheckedDB"><span class="hs-identifier hs-var hs-var">stdWithCheckedDB</span></a></span></span><span> </span><span id="local-6989586621679185915"><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621679185915"><span class="hs-identifier hs-var">pb</span></a></span></span><span> </span><span id="local-6989586621679185916"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679185916"><span class="hs-identifier hs-var">databasePath</span></a></span></span><span> </span><span id="local-6989586621679185917"><span class="annot"><span class="annottext">NetworkMagic
</span><a href="#local-6989586621679185917"><span class="hs-identifier hs-var">networkMagic</span></a></span></span><span> </span><span id="local-6989586621679185918"><span class="annot"><span class="annottext">LastShutDownWasClean -&gt; (ChainDB IO blk -&gt; IO a -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621679185918"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span>    </span><span class="hs-comment">-- Check the DB marker first, before doing the lock file, since if the</span><span>
</span><span id="line-577"></span><span>    </span><span class="hs-comment">-- marker is not present, it expects an empty DB dir.</span><span>
</span><span id="line-578"></span><span>    </span><span class="annot"><span class="annottext">(DbMarkerError -&gt; IO ())
-&gt; (() -&gt; IO ()) -&gt; Either DbMarkerError () -&gt; IO ()
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">DbMarkerError -&gt; IO ()
forall e a. Exception e =&gt; e -&gt; IO a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either DbMarkerError () -&gt; IO ())
-&gt; IO (Either DbMarkerError ()) -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">HasFS IO HandleIO
-&gt; MountPoint -&gt; NetworkMagic -&gt; IO (Either DbMarkerError ())
forall (m :: * -&gt; *) h.
MonadThrow m =&gt;
HasFS m h
-&gt; MountPoint -&gt; NetworkMagic -&gt; m (Either DbMarkerError ())
</span><a href="Ouroboros.Consensus.Node.DbMarker.html#checkDbMarker"><span class="hs-identifier hs-var">checkDbMarker</span></a></span><span>
</span><span id="line-579"></span><span>      </span><span class="annot"><span class="annottext">HasFS IO HandleIO
</span><a href="#local-6989586621679185922"><span class="hs-identifier hs-var">hasFS</span></a></span><span>
</span><span id="line-580"></span><span>      </span><span class="annot"><span class="annottext">MountPoint
</span><a href="#local-6989586621679185923"><span class="hs-identifier hs-var">mountPoint</span></a></span><span>
</span><span id="line-581"></span><span>      </span><span class="annot"><span class="annottext">NetworkMagic
</span><a href="#local-6989586621679185917"><span class="hs-identifier hs-var">networkMagic</span></a></span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span>    </span><span class="hs-comment">-- Then create the lock file.</span><span>
</span><span id="line-584"></span><span>    </span><span class="annot"><span class="annottext">MountPoint -&gt; IO a -&gt; IO a
forall a. MountPoint -&gt; IO a -&gt; IO a
</span><a href="Ouroboros.Consensus.Node.DbLock.html#withLockDB"><span class="hs-identifier hs-var">withLockDB</span></a></span><span> </span><span class="annot"><span class="annottext">MountPoint
</span><a href="#local-6989586621679185923"><span class="hs-identifier hs-var">mountPoint</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO a) -&gt; IO a -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
-&gt; HasFS IO HandleIO
-&gt; (LastShutDownWasClean
    -&gt; (ChainDB IO blk -&gt; IO a -&gt; IO a) -&gt; IO a)
-&gt; IO a
forall a (m :: * -&gt; *) h blk.
(IOLike m, StandardHash blk, Typeable blk) =&gt;
Proxy blk
-&gt; HasFS m h
-&gt; (LastShutDownWasClean -&gt; (ChainDB m blk -&gt; m a -&gt; m a) -&gt; m a)
-&gt; m a
</span><a href="Ouroboros.Consensus.Node.Recovery.html#runWithCheckedDB"><span class="hs-identifier hs-var">runWithCheckedDB</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk
</span><a href="#local-6989586621679185915"><span class="hs-identifier hs-var">pb</span></a></span><span> </span><span class="annot"><span class="annottext">HasFS IO HandleIO
</span><a href="#local-6989586621679185922"><span class="hs-identifier hs-var">hasFS</span></a></span><span> </span><span class="annot"><span class="annottext">LastShutDownWasClean -&gt; (ChainDB IO blk -&gt; IO a -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621679185918"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-585"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-586"></span><span>    </span><span id="local-6989586621679185923"><span class="annot"><span class="annottext">mountPoint :: MountPoint
</span><a href="#local-6989586621679185923"><span class="hs-identifier hs-var hs-var">mountPoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MountPoint
</span><span class="hs-identifier hs-var">MountPoint</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679185916"><span class="hs-identifier hs-var">databasePath</span></a></span><span>
</span><span id="line-587"></span><span>    </span><span id="local-6989586621679185922"><span class="annot"><span class="annottext">hasFS :: HasFS IO HandleIO
</span><a href="#local-6989586621679185922"><span class="hs-identifier hs-var hs-var">hasFS</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MountPoint -&gt; HasFS IO HandleIO
forall (m :: * -&gt; *). MonadIO m =&gt; MountPoint -&gt; HasFS m HandleIO
</span><span class="hs-identifier hs-var">ioHasFS</span></span><span> </span><span class="annot"><span class="annottext">MountPoint
</span><a href="#local-6989586621679185923"><span class="hs-identifier hs-var">mountPoint</span></a></span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#openChainDB"><span class="hs-identifier hs-type">openChainDB</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-590"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679184995"><span class="annot"><a href="#local-6989586621679184995"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679184994"><span class="annot"><a href="#local-6989586621679184994"><span class="hs-identifier hs-type">blk</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RunNode</span></span><span> </span><span class="annot"><a href="#local-6989586621679184994"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IOLike</span></span><span> </span><span class="annot"><a href="#local-6989586621679184995"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ResourceRegistry</span></span><span> </span><span class="annot"><a href="#local-6989586621679184995"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-592"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CheckInFuture</span></span><span> </span><span class="annot"><a href="#local-6989586621679184995"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184994"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-593"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TopLevelConfig</span></span><span> </span><span class="annot"><a href="#local-6989586621679184994"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-594"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExtLedgerState</span></span><span> </span><span class="annot"><a href="#local-6989586621679184994"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-595"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Initial ledger</span></span><span>
</span><span id="line-596"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ChainDbArgs</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defaults</span></span><span> </span><span class="annot"><a href="#local-6989586621679184995"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184994"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ChainDbArgs</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Identity.html#Identity"><span class="hs-identifier hs-type">Identity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184995"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184994"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ChainDbArgs</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Identity.html#Identity"><span class="hs-identifier hs-type">Identity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184995"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184994"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Customise the 'ChainDbArgs'</span></span><span>
</span><span id="line-599"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679184995"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ChainDB</span></span><span> </span><span class="annot"><a href="#local-6989586621679184995"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184994"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span id="openChainDB"><span class="annot"><span class="annottext">openChainDB :: forall (m :: * -&gt; *) blk.
(RunNode blk, IOLike m) =&gt;
ResourceRegistry m
-&gt; CheckInFuture m blk
-&gt; TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; ChainDbArgs Defaults m blk
-&gt; (ChainDbArgs Identity m blk -&gt; ChainDbArgs Identity m blk)
-&gt; m (ChainDB m blk)
</span><a href="Ouroboros.Consensus.Node.html#openChainDB"><span class="hs-identifier hs-var hs-var">openChainDB</span></a></span></span><span> </span><span id="local-6989586621679185946"><span class="annot"><span class="annottext">ResourceRegistry m
</span><a href="#local-6989586621679185946"><span class="hs-identifier hs-var">registry</span></a></span></span><span> </span><span id="local-6989586621679185947"><span class="annot"><span class="annottext">CheckInFuture m blk
</span><a href="#local-6989586621679185947"><span class="hs-identifier hs-var">inFuture</span></a></span></span><span> </span><span id="local-6989586621679185948"><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679185948"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621679185949"><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621679185949"><span class="hs-identifier hs-var">initLedger</span></a></span></span><span> </span><span id="local-6989586621679185950"><span class="annot"><span class="annottext">ChainDbArgs Defaults m blk
</span><a href="#local-6989586621679185950"><span class="hs-identifier hs-var">defArgs</span></a></span></span><span> </span><span id="local-6989586621679185951"><span class="annot"><span class="annottext">ChainDbArgs Identity m blk -&gt; ChainDbArgs Identity m blk
</span><a href="#local-6989586621679185951"><span class="hs-identifier hs-var">customiseArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-601"></span><span>    </span><span class="annot"><span class="annottext">ChainDbArgs Identity m blk -&gt; m (ChainDB m blk)
forall (m :: * -&gt; *) blk.
(IOLike m, LedgerSupportsProtocol blk, InspectLedger blk,
 HasHardForkHistory blk, ConvertRawHash blk,
 SerialiseDiskConstraints blk) =&gt;
ChainDbArgs Identity m blk -&gt; m (ChainDB m blk)
</span><span class="hs-identifier hs-var">ChainDB.openDB</span></span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity m blk
</span><a href="#local-6989586621679185953"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-602"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-603"></span><span>    </span><span class="annot"><a href="#local-6989586621679185953"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ChainDbArgs</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Identity.html#Identity"><span class="hs-identifier hs-type">Identity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184995"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184994"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-604"></span><span>    </span><span id="local-6989586621679185953"><span class="annot"><span class="annottext">args :: ChainDbArgs Identity m blk
</span><a href="#local-6989586621679185953"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity m blk -&gt; ChainDbArgs Identity m blk
</span><a href="#local-6989586621679185951"><span class="hs-identifier hs-var">customiseArgs</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainDbArgs Identity m blk -&gt; ChainDbArgs Identity m blk)
-&gt; ChainDbArgs Identity m blk -&gt; ChainDbArgs Identity m blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-605"></span><span>             </span><span class="annot"><span class="annottext">ResourceRegistry m
-&gt; CheckInFuture m blk
-&gt; TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; ChunkInfo
-&gt; ChainDbArgs Defaults m blk
-&gt; ChainDbArgs Identity m blk
forall (m :: * -&gt; *) blk.
(RunNode blk, IOLike m) =&gt;
ResourceRegistry m
-&gt; CheckInFuture m blk
-&gt; TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; ChunkInfo
-&gt; ChainDbArgs Defaults m blk
-&gt; ChainDbArgs Identity m blk
</span><a href="Ouroboros.Consensus.Node.html#mkChainDbArgs"><span class="hs-identifier hs-var">mkChainDbArgs</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRegistry m
</span><a href="#local-6989586621679185946"><span class="hs-identifier hs-var">registry</span></a></span><span> </span><span class="annot"><span class="annottext">CheckInFuture m blk
</span><a href="#local-6989586621679185947"><span class="hs-identifier hs-var">inFuture</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679185948"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621679185949"><span class="hs-identifier hs-var">initLedger</span></a></span><span>
</span><span id="line-606"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StorageConfig blk -&gt; ChunkInfo
forall blk. NodeInitStorage blk =&gt; StorageConfig blk -&gt; ChunkInfo
</span><span class="hs-identifier hs-var">nodeImmutableDbChunkInfo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; StorageConfig blk
forall blk. TopLevelConfig blk -&gt; StorageConfig blk
</span><span class="hs-identifier hs-var">configStorage</span></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679185948"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span>             </span><span class="annot"><span class="annottext">ChainDbArgs Defaults m blk
</span><a href="#local-6989586621679185950"><span class="hs-identifier hs-var">defArgs</span></a></span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#mkChainDbArgs"><span class="hs-identifier hs-type">mkChainDbArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-610"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679185190"><span class="annot"><a href="#local-6989586621679185190"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679185189"><span class="annot"><a href="#local-6989586621679185189"><span class="hs-identifier hs-type">blk</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RunNode</span></span><span> </span><span class="annot"><a href="#local-6989586621679185189"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IOLike</span></span><span> </span><span class="annot"><a href="#local-6989586621679185190"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ResourceRegistry</span></span><span> </span><span class="annot"><a href="#local-6989586621679185190"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-612"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CheckInFuture</span></span><span> </span><span class="annot"><a href="#local-6989586621679185190"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185189"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-613"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TopLevelConfig</span></span><span> </span><span class="annot"><a href="#local-6989586621679185189"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-614"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExtLedgerState</span></span><span> </span><span class="annot"><a href="#local-6989586621679185189"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-615"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Initial ledger</span></span><span>
</span><span id="line-616"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ChunkInfo</span></span><span>
</span><span id="line-617"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ChainDbArgs</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defaults</span></span><span> </span><span class="annot"><a href="#local-6989586621679185190"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185189"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ChainDbArgs</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Identity.html#Identity"><span class="hs-identifier hs-type">Identity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185190"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185189"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-619"></span><span id="mkChainDbArgs"><span class="annot"><span class="annottext">mkChainDbArgs :: forall (m :: * -&gt; *) blk.
(RunNode blk, IOLike m) =&gt;
ResourceRegistry m
-&gt; CheckInFuture m blk
-&gt; TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; ChunkInfo
-&gt; ChainDbArgs Defaults m blk
-&gt; ChainDbArgs Identity m blk
</span><a href="Ouroboros.Consensus.Node.html#mkChainDbArgs"><span class="hs-identifier hs-var hs-var">mkChainDbArgs</span></a></span></span><span>
</span><span id="line-620"></span><span>  </span><span id="local-6989586621679185965"><span class="annot"><span class="annottext">ResourceRegistry m
</span><a href="#local-6989586621679185965"><span class="hs-identifier hs-var">registry</span></a></span></span><span>
</span><span id="line-621"></span><span>  </span><span id="local-6989586621679185966"><span class="annot"><span class="annottext">CheckInFuture m blk
</span><a href="#local-6989586621679185966"><span class="hs-identifier hs-var">inFuture</span></a></span></span><span>
</span><span id="line-622"></span><span>  </span><span id="local-6989586621679185967"><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679185967"><span class="hs-identifier hs-var">cfg</span></a></span></span><span>
</span><span id="line-623"></span><span>  </span><span id="local-6989586621679185968"><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621679185968"><span class="hs-identifier hs-var">initLedger</span></a></span></span><span>
</span><span id="line-624"></span><span>  </span><span id="local-6989586621679185969"><span class="annot"><span class="annottext">ChunkInfo
</span><a href="#local-6989586621679185969"><span class="hs-identifier hs-var">chunkInfo</span></a></span></span><span>
</span><span id="line-625"></span><span>  </span><span id="local-6989586621679185970"><span class="annot"><span class="annottext">ChainDbArgs Defaults m blk
</span><a href="#local-6989586621679185970"><span class="hs-identifier hs-var">defArgs</span></a></span></span><span>
</span><span id="line-626"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Defaults m blk
</span><a href="#local-6989586621679185970"><span class="hs-identifier hs-var">defArgs</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-627"></span><span>      </span><span class="annot"><span class="hs-identifier hs-var">ChainDB.cdbTopLevelConfig</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679185967"><span class="hs-identifier hs-type">cfg</span></a></span><span>
</span><span id="line-628"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">ChainDB.cdbChunkInfo</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679185969"><span class="hs-identifier hs-type">chunkInfo</span></a></span><span>
</span><span id="line-629"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">ChainDB.cdbCheckIntegrity</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">nodeCheckIntegrity</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">configStorage</span></span><span> </span><span class="annot"><a href="#local-6989586621679185967"><span class="hs-identifier hs-type">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">ChainDB.cdbGenesis</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185968"><span class="hs-identifier hs-type">initLedger</span></a></span><span>
</span><span id="line-631"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">ChainDB.cdbCheckInFuture</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679185966"><span class="hs-identifier hs-type">inFuture</span></a></span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">ChainDB.cdbRegistry</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679185965"><span class="hs-identifier hs-type">registry</span></a></span><span>
</span><span id="line-634"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-635"></span><span>
</span><span id="line-636"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#mkNodeKernelArgs"><span class="hs-identifier hs-type">mkNodeKernelArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-637"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679185023"><span class="annot"><a href="#local-6989586621679185023"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679185024"><span class="annot"><a href="#local-6989586621679185024"><span class="hs-identifier hs-type">addrNTN</span></a></span></span><span> </span><span id="local-6989586621679185025"><span class="annot"><a href="#local-6989586621679185025"><span class="hs-identifier hs-type">addrNTC</span></a></span></span><span> </span><span id="local-6989586621679185022"><span class="annot"><a href="#local-6989586621679185022"><span class="hs-identifier hs-type">blk</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RunNode</span></span><span> </span><span class="annot"><a href="#local-6989586621679185022"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IOLike</span></span><span> </span><span class="annot"><a href="#local-6989586621679185023"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-638"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ResourceRegistry</span></span><span> </span><span class="annot"><a href="#local-6989586621679185023"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-639"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-640"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span>
</span><span id="line-641"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TopLevelConfig</span></span><span> </span><span class="annot"><a href="#local-6989586621679185022"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-642"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Tracers.html#Tracers"><span class="hs-identifier hs-type">Tracers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185023"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679185024"><span class="hs-identifier hs-type">addrNTN</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679185025"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679185022"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-643"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BlockchainTime</span></span><span> </span><span class="annot"><a href="#local-6989586621679185023"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-644"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InFutureCheck.SomeHeaderInFutureCheck</span></span><span> </span><span class="annot"><a href="#local-6989586621679185023"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185022"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-645"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ChainDB</span></span><span> </span><span class="annot"><a href="#local-6989586621679185023"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185022"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-646"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679185023"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185023"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185024"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679185025"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679185022"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span id="mkNodeKernelArgs"><span class="annot"><span class="annottext">mkNodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
(RunNode blk, IOLike m) =&gt;
ResourceRegistry m
-&gt; Int
-&gt; StdGen
-&gt; TopLevelConfig blk
-&gt; Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
-&gt; BlockchainTime m
-&gt; SomeHeaderInFutureCheck m blk
-&gt; ChainDB m blk
-&gt; m (NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
</span><a href="Ouroboros.Consensus.Node.html#mkNodeKernelArgs"><span class="hs-identifier hs-var hs-var">mkNodeKernelArgs</span></a></span></span><span>
</span><span id="line-648"></span><span>  </span><span id="local-6989586621679185993"><span class="annot"><span class="annottext">ResourceRegistry m
</span><a href="#local-6989586621679185993"><span class="hs-identifier hs-var">registry</span></a></span></span><span>
</span><span id="line-649"></span><span>  </span><span id="local-6989586621679185994"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679185994"><span class="hs-identifier hs-var">bfcSalt</span></a></span></span><span>
</span><span id="line-650"></span><span>  </span><span id="local-6989586621679185995"><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679185995"><span class="hs-identifier hs-var">keepAliveRng</span></a></span></span><span>
</span><span id="line-651"></span><span>  </span><span id="local-6989586621679185996"><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679185996"><span class="hs-identifier hs-var">cfg</span></a></span></span><span>
</span><span id="line-652"></span><span>  </span><span id="local-6989586621679185997"><span class="annot"><span class="annottext">Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185997"><span class="hs-identifier hs-var">tracers</span></a></span></span><span>
</span><span id="line-653"></span><span>  </span><span id="local-6989586621679185998"><span class="annot"><span class="annottext">BlockchainTime m
</span><a href="#local-6989586621679185998"><span class="hs-identifier hs-var">btime</span></a></span></span><span>
</span><span id="line-654"></span><span>  </span><span id="local-6989586621679185999"><span class="annot"><span class="annottext">SomeHeaderInFutureCheck m blk
</span><a href="#local-6989586621679185999"><span class="hs-identifier hs-var">chainSyncFutureCheck</span></a></span></span><span>
</span><span id="line-655"></span><span>  </span><span id="local-6989586621679186000"><span class="annot"><span class="annottext">ChainDB m blk
</span><a href="#local-6989586621679186000"><span class="hs-identifier hs-var">chainDB</span></a></span></span><span>
</span><span id="line-656"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-657"></span><span>    </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; m (NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span>
</span><span id="line-658"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
tracers :: Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
$sel:tracers:NodeKernelArgs :: Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679185997"><span class="hs-identifier hs-var hs-var">tracers</span></a></span><span>
</span><span id="line-659"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ResourceRegistry m
registry :: ResourceRegistry m
$sel:registry:NodeKernelArgs :: ResourceRegistry m
</span><a href="#local-6989586621679185993"><span class="hs-identifier hs-var hs-var">registry</span></a></span><span>
</span><span id="line-660"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
cfg :: TopLevelConfig blk
$sel:cfg:NodeKernelArgs :: TopLevelConfig blk
</span><a href="#local-6989586621679185996"><span class="hs-identifier hs-var hs-var">cfg</span></a></span><span>
</span><span id="line-661"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BlockchainTime m
btime :: BlockchainTime m
$sel:btime:NodeKernelArgs :: BlockchainTime m
</span><a href="#local-6989586621679185998"><span class="hs-identifier hs-var hs-var">btime</span></a></span><span>
</span><span id="line-662"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ChainDB m blk
chainDB :: ChainDB m blk
$sel:chainDB:NodeKernelArgs :: ChainDB m blk
</span><a href="#local-6989586621679186000"><span class="hs-identifier hs-var hs-var">chainDB</span></a></span><span>
</span><span id="line-663"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:initChainDB:NodeKernelArgs :: StorageConfig blk -&gt; InitChainDB m blk -&gt; m ()
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AinitChainDB%3ANodeKernelArgs"><span class="hs-identifier hs-var">initChainDB</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StorageConfig blk -&gt; InitChainDB m blk -&gt; m ()
forall blk (m :: * -&gt; *).
(NodeInitStorage blk, IOLike m) =&gt;
StorageConfig blk -&gt; InitChainDB m blk -&gt; m ()
forall (m :: * -&gt; *).
IOLike m =&gt;
StorageConfig blk -&gt; InitChainDB m blk -&gt; m ()
</span><span class="hs-identifier hs-var">nodeInitChainDB</span></span><span>
</span><span id="line-664"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SomeHeaderInFutureCheck m blk
chainSyncFutureCheck :: SomeHeaderInFutureCheck m blk
$sel:chainSyncFutureCheck:NodeKernelArgs :: SomeHeaderInFutureCheck m blk
</span><a href="#local-6989586621679185999"><span class="hs-identifier hs-var hs-var">chainSyncFutureCheck</span></a></span><span>
</span><span id="line-665"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:blockFetchSize:NodeKernelArgs :: Header blk -&gt; SizeInBytes
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AblockFetchSize%3ANodeKernelArgs"><span class="hs-identifier hs-var">blockFetchSize</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Header blk -&gt; SizeInBytes
forall blk.
SerialiseNodeToNodeConstraints blk =&gt;
Header blk -&gt; SizeInBytes
</span><span class="hs-identifier hs-var">estimateBlockSize</span></span><span>
</span><span id="line-666"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:mempoolCapacityOverride:NodeKernelArgs :: MempoolCapacityBytesOverride
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AmempoolCapacityOverride%3ANodeKernelArgs"><span class="hs-identifier hs-var">mempoolCapacityOverride</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MempoolCapacityBytesOverride
</span><span class="hs-identifier hs-var">NoMempoolCapacityBytesOverride</span></span><span>
</span><span id="line-667"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:miniProtocolParameters:NodeKernelArgs :: MiniProtocolParameters
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AminiProtocolParameters%3ANodeKernelArgs"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><span class="hs-identifier hs-var">defaultMiniProtocolParameters</span></span><span>
</span><span id="line-668"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:blockFetchConfiguration:NodeKernelArgs :: BlockFetchConfiguration
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AblockFetchConfiguration%3ANodeKernelArgs"><span class="hs-identifier hs-var">blockFetchConfiguration</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockFetchConfiguration
</span><a href="#local-6989586621679186015"><span class="hs-identifier hs-var">defaultBlockFetchConfiguration</span></a></span><span>
</span><span id="line-669"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StdGen
keepAliveRng :: StdGen
keepAliveRng :: StdGen
</span><a href="Ouroboros.Consensus.NodeKernel.html#keepAliveRng"><span class="hs-identifier hs-var hs-var">keepAliveRng</span></a></span><span>
</span><span id="line-670"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-672"></span><span>    </span><span class="annot"><a href="#local-6989586621679186015"><span class="hs-identifier hs-type">defaultBlockFetchConfiguration</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BlockFetchConfiguration</span></span><span>
</span><span id="line-673"></span><span>    </span><span id="local-6989586621679186015"><span class="annot"><span class="annottext">defaultBlockFetchConfiguration :: BlockFetchConfiguration
</span><a href="#local-6989586621679186015"><span class="hs-identifier hs-var hs-var">defaultBlockFetchConfiguration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BlockFetchConfiguration</span></span><span>
</span><span id="line-674"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bfcMaxConcurrencyBulkSync :: Word
</span><span class="hs-identifier hs-var">bfcMaxConcurrencyBulkSync</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span>
</span><span id="line-675"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bfcMaxConcurrencyDeadline :: Word
</span><span class="hs-identifier hs-var">bfcMaxConcurrencyDeadline</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span>
</span><span id="line-676"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bfcMaxRequestsInflight :: Word
</span><span class="hs-identifier hs-var">bfcMaxRequestsInflight</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; Word) -&gt; Word16 -&gt; Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters -&gt; Word16
</span><span class="hs-identifier hs-var">blockFetchPipeliningMax</span></span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><span class="hs-identifier hs-var">defaultMiniProtocolParameters</span></span><span>
</span><span id="line-677"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bfcDecisionLoopInterval :: DiffTime
</span><span class="hs-identifier hs-var">bfcDecisionLoopInterval</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">0.01</span></span><span> </span><span class="hs-comment">-- 10ms</span><span>
</span><span id="line-678"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
bfcSalt :: Int
bfcSalt :: Int
</span><span class="hs-identifier hs-var hs-var">bfcSalt</span></span><span>
</span><span id="line-679"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span class="hs-comment">-- | We allow the user running the node to customise the 'NodeKernelArgs'</span><span>
</span><span id="line-682"></span><span class="hs-comment">-- through 'llrnCustomiseNodeKernelArgs', but there are some limits to some</span><span>
</span><span id="line-683"></span><span class="hs-comment">-- values. This function makes sure we don't exceed those limits and that the</span><span>
</span><span id="line-684"></span><span class="hs-comment">-- values are consistent.</span><span>
</span><span id="line-685"></span><span id="local-6989586621679185014"><span id="local-6989586621679185015"><span id="local-6989586621679185016"><span id="local-6989586621679185017"><span class="annot"><a href="Ouroboros.Consensus.Node.html#nodeKernelArgsEnforceInvariants"><span class="hs-identifier hs-type">nodeKernelArgsEnforceInvariants</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-686"></span><span>     </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185014"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185015"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679185016"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679185017"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-687"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185014"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185015"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679185016"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679185017"><span class="hs-identifier hs-type">blk</span></a></span></span></span></span></span><span>
</span><span id="line-688"></span><span id="nodeKernelArgsEnforceInvariants"><span class="annot"><span class="annottext">nodeKernelArgsEnforceInvariants :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="Ouroboros.Consensus.Node.html#nodeKernelArgsEnforceInvariants"><span class="hs-identifier hs-var hs-var">nodeKernelArgsEnforceInvariants</span></a></span></span><span> </span><span id="local-6989586621679186027"><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679186027"><span class="hs-identifier hs-var">nodeKernelArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679186027"><span class="hs-identifier hs-var">nodeKernelArgs</span></a></span><span>
</span><span id="line-689"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AminiProtocolParameters%3ANodeKernelArgs"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679186028"><span class="hs-identifier hs-type">miniProtocolParameters</span></a></span><span>
</span><span id="line-690"></span><span>        </span><span class="hs-comment">-- If 'blockFetchPipeliningMax' exceeds the configured default, it</span><span>
</span><span id="line-691"></span><span>        </span><span class="hs-comment">-- would be a protocol violation.</span><span>
</span><span id="line-692"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">blockFetchPipeliningMax</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-693"></span><span>            </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#min"><span class="hs-identifier hs-type">min</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-var">blockFetchPipeliningMax</span></span><span> </span><span class="annot"><a href="#local-6989586621679186028"><span class="hs-identifier hs-type">miniProtocolParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-694"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-var">blockFetchPipeliningMax</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">defaultMiniProtocolParameters</span></span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-696"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AblockFetchConfiguration%3ANodeKernelArgs"><span class="hs-identifier hs-var">blockFetchConfiguration</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679186030"><span class="hs-identifier hs-type">blockFetchConfiguration</span></a></span><span>
</span><span id="line-697"></span><span>        </span><span class="hs-comment">-- 'bfcMaxRequestsInflight' must be &lt;= 'blockFetchPipeliningMax'</span><span>
</span><span id="line-698"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">bfcMaxRequestsInflight</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-699"></span><span>            </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#min"><span class="hs-identifier hs-type">min</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-var">bfcMaxRequestsInflight</span></span><span> </span><span class="annot"><a href="#local-6989586621679186030"><span class="hs-identifier hs-type">blockFetchConfiguration</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-700"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-type">fromIntegral</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-var">blockFetchPipeliningMax</span></span><span> </span><span class="annot"><a href="#local-6989586621679186028"><span class="hs-identifier hs-type">miniProtocolParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-702"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-703"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-704"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span class="hs-special">{</span><span id="local-6989586621679186028"><span id="local-6989586621679186030"><span id="local-6989586621679186031"><span id="local-6989586621679186032"><span id="local-6989586621679186033"><span id="local-6989586621679186034"><span id="local-6989586621679186035"><span id="local-6989586621679186036"><span id="local-6989586621679186037"><span id="local-6989586621679186038"><span id="local-6989586621679186039"><span id="local-6989586621679186040"><span class="annot"><span class="annottext">StdGen
BlockchainTime m
ChainDB m blk
ResourceRegistry m
TopLevelConfig blk
SomeHeaderInFutureCheck m blk
MempoolCapacityBytesOverride
BlockFetchConfiguration
Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
MiniProtocolParameters
Header blk -&gt; SizeInBytes
StorageConfig blk -&gt; InitChainDB m blk -&gt; m ()
keepAliveRng :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN addrNTC blk -&gt; StdGen
$sel:miniProtocolParameters:NodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN addrNTC blk -&gt; MiniProtocolParameters
$sel:tracers:NodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN addrNTC blk
-&gt; Tracers m (ConnectionId addrNTN) addrNTC blk
$sel:registry:NodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN addrNTC blk -&gt; ResourceRegistry m
$sel:cfg:NodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN addrNTC blk -&gt; TopLevelConfig blk
$sel:btime:NodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN addrNTC blk -&gt; BlockchainTime m
$sel:chainDB:NodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN addrNTC blk -&gt; ChainDB m blk
$sel:initChainDB:NodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN addrNTC blk
-&gt; StorageConfig blk -&gt; InitChainDB m blk -&gt; m ()
$sel:chainSyncFutureCheck:NodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN addrNTC blk
-&gt; SomeHeaderInFutureCheck m blk
$sel:blockFetchSize:NodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN addrNTC blk -&gt; Header blk -&gt; SizeInBytes
$sel:mempoolCapacityOverride:NodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN addrNTC blk
-&gt; MempoolCapacityBytesOverride
$sel:blockFetchConfiguration:NodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN addrNTC blk -&gt; BlockFetchConfiguration
miniProtocolParameters :: MiniProtocolParameters
blockFetchConfiguration :: BlockFetchConfiguration
tracers :: Tracers m (ConnectionId addrNTN) (ConnectionId addrNTC) blk
registry :: ResourceRegistry m
cfg :: TopLevelConfig blk
btime :: BlockchainTime m
chainDB :: ChainDB m blk
initChainDB :: StorageConfig blk -&gt; InitChainDB m blk -&gt; m ()
chainSyncFutureCheck :: SomeHeaderInFutureCheck m blk
blockFetchSize :: Header blk -&gt; SizeInBytes
mempoolCapacityOverride :: MempoolCapacityBytesOverride
keepAliveRng :: StdGen
</span><a href="Ouroboros.Consensus.NodeKernel.html#keepAliveRng"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679186027"><span class="hs-identifier hs-var">nodeKernelArgs</span></a></span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Arguments for use in the real node
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-709"></span><span>
</span><span id="line-710"></span><span class="annot"><span class="hs-comment">-- | How to locate the ChainDB on disk</span></span><span>
</span><span id="line-711"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdMkChainDbHasFS"><span class="hs-identifier hs-type">stdMkChainDbHasFS</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-712"></span><span>     </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-713"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ChainDB.RelativeMountPoint</span></span><span>
</span><span id="line-714"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeHasFS</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-715"></span><span id="stdMkChainDbHasFS"><span class="annot"><span class="annottext">stdMkChainDbHasFS :: String -&gt; RelativeMountPoint -&gt; SomeHasFS IO
</span><a href="Ouroboros.Consensus.Node.html#stdMkChainDbHasFS"><span class="hs-identifier hs-var hs-var">stdMkChainDbHasFS</span></a></span></span><span> </span><span id="local-6989586621679186041"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679186041"><span class="hs-identifier hs-var">rootPath</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ChainDB.RelativeMountPoint</span></span><span> </span><span id="local-6989586621679186043"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679186043"><span class="hs-identifier hs-var">relPath</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-716"></span><span>    </span><span class="annot"><span class="annottext">HasFS IO HandleIO -&gt; SomeHasFS IO
forall h (m :: * -&gt; *). Eq h =&gt; HasFS m h -&gt; SomeHasFS m
</span><span class="hs-identifier hs-var">SomeHasFS</span></span><span> </span><span class="annot"><span class="annottext">(HasFS IO HandleIO -&gt; SomeHasFS IO)
-&gt; HasFS IO HandleIO -&gt; SomeHasFS IO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MountPoint -&gt; HasFS IO HandleIO
forall (m :: * -&gt; *). MonadIO m =&gt; MountPoint -&gt; HasFS m HandleIO
</span><span class="hs-identifier hs-var">ioHasFS</span></span><span> </span><span class="annot"><span class="annottext">(MountPoint -&gt; HasFS IO HandleIO)
-&gt; MountPoint -&gt; HasFS IO HandleIO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; MountPoint
</span><span class="hs-identifier hs-var">MountPoint</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; MountPoint) -&gt; String -&gt; MountPoint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679186041"><span class="hs-identifier hs-var">rootPath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/filepath-1.4.100.4/src/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679186043"><span class="hs-identifier hs-var">relPath</span></a></span><span>
</span><span id="line-717"></span><span>
</span><span id="line-718"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdBfcSaltIO"><span class="hs-identifier hs-type">stdBfcSaltIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-719"></span><span id="stdBfcSaltIO"><span class="annot"><span class="annottext">stdBfcSaltIO :: IO Int
</span><a href="Ouroboros.Consensus.Node.html#stdBfcSaltIO"><span class="hs-identifier hs-var hs-var">stdBfcSaltIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Int
forall a (m :: * -&gt; *). (Random a, MonadIO m) =&gt; m a
</span><span class="hs-identifier hs-var">randomIO</span></span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdKeepAliveRngIO"><span class="hs-identifier hs-type">stdKeepAliveRngIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span>
</span><span id="line-722"></span><span id="stdKeepAliveRngIO"><span class="annot"><span class="annottext">stdKeepAliveRngIO :: IO StdGen
</span><a href="Ouroboros.Consensus.Node.html#stdKeepAliveRngIO"><span class="hs-identifier hs-var hs-var">stdKeepAliveRngIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO StdGen
forall (m :: * -&gt; *). MonadIO m =&gt; m StdGen
</span><span class="hs-identifier hs-var">newStdGen</span></span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdChainSyncTimeout"><span class="hs-identifier hs-type">stdChainSyncTimeout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NTN.ChainSyncTimeout</span></span><span>
</span><span id="line-725"></span><span id="stdChainSyncTimeout"><span class="annot"><span class="annottext">stdChainSyncTimeout :: IO ChainSyncTimeout
</span><a href="Ouroboros.Consensus.Node.html#stdChainSyncTimeout"><span class="hs-identifier hs-var hs-var">stdChainSyncTimeout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-726"></span><span>    </span><span class="hs-comment">-- These values approximately correspond to false positive</span><span>
</span><span id="line-727"></span><span>    </span><span class="hs-comment">-- thresholds for streaks of empty slots with 99% probability,</span><span>
</span><span id="line-728"></span><span>    </span><span class="hs-comment">-- 99.9% probability up to 99.999% probability.</span><span>
</span><span id="line-729"></span><span>    </span><span class="hs-comment">-- t = T_s [log (1-Y) / log (1-f)]</span><span>
</span><span id="line-730"></span><span>    </span><span class="hs-comment">-- Y = [0.99, 0.999...]</span><span>
</span><span id="line-731"></span><span>    </span><span class="hs-comment">-- T_s = slot length of 1s.</span><span>
</span><span id="line-732"></span><span>    </span><span class="hs-comment">-- f = 0.05</span><span>
</span><span id="line-733"></span><span>    </span><span class="hs-comment">-- The timeout is randomly picked per bearer to avoid all bearers</span><span>
</span><span id="line-734"></span><span>    </span><span class="hs-comment">-- going down at the same time in case of a long streak of empty</span><span>
</span><span id="line-735"></span><span>    </span><span class="hs-comment">-- slots.</span><span>
</span><span id="line-736"></span><span>    </span><span class="hs-comment">-- To avoid global synchronosation the timeout is picked uniformly</span><span>
</span><span id="line-737"></span><span>    </span><span class="hs-comment">-- from the interval 135 - 269, corresponds to the a 99.9% to</span><span>
</span><span id="line-738"></span><span>    </span><span class="hs-comment">-- 99.9999% thresholds.</span><span>
</span><span id="line-739"></span><span>    </span><span class="hs-comment">-- TODO: The timeout should be drawn at random everytime chainsync</span><span>
</span><span id="line-740"></span><span>    </span><span class="hs-comment">--       enters the must reply state. A static per connection timeout</span><span>
</span><span id="line-741"></span><span>    </span><span class="hs-comment">--       leads to selection preassure for connections with a large</span><span>
</span><span id="line-742"></span><span>    </span><span class="hs-comment">--       timeout, see #4244.</span><span>
</span><span id="line-743"></span><span>    </span><span id="local-6989586621679186045"><span class="annot"><span class="annottext">Maybe DiffTime
</span><a href="#local-6989586621679186045"><span class="hs-identifier hs-var">mustReplyTimeout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Maybe DiffTime
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(DiffTime -&gt; Maybe DiffTime)
-&gt; (Double -&gt; DiffTime) -&gt; Double -&gt; Maybe DiffTime
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; DiffTime
forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#realToFrac"><span class="hs-identifier hs-var">realToFrac</span></a></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Maybe DiffTime) -&gt; IO Double -&gt; IO (Maybe DiffTime)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Double, Double) -&gt; IO Double
forall a (m :: * -&gt; *). (Random a, MonadIO m) =&gt; (a, a) -&gt; m a
</span><span class="hs-identifier hs-var">randomRIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">135</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">269</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-744"></span><span>    </span><span class="annot"><span class="annottext">ChainSyncTimeout -&gt; IO ChainSyncTimeout
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NTN.ChainSyncTimeout</span></span><span>
</span><span id="line-745"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">canAwaitTimeout :: Maybe DiffTime
</span><span class="hs-identifier hs-var">canAwaitTimeout</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DiffTime
</span><span class="hs-identifier hs-var">shortWait</span></span><span>
</span><span id="line-746"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">intersectTimeout :: Maybe DiffTime
</span><span class="hs-identifier hs-var">intersectTimeout</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DiffTime
</span><span class="hs-identifier hs-var">shortWait</span></span><span>
</span><span id="line-747"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe DiffTime
mustReplyTimeout :: Maybe DiffTime
mustReplyTimeout :: Maybe DiffTime
</span><a href="#local-6989586621679186045"><span class="hs-identifier hs-var hs-var">mustReplyTimeout</span></a></span><span>
</span><span id="line-748"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">idleTimeout :: Maybe DiffTime
</span><span class="hs-identifier hs-var">idleTimeout</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Maybe DiffTime
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">3673</span></span><span>
</span><span id="line-749"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-750"></span><span>
</span><span id="line-751"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdVersionDataNTN"><span class="hs-identifier hs-type">stdVersionDataNTN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NetworkMagic</span></span><span>
</span><span id="line-752"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiffusionMode</span></span><span>
</span><span id="line-753"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerSharing</span></span><span>
</span><span id="line-754"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeToNodeVersionData</span></span><span>
</span><span id="line-755"></span><span id="stdVersionDataNTN"><span class="annot"><span class="annottext">stdVersionDataNTN :: NetworkMagic
-&gt; DiffusionMode -&gt; PeerSharing -&gt; NodeToNodeVersionData
</span><a href="Ouroboros.Consensus.Node.html#stdVersionDataNTN"><span class="hs-identifier hs-var hs-var">stdVersionDataNTN</span></a></span></span><span> </span><span id="local-6989586621679186050"><span class="annot"><span class="annottext">NetworkMagic
</span><a href="#local-6989586621679186050"><span class="hs-identifier hs-var">networkMagic</span></a></span></span><span> </span><span id="local-6989586621679186051"><span class="annot"><span class="annottext">DiffusionMode
</span><a href="#local-6989586621679186051"><span class="hs-identifier hs-var">diffusionMode</span></a></span></span><span> </span><span id="local-6989586621679186052"><span class="annot"><span class="annottext">PeerSharing
</span><a href="#local-6989586621679186052"><span class="hs-identifier hs-var">peerSharing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeToNodeVersionData</span></span><span>
</span><span id="line-756"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">NetworkMagic
networkMagic :: NetworkMagic
networkMagic :: NetworkMagic
</span><a href="#local-6989586621679186050"><span class="hs-identifier hs-var hs-var">networkMagic</span></a></span><span>
</span><span id="line-757"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DiffusionMode
diffusionMode :: DiffusionMode
diffusionMode :: DiffusionMode
</span><a href="#local-6989586621679186051"><span class="hs-identifier hs-var hs-var">diffusionMode</span></a></span><span>
</span><span id="line-758"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PeerSharing
peerSharing :: PeerSharing
peerSharing :: PeerSharing
</span><a href="#local-6989586621679186052"><span class="hs-identifier hs-var hs-var">peerSharing</span></a></span><span>
</span><span id="line-759"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">query :: Bool
</span><span class="hs-identifier hs-var">query</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-760"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-761"></span><span>
</span><span id="line-762"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdVersionDataNTC"><span class="hs-identifier hs-type">stdVersionDataNTC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NetworkMagic</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeToClientVersionData</span></span><span>
</span><span id="line-763"></span><span id="stdVersionDataNTC"><span class="annot"><span class="annottext">stdVersionDataNTC :: NetworkMagic -&gt; NodeToClientVersionData
</span><a href="Ouroboros.Consensus.Node.html#stdVersionDataNTC"><span class="hs-identifier hs-var hs-var">stdVersionDataNTC</span></a></span></span><span> </span><span id="local-6989586621679186058"><span class="annot"><span class="annottext">NetworkMagic
</span><a href="#local-6989586621679186058"><span class="hs-identifier hs-var">networkMagic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeToClientVersionData</span></span><span>
</span><span id="line-764"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">NetworkMagic
networkMagic :: NetworkMagic
networkMagic :: NetworkMagic
</span><a href="#local-6989586621679186058"><span class="hs-identifier hs-var hs-var">networkMagic</span></a></span><span>
</span><span id="line-765"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">query :: Bool
</span><span class="hs-identifier hs-var">query</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-766"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-767"></span><span>
</span><span id="line-768"></span><span id="local-6989586621679185273"><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdRunDataDiffusion"><span class="hs-identifier hs-type">stdRunDataDiffusion</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-769"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.Tracers</span></span><span>
</span><span id="line-770"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">RemoteAddress</span></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NodeToNodeVersion</span></span><span>
</span><span id="line-771"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">LocalAddress</span></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">NodeToClientVersion</span></span><span>
</span><span id="line-772"></span><span>       </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-773"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.ExtraTracers</span></span><span> </span><span class="annot"><a href="#local-6989586621679185273"><span class="hs-identifier hs-type">p2p</span></a></span><span>
</span><span id="line-774"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.Arguments</span></span><span>
</span><span id="line-775"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Socket</span></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">RemoteAddress</span></span><span>
</span><span id="line-776"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">LocalSocket</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LocalAddress</span></span><span>
</span><span id="line-777"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.ExtraArguments</span></span><span> </span><span class="annot"><a href="#local-6989586621679185273"><span class="hs-identifier hs-type">p2p</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-778"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.Applications</span></span><span>
</span><span id="line-779"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">RemoteAddress</span></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NodeToNodeVersion</span></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">NodeToNodeVersionData</span></span><span>
</span><span id="line-780"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">LocalAddress</span></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">NodeToClientVersion</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeToClientVersionData</span></span><span>
</span><span id="line-781"></span><span>       </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.ExitPolicy.html#NodeToNodeInitiatorResult"><span class="hs-identifier hs-type">NodeToNodeInitiatorResult</span></a></span><span>
</span><span id="line-782"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.ExtraApplications</span></span><span> </span><span class="annot"><a href="#local-6989586621679185273"><span class="hs-identifier hs-type">p2p</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RemoteAddress</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.ExitPolicy.html#NodeToNodeInitiatorResult"><span class="hs-identifier hs-type">NodeToNodeInitiatorResult</span></a></span><span>
</span><span id="line-783"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-784"></span><span id="stdRunDataDiffusion"><span class="annot"><span class="annottext">stdRunDataDiffusion :: forall (p2p :: P2P).
Tracers
  RemoteAddress NodeToNodeVersion LocalAddress NodeToClientVersion IO
-&gt; ExtraTracers p2p
-&gt; Arguments Socket RemoteAddress LocalSocket LocalAddress
-&gt; ExtraArguments p2p IO
-&gt; Applications
     RemoteAddress
     NodeToNodeVersion
     NodeToNodeVersionData
     LocalAddress
     NodeToClientVersion
     NodeToClientVersionData
     IO
     NodeToNodeInitiatorResult
-&gt; ExtraApplications p2p RemoteAddress IO NodeToNodeInitiatorResult
-&gt; IO ()
</span><a href="Ouroboros.Consensus.Node.html#stdRunDataDiffusion"><span class="hs-identifier hs-var hs-var">stdRunDataDiffusion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracers
  RemoteAddress NodeToNodeVersion LocalAddress NodeToClientVersion IO
-&gt; ExtraTracers p2p
-&gt; Arguments Socket RemoteAddress LocalSocket LocalAddress
-&gt; ExtraArguments p2p IO
-&gt; Applications
     RemoteAddress
     NodeToNodeVersion
     NodeToNodeVersionData
     LocalAddress
     NodeToClientVersion
     NodeToClientVersionData
     IO
     NodeToNodeInitiatorResult
-&gt; ExtraApplications p2p RemoteAddress IO NodeToNodeInitiatorResult
-&gt; IO ()
forall (p2p :: P2P) a.
Tracers
  RemoteAddress NodeToNodeVersion LocalAddress NodeToClientVersion IO
-&gt; ExtraTracers p2p
-&gt; Arguments Socket RemoteAddress LocalSocket LocalAddress
-&gt; ExtraArguments p2p IO
-&gt; Applications
     RemoteAddress
     NodeToNodeVersion
     NodeToNodeVersionData
     LocalAddress
     NodeToClientVersion
     NodeToClientVersionData
     IO
     a
-&gt; ExtraApplications p2p RemoteAddress IO a
-&gt; IO ()
</span><span class="hs-identifier hs-var">Diffusion.run</span></span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span class="hs-comment">-- | Higher-level arguments that can determine the 'LowLevelRunNodeArgs' under</span><span>
</span><span id="line-787"></span><span class="hs-comment">-- some usual assumptions for realistic use cases such as in @cardano-node@.</span><span>
</span><span id="line-788"></span><span class="hs-comment">--</span><span>
</span><span id="line-789"></span><span class="hs-comment">-- See 'stdLowLevelRunNodeArgsIO'.</span><span>
</span><span id="line-790"></span><span class="hs-keyword">data</span><span> </span><span id="StdRunNodeArgs"><span class="annot"><a href="Ouroboros.Consensus.Node.html#StdRunNodeArgs"><span class="hs-identifier hs-var">StdRunNodeArgs</span></a></span></span><span> </span><span id="local-6989586621679185282"><span class="annot"><a href="#local-6989586621679185282"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679185283"><span class="annot"><a href="#local-6989586621679185283"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679185284"><span class="annot"><a href="#local-6989586621679185284"><span class="hs-identifier hs-type">p2p</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.P2P</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StdRunNodeArgs"><span class="annot"><a href="Ouroboros.Consensus.Node.html#StdRunNodeArgs"><span class="hs-identifier hs-var">StdRunNodeArgs</span></a></span></span><span>
</span><span id="line-791"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="srnBfcMaxConcurrencyBulkSync"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; Maybe Word
</span><a href="Ouroboros.Consensus.Node.html#srnBfcMaxConcurrencyBulkSync"><span class="hs-identifier hs-var hs-var">srnBfcMaxConcurrencyBulkSync</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span>
</span><span id="line-792"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srnBfcMaxConcurrencyDeadline"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; Maybe Word
</span><a href="Ouroboros.Consensus.Node.html#srnBfcMaxConcurrencyDeadline"><span class="hs-identifier hs-var hs-var">srnBfcMaxConcurrencyDeadline</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span>
</span><span id="line-793"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srnChainDbValidateOverride"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; Bool
</span><a href="Ouroboros.Consensus.Node.html#srnChainDbValidateOverride"><span class="hs-identifier hs-var hs-var">srnChainDbValidateOverride</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-794"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ If @True@, validate the ChainDB on init no matter what</span></span><span>
</span><span id="line-795"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srnSnapshotInterval"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; SnapshotInterval
</span><a href="Ouroboros.Consensus.Node.html#srnSnapshotInterval"><span class="hs-identifier hs-var hs-var">srnSnapshotInterval</span></a></span></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SnapshotInterval</span></span><span>
</span><span id="line-796"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srnDatabasePath"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; String
</span><a href="Ouroboros.Consensus.Node.html#srnDatabasePath"><span class="hs-identifier hs-var hs-var">srnDatabasePath</span></a></span></span><span>                 </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-797"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Location of the DBs</span></span><span>
</span><span id="line-798"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srnDiffusionArguments"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p
-&gt; Arguments Socket RemoteAddress LocalSocket LocalAddress
</span><a href="Ouroboros.Consensus.Node.html#srnDiffusionArguments"><span class="hs-identifier hs-var hs-var">srnDiffusionArguments</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.Arguments</span></span><span>
</span><span id="line-799"></span><span>                                         </span><span class="annot"><span class="hs-identifier hs-type">Socket</span></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">RemoteAddress</span></span><span>
</span><span id="line-800"></span><span>                                         </span><span class="annot"><span class="hs-identifier hs-type">LocalSocket</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LocalAddress</span></span><span>
</span><span id="line-801"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srnDiffusionArgumentsExtra"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; ExtraArguments p2p m
</span><a href="Ouroboros.Consensus.Node.html#srnDiffusionArgumentsExtra"><span class="hs-identifier hs-var hs-var">srnDiffusionArgumentsExtra</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.ExtraArguments</span></span><span> </span><span class="annot"><a href="#local-6989586621679185284"><span class="hs-identifier hs-type">p2p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185282"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-802"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srnDiffusionTracers"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p
-&gt; Tracers
     RemoteAddress NodeToNodeVersion LocalAddress NodeToClientVersion IO
</span><a href="Ouroboros.Consensus.Node.html#srnDiffusionTracers"><span class="hs-identifier hs-var hs-var">srnDiffusionTracers</span></a></span></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.Tracers</span></span><span>
</span><span id="line-803"></span><span>                                         </span><span class="annot"><span class="hs-identifier hs-type">RemoteAddress</span></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NodeToNodeVersion</span></span><span>
</span><span id="line-804"></span><span>                                         </span><span class="annot"><span class="hs-identifier hs-type">LocalAddress</span></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">NodeToClientVersion</span></span><span>
</span><span id="line-805"></span><span>                                         </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-806"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srnDiffusionTracersExtra"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; ExtraTracers p2p
</span><a href="Ouroboros.Consensus.Node.html#srnDiffusionTracersExtra"><span class="hs-identifier hs-var hs-var">srnDiffusionTracersExtra</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diffusion.ExtraTracers</span></span><span> </span><span class="annot"><a href="#local-6989586621679185284"><span class="hs-identifier hs-type">p2p</span></a></span><span>
</span><span id="line-807"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srnEnableInDevelopmentVersions"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; Bool
</span><a href="Ouroboros.Consensus.Node.html#srnEnableInDevelopmentVersions"><span class="hs-identifier hs-var hs-var">srnEnableInDevelopmentVersions</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-808"></span><span>    </span><span class="hs-comment">-- ^ If @False@, then the node will limit the negotiated NTN and NTC</span><span>
</span><span id="line-809"></span><span>    </span><span class="hs-comment">-- versions to the latest &quot; official &quot; release (as chosen by Network and</span><span>
</span><span id="line-810"></span><span>    </span><span class="hs-comment">-- Consensus Team, with input from Node Team)</span><span>
</span><span id="line-811"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srnTraceChainDB"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; Tracer m (TraceEvent blk)
</span><a href="Ouroboros.Consensus.Node.html#srnTraceChainDB"><span class="hs-identifier hs-var hs-var">srnTraceChainDB</span></a></span></span><span>                 </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tracer</span></span><span> </span><span class="annot"><a href="#local-6989586621679185282"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ChainDB.TraceEvent</span></span><span> </span><span class="annot"><a href="#local-6989586621679185283"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-812"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srnMaybeMempoolCapacityOverride"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; Maybe MempoolCapacityBytesOverride
</span><a href="Ouroboros.Consensus.Node.html#srnMaybeMempoolCapacityOverride"><span class="hs-identifier hs-var hs-var">srnMaybeMempoolCapacityOverride</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MempoolCapacityBytesOverride</span></span><span>
</span><span id="line-813"></span><span>    </span><span class="hs-comment">-- ^ Determine whether to use the system default mempool capacity or explicitly set</span><span>
</span><span id="line-814"></span><span>    </span><span class="hs-comment">-- capacity of the mempool.</span><span>
</span><span id="line-815"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="srnChainSyncTimeout"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; Maybe (m ChainSyncTimeout)
</span><a href="Ouroboros.Consensus.Node.html#srnChainSyncTimeout"><span class="hs-identifier hs-var hs-var">srnChainSyncTimeout</span></a></span></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679185282"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NTN.ChainSyncTimeout</span></span><span class="hs-special">)</span><span>
</span><span id="line-816"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ A custom timeout for ChainSync.</span></span><span>
</span><span id="line-817"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span class="hs-comment">-- | Conveniently packaged 'LowLevelRunNodeArgs' arguments from a standard</span><span>
</span><span id="line-820"></span><span class="hs-comment">-- non-testing invocation.</span><span>
</span><span id="line-821"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#stdLowLevelRunNodeArgsIO"><span class="hs-identifier hs-type">stdLowLevelRunNodeArgsIO</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-822"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679184848"><span class="annot"><a href="#local-6989586621679184848"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span id="local-6989586621679184849"><span class="annot"><a href="#local-6989586621679184849"><span class="hs-identifier hs-type">p2p</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RunNode</span></span><span> </span><span class="annot"><a href="#local-6989586621679184848"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-823"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#RunNodeArgs"><span class="hs-identifier hs-type">RunNodeArgs</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RemoteAddress</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LocalAddress</span></span><span> </span><span class="annot"><a href="#local-6989586621679184848"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184849"><span class="hs-identifier hs-type">p2p</span></a></span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#StdRunNodeArgs"><span class="hs-identifier hs-type">StdRunNodeArgs</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184848"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184849"><span class="hs-identifier hs-type">p2p</span></a></span><span>
</span><span id="line-825"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Node.html#LowLevelRunNodeArgs"><span class="hs-identifier hs-type">LowLevelRunNodeArgs</span></a></span><span>
</span><span id="line-826"></span><span>          </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-827"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">RemoteAddress</span></span><span>
</span><span id="line-828"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">LocalAddress</span></span><span>
</span><span id="line-829"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">NodeToNodeVersionData</span></span><span>
</span><span id="line-830"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">NodeToClientVersionData</span></span><span>
</span><span id="line-831"></span><span>          </span><span class="annot"><a href="#local-6989586621679184848"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-832"></span><span>          </span><span class="annot"><a href="#local-6989586621679184849"><span class="hs-identifier hs-type">p2p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-833"></span><span id="stdLowLevelRunNodeArgsIO"><span class="annot"><span class="annottext">stdLowLevelRunNodeArgsIO :: forall blk (p2p :: P2P).
RunNode blk =&gt;
RunNodeArgs IO RemoteAddress LocalAddress blk p2p
-&gt; StdRunNodeArgs IO blk p2p
-&gt; IO
     (LowLevelRunNodeArgs
        IO
        RemoteAddress
        LocalAddress
        NodeToNodeVersionData
        NodeToClientVersionData
        blk
        p2p)
</span><a href="Ouroboros.Consensus.Node.html#stdLowLevelRunNodeArgsIO"><span class="hs-identifier hs-var hs-var">stdLowLevelRunNodeArgsIO</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#RunNodeArgs"><span class="hs-identifier hs-type">RunNodeArgs</span></a></span><span class="hs-special">{</span><span> </span><span id="local-6989586621679186100"><span class="annot"><span class="annottext">ProtocolInfo blk
rnProtocolInfo :: forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p -&gt; ProtocolInfo blk
rnProtocolInfo :: ProtocolInfo blk
</span><a href="Ouroboros.Consensus.Node.html#rnProtocolInfo"><span class="hs-identifier hs-var hs-var">rnProtocolInfo</span></a></span></span><span>
</span><span id="line-834"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679186101"><span class="annot"><span class="annottext">NetworkP2PMode p2p
rnEnableP2P :: forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p -&gt; NetworkP2PMode p2p
rnEnableP2P :: NetworkP2PMode p2p
</span><a href="Ouroboros.Consensus.Node.html#rnEnableP2P"><span class="hs-identifier hs-var hs-var">rnEnableP2P</span></a></span></span><span>
</span><span id="line-835"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679186102"><span class="annot"><span class="annottext">PeerSharing
rnPeerSharing :: forall (m :: * -&gt; *) addrNTN addrNTC blk (p2p :: P2P).
RunNodeArgs m addrNTN addrNTC blk p2p -&gt; PeerSharing
rnPeerSharing :: PeerSharing
</span><a href="Ouroboros.Consensus.Node.html#rnPeerSharing"><span class="hs-identifier hs-var hs-var">rnPeerSharing</span></a></span></span><span>
</span><span id="line-836"></span><span>                                    </span><span class="hs-special">}</span><span>
</span><span id="line-837"></span><span>                         </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#StdRunNodeArgs"><span class="hs-identifier hs-type">StdRunNodeArgs</span></a></span><span class="hs-special">{</span><span id="local-6989586621679186103"><span id="local-6989586621679186104"><span id="local-6989586621679186105"><span id="local-6989586621679186106"><span id="local-6989586621679186107"><span id="local-6989586621679186108"><span id="local-6989586621679186109"><span id="local-6989586621679186110"><span id="local-6989586621679186111"><span id="local-6989586621679186112"><span id="local-6989586621679186113"><span id="local-6989586621679186114"><span id="local-6989586621679186115"><span class="annot"><span class="annottext">Bool
String
Maybe (IO ChainSyncTimeout)
Maybe Word
Maybe MempoolCapacityBytesOverride
Tracer IO (TraceEvent blk)
SnapshotInterval
ExtraArguments p2p IO
ExtraTracers p2p
Arguments Socket RemoteAddress LocalSocket LocalAddress
Tracers
  RemoteAddress NodeToNodeVersion LocalAddress NodeToClientVersion IO
srnBfcMaxConcurrencyBulkSync :: forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; Maybe Word
srnBfcMaxConcurrencyDeadline :: forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; Maybe Word
srnChainDbValidateOverride :: forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; Bool
srnSnapshotInterval :: forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; SnapshotInterval
srnDatabasePath :: forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; String
srnDiffusionArguments :: forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p
-&gt; Arguments Socket RemoteAddress LocalSocket LocalAddress
srnDiffusionArgumentsExtra :: forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; ExtraArguments p2p m
srnDiffusionTracers :: forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p
-&gt; Tracers
     RemoteAddress NodeToNodeVersion LocalAddress NodeToClientVersion IO
srnDiffusionTracersExtra :: forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; ExtraTracers p2p
srnEnableInDevelopmentVersions :: forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; Bool
srnTraceChainDB :: forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; Tracer m (TraceEvent blk)
srnMaybeMempoolCapacityOverride :: forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; Maybe MempoolCapacityBytesOverride
srnChainSyncTimeout :: forall (m :: * -&gt; *) blk (p2p :: P2P).
StdRunNodeArgs m blk p2p -&gt; Maybe (m ChainSyncTimeout)
srnBfcMaxConcurrencyBulkSync :: Maybe Word
srnBfcMaxConcurrencyDeadline :: Maybe Word
srnChainDbValidateOverride :: Bool
srnSnapshotInterval :: SnapshotInterval
srnDatabasePath :: String
srnDiffusionArguments :: Arguments Socket RemoteAddress LocalSocket LocalAddress
srnDiffusionArgumentsExtra :: ExtraArguments p2p IO
srnDiffusionTracers :: Tracers
  RemoteAddress NodeToNodeVersion LocalAddress NodeToClientVersion IO
srnDiffusionTracersExtra :: ExtraTracers p2p
srnEnableInDevelopmentVersions :: Bool
srnTraceChainDB :: Tracer IO (TraceEvent blk)
srnMaybeMempoolCapacityOverride :: Maybe MempoolCapacityBytesOverride
srnChainSyncTimeout :: Maybe (IO ChainSyncTimeout)
</span><a href="Ouroboros.Consensus.Node.html#srnBfcMaxConcurrencyBulkSync"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-838"></span><span>    </span><span id="local-6989586621679186116"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679186116"><span class="hs-identifier hs-var">llrnBfcSalt</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="Ouroboros.Consensus.Node.html#stdBfcSaltIO"><span class="hs-identifier hs-var">stdBfcSaltIO</span></a></span><span>
</span><span id="line-839"></span><span>    </span><span id="local-6989586621679186117"><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679186117"><span class="hs-identifier hs-var">llrnKeepAliveRng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO StdGen
</span><a href="Ouroboros.Consensus.Node.html#stdKeepAliveRngIO"><span class="hs-identifier hs-var">stdKeepAliveRngIO</span></a></span><span>
</span><span id="line-840"></span><span>    </span><span class="annot"><span class="annottext">LowLevelRunNodeArgs
  IO
  RemoteAddress
  LocalAddress
  NodeToNodeVersionData
  NodeToClientVersionData
  blk
  p2p
-&gt; IO
     (LowLevelRunNodeArgs
        IO
        RemoteAddress
        LocalAddress
        NodeToNodeVersionData
        NodeToClientVersionData
        blk
        p2p)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#LowLevelRunNodeArgs"><span class="hs-identifier hs-type">LowLevelRunNodeArgs</span></a></span><span>
</span><span id="line-841"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Int
llrnBfcSalt :: Int
llrnBfcSalt :: Int
</span><a href="Ouroboros.Consensus.Node.html#llrnBfcSalt"><span class="hs-identifier hs-var hs-var">llrnBfcSalt</span></a></span><span>
</span><span id="line-842"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">llrnChainSyncTimeout :: IO ChainSyncTimeout
</span><a href="Ouroboros.Consensus.Node.html#llrnChainSyncTimeout"><span class="hs-identifier hs-var">llrnChainSyncTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ChainSyncTimeout
-&gt; Maybe (IO ChainSyncTimeout) -&gt; IO ChainSyncTimeout
forall a. a -&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">IO ChainSyncTimeout
</span><a href="Ouroboros.Consensus.Node.html#stdChainSyncTimeout"><span class="hs-identifier hs-var">stdChainSyncTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (IO ChainSyncTimeout)
</span><a href="#local-6989586621679186115"><span class="hs-identifier hs-var">srnChainSyncTimeout</span></a></span><span>
</span><span id="line-843"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">llrnCustomiseHardForkBlockchainTimeArgs :: HardForkBlockchainTimeArgs IO blk
-&gt; HardForkBlockchainTimeArgs IO blk
</span><a href="Ouroboros.Consensus.Node.html#llrnCustomiseHardForkBlockchainTimeArgs"><span class="hs-identifier hs-var">llrnCustomiseHardForkBlockchainTimeArgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HardForkBlockchainTimeArgs IO blk
-&gt; HardForkBlockchainTimeArgs IO blk
forall a. a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-844"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StdGen
llrnKeepAliveRng :: StdGen
llrnKeepAliveRng :: StdGen
</span><a href="Ouroboros.Consensus.Node.html#llrnKeepAliveRng"><span class="hs-identifier hs-var hs-var">llrnKeepAliveRng</span></a></span><span>
</span><span id="line-845"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">llrnChainDbArgsDefaults :: ChainDbArgs Defaults IO blk
</span><a href="Ouroboros.Consensus.Node.html#llrnChainDbArgsDefaults"><span class="hs-identifier hs-var">llrnChainDbArgsDefaults</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-846"></span><span>          </span><span class="annot"><span class="annottext">ChainDbArgs Defaults IO blk -&gt; ChainDbArgs Defaults IO blk
</span><a href="#local-6989586621679186119"><span class="hs-identifier hs-var">updateChainDbDefaults</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainDbArgs Defaults IO blk -&gt; ChainDbArgs Defaults IO blk)
-&gt; ChainDbArgs Defaults IO blk -&gt; ChainDbArgs Defaults IO blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(RelativeMountPoint -&gt; SomeHasFS IO)
-&gt; DiskPolicy -&gt; ChainDbArgs Defaults IO blk
forall (m :: * -&gt; *) blk.
Monad m =&gt;
(RelativeMountPoint -&gt; SomeHasFS m)
-&gt; DiskPolicy -&gt; ChainDbArgs Defaults m blk
</span><span class="hs-identifier hs-var">ChainDB.defaultArgs</span></span><span> </span><span class="annot"><span class="annottext">RelativeMountPoint -&gt; SomeHasFS IO
</span><a href="#local-6989586621679186121"><span class="hs-identifier hs-var">mkHasFS</span></a></span><span> </span><span class="annot"><span class="annottext">DiskPolicy
</span><a href="#local-6989586621679186122"><span class="hs-identifier hs-var">diskPolicy</span></a></span><span>
</span><span id="line-847"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">llrnCustomiseChainDbArgs :: ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
</span><a href="Ouroboros.Consensus.Node.html#llrnCustomiseChainDbArgs"><span class="hs-identifier hs-var">llrnCustomiseChainDbArgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
forall a. a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-848"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs IO RemoteAddress (ConnectionId LocalAddress) blk
-&gt; NodeKernelArgs IO RemoteAddress (ConnectionId LocalAddress) blk
forall (m :: * -&gt; *) addrNTN addrNTC.
NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
llrnCustomiseNodeKernelArgs :: NodeKernelArgs IO RemoteAddress (ConnectionId LocalAddress) blk
-&gt; NodeKernelArgs IO RemoteAddress (ConnectionId LocalAddress) blk
llrnCustomiseNodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC.
NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="Ouroboros.Consensus.Node.html#llrnCustomiseNodeKernelArgs"><span class="hs-identifier hs-var hs-var">llrnCustomiseNodeKernelArgs</span></a></span><span>
</span><span id="line-849"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">llrnRunDataDiffusion :: ResourceRegistry IO
-&gt; Applications
     RemoteAddress
     NodeToNodeVersion
     NodeToNodeVersionData
     LocalAddress
     NodeToClientVersion
     NodeToClientVersionData
     IO
     NodeToNodeInitiatorResult
-&gt; ExtraApplications p2p RemoteAddress IO NodeToNodeInitiatorResult
-&gt; IO ()
</span><a href="Ouroboros.Consensus.Node.html#llrnRunDataDiffusion"><span class="hs-identifier hs-var">llrnRunDataDiffusion</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-850"></span><span>          </span><span class="hs-glyph">\</span><span id="local-6989586621679186124"><span class="annot"><span class="annottext">ResourceRegistry IO
</span><a href="#local-6989586621679186124"><span class="hs-identifier hs-var">_reg</span></a></span></span><span> </span><span id="local-6989586621679186125"><span class="annot"><span class="annottext">Applications
  RemoteAddress
  NodeToNodeVersion
  NodeToNodeVersionData
  LocalAddress
  NodeToClientVersion
  NodeToClientVersionData
  IO
  NodeToNodeInitiatorResult
</span><a href="#local-6989586621679186125"><span class="hs-identifier hs-var">apps</span></a></span></span><span> </span><span id="local-6989586621679186126"><span class="annot"><span class="annottext">ExtraApplications p2p RemoteAddress IO NodeToNodeInitiatorResult
</span><a href="#local-6989586621679186126"><span class="hs-identifier hs-var">extraApps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-851"></span><span>            </span><span class="annot"><span class="annottext">Tracers
  RemoteAddress NodeToNodeVersion LocalAddress NodeToClientVersion IO
-&gt; ExtraTracers p2p
-&gt; Arguments Socket RemoteAddress LocalSocket LocalAddress
-&gt; ExtraArguments p2p IO
-&gt; Applications
     RemoteAddress
     NodeToNodeVersion
     NodeToNodeVersionData
     LocalAddress
     NodeToClientVersion
     NodeToClientVersionData
     IO
     NodeToNodeInitiatorResult
-&gt; ExtraApplications p2p RemoteAddress IO NodeToNodeInitiatorResult
-&gt; IO ()
forall (p2p :: P2P).
Tracers
  RemoteAddress NodeToNodeVersion LocalAddress NodeToClientVersion IO
-&gt; ExtraTracers p2p
-&gt; Arguments Socket RemoteAddress LocalSocket LocalAddress
-&gt; ExtraArguments p2p IO
-&gt; Applications
     RemoteAddress
     NodeToNodeVersion
     NodeToNodeVersionData
     LocalAddress
     NodeToClientVersion
     NodeToClientVersionData
     IO
     NodeToNodeInitiatorResult
-&gt; ExtraApplications p2p RemoteAddress IO NodeToNodeInitiatorResult
-&gt; IO ()
</span><a href="Ouroboros.Consensus.Node.html#stdRunDataDiffusion"><span class="hs-identifier hs-var">stdRunDataDiffusion</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers
  RemoteAddress NodeToNodeVersion LocalAddress NodeToClientVersion IO
</span><a href="#local-6989586621679186110"><span class="hs-identifier hs-var">srnDiffusionTracers</span></a></span><span>
</span><span id="line-852"></span><span>                                </span><span class="annot"><span class="annottext">ExtraTracers p2p
</span><a href="#local-6989586621679186111"><span class="hs-identifier hs-var">srnDiffusionTracersExtra</span></a></span><span>
</span><span id="line-853"></span><span>                                </span><span class="annot"><span class="annottext">Arguments Socket RemoteAddress LocalSocket LocalAddress
</span><a href="#local-6989586621679186108"><span class="hs-identifier hs-var">srnDiffusionArguments</span></a></span><span>
</span><span id="line-854"></span><span>                                </span><span class="annot"><span class="annottext">ExtraArguments p2p IO
</span><a href="#local-6989586621679186109"><span class="hs-identifier hs-var">srnDiffusionArgumentsExtra</span></a></span><span>
</span><span id="line-855"></span><span>                                </span><span class="annot"><span class="annottext">Applications
  RemoteAddress
  NodeToNodeVersion
  NodeToNodeVersionData
  LocalAddress
  NodeToClientVersion
  NodeToClientVersionData
  IO
  NodeToNodeInitiatorResult
</span><a href="#local-6989586621679186125"><span class="hs-identifier hs-var">apps</span></a></span><span> </span><span class="annot"><span class="annottext">ExtraApplications p2p RemoteAddress IO NodeToNodeInitiatorResult
</span><a href="#local-6989586621679186126"><span class="hs-identifier hs-var">extraApps</span></a></span><span>
</span><span id="line-856"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">llrnVersionDataNTC :: NodeToClientVersionData
</span><a href="Ouroboros.Consensus.Node.html#llrnVersionDataNTC"><span class="hs-identifier hs-var">llrnVersionDataNTC</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-857"></span><span>          </span><span class="annot"><span class="annottext">NetworkMagic -&gt; NodeToClientVersionData
</span><a href="Ouroboros.Consensus.Node.html#stdVersionDataNTC"><span class="hs-identifier hs-var">stdVersionDataNTC</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkMagic
</span><a href="#local-6989586621679186127"><span class="hs-identifier hs-var">networkMagic</span></a></span><span>
</span><span id="line-858"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">llrnVersionDataNTN :: NodeToNodeVersionData
</span><a href="Ouroboros.Consensus.Node.html#llrnVersionDataNTN"><span class="hs-identifier hs-var">llrnVersionDataNTN</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-859"></span><span>          </span><span class="annot"><span class="annottext">NetworkMagic
-&gt; DiffusionMode -&gt; PeerSharing -&gt; NodeToNodeVersionData
</span><a href="Ouroboros.Consensus.Node.html#stdVersionDataNTN"><span class="hs-identifier hs-var">stdVersionDataNTN</span></a></span><span>
</span><span id="line-860"></span><span>            </span><span class="annot"><span class="annottext">NetworkMagic
</span><a href="#local-6989586621679186127"><span class="hs-identifier hs-var">networkMagic</span></a></span><span>
</span><span id="line-861"></span><span>            </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NetworkP2PMode p2p
</span><a href="#local-6989586621679186101"><span class="hs-identifier hs-var">rnEnableP2P</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-862"></span><span>               </span><span class="annot"><span class="annottext">NetworkP2PMode p2p
</span><a href="Ouroboros.Consensus.Node.html#EnabledP2PMode"><span class="hs-identifier hs-var">EnabledP2PMode</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Arguments Socket RemoteAddress LocalSocket LocalAddress
-&gt; DiffusionMode
forall ntnFd ntnAddr ntcFd ntcAddr.
Arguments ntnFd ntnAddr ntcFd ntcAddr -&gt; DiffusionMode
</span><span class="hs-identifier hs-var">Diffusion.daMode</span></span><span> </span><span class="annot"><span class="annottext">Arguments Socket RemoteAddress LocalSocket LocalAddress
</span><a href="#local-6989586621679186108"><span class="hs-identifier hs-var">srnDiffusionArguments</span></a></span><span>
</span><span id="line-863"></span><span>               </span><span class="hs-comment">-- Every connection in non-p2p mode is unidirectional; We connect</span><span>
</span><span id="line-864"></span><span>               </span><span class="hs-comment">-- from an ephemeral port.  We still pass `srnDiffusionArguments`</span><span>
</span><span id="line-865"></span><span>               </span><span class="hs-comment">-- to the diffusion layer, so the server side will be run also in</span><span>
</span><span id="line-866"></span><span>               </span><span class="hs-comment">-- `InitiatorAndResponderDiffusionMode`.</span><span>
</span><span id="line-867"></span><span>               </span><span class="annot"><span class="annottext">NetworkP2PMode p2p
</span><a href="Ouroboros.Consensus.Node.html#DisabledP2PMode"><span class="hs-identifier hs-var">DisabledP2PMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DiffusionMode
</span><span class="hs-identifier hs-var">InitiatorOnlyDiffusionMode</span></span><span>
</span><span id="line-868"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-869"></span><span>            </span><span class="annot"><span class="annottext">PeerSharing
</span><a href="#local-6989586621679186102"><span class="hs-identifier hs-var">rnPeerSharing</span></a></span><span>
</span><span id="line-870"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">llrnNodeToNodeVersions :: Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
</span><a href="Ouroboros.Consensus.Node.html#llrnNodeToNodeVersions"><span class="hs-identifier hs-var">llrnNodeToNodeVersions</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-871"></span><span>          </span><span class="annot"><span class="annottext">((Maybe NodeToNodeVersion, Maybe NodeToClientVersion)
 -&gt; Maybe NodeToNodeVersion)
-&gt; Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
-&gt; Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
forall k v.
Ord k =&gt;
((Maybe NodeToNodeVersion, Maybe NodeToClientVersion) -&gt; Maybe k)
-&gt; Map k v -&gt; Map k v
</span><a href="#local-6989586621679186132"><span class="hs-identifier hs-var">limitToLatestReleasedVersion</span></a></span><span>
</span><span id="line-872"></span><span>            </span><span class="annot"><span class="annottext">(Maybe NodeToNodeVersion, Maybe NodeToClientVersion)
-&gt; Maybe NodeToNodeVersion
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span>
</span><span id="line-873"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
forall blk.
SupportedNetworkProtocolVersion blk =&gt;
Proxy blk -&gt; Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
</span><span class="hs-identifier hs-var">supportedNodeToNodeVersions</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall t. Proxy t
forall {k} (t :: k). Proxy t
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Proxy.html#Proxy"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679184848"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-874"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">llrnNodeToClientVersions :: Map NodeToClientVersion (BlockNodeToClientVersion blk)
</span><a href="Ouroboros.Consensus.Node.html#llrnNodeToClientVersions"><span class="hs-identifier hs-var">llrnNodeToClientVersions</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-875"></span><span>          </span><span class="annot"><span class="annottext">((Maybe NodeToNodeVersion, Maybe NodeToClientVersion)
 -&gt; Maybe NodeToClientVersion)
-&gt; Map NodeToClientVersion (BlockNodeToClientVersion blk)
-&gt; Map NodeToClientVersion (BlockNodeToClientVersion blk)
forall k v.
Ord k =&gt;
((Maybe NodeToNodeVersion, Maybe NodeToClientVersion) -&gt; Maybe k)
-&gt; Map k v -&gt; Map k v
</span><a href="#local-6989586621679186132"><span class="hs-identifier hs-var">limitToLatestReleasedVersion</span></a></span><span>
</span><span id="line-876"></span><span>            </span><span class="annot"><span class="annottext">(Maybe NodeToNodeVersion, Maybe NodeToClientVersion)
-&gt; Maybe NodeToClientVersion
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span>
</span><span id="line-877"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy blk -&gt; Map NodeToClientVersion (BlockNodeToClientVersion blk)
forall blk.
SupportedNetworkProtocolVersion blk =&gt;
Proxy blk -&gt; Map NodeToClientVersion (BlockNodeToClientVersion blk)
</span><span class="hs-identifier hs-var">supportedNodeToClientVersions</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall t. Proxy t
forall {k} (t :: k). Proxy t
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Proxy.html#Proxy"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679184848"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-878"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">llrnWithCheckedDB :: forall a.
(LastShutDownWasClean -&gt; (ChainDB IO blk -&gt; IO a -&gt; IO a) -&gt; IO a)
-&gt; IO a
</span><a href="Ouroboros.Consensus.Node.html#llrnWithCheckedDB"><span class="hs-identifier hs-var">llrnWithCheckedDB</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-879"></span><span>          </span><span class="annot"><span class="annottext">Proxy blk
-&gt; String
-&gt; NetworkMagic
-&gt; (LastShutDownWasClean
    -&gt; (ChainDB IO blk -&gt; IO a -&gt; IO a) -&gt; IO a)
-&gt; IO a
forall blk a.
(StandardHash blk, Typeable blk) =&gt;
Proxy blk
-&gt; String
-&gt; NetworkMagic
-&gt; (LastShutDownWasClean
    -&gt; (ChainDB IO blk -&gt; IO a -&gt; IO a) -&gt; IO a)
-&gt; IO a
</span><a href="Ouroboros.Consensus.Node.html#stdWithCheckedDB"><span class="hs-identifier hs-var">stdWithCheckedDB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall t. Proxy t
forall {k} (t :: k). Proxy t
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Proxy.html#Proxy"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679184848"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679186107"><span class="hs-identifier hs-var">srnDatabasePath</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkMagic
</span><a href="#local-6989586621679186127"><span class="hs-identifier hs-var">networkMagic</span></a></span><span>
</span><span id="line-880"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">llrnMaxClockSkew :: ClockSkew
</span><a href="Ouroboros.Consensus.Node.html#llrnMaxClockSkew"><span class="hs-identifier hs-var">llrnMaxClockSkew</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-881"></span><span>          </span><span class="annot"><span class="annottext">ClockSkew
</span><span class="hs-identifier hs-var">InFuture.defaultClockSkew</span></span><span>
</span><span id="line-882"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-883"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-884"></span><span>    </span><span id="local-6989586621679186122"><span class="annot"><span class="annottext">diskPolicy :: DiskPolicy
</span><a href="#local-6989586621679186122"><span class="hs-identifier hs-var hs-var">diskPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-885"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-886"></span><span>        </span><span id="local-6989586621679186140"><span class="annot"><span class="annottext">cfg :: TopLevelConfig blk
</span><a href="#local-6989586621679186140"><span class="hs-identifier hs-var hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolInfo blk -&gt; TopLevelConfig blk
forall b. ProtocolInfo b -&gt; TopLevelConfig b
</span><span class="hs-identifier hs-var">pInfoConfig</span></span><span> </span><span class="annot"><span class="annottext">ProtocolInfo blk
</span><a href="#local-6989586621679186100"><span class="hs-identifier hs-var">rnProtocolInfo</span></a></span><span>
</span><span id="line-887"></span><span>        </span><span id="local-6989586621679186141"><span class="annot"><span class="annottext">k :: SecurityParam
</span><a href="#local-6989586621679186141"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; SecurityParam
forall blk.
ConsensusProtocol (BlockProtocol blk) =&gt;
TopLevelConfig blk -&gt; SecurityParam
</span><span class="hs-identifier hs-var">configSecurityParam</span></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679186140"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-888"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SecurityParam -&gt; SnapshotInterval -&gt; DiskPolicy
</span><span class="hs-identifier hs-var">defaultDiskPolicy</span></span><span> </span><span class="annot"><span class="annottext">SecurityParam
</span><a href="#local-6989586621679186141"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotInterval
</span><a href="#local-6989586621679186106"><span class="hs-identifier hs-var">srnSnapshotInterval</span></a></span><span>
</span><span id="line-889"></span><span>
</span><span id="line-890"></span><span>    </span><span class="annot"><a href="#local-6989586621679186121"><span class="hs-identifier hs-type">mkHasFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ChainDB.RelativeMountPoint</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeHasFS</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-891"></span><span>    </span><span id="local-6989586621679186121"><span class="annot"><span class="annottext">mkHasFS :: RelativeMountPoint -&gt; SomeHasFS IO
</span><a href="#local-6989586621679186121"><span class="hs-identifier hs-var hs-var">mkHasFS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; RelativeMountPoint -&gt; SomeHasFS IO
</span><a href="Ouroboros.Consensus.Node.html#stdMkChainDbHasFS"><span class="hs-identifier hs-var">stdMkChainDbHasFS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679186107"><span class="hs-identifier hs-var">srnDatabasePath</span></a></span><span>
</span><span id="line-892"></span><span>
</span><span id="line-893"></span><span>    </span><span class="annot"><a href="#local-6989586621679186127"><span class="hs-identifier hs-type">networkMagic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NetworkMagic</span></span><span>
</span><span id="line-894"></span><span>    </span><span id="local-6989586621679186127"><span class="annot"><span class="annottext">networkMagic :: NetworkMagic
</span><a href="#local-6989586621679186127"><span class="hs-identifier hs-var hs-var">networkMagic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockConfig blk -&gt; NetworkMagic
forall blk.
ConfigSupportsNode blk =&gt;
BlockConfig blk -&gt; NetworkMagic
</span><span class="hs-identifier hs-var">getNetworkMagic</span></span><span> </span><span class="annot"><span class="annottext">(BlockConfig blk -&gt; NetworkMagic)
-&gt; BlockConfig blk -&gt; NetworkMagic
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; BlockConfig blk
forall blk. TopLevelConfig blk -&gt; BlockConfig blk
</span><span class="hs-identifier hs-var">configBlock</span></span><span> </span><span class="annot"><span class="annottext">(TopLevelConfig blk -&gt; BlockConfig blk)
-&gt; TopLevelConfig blk -&gt; BlockConfig blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolInfo blk -&gt; TopLevelConfig blk
forall b. ProtocolInfo b -&gt; TopLevelConfig b
</span><span class="hs-identifier hs-var">pInfoConfig</span></span><span> </span><span class="annot"><span class="annottext">ProtocolInfo blk
</span><a href="#local-6989586621679186100"><span class="hs-identifier hs-var">rnProtocolInfo</span></a></span><span>
</span><span id="line-895"></span><span>
</span><span id="line-896"></span><span>    </span><span class="annot"><a href="#local-6989586621679186119"><span class="hs-identifier hs-type">updateChainDbDefaults</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-897"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">ChainDbArgs</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defaults</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184848"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-898"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ChainDbArgs</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defaults</span></span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679184848"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-899"></span><span>    </span><span id="local-6989586621679186119"><span class="annot"><span class="annottext">updateChainDbDefaults :: ChainDbArgs Defaults IO blk -&gt; ChainDbArgs Defaults IO blk
</span><a href="#local-6989586621679186119"><span class="hs-identifier hs-var hs-var">updateChainDbDefaults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-900"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679186144"><span class="annot"><span class="annottext">ChainDbArgs Defaults IO blk
</span><a href="#local-6989586621679186144"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Defaults IO blk
</span><a href="#local-6989586621679186144"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">ChainDB.cdbTracer</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679186113"><span class="hs-identifier hs-type">srnTraceChainDB</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ChainDbArgs Defaults IO blk -&gt; ChainDbArgs Defaults IO blk)
-&gt; (ChainDbArgs Defaults IO blk -&gt; ChainDbArgs Defaults IO blk)
-&gt; ChainDbArgs Defaults IO blk
-&gt; ChainDbArgs Defaults IO blk
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-901"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679186105"><span class="hs-identifier hs-var">srnChainDbValidateOverride</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Defaults IO blk -&gt; ChainDbArgs Defaults IO blk
forall a. a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679186147"><span class="annot"><span class="annottext">ChainDbArgs Defaults IO blk
</span><a href="#local-6989586621679186147"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Defaults IO blk
</span><a href="#local-6989586621679186147"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-902"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">ChainDB.cdbImmutableDbValidation</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ValidateAllChunks</span></span><span>
</span><span id="line-903"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">ChainDB.cdbVolatileDbValidation</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ValidateAll</span></span><span>
</span><span id="line-904"></span><span>          </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span>    </span><span id="local-6989586621679185336"><span id="local-6989586621679185337"><span id="local-6989586621679185338"><span class="annot"><a href="#local-6989586621679186123"><span class="hs-identifier hs-type">llrnCustomiseNodeKernelArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-907"></span><span>         </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185336"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185337"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679185338"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679184848"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-908"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185336"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185337"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679185338"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679184848"><span class="hs-identifier hs-type">blk</span></a></span></span></span></span><span>
</span><span id="line-909"></span><span>    </span><span id="local-6989586621679186123"><span class="annot"><span class="annottext">llrnCustomiseNodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC.
NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679186123"><span class="hs-identifier hs-var hs-var">llrnCustomiseNodeKernelArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-910"></span><span>        </span><span class="annot"><span class="annottext">(BlockFetchConfiguration -&gt; BlockFetchConfiguration)
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
forall (m :: * -&gt; *) addrNTN addrNTC blk.
(BlockFetchConfiguration -&gt; BlockFetchConfiguration)
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="Ouroboros.Consensus.Node.html#overBlockFetchConfiguration"><span class="hs-identifier hs-var">overBlockFetchConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">BlockFetchConfiguration -&gt; BlockFetchConfiguration
</span><a href="#local-6989586621679186149"><span class="hs-identifier hs-var">modifyBlockFetchConfiguration</span></a></span><span>
</span><span id="line-911"></span><span>      </span><span class="annot"><span class="annottext">(NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
 -&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
-&gt; (NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
    -&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679186150"><span class="hs-identifier hs-var">modifyMempoolCapacityOverride</span></a></span><span>
</span><span id="line-912"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-913"></span><span>        </span><span id="local-6989586621679186149"><span class="annot"><span class="annottext">modifyBlockFetchConfiguration :: BlockFetchConfiguration -&gt; BlockFetchConfiguration
</span><a href="#local-6989586621679186149"><span class="hs-identifier hs-var hs-var">modifyBlockFetchConfiguration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-914"></span><span>            </span><span class="annot"><span class="annottext">(BlockFetchConfiguration -&gt; BlockFetchConfiguration)
-&gt; (Word -&gt; BlockFetchConfiguration -&gt; BlockFetchConfiguration)
-&gt; Maybe Word
-&gt; BlockFetchConfiguration
-&gt; BlockFetchConfiguration
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">BlockFetchConfiguration -&gt; BlockFetchConfiguration
forall a. a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-915"></span><span>              </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679186151"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679186151"><span class="hs-identifier hs-var">mc</span></a></span></span><span> </span><span id="local-6989586621679186152"><span class="annot"><span class="annottext">BlockFetchConfiguration
</span><a href="#local-6989586621679186152"><span class="hs-identifier hs-var">bfc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BlockFetchConfiguration
</span><a href="#local-6989586621679186152"><span class="hs-identifier hs-var">bfc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">bfcMaxConcurrencyDeadline</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679186151"><span class="hs-identifier hs-type">mc</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-916"></span><span>              </span><span class="annot"><span class="annottext">Maybe Word
</span><a href="#local-6989586621679186104"><span class="hs-identifier hs-var">srnBfcMaxConcurrencyDeadline</span></a></span><span>
</span><span id="line-917"></span><span>          </span><span class="annot"><span class="annottext">(BlockFetchConfiguration -&gt; BlockFetchConfiguration)
-&gt; (BlockFetchConfiguration -&gt; BlockFetchConfiguration)
-&gt; BlockFetchConfiguration
-&gt; BlockFetchConfiguration
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(BlockFetchConfiguration -&gt; BlockFetchConfiguration)
-&gt; (Word -&gt; BlockFetchConfiguration -&gt; BlockFetchConfiguration)
-&gt; Maybe Word
-&gt; BlockFetchConfiguration
-&gt; BlockFetchConfiguration
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">BlockFetchConfiguration -&gt; BlockFetchConfiguration
forall a. a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-918"></span><span>              </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679186153"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679186153"><span class="hs-identifier hs-var">mc</span></a></span></span><span> </span><span id="local-6989586621679186154"><span class="annot"><span class="annottext">BlockFetchConfiguration
</span><a href="#local-6989586621679186154"><span class="hs-identifier hs-var">bfc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BlockFetchConfiguration
</span><a href="#local-6989586621679186154"><span class="hs-identifier hs-var">bfc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">bfcMaxConcurrencyBulkSync</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679186153"><span class="hs-identifier hs-type">mc</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-919"></span><span>              </span><span class="annot"><span class="annottext">Maybe Word
</span><a href="#local-6989586621679186103"><span class="hs-identifier hs-var">srnBfcMaxConcurrencyBulkSync</span></a></span><span>
</span><span id="line-920"></span><span>        </span><span id="local-6989586621679186150"><span class="annot"><span class="annottext">modifyMempoolCapacityOverride :: NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679186150"><span class="hs-identifier hs-var hs-var">modifyMempoolCapacityOverride</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-921"></span><span>            </span><span class="annot"><span class="annottext">(NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
 -&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
-&gt; (MempoolCapacityBytesOverride
    -&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
    -&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk)
-&gt; Maybe MempoolCapacityBytesOverride
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
forall a. a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-922"></span><span>              </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679186155"><span class="annot"><span class="annottext">MempoolCapacityBytesOverride
</span><a href="#local-6989586621679186155"><span class="hs-identifier hs-var">mc</span></a></span></span><span> </span><span id="local-6989586621679186156"><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679186156"><span class="hs-identifier hs-var">nka</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679186156"><span class="hs-identifier hs-var">nka</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AmempoolCapacityOverride%3ANodeKernelArgs"><span class="hs-identifier hs-var">mempoolCapacityOverride</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679186155"><span class="hs-identifier hs-type">mc</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-923"></span><span>              </span><span class="annot"><span class="annottext">Maybe MempoolCapacityBytesOverride
</span><a href="#local-6989586621679186114"><span class="hs-identifier hs-var">srnMaybeMempoolCapacityOverride</span></a></span><span>
</span><span id="line-924"></span><span>
</span><span id="line-925"></span><span>    </span><span class="hs-comment">-- Limit the node version unless srnEnableInDevelopmentVersions is set</span><span>
</span><span id="line-926"></span><span>    </span><span class="annot"><a href="#local-6989586621679186132"><span class="hs-identifier hs-type">limitToLatestReleasedVersion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679185343"><span class="annot"><a href="#local-6989586621679185343"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621679185344"><span class="annot"><a href="#local-6989586621679185344"><span class="hs-identifier hs-type">v</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-927"></span><span>         </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185343"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-928"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeToNodeVersion</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NodeToClientVersion</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185343"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-929"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185343"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185344"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-930"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185343"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185344"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-931"></span><span>    </span><span id="local-6989586621679186132"><span class="annot"><span class="annottext">limitToLatestReleasedVersion :: forall k v.
Ord k =&gt;
((Maybe NodeToNodeVersion, Maybe NodeToClientVersion) -&gt; Maybe k)
-&gt; Map k v -&gt; Map k v
</span><a href="#local-6989586621679186132"><span class="hs-identifier hs-var hs-var">limitToLatestReleasedVersion</span></a></span></span><span> </span><span id="local-6989586621679186160"><span class="annot"><span class="annottext">(Maybe NodeToNodeVersion, Maybe NodeToClientVersion) -&gt; Maybe k
</span><a href="#local-6989586621679186160"><span class="hs-identifier hs-var">prj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-932"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679186112"><span class="hs-identifier hs-var">srnEnableInDevelopmentVersions</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Map k v -&gt; Map k v
forall a. a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-933"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-934"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Maybe NodeToNodeVersion, Maybe NodeToClientVersion) -&gt; Maybe k
</span><a href="#local-6989586621679186160"><span class="hs-identifier hs-var">prj</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe NodeToNodeVersion, Maybe NodeToClientVersion) -&gt; Maybe k)
-&gt; (Maybe NodeToNodeVersion, Maybe NodeToClientVersion) -&gt; Maybe k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy blk -&gt; (Maybe NodeToNodeVersion, Maybe NodeToClientVersion)
forall blk.
SupportedNetworkProtocolVersion blk =&gt;
Proxy blk -&gt; (Maybe NodeToNodeVersion, Maybe NodeToClientVersion)
</span><span class="hs-identifier hs-var">latestReleasedNodeVersion</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall t. Proxy t
forall {k} (t :: k). Proxy t
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Proxy.html#Proxy"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679184848"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-935"></span><span>          </span><span class="annot"><span class="annottext">Maybe k
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map k v -&gt; Map k v
forall a. a -&gt; a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-936"></span><span>          </span><span class="annot"><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679186162"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679186162"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(k -&gt; Bool) -&gt; Map k v -&gt; Map k v
forall k a. (k -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#takeWhileAntitone"><span class="hs-identifier hs-var">Map.takeWhileAntitone</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; k -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/9f69j6hfgwz5xdil7lfn1c1mbhrhidl1-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679186162"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Miscellany
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-941"></span><span>
</span><span id="line-942"></span><span id="local-6989586621679185356"><span id="local-6989586621679185357"><span id="local-6989586621679185358"><span id="local-6989586621679185359"><span class="annot"><a href="Ouroboros.Consensus.Node.html#overBlockFetchConfiguration"><span class="hs-identifier hs-type">overBlockFetchConfiguration</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-943"></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BlockFetchConfiguration</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BlockFetchConfiguration</span></span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185356"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185357"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679185358"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679185359"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-945"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185356"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679185357"><span class="hs-identifier hs-type">addrNTN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><a href="#local-6989586621679185358"><span class="hs-identifier hs-type">addrNTC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679185359"><span class="hs-identifier hs-type">blk</span></a></span></span></span></span></span><span>
</span><span id="line-946"></span><span id="overBlockFetchConfiguration"><span class="annot"><span class="annottext">overBlockFetchConfiguration :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
(BlockFetchConfiguration -&gt; BlockFetchConfiguration)
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
-&gt; NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="Ouroboros.Consensus.Node.html#overBlockFetchConfiguration"><span class="hs-identifier hs-var hs-var">overBlockFetchConfiguration</span></a></span></span><span> </span><span id="local-6989586621679186165"><span class="annot"><span class="annottext">BlockFetchConfiguration -&gt; BlockFetchConfiguration
</span><a href="#local-6989586621679186165"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679186166"><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679186166"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679186166"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-947"></span><span>      </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AblockFetchConfiguration%3ANodeKernelArgs"><span class="hs-identifier hs-var">blockFetchConfiguration</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679186165"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679186167"><span class="hs-identifier hs-type">blockFetchConfiguration</span></a></span><span>
</span><span id="line-948"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-949"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-950"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernelArgs"><span class="hs-identifier hs-type">NodeKernelArgs</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679186167"><span class="annot"><span class="annottext">BlockFetchConfiguration
$sel:blockFetchConfiguration:NodeKernelArgs :: forall (m :: * -&gt; *) addrNTN addrNTC blk.
NodeKernelArgs m addrNTN addrNTC blk -&gt; BlockFetchConfiguration
blockFetchConfiguration :: BlockFetchConfiguration
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AblockFetchConfiguration%3ANodeKernelArgs"><span class="hs-identifier hs-var hs-var">blockFetchConfiguration</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeKernelArgs m addrNTN (ConnectionId addrNTC) blk
</span><a href="#local-6989586621679186166"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-951"></span></pre></body></html>